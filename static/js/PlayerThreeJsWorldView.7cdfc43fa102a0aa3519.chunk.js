"use strict";(self.webpackChunkvisme_web=self.webpackChunkvisme_web||[]).push([[6576,8760,8370],{281079:(fe,Et,Q)=>{Q.r(Et),Q.d(Et,{default:()=>qi});var I=Q(411855),mt=Q(270851),at=Q(55946),E=Q(491530),D=Q(369789),Y=Q(72924),ft=Q(333515),M=Q(674554),q=Q(894639),O=Q(65043),A=Q(143191),y=Q(525204),g=Q(528202);const T=It=>{let{object:X,character:ut,isSaving:wt,layer:Nt,shouldShowCachedAssets:Bt=!1}=It;var St;const Vt=X==null||(St=X.threeJsViewStore)===null||St===void 0?void 0:St.modelScene;(0,I.useEffect)(()=>{X.characterStyle!==ut.style&&X.setCharacterStyle(ut.style)},[ut.style]);const Ct=Ut=>{if(Ut)for(const Jt in Ut){var Dt;(Dt=Ut[Jt])===null||Dt===void 0||Dt.scene.traverse(Yt=>{Yt.layers.set(Nt)})}},zt=async()=>{let Ut=Bt?X.cachedAssets:null;if(Ut||(Ut=await(0,A.TZ)(ut),X.setCachedAssets(Ut)),!Ut||!Vt)return console.error("Cannot prepare character. CharacterAssets or modelScene  are not loaded"),null;Ct(Ut);const Dt=(0,O.lS)(Vt);if(!Dt)return console.error("Cannot prepare character. Rig is not loaded"),null;const Jt=(0,q.A)(Dt),Yt=(0,g.VR)(Jt,Vt),Me=(0,g.H9)({bones:Yt,character:ut,assets:Ut});return(0,y.K)({meshes:Me,character:ut,bodyPart:"skinTone",materialKeyword:"skin"}),(0,y.K)({meshes:Me,character:ut,bodyPart:"eyeColor",materialKeyword:M.F[ut.style].eye}),{nodes:Jt,meshes:Me,rig:Dt}},re=async()=>{X?.setAssetsLoaded(!1);const Ut=await zt();if(!Ut)return;const{nodes:Dt,meshes:Jt,rig:Yt}=Ut;(0,g.mN)(Dt),Jt.forEach(Me=>{Yt?.add(Me)}),X.threeJsViewStore.object.redraw(),X?.setAssetsLoaded(!0)};return(0,I.useEffect)(()=>{wt||re()},[ut.style,ut.gender,ut.skinTone,ut.eyeColor,JSON.stringify(ut.characterAssetsColors),JSON.stringify(ut.assets)]),I.createElement(I.Fragment,null)},P=(0,at.PA)(T);var Z=Q(833085),tt=Q(114317),R=Q(665217),j=Q(837268),J=Q(786707);const lt=It=>{let{object:X}=It;var ut,wt;(0,I.useEffect)(()=>{var Nt;const Bt=X?.threeJsViewStore,St=Bt?.modelScene,Vt=X?.type===Z.u.OBJECT;if(!St||!Vt)return;const{position:Ct}=X.transformSettings,zt=(0,R.uR)(St,X.id),re=zt?.children.find(Ut=>Ut.name.startsWith(R.H2))||St?.children.find(Ut=>Ut.name.startsWith(R.H2));!St||!re||(re.position.x=Ct.x,re.position.y=Ct.y,(Nt=Bt.object)===null||Nt===void 0||Nt.redraw())},[JSON.stringify(X==null||(ut=X.transformSettings)===null||ut===void 0?void 0:ut.position),X==null||(wt=X.threeJsViewStore)===null||wt===void 0?void 0:wt.modelScene])};var st=Q(103473);let ht=null;function yt(){let It=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return ht||(ht=Q.e(4909).then(Q.bind(Q,86622)).then(X=>{try{return X.configureTextBuilder({useWorker:It}),X}catch(ut){throw console.error("Error configuring Troika text builder:",ut),ut}}).catch(X=>{throw console.error("Failed to load troika-three-text:",X),ht=null,X})),ht}const it=(It=!1)=>({getFontUrl:ut=>{const wt=window[ut];return{"notosans-bold":It?`data:font/woff;base64,${wt}`:"https://assets.visme.co/fonts/fonts/NotoSans-Bold.woff"}[ut]||""}});var $=Q(824954),pt=Q(21020);const dt=It=>{let{camera:X,viewAreaBounds:ut,zoom:wt,paddingVertical:Nt,paddingHorizontal:Bt,paddingDepth:St,canvasSize:Vt}=It;const Ct=new $.Vector3;ut.getSize(Ct),Nt&&(Ct.y+=Nt),Bt&&(Ct.x+=Bt),St&&(Ct.z+=St);const zt=Ct.x,re=Ct.y,Ut=Ct.z,Dt=(0,pt.O)({canvasSize:Vt,planeWidth:zt,planeHeight:re,camera:X,zoom:wt}),Jt=new $.Vector3;ut.getCenter(Jt);const Yt=Dt+Ut/2;X.position.set(Jt.x,Jt.y,Jt.z+Yt),X.lookAt(Jt),X.updateProjectionMatrix()};var Ft=Q(523006);const Wt=(It,X)=>{let ut=null;X.isBox3?ut=X:ut=new Ft.Box3().setFromObject(X);const wt=new Ft.Box3().setFromObject(It),Nt=new $.Vector3,Bt=new $.Vector3;wt.getSize(Nt),ut.getSize(Bt);const St=new $.Vector3,Vt=new $.Vector3;wt.getCenter(St),ut.getCenter(Vt);const Ct=new $.Vector3().subVectors(St,Vt),zt=3;let re="",Ut="";return Math.abs(Ct.x)<Bt.x/zt?re="center":Ct.x<0?re="left":re="right",Math.abs(Ct.y)<Bt.y/zt?Ut="middle":Ct.y<0?Ut="bottom":Ut="top",`${Ut} ${re}`.trim()};var qt=Q(765872);const me="static_ctrl_text",le=(It,X)=>{var ut;const wt=X.threeJsAnimation,Nt=new Ft.Box3,Bt=new Ft.Box3().setFromObject(It);Nt.copy(Bt);const St=wt==null||(ut=wt.animation)===null||ut===void 0?void 0:ut.tracks,Vt=St?.find(re=>re.name.startsWith(me));if(!Vt&&X?.boundingBoxObject)return Nt.union(X.boundingBoxObject),Nt;if(Vt&&X?.boundingBoxObject){var Ct,zt;const{maxX:re,maxY:Ut,minX:Dt,minY:Jt}=(0,qt.e)(Vt),Yt=new Ft.Box3(new $.Vector3(Dt,Jt,(X==null||(Ct=X.boundingBoxObject)===null||Ct===void 0?void 0:Ct.min.z)??0),new $.Vector3(re,Ut,(X==null||(zt=X.boundingBoxObject)===null||zt===void 0?void 0:zt.max.z)??0)),Me=Bt.max.y-Bt.min.y;Yt.max.y+=Me/2,Yt.min.y-=Me/2,Nt.union(Yt),Nt.union(X.boundingBoxObject)}return Nt},ee=(It,X)=>{if(!It||!X)return null;const ut=Wt(It,X);return ut==="bottom left"||ut==="top left"||ut==="middle left"?"left":ut==="bottom center"||ut==="top center"||ut==="middle center"?"top":null},Le="notosans-bold",Te=It=>{let{object:X,threeJsObject:ut,isStaticRender:wt}=It;var Nt,Bt,St,Vt;const[Ct,zt]=(0,I.useState)(!1),re=ut?.type===Z.u.WIDGET,Ut=ut.threeJsViewStore,Dt=ut.threeJsAnimation,Jt=Ut?.modelScene,Yt=(Nt=ut.progressText)===null||Nt===void 0?void 0:Nt.shouldShowText,Me=(Bt=ut.progressText)===null||Bt===void 0?void 0:Bt.shouldShowPercent,Ce=(St=ut.progressText)===null||St===void 0?void 0:St.color,Fe=(Vt=ut.progressText)===null||Vt===void 0?void 0:Vt.size,Ue=X.getAppStore(),{isPlayerMode:xe,isBlockInfographic:si,Html5Download:li}=Ue.settings,{getFontUrl:ve}=it(li),We=(0,I.useRef)(null),Cs=C=>C/100,Hs=()=>Jt?Jt.children.find(C=>C.name.startsWith("Rot_")):null,G=()=>Jt?Jt.children.find(C=>C.name.startsWith(me)):null,m=C=>{if(!C||!X?.camera)return;const k=le(C,ut),V=X.threeJsCanvasEl,U={width:V.width*X.renderer.getPixelRatio(),height:V.height*X.renderer.getPixelRatio()};dt({camera:X.camera,viewAreaBounds:k,canvasSize:U,zoom:1,paddingVertical:.3})},x=C=>{if(!C)return;const k=G(),V=Hs();if(!k||!V||!ut?.boundingBoxObject)return;const U=ee(k,ut.boundingBoxObject);C.fontSize=Cs(Fe),C.fontWeight="bold",C.color=Ce,C.material.opacity=1,C.anchorX=null,C.anchorY=null,U==="left"?(C.anchorX="right",C.anchorY="middle"):U==="top"&&(C.anchorX="center",C.anchorY="top-baseline"),C.sync(()=>{m(C),zt(!0),X.redraw(),ut.progressText.setIsProgressTextStylesSynced(!0)})},w=function(C){let k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;var V;const U=We.current,H=wt?Dt?.animationTimestamp:Dt?.currentTimeAnimation,K=Dt==null||(V=Dt.animation)===null||V===void 0?void 0:V.duration;if(!U||K==null)return;const nt=Math.ceil(H/K*100);k&&(zt(!1),U.text="",U.material.opacity=0);const vt=Me?"%":"",Mt=C||nt;U.text=`${Mt}${vt}`,U.sync(()=>{(k||wt)&&x(U),X.redraw()}),X.redraw()},v=()=>{const C=We.current;if(!C||!Jt)return;const k=G();k&&(k.remove(C),ut.progressText.setIsProgressTextStylesSynced(!1)),zt(!1),C.dispose(),We.current=null},_=async()=>{if(Dt?.animationTimestamp==null)return;const C=G();if(C&&We.current)return;const k=Dt.animationTimestamp||0;if(!(!k&&k!==0||!Ut))try{const V=!li,{Text:U}=await yt(V),H=new U;H.font=ve(Le);const K=new st._({color:Ce,roughness:1,metalness:.8});H.material=K,We.current=H,H.sync(()=>{w(100,!0)});const nt=X.layer;H.layers.set(nt),C&&(C?.clear(),C.add(H))}catch(V){console.error("Failed to create progress text:",V)}},b=async()=>{try{!We.current&&Yt?await _():Yt?w(100,!0):(v(),X.resetCameraPosition(),X.redraw())}catch(C){console.error("Failed to update progress text:",C)}};(0,I.useEffect)(()=>{if(!(!Jt||!Ut||!Yt||!re||!ut.isWidgetCamera))return(async()=>await _())(),()=>{xe||v()}},[Jt,ut.isWidgetCamera]),(0,I.useEffect)(()=>{var C;const k=X?.isPlacedOnSelectedSlide||si||wt||((C=Ue.uiStateStore)===null||C===void 0?void 0:C.isShowingAnimationDemo);!Jt||!Ut||!re||!Ct||!k||!ut.isLoaded||w()},[Dt?.currentTimeAnimation,Ct]),(0,I.useEffect)(()=>{!Jt||!Ut||!re||(async()=>await b())()},[Ce,Fe,Yt,Me])},Ke=It=>{let{object:X}=It;var ut,wt;(0,I.useEffect)(()=>{var Nt;const Bt=X?.threeJsViewStore,St=Bt?.modelScene,Vt=X?.type===Z.u.WIDGET,Ct=X?.type===Z.u.OBJECT;if(!St||!Vt&&!Ct)return;const{rotation:zt}=X.transformSettings,re=(0,R.uR)(St,X.id),Ut=(0,R.i$)(re)||(0,R.i$)(St),Dt=zt.y,Jt=zt.x,Yt=zt.z;!St||!Ut||(Ut.rotation.y=Dt,Ut.rotation.x=Jt,Ut.rotation.z=Yt,(Nt=Bt.object)===null||Nt===void 0||Nt.redraw())},[JSON.stringify(X==null||(ut=X.transformSettings)===null||ut===void 0?void 0:ut.rotation),X==null||(wt=X.threeJsViewStore)===null||wt===void 0?void 0:wt.modelScene])},Xe=It=>{let{object:X}=It;const ut=X.threeJsViewStore,wt=X.threeJsAnimation;(0,I.useEffect)(()=>{if(ut?.isLoaded){if(!wt.isAnimated){wt.setStaticPose();return}return wt.runAnimation(),()=>{wt.resetCurrentAnimation()}}},[wt.isAnimated,wt.speed,wt.loop]),(0,I.useEffect)(()=>{ut.renderShadows&&ut.renderShadows()},[wt?.currentTimeAnimation])},cs=It=>{(0,I.useEffect)(()=>{var X;const wt=It.threeJsViewStore.modelScene,Nt=wt?.getObjectByName("shadowGroup"),Bt=(0,R.uR)(wt,It.id),St=(0,R.i$)(Bt)||(0,R.i$)(wt);if(!wt||!Nt||!St)return;const Vt=new Ft.Box3().setFromObject(St),Ct=new $.Vector3;Vt.getCenter(Ct),Nt.position.copy(Ct).setY(0),(X=It.threeJsViewStore)===null||X===void 0||X.renderShadows()},[JSON.stringify(It.transformSettings)])},Re=It=>{let{object:X,threeJsObject:ut,shouldShowCachedObject:wt=!1}=It;var Nt;const{appStore:Bt}=(0,E.g)(),{settings:St}=Bt,{isBlockInfographic:Vt,isEditorMode:Ct,isStaticRender:zt}=St,re=Vt;(0,I.useEffect)(()=>{if(!X.isReadyForInitChildren)return;const Ut=(0,R.RB)(X.id,ut.id),Dt=j.A.isObjectExistInMainScene(Ut);return re&&Dt&&j.A.removeObjectFromScene(Dt),ut.threeJsViewStore.init({object:X,isInitiallyConnectedToTimeline:!Ct,shouldShowCachedObject:wt}),()=>{(0,tt.isAlive)(X)&&ut.destroy()}},[ut.modelUrl,(Nt=ut.threeJsCharacter)===null||Nt===void 0?void 0:Nt.id,ut.characterStyle]),Te({object:X,threeJsObject:ut,isStaticRender:zt}),(0,J.G)({object:ut}),Ke({object:ut}),lt({object:ut}),cs(ut),Xe({object:ut})},Ye=It=>{let{threeJsObject:X,object:ut,onLoaded:wt,shouldShowCachedObject:Nt=!1}=It;var Bt;const{appStore:St}=(0,E.g)(),Vt=St==null||(Bt=St.vismeObjectsStore)===null||Bt===void 0?void 0:Bt.characterEditorStore;(0,I.useEffect)(()=>{wt()},[X.isLoaded]),Re({threeJsObject:X,object:ut,shouldShowCachedObject:Nt});let Ct=X.threeJsCharacter;return X.isCharacterEdited&&Vt?.character&&(Ct=Vt?.character),I.createElement(I.Fragment,null,X.threeJsCharacter&&X.threeJsViewStore.isLoaded&&X.type===Z.u.CHARACTER&&I.createElement(P,{object:X,character:Ct,isSaving:Vt?.isVismeObjectSaving,layer:ut.layer,shouldShowCachedAssets:Nt}))},Qe=I.memo((0,at.PA)(Ye));var ts=Q(925345),Ae=Q(555443),ls=Q(237481),us=Q(248056),es=Q(541761);const ss=async function(It,X){let ut=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.1;if(!X)return;const wt=.1,Nt=It.getSize(new $.Vector3),Bt=It.getCenter(new $.Vector3);X.updateMatrixWorld();const St=new us.P,Vt=new es.k,Ct=await(0,R.u7)(It,ut),re=X.fov*(Math.PI/180),Ut=Fe=>{const Ue=new $.Vector3().subVectors(X.position,Bt).normalize(),xe=Bt.clone().add(Ue.multiplyScalar(Fe));X.position.copy(xe),X.lookAt(Bt),X.updateProjectionMatrix(),X.updateMatrixWorld(),X.matrixWorldInverse.copy(X.matrixWorld).invert(),Vt.multiplyMatrices(X.projectionMatrix,X.matrixWorldInverse),St.setFromProjectionMatrix(Vt)},Dt=Fe=>{Ut(Fe);let Ue=!0;return Ct.forEach(xe=>{St.containsPoint(xe)||(Ue=!1)}),Ue},Jt=Nt.x/(2*Math.tan(re/2)),Yt=Nt.y/(2*Math.tan(re/2));let Me=Math.max(Jt,Yt);const Ce=(Fe,Ue)=>{const xe=Dt(Fe);return Ue>0&&!xe?Ce(Fe+wt,Ue):Ue<0&&xe?Ce(Fe-wt,Ue):Fe};Me=Ce(Me,1),Ce(Me,-1)},ke=async It=>{const X=It.camera,ut=It.threeJsCanvasEl;if(!It.checkAllLoaded||!It.shouldUpdateCameraDistance||!X||!ut||!It.isTempDimensions)return;const wt=await(0,R.Fx)(It.allChildren,!0),Nt=await(0,R.u7)(wt);X.updateProjectionMatrix();const Bt=new ls.I(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),St=new ls.I(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);Nt.forEach(Yt=>{Yt.project(X),Bt.x=Math.min(Bt.x,Yt.x),Bt.y=Math.min(Bt.y,Yt.y),St.x=Math.max(St.x,Yt.x),St.y=Math.max(St.y,Yt.y)});const Vt=It.canvasWidth,Ct=It.canvasHeight,zt=.5,re={x:(Bt.x*zt+zt)*Vt,y:(St.y*-zt+zt)*Ct},Ut={x:(St.x*zt+zt)*Vt,y:(Bt.y*-zt+zt)*Ct},Dt=Ut.x-re.x,Jt=Ut.y-re.y;It.setDimensions(Dt,Jt),X.aspect=It.canvasWidth/It.canvasHeight,X.updateProjectionMatrix(),X.updateMatrixWorld(),ss(wt,It.camera),It.redraw()},Ls=It=>{let{object:X}=It;(0,I.useEffect)(()=>{(async()=>{if(!X.checkAllLoaded||!X.shouldUpdateCameraDistance)return;const ut=await(0,R.Fx)(X.allChildren);await ss(ut,X.camera),await ke(X),X.redraw()})()},[X.checkAllLoaded])},Ei=It=>{let{object:X,zoom:ut}=It;const wt=X.canvasWidth??0,Nt=X.canvasHeight??0,Bt=X.renderer;(0,I.useEffect)(()=>{const St=X.camera,Vt=X.threeJsCanvasEl;if(!St||!Vt||!wt||!Nt||!Bt)return;const Ct=wt/Nt,zt=St.fov*(Ct/St.aspect);St.aspect=Ct,St.fov=zt,St.updateProjectionMatrix(),(0,Ae.Z)({canvas:Vt,canvasWidth:wt,canvasHeight:Nt,zoom:ut,renderer:Bt}),X.redraw()},[wt,Nt,X?.camera])},Ri=It=>{let{object:X}=It;var ut;(0,I.useEffect)(()=>{const wt=X.checkAllLoaded&&X.shouldUpdateCameraDistance;(async()=>{if(!wt)return;const Nt=await(0,R.Fx)(X.allChildren);ss(Nt,X.camera),X.redraw()})()},[JSON.stringify((ut=X.selectedChild)===null||ut===void 0?void 0:ut.transformSettings)])},ci=It=>{let{object:X,isThumb:ut}=It;var wt,Nt,Bt,St,Vt;const{appStore:Ct,uiStateStore:zt}=(0,E.g)(),{settings:re}=Ct,{isBlockInfographic:Ut,isStaticRender:Dt}=re,Jt=Ct.slideStore,Yt=zt?.zoom??1,Me=31,Ce=!!(!(Ct==null||(Nt=Ct.uiStateStore)===null||Nt===void 0||(wt=Nt.slideTransitioningTo)===null||wt===void 0)&&wt.objectsAndGroupsMap[X.id]),Fe=()=>{if(X.isPlacedOnSelectedSlide||Ce||Ut||Dt||zt?.isShowingAnimationDemo){const We=j.A.getCurrentLayer();We>=Me&&Dt&&j.A.resetLayer(),X.setLayer(We)}else X.setLayer(null)},Ue=(!Ct.settings.isBlockInfographic||Ct.settings.isBlockInfographic&&!Ct.settings.isEditorMode)&&((Bt=Jt.selectedSlide)===null||Bt===void 0?void 0:Bt.id),xe=()=>Jt.selectedSlide?!X.isPlacedOnSelectedSlide&&Ct.settings.isRenderingVideo:!1,si=()=>{var ve;return!(!((ve=Jt.selectedSlide)===null||ve===void 0)&&ve.id)&&!Dt&&!Ct.settings.isBlockInfographic&&!Ct.settings.isRenderingVideo},li=()=>{const ve=xe(),We=si();return ut||!X.threeJsCanvasEl||zt?.isPreviewWindowShown||We||ve};(0,I.useEffect)(()=>{if(!li())return Fe(),X.init(),()=>{X.destroy({removeAll:!1})}},[Ue,zt?.isPreviewWindowShown,Ce]),Ei({object:X,zoom:Yt}),(0,I.useEffect)(()=>{const ve=()=>{document.visibilityState==="visible"&&X.redraw()};return document.addEventListener("visibilitychange",ve),()=>{document.removeEventListener("visibilitychange",ve)}},[]),(0,I.useEffect)(()=>{zt?.isPreviewWindowShown&&(j.A.resetLayer(),X.destroy({removeAll:!0}),(0,ts.yA)())},[zt?.isPreviewWindowShown]),(0,I.useEffect)(()=>{const ve=X.threeJsCanvasEl,We=X.canvasWidth,Cs=X.canvasHeight,Hs=X.renderer;!ve||!We||!Cs||!Hs||((0,Ae.Z)({canvas:ve,canvasWidth:We,canvasHeight:Cs,zoom:Yt,renderer:Hs}),X.redraw())},[Yt,Jt==null||(St=Jt.selectedSlide)===null||St===void 0?void 0:St.id,X.isLoaded]),(0,I.useEffect)(()=>{X.redraw()},[(Vt=Ct.uiStateStore)===null||Vt===void 0?void 0:Vt.isShowingAnimationDemo]),Ls({object:X}),Ri({object:X})},Fs={wrapperCanvas:"wrapperCanvas--xVlq2Yy",selectingChildMode:"selectingChildMode--AToolTo",canvas:"canvas--uQEFtg8",loading:"loading--cY1aq47"},xs=It=>{let{object:X,isThumb:ut,shouldShowCachedObject:wt}=It;var Nt;const{appStore:Bt,uiStateStore:St}=(0,E.g)(),Vt=(0,I.useRef)(null),[Ct,zt]=(0,I.useState)(!1);(0,ft.A)(Vt,X.flipX,!1,Bt.settings.mode);const re=Bt.slideStore,Ut=(0,I.useCallback)(Jt=>X.setProp("threeJsCanvasEl",Jt),[]);ci({object:X,isThumb:ut});const Dt=()=>{const Jt=X.checkAllLoaded;zt(Jt)};return(0,I.useEffect)(()=>{Ct&&(X.redraw(),X.setStatus(D.d.rendered),X.setNoBroadcastRenderFlag(!1))},[Ct]),I.createElement(I.Fragment,null,!ut&&X.isReadyForInitChildren&&X.allChildren.map(Jt=>I.createElement(Qe,{key:Jt.id,threeJsObject:Jt,object:X,onLoaded:Dt,shouldShowCachedObject:wt})),I.createElement("div",{className:(0,mt.A)(Fs.wrapperCanvas,{[Fs.selectingChildMode]:St?.isEditThreeDChildren}),key:`${(Nt=re.selectedSlide)===null||Nt===void 0?void 0:Nt.id}${St?.isPreviewWindowShown}`,ref:Vt},!Ct&&I.createElement(Y.A,null),I.createElement("canvas",{ref:Ut,className:(0,mt.A)(Fs.canvas,{[Fs.loading]:!Ct})})))},qi=(0,at.PA)(xs)},786707:(fe,Et,Q)=>{Q.d(Et,{G:()=>E});var I=Q(411855),mt=Q(833085),at=Q(528202);const E=D=>{let{object:Y,targetScene:ft,isPreview:M=!1}=D;var q;(0,I.useEffect)(()=>{var O,A,y;const g=Y?.threeJsViewStore,T=Y?.type===mt.u.WIDGET,P=Y?.type===mt.u.OBJECT&&Y?.mainCategoryId===mt.O.OBJECTS,Z=ft||g?.modelScene;if(!Z||!T&&!P)return;const tt=j=>{const J=[];return j.traverse(lt=>{lt.type==="Mesh"&&J.push(lt)}),J},R=M?null:(O=(A=g.object).getHistoryManager)===null||O===void 0?void 0:O.call(A);Z.traverse(j=>{var J,lt,st;const ht=tt(j);if(!((J=j.userData)===null||J===void 0)&&J.mainColor&&Y?.colors){var yt;const pt=(yt=j.userData)===null||yt===void 0?void 0:yt.mainColor,Ft={mesh:(0,at.SQ)(ht,pt),assetColors:Y};R?R.withoutUndo(()=>(0,at.$O)(Ft)):(0,at.$O)(Ft)}if((!((lt=j.userData)===null||lt===void 0)&&lt.secondaryColor||!((st=j.userData)===null||st===void 0)&&st.secondColor)&&Y?.colors){var it,$;const pt=((it=j.userData)===null||it===void 0?void 0:it.secondaryColor)||(($=j.userData)===null||$===void 0?void 0:$.secondColor),Ft={mesh:(0,at.SQ)(ht,pt),assetColors:Y,index:1};R?R.withoutUndo(()=>(0,at.$O)(Ft)):(0,at.$O)(Ft)}}),(y=g.object)===null||y===void 0||y.redraw()},[JSON.stringify(Y?.colors),Y==null||(q=Y.threeJsViewStore)===null||q===void 0?void 0:q.modelScene,ft,M])}},674554:(fe,Et,Q)=>{Q.d(Et,{F:()=>at});var I=Q(258034),mt=Q(743473);const at={[I.Te.Casual]:{eye:"Vis_Eye_Color.003",eyeBrows:"Vis_Hair.003",rig:mt.t.Rig002},[I.Te.Formal]:{eye:"Vis_Eye.001",eyeBrows:"Vis_Hair.001",rig:mt.t.rig002}}},743473:(fe,Et,Q)=>{Q.d(Et,{t:()=>I});var I;(function(mt){mt.rig002="rig002",mt.Rig002="Rig002"})(I||(I={}))},21020:(fe,Et,Q)=>{Q.d(Et,{O:()=>I});const I=mt=>{let{canvasSize:at,planeWidth:E,planeHeight:D,camera:Y,zoom:ft}=mt;const M=180,q=at.width,O=at.height,A=q/O,y=E/D,g=Y.fov*Math.PI/M,T=D/2/Math.tan(g/2),P=2*Math.atan(Math.tan(g/2)*A),Z=E/2/Math.tan(P/2);return(A>y?T:Z)*(1/ft)}},894639:(fe,Et,Q)=>{Q.d(Et,{A:()=>mt});const mt=at=>{const E={};return at.traverse(D=>{D.name&&(E[D.name]=D)}),E}},65043:(fe,Et,Q)=>{Q.d(Et,{C2:()=>at,lS:()=>E});var I=Q(743473);const mt=()=>Object.values(I.t),at=function(Y){let ft=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mt();return Object.values(Y).find(M=>ft.includes(M.name))},E=function(Y){let ft=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mt(),M;return Y.traverse(q=>{ft.includes(q.name)&&(M=q)}),M};var D=null},143191:(fe,Et,Q)=>{Q.d(Et,{Ay:()=>st,TZ:()=>tt});var I=Q(411855),mt=Q(593883),at=Q.n(mt),E=Q(489699),D=Q(258034),Y=Q(4606),ft=Q(718121),M=Q(894639),q=Q(950758),O=Q(65043),A=Q(314942),y;const g=!!(!((y=bootstrap)===null||y===void 0)&&y.Html5Download),T=new A.A(g),P={};let Z={};const tt=async ht=>{const yt={},it=[],$={};return Object.keys(ht.assets).forEach(pt=>{let dt=Y.V.body===pt&&!g?ht.bodyAsset:ht.assets[pt];if(!dt&&ft.bl[pt].fallbackToDefault&&(dt=ht.fallbackAssets[pt]),!dt)return null;if(Z[dt.src]){yt[pt]=Z[dt.src],$[dt.src]=Z[dt.src];return}let Ft=at();it.push(new Promise(Wt=>Ft=Wt)),T.load(dt.src,Wt=>{dt&&($[dt.src]=Wt),!P[ht.style]&&pt===Y.V.body&&(P[ht.style]=Wt),yt[pt]=Wt,Ft()},()=>{},()=>{})}),await Promise.all(it),Z=$,yt},R=`${(0,q.A)()}/formal/body.visme3d`,j=`${(0,q.A)()}/casual/body.visme3d`,J=async ht=>{let yt=P[ht.style];yt||(yt=await new Promise($=>{T.load(ht.style===D.Te.Formal?R:j,pt=>{$(pt)},()=>{},()=>{})}),P[ht.style]=yt);const it=(0,O.lS)(yt.scene);return(0,E.o8)(it)},st=(ht,yt)=>{const[it,$]=(0,I.useState)({}),[pt,dt]=(0,I.useState)(),[Ft,Wt]=(0,I.useState)({});return(0,I.useEffect)(()=>{if(yt){$(yt);return}tt(ht).then($)},[ht,ht.style,ht.gender,ht.skinTone,JSON.stringify(ht.characterAssetsColors),JSON.stringify(ht.assets)]),(0,I.useEffect)(()=>{(async()=>{const qt=await J(ht);if(!qt)return;const me=Object.values(it).length;qt&&me&&(dt(qt),Wt((0,M.A)(qt)))})()},[ht.style,it]),[it,pt,Ft]}},525204:(fe,Et,Q)=>{Q.d(Et,{A:()=>Y,K:()=>E});var I=Q(411855),mt=Q(674554),at=Q(7069);const E=ft=>{let{character:M,meshes:q,bodyPart:O,materialKeyword:A}=ft;M[O]&&q.forEach(y=>{(0,at.$r)(y.material).forEach(T=>{if(T.name.toLowerCase().includes(A.toLowerCase())){const P=T.clone();P.color.setStyle(M[O]),y.material=P}})})},Y=ft=>{let{character:M,meshes:q}=ft;(0,I.useEffect)(()=>{E({character:M,meshes:q,bodyPart:"skinTone",materialKeyword:"skin"})},[M.skinTone,q]),(0,I.useEffect)(()=>{E({character:M,meshes:q,bodyPart:"eyeColor",materialKeyword:mt.F[M.style].eye})},[M.eyeColor,q])}},528202:(fe,Et,Q)=>{Q.d(Et,{mN:()=>J,lt:()=>j,SQ:()=>y,VR:()=>Z,H9:()=>ht,V0:()=>yt,$O:()=>g});var I=Q(114317),mt=Q(489699),at=Q(4606),E=Q(674554),D=Q(339957);const Y=255,ft=function(it){let $=arguments.length>1&&arguments[1]!==void 0?arguments[1]:50;const dt=new D.Q(it).toArray().map(le=>le*Y),Ft=1-$/100,Wt=dt.map(le=>Math.max(0,le*Ft));return`#${new D.Q().fromArray(Wt.map(le=>le/Y)).getHexString()}`};var M=Q(471237),q=Q(65043),O=Q(401872);const A="#0f0b08",y=(it,$)=>{if(!$)return null;const pt=it.find(dt=>dt.material.name===$);return pt||null},g=it=>{let{mesh:$,assetColors:pt,index:dt=0}=it;if(!$?.material)return;const Ft=$.material.clone(),Wt=Ft.color.getHexString();let qt=pt.colors[dt]||Wt;pt.updateColorAtIndex(dt,qt),qt=qt.startsWith("#")?qt:`#${qt}`,Ft.color.setStyle(qt),$.material=Ft},T=it=>{let{asset:$,type:pt,vismeObject:dt,meshes:Ft}=it;var Wt,qt,me,le,ee,Le,Te;const Ke=$==null||(me=$.scene)===null||me===void 0||(qt=me.children[0])===null||qt===void 0||(Wt=qt.userData)===null||Wt===void 0?void 0:Wt.mainColor,Xe=y(Ft,Ke),cs=$==null||(Le=$.scene)===null||Le===void 0||(ee=Le.children[0])===null||ee===void 0||(le=ee.userData)===null||le===void 0?void 0:le.secondaryColor,Re=y(Ft,cs);if(pt===at.V.body){var Ye,Qe,ts;if(!(0,I.isAlive)(dt.assets))return;const ls=!!(!((Ye=dt.assets)===null||Ye===void 0)&&Ye[at.V.hair]),us=E.F[dt.style].eyeBrows,es=$?.materials[us];if(!es)return;if(!ls){es.color.setStyle(A);return}const ss=(0,M.fM)({newColor:(ts=dt.characterAssetsColors)===null||ts===void 0||(Qe=ts[at.V.hair])===null||Qe===void 0?void 0:Qe.colors[0],fallbackColor:A});es.color.setStyle(ft(ss))}if(!(0,I.isAlive)(dt.characterAssetsColors))return;const Ae=dt.characterAssetsColors[pt];if(!(!Ae||!(0,I.isAlive)(Ae))){if((pt===at.V.hair||pt===at.V.beard)&&(!((Te=Ft[0])===null||Te===void 0)&&Te.material)){g({mesh:Ft[0],assetColors:Ae});return}Xe?.material&&g({mesh:Xe,assetColors:Ae}),Re?.material&&g({mesh:Re,assetColors:Ae,index:1}),Ae.setIsMainColorAvailable(!!Xe),Ae.setIsSecondaryColorAvailable(!!Re)}},P=it=>{const $=[];return it.traverse(pt=>{pt.type==="SkinnedMesh"&&$.push(pt)}),$},Z=(it,$)=>{let pt=[];return $?pt=$.getObjectsByProperty("type","Bone"):pt=Object.values(it).filter(O.Ti),pt},tt=(it,$)=>{it.skeleton.bones=it.skeleton.bones.map(pt=>{let dt=pt?.name;return dt?(dt.endsWith("_1")&&(dt=dt.slice(0,-2)),$.find(Wt=>[dt,`${dt}_1`].includes(Wt?.name))):pt})},R=it=>{Object.values(it).forEach($=>{$?.isTexture===!0&&$.dispose()}),it.dispose()},j=it=>{it?.removeFromParent(),it?.geometry.dispose(),it?.material&&(Array.isArray(it.material)?it.material.forEach(R):R(it.material)),it.type==="SkinnedMesh"&&it.skeleton.dispose()},J=it=>{const $=(0,q.C2)(it);if(!$)return;$.getObjectsByProperty("type","SkinnedMesh").forEach(dt=>{dt.userData.isReplaceable&&dt.removeFromParent()})},lt=it=>{let{bones:$,character:pt,assets:dt,onAssetProcess:Ft=()=>{}}=it;const Wt=[];if(!$.length||!dt)return[];const qt=Object.entries(dt).filter(me=>{let[le,ee]=me;return le===at.V.hair&&dt.hats?!1:!!ee});for(const[me,le]of qt){if(le===null)continue;const ee=P((0,mt.o8)(le.scene));Ft({asset:le,object:pt,assetMeshes:ee,type:me}),ee.forEach(Te=>tt(Te,$));const Le=ee.map(Te=>(0,mt.o8)(Te));Le.forEach((Te,Ke)=>{Te.userData.isReplaceable=!0,Te.skeleton.bones=ee[Ke].skeleton.bones}),Wt.push(...Le)}return Wt},st=it=>{let{type:$,vismeObject:pt,meshes:dt}=it;if(!(0,I.isAlive)(pt.gestureAssetsColors))return;if($===at.t.body){dt.forEach(Wt=>{Wt.name.toLowerCase().includes("nails")?Wt.material.color.setStyle(pt.nailsColor):Wt.material.color.setStyle(pt.skinTone)});return}const Ft=pt.gestureAssetsColors[$];!Ft||!(0,I.isAlive)(Ft)||(Object.values(at.t).includes($)&&g({mesh:dt[0],assetColors:Ft}),Ft.setIsMainColorAvailable(!0))},ht=it=>lt({...it,onAssetProcess:$=>{let{asset:pt,object:dt,assetMeshes:Ft,type:Wt}=$;if(Wt===at.V.body&&!dt.skinTone){const qt=Ft[0].material.color.getHexString();dt.setSkinTone(`#${qt}`)}T({asset:pt,type:Wt,vismeObject:dt,meshes:Ft})}}),yt=it=>lt({...it,onAssetProcess:$=>{let{object:pt,assetMeshes:dt,type:Ft,asset:Wt}=$;if(Ft===at.t.body&&!pt.skinTone){const qt=dt[0].material.color.getHexString();pt.setSkinTone(`#${qt}`)}st({asset:Wt,type:Ft,vismeObject:pt,meshes:dt})}})},401872:(fe,Et,Q)=>{Q.d(Et,{Ti:()=>ft});var I;(function(M){M.PLAY="play",M.FINISH="finish"})(I||(I={}));var mt;(function(M){M.entrance="entrance",M.waiting="waiting",M.ending="ending",M.idle="idle"})(mt||(mt={}));var at;(function(M){M.walking="walking",M.waiting="waiting",M.ending="ending",M.error="error",M.idle="idle",M.expression="expression"})(at||(at={}));var E;(function(M){M.forward="forward",M.backward="backward"})(E||(E={}));const D=M=>M.type==="Mesh",Y=M=>M.type==="SkinnedMesh",ft=M=>M.type==="Bone"},314942:(fe,Et,Q)=>{Q.d(Et,{A:()=>Hs});var I=Q(979248);const mt=new WeakMap;class at extends I.aHM{constructor(m){super(m),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(m){return this.decoderPath=m,this}setDecoderConfig(m){return this.decoderConfig=m,this}setWorkerLimit(m){return this.workerLimit=m,this}load(m,x,w,v){const _=new I.Y9S(this.manager);_.setPath(this.path),_.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(m,b=>{this.parse(b,x,v)},w,v)}parse(m,x,w=()=>{}){this.decodeDracoFile(m,x,null,null,I.er$,w).catch(w)}decodeDracoFile(m,x,w,v,_=I.Zr2,b=()=>{}){const C={attributeIDs:w||this.defaultAttributeIDs,attributeTypes:v||this.defaultAttributeTypes,useUniqueIDs:!!w,vertexColorSpace:_};return this.decodeGeometry(m,C).then(x).catch(b)}decodeGeometry(m,x){const w=JSON.stringify(x);if(mt.has(m)){const k=mt.get(m);if(k.key===w)return k.promise;if(m.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let v;const _=this.workerNextTaskID++,b=m.byteLength,C=this._getWorker(_,b).then(k=>(v=k,new Promise((V,U)=>{v._callbacks[_]={resolve:V,reject:U},v.postMessage({type:"decode",id:_,taskConfig:x,buffer:m},[m])}))).then(k=>this._createGeometry(k.geometry));return C.catch(()=>!0).then(()=>{v&&_&&this._releaseTask(v,_)}),mt.set(m,{key:w,promise:C}),C}_createGeometry(m){const x=new I.LoY;m.index&&x.setIndex(new I.THS(m.index.array,1));for(let w=0;w<m.attributes.length;w++){const v=m.attributes[w],_=v.name,b=v.array,C=v.itemSize,k=new I.THS(b,C);_==="color"&&(this._assignVertexColorSpace(k,v.vertexColorSpace),k.normalized=!(b instanceof Float32Array)),x.setAttribute(_,k)}return x}_assignVertexColorSpace(m,x){if(x!==I.er$)return;const w=new I.Q1f;for(let v=0,_=m.count;v<_;v++)w.fromBufferAttribute(m,v),I.ppV.colorSpaceToWorking(w,I.er$),m.setXYZ(v,w.r,w.g,w.b)}_loadLibrary(m,x){const w=new I.Y9S(this.manager);return w.setPath(this.decoderPath),w.setResponseType(x),w.setWithCredentials(this.withCredentials),new Promise((v,_)=>{w.load(m,v,void 0,_)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const m=typeof WebAssembly!="object"||this.decoderConfig.type==="js",x=[];return m?x.push(this._loadLibrary("draco_decoder.js","text")):(x.push(this._loadLibrary("draco_wasm_wrapper.js","text")),x.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(x).then(w=>{const v=w[0];m||(this.decoderConfig.wasmBinary=w[1]);const _=E.toString(),b=["/* draco decoder */",v,"","/* worker */",_.substring(_.indexOf("{")+1,_.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([b]))}),this.decoderPending}_getWorker(m,x){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const v=new Worker(this.workerSourceURL);v._callbacks={},v._taskCosts={},v._taskLoad=0,v.postMessage({type:"init",decoderConfig:this.decoderConfig}),v.onmessage=function(_){const b=_.data;switch(b.type){case"decode":v._callbacks[b.id].resolve(b);break;case"error":v._callbacks[b.id].reject(b);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+b.type+'"')}},this.workerPool.push(v)}else this.workerPool.sort(function(v,_){return v._taskLoad>_._taskLoad?-1:1});const w=this.workerPool[this.workerPool.length-1];return w._taskCosts[m]=x,w._taskLoad+=x,w})}_releaseTask(m,x){m._taskLoad-=m._taskCosts[x],delete m._callbacks[x],delete m._taskCosts[x]}debug(){console.log("Task load: ",this.workerPool.map(m=>m._taskLoad))}dispose(){for(let m=0;m<this.workerPool.length;++m)this.workerPool[m].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function E(){let G,m;onmessage=function(b){const C=b.data;switch(C.type){case"init":G=C.decoderConfig,m=new Promise(function(U){G.onModuleLoaded=function(H){U({draco:H})},DracoDecoderModule(G)});break;case"decode":const k=C.buffer,V=C.taskConfig;m.then(U=>{const H=U.draco,K=new H.Decoder;try{const nt=x(H,K,new Int8Array(k),V),vt=nt.attributes.map(Mt=>Mt.array.buffer);nt.index&&vt.push(nt.index.array.buffer),self.postMessage({type:"decode",id:C.id,geometry:nt},vt)}catch(nt){console.error(nt),self.postMessage({type:"error",id:C.id,error:nt.message})}finally{H.destroy(K)}});break}};function x(b,C,k,V){const U=V.attributeIDs,H=V.attributeTypes;let K,nt;const vt=C.GetEncodedGeometryType(k);if(vt===b.TRIANGULAR_MESH)K=new b.Mesh,nt=C.DecodeArrayToMesh(k,k.byteLength,K);else if(vt===b.POINT_CLOUD)K=new b.PointCloud,nt=C.DecodeArrayToPointCloud(k,k.byteLength,K);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!nt.ok()||K.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+nt.error_msg());const Mt={index:null,attributes:[]};for(const _t in U){const At=self[H[_t]];let kt,Zt;if(V.useUniqueIDs)Zt=U[_t],kt=C.GetAttributeByUniqueId(K,Zt);else{if(Zt=C.GetAttributeId(K,b[U[_t]]),Zt===-1)continue;kt=C.GetAttribute(K,Zt)}const Rt=v(b,C,K,_t,At,kt);_t==="color"&&(Rt.vertexColorSpace=V.vertexColorSpace),Mt.attributes.push(Rt)}return vt===b.TRIANGULAR_MESH&&(Mt.index=w(b,C,K)),b.destroy(K),Mt}function w(b,C,k){const U=k.num_faces()*3,H=U*4,K=b._malloc(H);C.GetTrianglesUInt32Array(k,H,K);const nt=new Uint32Array(b.HEAPF32.buffer,K,U).slice();return b._free(K),{array:nt,itemSize:1}}function v(b,C,k,V,U,H){const K=H.num_components(),vt=k.num_points()*K,Mt=vt*U.BYTES_PER_ELEMENT,_t=_(b,U),At=b._malloc(Mt);C.GetAttributeDataArrayForAllPoints(k,H,_t,Mt,At);const kt=new U(b.HEAPF32.buffer,At,vt).slice();return b._free(At),{name:V,array:kt,itemSize:K}}function _(b,C){switch(C){case Float32Array:return b.DT_FLOAT32;case Int8Array:return b.DT_INT8;case Int16Array:return b.DT_INT16;case Int32Array:return b.DT_INT32;case Uint8Array:return b.DT_UINT8;case Uint16Array:return b.DT_UINT16;case Uint32Array:return b.DT_UINT32}}}function D(G,m,x=!0){if(!m||!m.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!G.hasAttribute("position")||!G.hasAttribute("normal")||!G.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function w(b){if(b.normalized||b.isInterleavedBufferAttribute){const C=new Float32Array(b.count*b.itemSize);for(let k=0,V=0;k<b.count;k++)C[V++]=b.getX(k),C[V++]=b.getY(k),b.itemSize>2&&(C[V++]=b.getZ(k));return C}return b.array instanceof Float32Array?b.array:new Float32Array(b.array)}const v=G.index?G.toNonIndexed():G,_=m.generateTangents(w(v.attributes.position),w(v.attributes.normal),w(v.attributes.uv));if(x)for(let b=3;b<_.length;b+=4)_[b]*=-1;return v.setAttribute("tangent",new BufferAttribute(_,4)),G!==v&&G.copy(v),G}function Y(G,m=!1){const x=G[0].index!==null,w=new Set(Object.keys(G[0].attributes)),v=new Set(Object.keys(G[0].morphAttributes)),_={},b={},C=G[0].morphTargetsRelative,k=new BufferGeometry;let V=0;for(let U=0;U<G.length;++U){const H=G[U];let K=0;if(x!==(H.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+U+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const nt in H.attributes){if(!w.has(nt))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+U+'. All geometries must have compatible attributes; make sure "'+nt+'" attribute exists among all geometries, or in none of them.'),null;_[nt]===void 0&&(_[nt]=[]),_[nt].push(H.attributes[nt]),K++}if(K!==w.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+U+". Make sure all geometries have the same number of attributes."),null;if(C!==H.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+U+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const nt in H.morphAttributes){if(!v.has(nt))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+U+".  .morphAttributes must be consistent throughout all geometries."),null;b[nt]===void 0&&(b[nt]=[]),b[nt].push(H.morphAttributes[nt])}if(m){let nt;if(x)nt=H.index.count;else if(H.attributes.position!==void 0)nt=H.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+U+". The geometry must have either an index or a position attribute"),null;k.addGroup(V,nt,U),V+=nt}}if(x){let U=0;const H=[];for(let K=0;K<G.length;++K){const nt=G[K].index;for(let vt=0;vt<nt.count;++vt)H.push(nt.getX(vt)+U);U+=G[K].attributes.position.count}k.setIndex(H)}for(const U in _){const H=ft(_[U]);if(!H)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+U+" attribute."),null;k.setAttribute(U,H)}for(const U in b){const H=b[U][0].length;if(H===0)break;k.morphAttributes=k.morphAttributes||{},k.morphAttributes[U]=[];for(let K=0;K<H;++K){const nt=[];for(let Mt=0;Mt<b[U].length;++Mt)nt.push(b[U][Mt][K]);const vt=ft(nt);if(!vt)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+U+" morphAttribute."),null;k.morphAttributes[U].push(vt)}}return k}function ft(G){let m,x,w,v=-1,_=0;for(let V=0;V<G.length;++V){const U=G[V];if(m===void 0&&(m=U.array.constructor),m!==U.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(x===void 0&&(x=U.itemSize),x!==U.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(w===void 0&&(w=U.normalized),w!==U.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(v===-1&&(v=U.gpuType),v!==U.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;_+=U.count*x}const b=new m(_),C=new BufferAttribute(b,x,w);let k=0;for(let V=0;V<G.length;++V){const U=G[V];if(U.isInterleavedBufferAttribute){const H=k/x;for(let K=0,nt=U.count;K<nt;K++)for(let vt=0;vt<x;vt++){const Mt=U.getComponent(K,vt);C.setComponent(K+H,vt,Mt)}}else b.set(U.array,k);k+=U.count*x}return v!==void 0&&(C.gpuType=v),C}function M(G){return G.isInstancedInterleavedBufferAttribute||G.isInterleavedBufferAttribute?O(G):G.isInstancedBufferAttribute?new InstancedBufferAttribute().copy(G):new BufferAttribute().copy(G)}function q(G){let m,x=0,w=0;for(let V=0,U=G.length;V<U;++V){const H=G[V];if(m===void 0&&(m=H.array.constructor),m!==H.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;x+=H.array.length,w+=H.itemSize}const v=new InterleavedBuffer(new m(x),w);let _=0;const b=[],C=["getX","getY","getZ","getW"],k=["setX","setY","setZ","setW"];for(let V=0,U=G.length;V<U;V++){const H=G[V],K=H.itemSize,nt=H.count,vt=new InterleavedBufferAttribute(v,K,_,H.normalized);b.push(vt),_+=K;for(let Mt=0;Mt<nt;Mt++)for(let _t=0;_t<K;_t++)vt[k[_t]](Mt,H[C[_t]](Mt))}return b}function O(G){const m=G.data.array.constructor,x=G.count,w=G.itemSize,v=G.normalized,_=new m(x*w);let b;G.isInstancedInterleavedBufferAttribute?b=new InstancedBufferAttribute(_,w,v,G.meshPerAttribute):b=new BufferAttribute(_,w,v);for(let C=0;C<x;C++)b.setX(C,G.getX(C)),w>=2&&b.setY(C,G.getY(C)),w>=3&&b.setZ(C,G.getZ(C)),w>=4&&b.setW(C,G.getW(C));return b}function A(G){const m=G.attributes,x=G.morphTargets,w=new Map;for(const v in m){const _=m[v];_.isInterleavedBufferAttribute&&(w.has(_)||w.set(_,O(_)),m[v]=w.get(_))}for(const v in x){const _=x[v];_.isInterleavedBufferAttribute&&(w.has(_)||w.set(_,O(_)),x[v]=w.get(_))}}function y(G){let m=0;for(const w in G.attributes){const v=G.getAttribute(w);m+=v.count*v.itemSize*v.array.BYTES_PER_ELEMENT}const x=G.getIndex();return m+=x?x.count*x.itemSize*x.array.BYTES_PER_ELEMENT:0,m}function g(G,m=1e-4){m=Math.max(m,Number.EPSILON);const x={},w=G.getIndex(),v=G.getAttribute("position"),_=w?w.count:v.count;let b=0;const C=Object.keys(G.attributes),k={},V={},U=[],H=["getX","getY","getZ","getW"],K=["setX","setY","setZ","setW"];for(let kt=0,Zt=C.length;kt<Zt;kt++){const Rt=C[kt],$t=G.attributes[Rt];k[Rt]=new $t.constructor(new $t.array.constructor($t.count*$t.itemSize),$t.itemSize,$t.normalized);const ye=G.morphAttributes[Rt];ye&&(V[Rt]||(V[Rt]=[]),ye.forEach((Kt,Qt)=>{const he=new Kt.array.constructor(Kt.count*Kt.itemSize);V[Rt][Qt]=new Kt.constructor(he,Kt.itemSize,Kt.normalized)}))}const nt=m*.5,vt=Math.log10(1/m),Mt=Math.pow(10,vt),_t=nt*Mt;for(let kt=0;kt<_;kt++){const Zt=w?w.getX(kt):kt;let Rt="";for(let $t=0,ye=C.length;$t<ye;$t++){const Kt=C[$t],Qt=G.getAttribute(Kt),he=Qt.itemSize;for(let we=0;we<he;we++)Rt+=`${~~(Qt[H[we]](Zt)*Mt+_t)},`}if(Rt in x)U.push(x[Rt]);else{for(let $t=0,ye=C.length;$t<ye;$t++){const Kt=C[$t],Qt=G.getAttribute(Kt),he=G.morphAttributes[Kt],we=Qt.itemSize,vs=k[Kt],ds=V[Kt];for(let qe=0;qe<we;qe++){const is=H[qe],Is=K[qe];if(vs[Is](b,Qt[is](Zt)),he)for(let ps=0,Pi=he.length;ps<Pi;ps++)ds[ps][Is](b,he[ps][is](Zt))}}x[Rt]=b,U.push(b),b++}}const At=G.clone();for(const kt in G.attributes){const Zt=k[kt];if(At.setAttribute(kt,new Zt.constructor(Zt.array.slice(0,b*Zt.itemSize),Zt.itemSize,Zt.normalized)),kt in V)for(let Rt=0;Rt<V[kt].length;Rt++){const $t=V[kt][Rt];At.morphAttributes[kt][Rt]=new $t.constructor($t.array.slice(0,b*$t.itemSize),$t.itemSize,$t.normalized)}}return At.setIndex(U),At}function T(G,m){if(m===I.RJ4)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),G;if(m===I.rYR||m===I.O49){let x=G.getIndex();if(x===null){const b=[],C=G.getAttribute("position");if(C!==void 0){for(let k=0;k<C.count;k++)b.push(k);G.setIndex(b),x=G.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),G}const w=x.count-2,v=[];if(m===I.rYR)for(let b=1;b<=w;b++)v.push(x.getX(0)),v.push(x.getX(b)),v.push(x.getX(b+1));else for(let b=0;b<w;b++)b%2===0?(v.push(x.getX(b)),v.push(x.getX(b+1)),v.push(x.getX(b+2))):(v.push(x.getX(b+2)),v.push(x.getX(b+1)),v.push(x.getX(b)));v.length/3!==w&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const _=G.clone();return _.setIndex(v),_.clearGroups(),_}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",m),G}function P(G){const m=new Vector3,x=new Vector3,w=new Vector3,v=new Vector3,_=new Vector3,b=new Vector3,C=new Vector3,k=new Vector3,V=new Vector3;function U(ii,Bi,zi,wn,Gs,Js,Xs,bs){m.fromBufferAttribute(Bi,Gs),x.fromBufferAttribute(Bi,Js),w.fromBufferAttribute(Bi,Xs);const Zi=ii.morphTargetInfluences;if(zi&&Zi){C.set(0,0,0),k.set(0,0,0),V.set(0,0,0);for(let ui=0,_n=zi.length;ui<_n;ui++){const Ns=Zi[ui],ki=zi[ui];Ns!==0&&(v.fromBufferAttribute(ki,Gs),_.fromBufferAttribute(ki,Js),b.fromBufferAttribute(ki,Xs),wn?(C.addScaledVector(v,Ns),k.addScaledVector(_,Ns),V.addScaledVector(b,Ns)):(C.addScaledVector(v.sub(m),Ns),k.addScaledVector(_.sub(x),Ns),V.addScaledVector(b.sub(w),Ns)))}m.add(C),x.add(k),w.add(V)}ii.isSkinnedMesh&&(ii.applyBoneTransform(Gs,m),ii.applyBoneTransform(Js,x),ii.applyBoneTransform(Xs,w)),bs[Gs*3+0]=m.x,bs[Gs*3+1]=m.y,bs[Gs*3+2]=m.z,bs[Js*3+0]=x.x,bs[Js*3+1]=x.y,bs[Js*3+2]=x.z,bs[Xs*3+0]=w.x,bs[Xs*3+1]=w.y,bs[Xs*3+2]=w.z}const H=G.geometry,K=G.material;let nt,vt,Mt;const _t=H.index,At=H.attributes.position,kt=H.morphAttributes.position,Zt=H.morphTargetsRelative,Rt=H.attributes.normal,$t=H.morphAttributes.position,ye=H.groups,Kt=H.drawRange;let Qt,he,we,vs,ds,qe,is;const Is=new Float32Array(At.count*At.itemSize),ps=new Float32Array(Rt.count*Rt.itemSize);if(_t!==null)if(Array.isArray(K))for(Qt=0,we=ye.length;Qt<we;Qt++)for(ds=ye[Qt],qe=Math.max(ds.start,Kt.start),is=Math.min(ds.start+ds.count,Kt.start+Kt.count),he=qe,vs=is;he<vs;he+=3)nt=_t.getX(he),vt=_t.getX(he+1),Mt=_t.getX(he+2),U(G,At,kt,Zt,nt,vt,Mt,Is),U(G,Rt,$t,Zt,nt,vt,Mt,ps);else for(qe=Math.max(0,Kt.start),is=Math.min(_t.count,Kt.start+Kt.count),Qt=qe,we=is;Qt<we;Qt+=3)nt=_t.getX(Qt),vt=_t.getX(Qt+1),Mt=_t.getX(Qt+2),U(G,At,kt,Zt,nt,vt,Mt,Is),U(G,Rt,$t,Zt,nt,vt,Mt,ps);else if(Array.isArray(K))for(Qt=0,we=ye.length;Qt<we;Qt++)for(ds=ye[Qt],qe=Math.max(ds.start,Kt.start),is=Math.min(ds.start+ds.count,Kt.start+Kt.count),he=qe,vs=is;he<vs;he+=3)nt=he,vt=he+1,Mt=he+2,U(G,At,kt,Zt,nt,vt,Mt,Is),U(G,Rt,$t,Zt,nt,vt,Mt,ps);else for(qe=Math.max(0,Kt.start),is=Math.min(At.count,Kt.start+Kt.count),Qt=qe,we=is;Qt<we;Qt+=3)nt=Qt,vt=Qt+1,Mt=Qt+2,U(G,At,kt,Zt,nt,vt,Mt,Is),U(G,Rt,$t,Zt,nt,vt,Mt,ps);const Pi=new Float32BufferAttribute(Is,3),Mn=new Float32BufferAttribute(ps,3);return{positionAttribute:At,normalAttribute:Rt,morphedPositionAttribute:Pi,morphedNormalAttribute:Mn}}function Z(G){if(G.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),G;let m=G.groups;if(m=m.sort((b,C)=>b.materialIndex!==C.materialIndex?b.materialIndex-C.materialIndex:b.start-C.start),G.getIndex()===null){const b=G.getAttribute("position"),C=[];for(let k=0;k<b.count;k+=3)C.push(k,k+1,k+2);G.setIndex(C)}const x=G.getIndex(),w=[];for(let b=0;b<m.length;b++){const C=m[b],k=C.start,V=k+C.count;for(let U=k;U<V;U++)w.push(x.getX(U))}G.dispose(),G.setIndex(w);let v=0;for(let b=0;b<m.length;b++){const C=m[b];C.start=v,v+=C.count}let _=m[0];G.groups=[_];for(let b=1;b<m.length;b++){const C=m[b];_.materialIndex===C.materialIndex?_.count+=C.count:(_=C,G.groups.push(_))}return G}function tt(G,m=Math.PI/3){const x=Math.cos(m),w=(1+1e-10)*100,v=[new Vector3,new Vector3,new Vector3],_=new Vector3,b=new Vector3,C=new Vector3,k=new Vector3;function V(Mt){const _t=~~(Mt.x*w),At=~~(Mt.y*w),kt=~~(Mt.z*w);return`${_t},${At},${kt}`}const U=G.index?G.toNonIndexed():G,H=U.attributes.position,K={};for(let Mt=0,_t=H.count/3;Mt<_t;Mt++){const At=3*Mt,kt=v[0].fromBufferAttribute(H,At+0),Zt=v[1].fromBufferAttribute(H,At+1),Rt=v[2].fromBufferAttribute(H,At+2);_.subVectors(Rt,Zt),b.subVectors(kt,Zt);const $t=new Vector3().crossVectors(_,b).normalize();for(let ye=0;ye<3;ye++){const Kt=v[ye],Qt=V(Kt);Qt in K||(K[Qt]=[]),K[Qt].push($t)}}const nt=new Float32Array(H.count*3),vt=new BufferAttribute(nt,3,!1);for(let Mt=0,_t=H.count/3;Mt<_t;Mt++){const At=3*Mt,kt=v[0].fromBufferAttribute(H,At+0),Zt=v[1].fromBufferAttribute(H,At+1),Rt=v[2].fromBufferAttribute(H,At+2);_.subVectors(Rt,Zt),b.subVectors(kt,Zt),C.crossVectors(_,b).normalize();for(let $t=0;$t<3;$t++){const ye=v[$t],Kt=V(ye),Qt=K[Kt];k.set(0,0,0);for(let he=0,we=Qt.length;he<we;he++){const vs=Qt[he];C.dot(vs)>x&&k.add(vs)}k.normalize(),vt.setXYZ(At+$t,k.x,k.y,k.z)}}return U.setAttribute("normal",vt),U}class R extends I.aHM{constructor(m){super(m),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(x){return new yt(x)}),this.register(function(x){return new it(x)}),this.register(function(x){return new ee(x)}),this.register(function(x){return new Le(x)}),this.register(function(x){return new Te(x)}),this.register(function(x){return new pt(x)}),this.register(function(x){return new dt(x)}),this.register(function(x){return new Ft(x)}),this.register(function(x){return new Wt(x)}),this.register(function(x){return new ht(x)}),this.register(function(x){return new qt(x)}),this.register(function(x){return new $(x)}),this.register(function(x){return new le(x)}),this.register(function(x){return new me(x)}),this.register(function(x){return new lt(x)}),this.register(function(x){return new Ke(x)}),this.register(function(x){return new Xe(x)})}load(m,x,w,v){const _=this;let b;if(this.resourcePath!=="")b=this.resourcePath;else if(this.path!==""){const V=I.r6x.extractUrlBase(m);b=I.r6x.resolveURL(V,this.path)}else b=I.r6x.extractUrlBase(m);this.manager.itemStart(m);const C=function(V){v?v(V):console.error(V),_.manager.itemError(m),_.manager.itemEnd(m)},k=new I.Y9S(this.manager);k.setPath(this.path),k.setResponseType("arraybuffer"),k.setRequestHeader(this.requestHeader),k.setWithCredentials(this.withCredentials),k.load(m,function(V){try{_.parse(V,b,function(U){x(U),_.manager.itemEnd(m)},C)}catch(U){C(U)}},w,C)}setDRACOLoader(m){return this.dracoLoader=m,this}setKTX2Loader(m){return this.ktx2Loader=m,this}setMeshoptDecoder(m){return this.meshoptDecoder=m,this}register(m){return this.pluginCallbacks.indexOf(m)===-1&&this.pluginCallbacks.push(m),this}unregister(m){return this.pluginCallbacks.indexOf(m)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(m),1),this}parse(m,x,w,v){let _;const b={},C={},k=new TextDecoder;if(typeof m=="string")_=JSON.parse(m);else if(m instanceof ArrayBuffer)if(k.decode(new Uint8Array(m,0,4))===cs){try{b[J.KHR_BINARY_GLTF]=new Qe(m)}catch(H){v&&v(H);return}_=JSON.parse(b[J.KHR_BINARY_GLTF].content)}else _=JSON.parse(k.decode(m));else _=m;if(_.asset===void 0||_.asset.version[0]<2){v&&v(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const V=new Ut(_,{path:x||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});V.fileLoader.setRequestHeader(this.requestHeader);for(let U=0;U<this.pluginCallbacks.length;U++){const H=this.pluginCallbacks[U](V);H.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),C[H.name]=H,b[H.name]=!0}if(_.extensionsUsed)for(let U=0;U<_.extensionsUsed.length;++U){const H=_.extensionsUsed[U],K=_.extensionsRequired||[];switch(H){case J.KHR_MATERIALS_UNLIT:b[H]=new st;break;case J.KHR_DRACO_MESH_COMPRESSION:b[H]=new ts(_,this.dracoLoader);break;case J.KHR_TEXTURE_TRANSFORM:b[H]=new Ae;break;case J.KHR_MESH_QUANTIZATION:b[H]=new ls;break;default:K.indexOf(H)>=0&&C[H]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+H+'".')}}V.setExtensions(b),V.setPlugins(C),V.parse(w,v)}parseAsync(m,x){const w=this;return new Promise(function(v,_){w.parse(m,x,v,_)})}}function j(){let G={};return{get:function(m){return G[m]},add:function(m,x){G[m]=x},remove:function(m){delete G[m]},removeAll:function(){G={}}}}const J={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class lt{constructor(m){this.parser=m,this.name=J.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const m=this.parser,x=this.parser.json.nodes||[];for(let w=0,v=x.length;w<v;w++){const _=x[w];_.extensions&&_.extensions[this.name]&&_.extensions[this.name].light!==void 0&&m._addNodeRef(this.cache,_.extensions[this.name].light)}}_loadLight(m){const x=this.parser,w="light:"+m;let v=x.cache.get(w);if(v)return v;const _=x.json,k=((_.extensions&&_.extensions[this.name]||{}).lights||[])[m];let V;const U=new I.Q1f(16777215);k.color!==void 0&&U.setRGB(k.color[0],k.color[1],k.color[2],I.Zr2);const H=k.range!==void 0?k.range:0;switch(k.type){case"directional":V=new I.ZyN(U),V.target.position.set(0,0,-1),V.add(V.target);break;case"point":V=new I.HiM(U),V.distance=H;break;case"spot":V=new I.nCl(U),V.distance=H,k.spot=k.spot||{},k.spot.innerConeAngle=k.spot.innerConeAngle!==void 0?k.spot.innerConeAngle:0,k.spot.outerConeAngle=k.spot.outerConeAngle!==void 0?k.spot.outerConeAngle:Math.PI/4,V.angle=k.spot.outerConeAngle,V.penumbra=1-k.spot.innerConeAngle/k.spot.outerConeAngle,V.target.position.set(0,0,-1),V.add(V.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+k.type)}return V.position.set(0,0,0),wt(V,k),k.intensity!==void 0&&(V.intensity=k.intensity),V.name=x.createUniqueName(k.name||"light_"+m),v=Promise.resolve(V),x.cache.add(w,v),v}getDependency(m,x){if(m==="light")return this._loadLight(x)}createNodeAttachment(m){const x=this,w=this.parser,_=w.json.nodes[m],C=(_.extensions&&_.extensions[this.name]||{}).light;return C===void 0?null:this._loadLight(C).then(function(k){return w._getNodeRef(x.cache,C,k)})}}class st{constructor(){this.name=J.KHR_MATERIALS_UNLIT}getMaterialType(){return I.V9B}extendParams(m,x,w){const v=[];m.color=new I.Q1f(1,1,1),m.opacity=1;const _=x.pbrMetallicRoughness;if(_){if(Array.isArray(_.baseColorFactor)){const b=_.baseColorFactor;m.color.setRGB(b[0],b[1],b[2],I.Zr2),m.opacity=b[3]}_.baseColorTexture!==void 0&&v.push(w.assignTexture(m,"map",_.baseColorTexture,I.er$))}return Promise.all(v)}}class ht{constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(m,x){const v=this.parser.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=v.extensions[this.name].emissiveStrength;return _!==void 0&&(x.emissiveIntensity=_),Promise.resolve()}}class yt{constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_CLEARCOAT}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const w=this.parser,v=w.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=[],b=v.extensions[this.name];if(b.clearcoatFactor!==void 0&&(x.clearcoat=b.clearcoatFactor),b.clearcoatTexture!==void 0&&_.push(w.assignTexture(x,"clearcoatMap",b.clearcoatTexture)),b.clearcoatRoughnessFactor!==void 0&&(x.clearcoatRoughness=b.clearcoatRoughnessFactor),b.clearcoatRoughnessTexture!==void 0&&_.push(w.assignTexture(x,"clearcoatRoughnessMap",b.clearcoatRoughnessTexture)),b.clearcoatNormalTexture!==void 0&&(_.push(w.assignTexture(x,"clearcoatNormalMap",b.clearcoatNormalTexture)),b.clearcoatNormalTexture.scale!==void 0)){const C=b.clearcoatNormalTexture.scale;x.clearcoatNormalScale=new I.I9Y(C,C)}return Promise.all(_)}}class it{constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_DISPERSION}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const v=this.parser.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=v.extensions[this.name];return x.dispersion=_.dispersion!==void 0?_.dispersion:0,Promise.resolve()}}class ${constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_IRIDESCENCE}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const w=this.parser,v=w.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=[],b=v.extensions[this.name];return b.iridescenceFactor!==void 0&&(x.iridescence=b.iridescenceFactor),b.iridescenceTexture!==void 0&&_.push(w.assignTexture(x,"iridescenceMap",b.iridescenceTexture)),b.iridescenceIor!==void 0&&(x.iridescenceIOR=b.iridescenceIor),x.iridescenceThicknessRange===void 0&&(x.iridescenceThicknessRange=[100,400]),b.iridescenceThicknessMinimum!==void 0&&(x.iridescenceThicknessRange[0]=b.iridescenceThicknessMinimum),b.iridescenceThicknessMaximum!==void 0&&(x.iridescenceThicknessRange[1]=b.iridescenceThicknessMaximum),b.iridescenceThicknessTexture!==void 0&&_.push(w.assignTexture(x,"iridescenceThicknessMap",b.iridescenceThicknessTexture)),Promise.all(_)}}class pt{constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_SHEEN}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const w=this.parser,v=w.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=[];x.sheenColor=new I.Q1f(0,0,0),x.sheenRoughness=0,x.sheen=1;const b=v.extensions[this.name];if(b.sheenColorFactor!==void 0){const C=b.sheenColorFactor;x.sheenColor.setRGB(C[0],C[1],C[2],I.Zr2)}return b.sheenRoughnessFactor!==void 0&&(x.sheenRoughness=b.sheenRoughnessFactor),b.sheenColorTexture!==void 0&&_.push(w.assignTexture(x,"sheenColorMap",b.sheenColorTexture,I.er$)),b.sheenRoughnessTexture!==void 0&&_.push(w.assignTexture(x,"sheenRoughnessMap",b.sheenRoughnessTexture)),Promise.all(_)}}class dt{constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_TRANSMISSION}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const w=this.parser,v=w.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=[],b=v.extensions[this.name];return b.transmissionFactor!==void 0&&(x.transmission=b.transmissionFactor),b.transmissionTexture!==void 0&&_.push(w.assignTexture(x,"transmissionMap",b.transmissionTexture)),Promise.all(_)}}class Ft{constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_VOLUME}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const w=this.parser,v=w.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=[],b=v.extensions[this.name];x.thickness=b.thicknessFactor!==void 0?b.thicknessFactor:0,b.thicknessTexture!==void 0&&_.push(w.assignTexture(x,"thicknessMap",b.thicknessTexture)),x.attenuationDistance=b.attenuationDistance||1/0;const C=b.attenuationColor||[1,1,1];return x.attenuationColor=new I.Q1f().setRGB(C[0],C[1],C[2],I.Zr2),Promise.all(_)}}class Wt{constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_IOR}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const v=this.parser.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=v.extensions[this.name];return x.ior=_.ior!==void 0?_.ior:1.5,Promise.resolve()}}class qt{constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_SPECULAR}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const w=this.parser,v=w.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=[],b=v.extensions[this.name];x.specularIntensity=b.specularFactor!==void 0?b.specularFactor:1,b.specularTexture!==void 0&&_.push(w.assignTexture(x,"specularIntensityMap",b.specularTexture));const C=b.specularColorFactor||[1,1,1];return x.specularColor=new I.Q1f().setRGB(C[0],C[1],C[2],I.Zr2),b.specularColorTexture!==void 0&&_.push(w.assignTexture(x,"specularColorMap",b.specularColorTexture,I.er$)),Promise.all(_)}}class me{constructor(m){this.parser=m,this.name=J.EXT_MATERIALS_BUMP}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const w=this.parser,v=w.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=[],b=v.extensions[this.name];return x.bumpScale=b.bumpFactor!==void 0?b.bumpFactor:1,b.bumpTexture!==void 0&&_.push(w.assignTexture(x,"bumpMap",b.bumpTexture)),Promise.all(_)}}class le{constructor(m){this.parser=m,this.name=J.KHR_MATERIALS_ANISOTROPY}getMaterialType(m){const w=this.parser.json.materials[m];return!w.extensions||!w.extensions[this.name]?null:I.uSd}extendMaterialParams(m,x){const w=this.parser,v=w.json.materials[m];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const _=[],b=v.extensions[this.name];return b.anisotropyStrength!==void 0&&(x.anisotropy=b.anisotropyStrength),b.anisotropyRotation!==void 0&&(x.anisotropyRotation=b.anisotropyRotation),b.anisotropyTexture!==void 0&&_.push(w.assignTexture(x,"anisotropyMap",b.anisotropyTexture)),Promise.all(_)}}class ee{constructor(m){this.parser=m,this.name=J.KHR_TEXTURE_BASISU}loadTexture(m){const x=this.parser,w=x.json,v=w.textures[m];if(!v.extensions||!v.extensions[this.name])return null;const _=v.extensions[this.name],b=x.options.ktx2Loader;if(!b){if(w.extensionsRequired&&w.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return x.loadTextureImage(m,_.source,b)}}class Le{constructor(m){this.parser=m,this.name=J.EXT_TEXTURE_WEBP}loadTexture(m){const x=this.name,w=this.parser,v=w.json,_=v.textures[m];if(!_.extensions||!_.extensions[x])return null;const b=_.extensions[x],C=v.images[b.source];let k=w.textureLoader;if(C.uri){const V=w.options.manager.getHandler(C.uri);V!==null&&(k=V)}return w.loadTextureImage(m,b.source,k)}}class Te{constructor(m){this.parser=m,this.name=J.EXT_TEXTURE_AVIF}loadTexture(m){const x=this.name,w=this.parser,v=w.json,_=v.textures[m];if(!_.extensions||!_.extensions[x])return null;const b=_.extensions[x],C=v.images[b.source];let k=w.textureLoader;if(C.uri){const V=w.options.manager.getHandler(C.uri);V!==null&&(k=V)}return w.loadTextureImage(m,b.source,k)}}class Ke{constructor(m){this.name=J.EXT_MESHOPT_COMPRESSION,this.parser=m}loadBufferView(m){const x=this.parser.json,w=x.bufferViews[m];if(w.extensions&&w.extensions[this.name]){const v=w.extensions[this.name],_=this.parser.getDependency("buffer",v.buffer),b=this.parser.options.meshoptDecoder;if(!b||!b.supported){if(x.extensionsRequired&&x.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return _.then(function(C){const k=v.byteOffset||0,V=v.byteLength||0,U=v.count,H=v.byteStride,K=new Uint8Array(C,k,V);return b.decodeGltfBufferAsync?b.decodeGltfBufferAsync(U,H,K,v.mode,v.filter).then(function(nt){return nt.buffer}):b.ready.then(function(){const nt=new ArrayBuffer(U*H);return b.decodeGltfBuffer(new Uint8Array(nt),U,H,K,v.mode,v.filter),nt})})}else return null}}class Xe{constructor(m){this.name=J.EXT_MESH_GPU_INSTANCING,this.parser=m}createNodeMesh(m){const x=this.parser.json,w=x.nodes[m];if(!w.extensions||!w.extensions[this.name]||w.mesh===void 0)return null;const v=x.meshes[w.mesh];for(const V of v.primitives)if(V.mode!==ke.TRIANGLES&&V.mode!==ke.TRIANGLE_STRIP&&V.mode!==ke.TRIANGLE_FAN&&V.mode!==void 0)return null;const b=w.extensions[this.name].attributes,C=[],k={};for(const V in b)C.push(this.parser.getDependency("accessor",b[V]).then(U=>(k[V]=U,k[V])));return C.length<1?null:(C.push(this.parser.createNodeMesh(m)),Promise.all(C).then(V=>{const U=V.pop(),H=U.isGroup?U.children:[U],K=V[0].count,nt=[];for(const vt of H){const Mt=new I.kn4,_t=new I.Pq0,At=new I.PTz,kt=new I.Pq0(1,1,1),Zt=new I.ZLX(vt.geometry,vt.material,K);for(let Rt=0;Rt<K;Rt++)k.TRANSLATION&&_t.fromBufferAttribute(k.TRANSLATION,Rt),k.ROTATION&&At.fromBufferAttribute(k.ROTATION,Rt),k.SCALE&&kt.fromBufferAttribute(k.SCALE,Rt),Zt.setMatrixAt(Rt,Mt.compose(_t,At,kt));for(const Rt in k)if(Rt==="_COLOR_0"){const $t=k[Rt];Zt.instanceColor=new I.uWO($t.array,$t.itemSize,$t.normalized)}else Rt!=="TRANSLATION"&&Rt!=="ROTATION"&&Rt!=="SCALE"&&vt.geometry.setAttribute(Rt,k[Rt]);I.B69.prototype.copy.call(Zt,vt),this.parser.assignFinalMaterial(Zt),nt.push(Zt)}return U.isGroup?(U.clear(),U.add(...nt),U):nt[0]}))}}const cs="glTF",Re=12,Ye={JSON:1313821514,BIN:5130562};class Qe{constructor(m){this.name=J.KHR_BINARY_GLTF,this.content=null,this.body=null;const x=new DataView(m,0,Re),w=new TextDecoder;if(this.header={magic:w.decode(new Uint8Array(m.slice(0,4))),version:x.getUint32(4,!0),length:x.getUint32(8,!0)},this.header.magic!==cs)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const v=this.header.length-Re,_=new DataView(m,Re);let b=0;for(;b<v;){const C=_.getUint32(b,!0);b+=4;const k=_.getUint32(b,!0);if(b+=4,k===Ye.JSON){const V=new Uint8Array(m,Re+b,C);this.content=w.decode(V)}else if(k===Ye.BIN){const V=Re+b;this.body=m.slice(V,V+C)}b+=C}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ts{constructor(m,x){if(!x)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=J.KHR_DRACO_MESH_COMPRESSION,this.json=m,this.dracoLoader=x,this.dracoLoader.preload()}decodePrimitive(m,x){const w=this.json,v=this.dracoLoader,_=m.extensions[this.name].bufferView,b=m.extensions[this.name].attributes,C={},k={},V={};for(const U in b){const H=Fs[U]||U.toLowerCase();C[H]=b[U]}for(const U in m.attributes){const H=Fs[U]||U.toLowerCase();if(b[U]!==void 0){const K=w.accessors[m.attributes[U]],nt=Ls[K.componentType];V[H]=nt.name,k[H]=K.normalized===!0}}return x.getDependency("bufferView",_).then(function(U){return new Promise(function(H,K){v.decodeDracoFile(U,function(nt){for(const vt in nt.attributes){const Mt=nt.attributes[vt],_t=k[vt];_t!==void 0&&(Mt.normalized=_t)}H(nt)},C,V,I.Zr2,K)})})}}class Ae{constructor(){this.name=J.KHR_TEXTURE_TRANSFORM}extendTexture(m,x){return(x.texCoord===void 0||x.texCoord===m.channel)&&x.offset===void 0&&x.rotation===void 0&&x.scale===void 0||(m=m.clone(),x.texCoord!==void 0&&(m.channel=x.texCoord),x.offset!==void 0&&m.offset.fromArray(x.offset),x.rotation!==void 0&&(m.rotation=x.rotation),x.scale!==void 0&&m.repeat.fromArray(x.scale),m.needsUpdate=!0),m}}class ls{constructor(){this.name=J.KHR_MESH_QUANTIZATION}}class us extends I.lGw{constructor(m,x,w,v){super(m,x,w,v)}copySampleValue_(m){const x=this.resultBuffer,w=this.sampleValues,v=this.valueSize,_=m*v*3+v;for(let b=0;b!==v;b++)x[b]=w[_+b];return x}interpolate_(m,x,w,v){const _=this.resultBuffer,b=this.sampleValues,C=this.valueSize,k=C*2,V=C*3,U=v-x,H=(w-x)/U,K=H*H,nt=K*H,vt=m*V,Mt=vt-V,_t=-2*nt+3*K,At=nt-K,kt=1-_t,Zt=At-K+H;for(let Rt=0;Rt!==C;Rt++){const $t=b[Mt+Rt+C],ye=b[Mt+Rt+k]*U,Kt=b[vt+Rt+C],Qt=b[vt+Rt]*U;_[Rt]=kt*$t+Zt*ye+_t*Kt+At*Qt}return _}}const es=new I.PTz;class ss extends us{interpolate_(m,x,w,v){const _=super.interpolate_(m,x,w,v);return es.fromArray(_).normalize().toArray(_),_}}const ke={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ls={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ei={9728:I.hxR,9729:I.k6q,9984:I.pHI,9985:I.kRr,9986:I.Cfg,9987:I.$_I},Ri={33071:I.ghU,33648:I.kTW,10497:I.GJx},ci={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fs={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},xs={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},qi={CUBICSPLINE:void 0,LINEAR:I.PJ3,STEP:I.ljd},It={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function X(G){return G.DefaultMaterial===void 0&&(G.DefaultMaterial=new I._4j({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:I.hB5})),G.DefaultMaterial}function ut(G,m,x){for(const w in x.extensions)G[w]===void 0&&(m.userData.gltfExtensions=m.userData.gltfExtensions||{},m.userData.gltfExtensions[w]=x.extensions[w])}function wt(G,m){m.extras!==void 0&&(typeof m.extras=="object"?Object.assign(G.userData,m.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+m.extras))}function Nt(G,m,x){let w=!1,v=!1,_=!1;for(let V=0,U=m.length;V<U;V++){const H=m[V];if(H.POSITION!==void 0&&(w=!0),H.NORMAL!==void 0&&(v=!0),H.COLOR_0!==void 0&&(_=!0),w&&v&&_)break}if(!w&&!v&&!_)return Promise.resolve(G);const b=[],C=[],k=[];for(let V=0,U=m.length;V<U;V++){const H=m[V];if(w){const K=H.POSITION!==void 0?x.getDependency("accessor",H.POSITION):G.attributes.position;b.push(K)}if(v){const K=H.NORMAL!==void 0?x.getDependency("accessor",H.NORMAL):G.attributes.normal;C.push(K)}if(_){const K=H.COLOR_0!==void 0?x.getDependency("accessor",H.COLOR_0):G.attributes.color;k.push(K)}}return Promise.all([Promise.all(b),Promise.all(C),Promise.all(k)]).then(function(V){const U=V[0],H=V[1],K=V[2];return w&&(G.morphAttributes.position=U),v&&(G.morphAttributes.normal=H),_&&(G.morphAttributes.color=K),G.morphTargetsRelative=!0,G})}function Bt(G,m){if(G.updateMorphTargets(),m.weights!==void 0)for(let x=0,w=m.weights.length;x<w;x++)G.morphTargetInfluences[x]=m.weights[x];if(m.extras&&Array.isArray(m.extras.targetNames)){const x=m.extras.targetNames;if(G.morphTargetInfluences.length===x.length){G.morphTargetDictionary={};for(let w=0,v=x.length;w<v;w++)G.morphTargetDictionary[x[w]]=w}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function St(G){let m;const x=G.extensions&&G.extensions[J.KHR_DRACO_MESH_COMPRESSION];if(x?m="draco:"+x.bufferView+":"+x.indices+":"+Vt(x.attributes):m=G.indices+":"+Vt(G.attributes)+":"+G.mode,G.targets!==void 0)for(let w=0,v=G.targets.length;w<v;w++)m+=":"+Vt(G.targets[w]);return m}function Vt(G){let m="";const x=Object.keys(G).sort();for(let w=0,v=x.length;w<v;w++)m+=x[w]+":"+G[x[w]]+";";return m}function Ct(G){switch(G){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function zt(G){return G.search(/\.jpe?g($|\?)/i)>0||G.search(/^data\:image\/jpeg/)===0?"image/jpeg":G.search(/\.webp($|\?)/i)>0||G.search(/^data\:image\/webp/)===0?"image/webp":G.search(/\.ktx2($|\?)/i)>0||G.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const re=new I.kn4;class Ut{constructor(m={},x={}){this.json=m,this.extensions={},this.plugins={},this.options=x,this.cache=new j,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let w=!1,v=-1,_=!1,b=-1;if(typeof navigator<"u"){const C=navigator.userAgent;w=/^((?!chrome|android).)*safari/i.test(C)===!0;const k=C.match(/Version\/(\d+)/);v=w&&k?parseInt(k[1],10):-1,_=C.indexOf("Firefox")>-1,b=_?C.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||w&&v<17||_&&b<98?this.textureLoader=new I.Tap(this.options.manager):this.textureLoader=new I.Kzg(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new I.Y9S(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(m){this.extensions=m}setPlugins(m){this.plugins=m}parse(m,x){const w=this,v=this.json,_=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(b){return b._markDefs&&b._markDefs()}),Promise.all(this._invokeAll(function(b){return b.beforeRoot&&b.beforeRoot()})).then(function(){return Promise.all([w.getDependencies("scene"),w.getDependencies("animation"),w.getDependencies("camera")])}).then(function(b){const C={scene:b[0][v.scene||0],scenes:b[0],animations:b[1],cameras:b[2],asset:v.asset,parser:w,userData:{}};return ut(_,C,v),wt(C,v),Promise.all(w._invokeAll(function(k){return k.afterRoot&&k.afterRoot(C)})).then(function(){for(const k of C.scenes)k.updateMatrixWorld();m(C)})}).catch(x)}_markDefs(){const m=this.json.nodes||[],x=this.json.skins||[],w=this.json.meshes||[];for(let v=0,_=x.length;v<_;v++){const b=x[v].joints;for(let C=0,k=b.length;C<k;C++)m[b[C]].isBone=!0}for(let v=0,_=m.length;v<_;v++){const b=m[v];b.mesh!==void 0&&(this._addNodeRef(this.meshCache,b.mesh),b.skin!==void 0&&(w[b.mesh].isSkinnedMesh=!0)),b.camera!==void 0&&this._addNodeRef(this.cameraCache,b.camera)}}_addNodeRef(m,x){x!==void 0&&(m.refs[x]===void 0&&(m.refs[x]=m.uses[x]=0),m.refs[x]++)}_getNodeRef(m,x,w){if(m.refs[x]<=1)return w;const v=w.clone(),_=(b,C)=>{const k=this.associations.get(b);k!=null&&this.associations.set(C,k);for(const[V,U]of b.children.entries())_(U,C.children[V])};return _(w,v),v.name+="_instance_"+m.uses[x]++,v}_invokeOne(m){const x=Object.values(this.plugins);x.push(this);for(let w=0;w<x.length;w++){const v=m(x[w]);if(v)return v}return null}_invokeAll(m){const x=Object.values(this.plugins);x.unshift(this);const w=[];for(let v=0;v<x.length;v++){const _=m(x[v]);_&&w.push(_)}return w}getDependency(m,x){const w=m+":"+x;let v=this.cache.get(w);if(!v){switch(m){case"scene":v=this.loadScene(x);break;case"node":v=this._invokeOne(function(_){return _.loadNode&&_.loadNode(x)});break;case"mesh":v=this._invokeOne(function(_){return _.loadMesh&&_.loadMesh(x)});break;case"accessor":v=this.loadAccessor(x);break;case"bufferView":v=this._invokeOne(function(_){return _.loadBufferView&&_.loadBufferView(x)});break;case"buffer":v=this.loadBuffer(x);break;case"material":v=this._invokeOne(function(_){return _.loadMaterial&&_.loadMaterial(x)});break;case"texture":v=this._invokeOne(function(_){return _.loadTexture&&_.loadTexture(x)});break;case"skin":v=this.loadSkin(x);break;case"animation":v=this._invokeOne(function(_){return _.loadAnimation&&_.loadAnimation(x)});break;case"camera":v=this.loadCamera(x);break;default:if(v=this._invokeOne(function(_){return _!=this&&_.getDependency&&_.getDependency(m,x)}),!v)throw new Error("Unknown type: "+m);break}this.cache.add(w,v)}return v}getDependencies(m){let x=this.cache.get(m);if(!x){const w=this,v=this.json[m+(m==="mesh"?"es":"s")]||[];x=Promise.all(v.map(function(_,b){return w.getDependency(m,b)})),this.cache.add(m,x)}return x}loadBuffer(m){const x=this.json.buffers[m],w=this.fileLoader;if(x.type&&x.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+x.type+" buffer type is not supported.");if(x.uri===void 0&&m===0)return Promise.resolve(this.extensions[J.KHR_BINARY_GLTF].body);const v=this.options;return new Promise(function(_,b){w.load(I.r6x.resolveURL(x.uri,v.path),_,void 0,function(){b(new Error('THREE.GLTFLoader: Failed to load buffer "'+x.uri+'".'))})})}loadBufferView(m){const x=this.json.bufferViews[m];return this.getDependency("buffer",x.buffer).then(function(w){const v=x.byteLength||0,_=x.byteOffset||0;return w.slice(_,_+v)})}loadAccessor(m){const x=this,w=this.json,v=this.json.accessors[m];if(v.bufferView===void 0&&v.sparse===void 0){const b=ci[v.type],C=Ls[v.componentType],k=v.normalized===!0,V=new C(v.count*b);return Promise.resolve(new I.THS(V,b,k))}const _=[];return v.bufferView!==void 0?_.push(this.getDependency("bufferView",v.bufferView)):_.push(null),v.sparse!==void 0&&(_.push(this.getDependency("bufferView",v.sparse.indices.bufferView)),_.push(this.getDependency("bufferView",v.sparse.values.bufferView))),Promise.all(_).then(function(b){const C=b[0],k=ci[v.type],V=Ls[v.componentType],U=V.BYTES_PER_ELEMENT,H=U*k,K=v.byteOffset||0,nt=v.bufferView!==void 0?w.bufferViews[v.bufferView].byteStride:void 0,vt=v.normalized===!0;let Mt,_t;if(nt&&nt!==H){const At=Math.floor(K/nt),kt="InterleavedBuffer:"+v.bufferView+":"+v.componentType+":"+At+":"+v.count;let Zt=x.cache.get(kt);Zt||(Mt=new V(C,At*nt,v.count*nt/U),Zt=new I.eB$(Mt,nt/U),x.cache.add(kt,Zt)),_t=new I.eHs(Zt,k,K%nt/U,vt)}else C===null?Mt=new V(v.count*k):Mt=new V(C,K,v.count*k),_t=new I.THS(Mt,k,vt);if(v.sparse!==void 0){const At=ci.SCALAR,kt=Ls[v.sparse.indices.componentType],Zt=v.sparse.indices.byteOffset||0,Rt=v.sparse.values.byteOffset||0,$t=new kt(b[1],Zt,v.sparse.count*At),ye=new V(b[2],Rt,v.sparse.count*k);C!==null&&(_t=new I.THS(_t.array.slice(),_t.itemSize,_t.normalized)),_t.normalized=!1;for(let Kt=0,Qt=$t.length;Kt<Qt;Kt++){const he=$t[Kt];if(_t.setX(he,ye[Kt*k]),k>=2&&_t.setY(he,ye[Kt*k+1]),k>=3&&_t.setZ(he,ye[Kt*k+2]),k>=4&&_t.setW(he,ye[Kt*k+3]),k>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}_t.normalized=vt}return _t})}loadTexture(m){const x=this.json,w=this.options,_=x.textures[m].source,b=x.images[_];let C=this.textureLoader;if(b.uri){const k=w.manager.getHandler(b.uri);k!==null&&(C=k)}return this.loadTextureImage(m,_,C)}loadTextureImage(m,x,w){const v=this,_=this.json,b=_.textures[m],C=_.images[x],k=(C.uri||C.bufferView)+":"+b.sampler;if(this.textureCache[k])return this.textureCache[k];const V=this.loadImageSource(x,w).then(function(U){U.flipY=!1,U.name=b.name||C.name||"",U.name===""&&typeof C.uri=="string"&&C.uri.startsWith("data:image/")===!1&&(U.name=C.uri);const K=(_.samplers||{})[b.sampler]||{};return U.magFilter=Ei[K.magFilter]||I.k6q,U.minFilter=Ei[K.minFilter]||I.$_I,U.wrapS=Ri[K.wrapS]||I.GJx,U.wrapT=Ri[K.wrapT]||I.GJx,U.generateMipmaps=!U.isCompressedTexture&&U.minFilter!==I.hxR&&U.minFilter!==I.k6q,v.associations.set(U,{textures:m}),U}).catch(function(){return null});return this.textureCache[k]=V,V}loadImageSource(m,x){const w=this,v=this.json,_=this.options;if(this.sourceCache[m]!==void 0)return this.sourceCache[m].then(H=>H.clone());const b=v.images[m],C=self.URL||self.webkitURL;let k=b.uri||"",V=!1;if(b.bufferView!==void 0)k=w.getDependency("bufferView",b.bufferView).then(function(H){V=!0;const K=new Blob([H],{type:b.mimeType});return k=C.createObjectURL(K),k});else if(b.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+m+" is missing URI and bufferView");const U=Promise.resolve(k).then(function(H){return new Promise(function(K,nt){let vt=K;x.isImageBitmapLoader===!0&&(vt=function(Mt){const _t=new I.gPd(Mt);_t.needsUpdate=!0,K(_t)}),x.load(I.r6x.resolveURL(H,_.path),vt,void 0,nt)})}).then(function(H){return V===!0&&C.revokeObjectURL(k),wt(H,b),H.userData.mimeType=b.mimeType||zt(b.uri),H}).catch(function(H){throw console.error("THREE.GLTFLoader: Couldn't load texture",k),H});return this.sourceCache[m]=U,U}assignTexture(m,x,w,v){const _=this;return this.getDependency("texture",w.index).then(function(b){if(!b)return null;if(w.texCoord!==void 0&&w.texCoord>0&&(b=b.clone(),b.channel=w.texCoord),_.extensions[J.KHR_TEXTURE_TRANSFORM]){const C=w.extensions!==void 0?w.extensions[J.KHR_TEXTURE_TRANSFORM]:void 0;if(C){const k=_.associations.get(b);b=_.extensions[J.KHR_TEXTURE_TRANSFORM].extendTexture(b,C),_.associations.set(b,k)}}return v!==void 0&&(b.colorSpace=v),m[x]=b,b})}assignFinalMaterial(m){const x=m.geometry;let w=m.material;const v=x.attributes.tangent===void 0,_=x.attributes.color!==void 0,b=x.attributes.normal===void 0;if(m.isPoints){const C="PointsMaterial:"+w.uuid;let k=this.cache.get(C);k||(k=new I.BH$,I.imn.prototype.copy.call(k,w),k.color.copy(w.color),k.map=w.map,k.sizeAttenuation=!1,this.cache.add(C,k)),w=k}else if(m.isLine){const C="LineBasicMaterial:"+w.uuid;let k=this.cache.get(C);k||(k=new I.mrM,I.imn.prototype.copy.call(k,w),k.color.copy(w.color),k.map=w.map,this.cache.add(C,k)),w=k}if(v||_||b){let C="ClonedMaterial:"+w.uuid+":";v&&(C+="derivative-tangents:"),_&&(C+="vertex-colors:"),b&&(C+="flat-shading:");let k=this.cache.get(C);k||(k=w.clone(),_&&(k.vertexColors=!0),b&&(k.flatShading=!0),v&&(k.normalScale&&(k.normalScale.y*=-1),k.clearcoatNormalScale&&(k.clearcoatNormalScale.y*=-1)),this.cache.add(C,k),this.associations.set(k,this.associations.get(w))),w=k}m.material=w}getMaterialType(){return I._4j}loadMaterial(m){const x=this,w=this.json,v=this.extensions,_=w.materials[m];let b;const C={},k=_.extensions||{},V=[];if(k[J.KHR_MATERIALS_UNLIT]){const H=v[J.KHR_MATERIALS_UNLIT];b=H.getMaterialType(),V.push(H.extendParams(C,_,x))}else{const H=_.pbrMetallicRoughness||{};if(C.color=new I.Q1f(1,1,1),C.opacity=1,Array.isArray(H.baseColorFactor)){const K=H.baseColorFactor;C.color.setRGB(K[0],K[1],K[2],I.Zr2),C.opacity=K[3]}H.baseColorTexture!==void 0&&V.push(x.assignTexture(C,"map",H.baseColorTexture,I.er$)),C.metalness=H.metallicFactor!==void 0?H.metallicFactor:1,C.roughness=H.roughnessFactor!==void 0?H.roughnessFactor:1,H.metallicRoughnessTexture!==void 0&&(V.push(x.assignTexture(C,"metalnessMap",H.metallicRoughnessTexture)),V.push(x.assignTexture(C,"roughnessMap",H.metallicRoughnessTexture))),b=this._invokeOne(function(K){return K.getMaterialType&&K.getMaterialType(m)}),V.push(Promise.all(this._invokeAll(function(K){return K.extendMaterialParams&&K.extendMaterialParams(m,C)})))}_.doubleSided===!0&&(C.side=I.$EB);const U=_.alphaMode||It.OPAQUE;if(U===It.BLEND?(C.transparent=!0,C.depthWrite=!1):(C.transparent=!1,U===It.MASK&&(C.alphaTest=_.alphaCutoff!==void 0?_.alphaCutoff:.5)),_.normalTexture!==void 0&&b!==I.V9B&&(V.push(x.assignTexture(C,"normalMap",_.normalTexture)),C.normalScale=new I.I9Y(1,1),_.normalTexture.scale!==void 0)){const H=_.normalTexture.scale;C.normalScale.set(H,H)}if(_.occlusionTexture!==void 0&&b!==I.V9B&&(V.push(x.assignTexture(C,"aoMap",_.occlusionTexture)),_.occlusionTexture.strength!==void 0&&(C.aoMapIntensity=_.occlusionTexture.strength)),_.emissiveFactor!==void 0&&b!==I.V9B){const H=_.emissiveFactor;C.emissive=new I.Q1f().setRGB(H[0],H[1],H[2],I.Zr2)}return _.emissiveTexture!==void 0&&b!==I.V9B&&V.push(x.assignTexture(C,"emissiveMap",_.emissiveTexture,I.er$)),Promise.all(V).then(function(){const H=new b(C);return _.name&&(H.name=_.name),wt(H,_),x.associations.set(H,{materials:m}),_.extensions&&ut(v,H,_),H})}createUniqueName(m){const x=I.Nwf.sanitizeNodeName(m||"");return x in this.nodeNamesUsed?x+"_"+ ++this.nodeNamesUsed[x]:(this.nodeNamesUsed[x]=0,x)}loadGeometries(m){const x=this,w=this.extensions,v=this.primitiveCache;function _(C){return w[J.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(C,x).then(function(k){return Jt(k,C,x)})}const b=[];for(let C=0,k=m.length;C<k;C++){const V=m[C],U=St(V),H=v[U];if(H)b.push(H.promise);else{let K;V.extensions&&V.extensions[J.KHR_DRACO_MESH_COMPRESSION]?K=_(V):K=Jt(new I.LoY,V,x),v[U]={primitive:V,promise:K},b.push(K)}}return Promise.all(b)}loadMesh(m){const x=this,w=this.json,v=this.extensions,_=w.meshes[m],b=_.primitives,C=[];for(let k=0,V=b.length;k<V;k++){const U=b[k].material===void 0?X(this.cache):this.getDependency("material",b[k].material);C.push(U)}return C.push(x.loadGeometries(b)),Promise.all(C).then(function(k){const V=k.slice(0,k.length-1),U=k[k.length-1],H=[];for(let nt=0,vt=U.length;nt<vt;nt++){const Mt=U[nt],_t=b[nt];let At;const kt=V[nt];if(_t.mode===ke.TRIANGLES||_t.mode===ke.TRIANGLE_STRIP||_t.mode===ke.TRIANGLE_FAN||_t.mode===void 0)At=_.isSkinnedMesh===!0?new I.I46(Mt,kt):new I.eaF(Mt,kt),At.isSkinnedMesh===!0&&At.normalizeSkinWeights(),_t.mode===ke.TRIANGLE_STRIP?At.geometry=T(At.geometry,I.O49):_t.mode===ke.TRIANGLE_FAN&&(At.geometry=T(At.geometry,I.rYR));else if(_t.mode===ke.LINES)At=new I.DXC(Mt,kt);else if(_t.mode===ke.LINE_STRIP)At=new I.N1A(Mt,kt);else if(_t.mode===ke.LINE_LOOP)At=new I.FCc(Mt,kt);else if(_t.mode===ke.POINTS)At=new I.ONl(Mt,kt);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+_t.mode);Object.keys(At.geometry.morphAttributes).length>0&&Bt(At,_),At.name=x.createUniqueName(_.name||"mesh_"+m),wt(At,_),_t.extensions&&ut(v,At,_t),x.assignFinalMaterial(At),H.push(At)}for(let nt=0,vt=H.length;nt<vt;nt++)x.associations.set(H[nt],{meshes:m,primitives:nt});if(H.length===1)return _.extensions&&ut(v,H[0],_),H[0];const K=new I.YJl;_.extensions&&ut(v,K,_),x.associations.set(K,{meshes:m});for(let nt=0,vt=H.length;nt<vt;nt++)K.add(H[nt]);return K})}loadCamera(m){let x;const w=this.json.cameras[m],v=w[w.type];if(!v){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return w.type==="perspective"?x=new I.ubm(I.cj9.radToDeg(v.yfov),v.aspectRatio||1,v.znear||1,v.zfar||2e6):w.type==="orthographic"&&(x=new I.qUd(-v.xmag,v.xmag,v.ymag,-v.ymag,v.znear,v.zfar)),w.name&&(x.name=this.createUniqueName(w.name)),wt(x,w),Promise.resolve(x)}loadSkin(m){const x=this.json.skins[m],w=[];for(let v=0,_=x.joints.length;v<_;v++)w.push(this._loadNodeShallow(x.joints[v]));return x.inverseBindMatrices!==void 0?w.push(this.getDependency("accessor",x.inverseBindMatrices)):w.push(null),Promise.all(w).then(function(v){const _=v.pop(),b=v,C=[],k=[];for(let V=0,U=b.length;V<U;V++){const H=b[V];if(H){C.push(H);const K=new I.kn4;_!==null&&K.fromArray(_.array,V*16),k.push(K)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',x.joints[V])}return new I.EAD(C,k)})}loadAnimation(m){const x=this.json,w=this,v=x.animations[m],_=v.name?v.name:"animation_"+m,b=[],C=[],k=[],V=[],U=[];for(let H=0,K=v.channels.length;H<K;H++){const nt=v.channels[H],vt=v.samplers[nt.sampler],Mt=nt.target,_t=Mt.node,At=v.parameters!==void 0?v.parameters[vt.input]:vt.input,kt=v.parameters!==void 0?v.parameters[vt.output]:vt.output;Mt.node!==void 0&&(b.push(this.getDependency("node",_t)),C.push(this.getDependency("accessor",At)),k.push(this.getDependency("accessor",kt)),V.push(vt),U.push(Mt))}return Promise.all([Promise.all(b),Promise.all(C),Promise.all(k),Promise.all(V),Promise.all(U)]).then(function(H){const K=H[0],nt=H[1],vt=H[2],Mt=H[3],_t=H[4],At=[];for(let kt=0,Zt=K.length;kt<Zt;kt++){const Rt=K[kt],$t=nt[kt],ye=vt[kt],Kt=Mt[kt],Qt=_t[kt];if(Rt===void 0)continue;Rt.updateMatrix&&Rt.updateMatrix();const he=w._createAnimationTracks(Rt,$t,ye,Kt,Qt);if(he)for(let we=0;we<he.length;we++)At.push(he[we])}return new I.tz3(_,void 0,At)})}createNodeMesh(m){const x=this.json,w=this,v=x.nodes[m];return v.mesh===void 0?null:w.getDependency("mesh",v.mesh).then(function(_){const b=w._getNodeRef(w.meshCache,v.mesh,_);return v.weights!==void 0&&b.traverse(function(C){if(C.isMesh)for(let k=0,V=v.weights.length;k<V;k++)C.morphTargetInfluences[k]=v.weights[k]}),b})}loadNode(m){const x=this.json,w=this,v=x.nodes[m],_=w._loadNodeShallow(m),b=[],C=v.children||[];for(let V=0,U=C.length;V<U;V++)b.push(w.getDependency("node",C[V]));const k=v.skin===void 0?Promise.resolve(null):w.getDependency("skin",v.skin);return Promise.all([_,Promise.all(b),k]).then(function(V){const U=V[0],H=V[1],K=V[2];K!==null&&U.traverse(function(nt){nt.isSkinnedMesh&&nt.bind(K,re)});for(let nt=0,vt=H.length;nt<vt;nt++)U.add(H[nt]);return U})}_loadNodeShallow(m){const x=this.json,w=this.extensions,v=this;if(this.nodeCache[m]!==void 0)return this.nodeCache[m];const _=x.nodes[m],b=_.name?v.createUniqueName(_.name):"",C=[],k=v._invokeOne(function(V){return V.createNodeMesh&&V.createNodeMesh(m)});return k&&C.push(k),_.camera!==void 0&&C.push(v.getDependency("camera",_.camera).then(function(V){return v._getNodeRef(v.cameraCache,_.camera,V)})),v._invokeAll(function(V){return V.createNodeAttachment&&V.createNodeAttachment(m)}).forEach(function(V){C.push(V)}),this.nodeCache[m]=Promise.all(C).then(function(V){let U;if(_.isBone===!0?U=new I.$Kf:V.length>1?U=new I.YJl:V.length===1?U=V[0]:U=new I.B69,U!==V[0])for(let H=0,K=V.length;H<K;H++)U.add(V[H]);if(_.name&&(U.userData.name=_.name,U.name=b),wt(U,_),_.extensions&&ut(w,U,_),_.matrix!==void 0){const H=new I.kn4;H.fromArray(_.matrix),U.applyMatrix4(H)}else _.translation!==void 0&&U.position.fromArray(_.translation),_.rotation!==void 0&&U.quaternion.fromArray(_.rotation),_.scale!==void 0&&U.scale.fromArray(_.scale);if(!v.associations.has(U))v.associations.set(U,{});else if(_.mesh!==void 0&&v.meshCache.refs[_.mesh]>1){const H=v.associations.get(U);v.associations.set(U,{...H})}return v.associations.get(U).nodes=m,U}),this.nodeCache[m]}loadScene(m){const x=this.extensions,w=this.json.scenes[m],v=this,_=new I.YJl;w.name&&(_.name=v.createUniqueName(w.name)),wt(_,w),w.extensions&&ut(x,_,w);const b=w.nodes||[],C=[];for(let k=0,V=b.length;k<V;k++)C.push(v.getDependency("node",b[k]));return Promise.all(C).then(function(k){for(let U=0,H=k.length;U<H;U++)_.add(k[U]);const V=U=>{const H=new Map;for(const[K,nt]of v.associations)(K instanceof I.imn||K instanceof I.gPd)&&H.set(K,nt);return U.traverse(K=>{const nt=v.associations.get(K);nt!=null&&H.set(K,nt)}),H};return v.associations=V(_),_})}_createAnimationTracks(m,x,w,v,_){const b=[],C=m.name?m.name:m.uuid,k=[];xs[_.path]===xs.weights?m.traverse(function(K){K.morphTargetInfluences&&k.push(K.name?K.name:K.uuid)}):k.push(C);let V;switch(xs[_.path]){case xs.weights:V=I.Hit;break;case xs.rotation:V=I.MBL;break;case xs.translation:case xs.scale:V=I.RiT;break;default:switch(w.itemSize){case 1:V=I.Hit;break;case 2:case 3:default:V=I.RiT;break}break}const U=v.interpolation!==void 0?qi[v.interpolation]:I.PJ3,H=this._getArrayFromAccessor(w);for(let K=0,nt=k.length;K<nt;K++){const vt=new V(k[K]+"."+xs[_.path],x.array,H,U);v.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(vt),b.push(vt)}return b}_getArrayFromAccessor(m){let x=m.array;if(m.normalized){const w=Ct(x.constructor),v=new Float32Array(x.length);for(let _=0,b=x.length;_<b;_++)v[_]=x[_]*w;x=v}return x}_createCubicSplineTrackInterpolant(m){m.createInterpolant=function(w){const v=this instanceof I.MBL?ss:us;return new v(this.times,this.values,this.getValueSize()/3,w)},m.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Dt(G,m,x){const w=m.attributes,v=new I.NRn;if(w.POSITION!==void 0){const C=x.json.accessors[w.POSITION],k=C.min,V=C.max;if(k!==void 0&&V!==void 0){if(v.set(new I.Pq0(k[0],k[1],k[2]),new I.Pq0(V[0],V[1],V[2])),C.normalized){const U=Ct(Ls[C.componentType]);v.min.multiplyScalar(U),v.max.multiplyScalar(U)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const _=m.targets;if(_!==void 0){const C=new I.Pq0,k=new I.Pq0;for(let V=0,U=_.length;V<U;V++){const H=_[V];if(H.POSITION!==void 0){const K=x.json.accessors[H.POSITION],nt=K.min,vt=K.max;if(nt!==void 0&&vt!==void 0){if(k.setX(Math.max(Math.abs(nt[0]),Math.abs(vt[0]))),k.setY(Math.max(Math.abs(nt[1]),Math.abs(vt[1]))),k.setZ(Math.max(Math.abs(nt[2]),Math.abs(vt[2]))),K.normalized){const Mt=Ct(Ls[K.componentType]);k.multiplyScalar(Mt)}C.max(k)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}v.expandByVector(C)}G.boundingBox=v;const b=new I.iyt;v.getCenter(b.center),b.radius=v.min.distanceTo(v.max)/2,G.boundingSphere=b}function Jt(G,m,x){const w=m.attributes,v=[];function _(b,C){return x.getDependency("accessor",b).then(function(k){G.setAttribute(C,k)})}for(const b in w){const C=Fs[b]||b.toLowerCase();C in G.attributes||v.push(_(w[b],C))}if(m.indices!==void 0&&!G.index){const b=x.getDependency("accessor",m.indices).then(function(C){G.setIndex(C)});v.push(b)}return I.ppV.workingColorSpace!==I.Zr2&&"COLOR_0"in w&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${I.ppV.workingColorSpace}" not supported.`),wt(G,m),Dt(G,m,x),Promise.all(v).then(function(){return m.targets!==void 0?Nt(G,m.targets,x):G})}const Yt=G=>{const m="https://static.visme.co/dracoDecoders/";switch(G){case"js":return`${m}draco_decoder.js`;case"wasm":return`${m}draco_decoder.wasm`;case"wrapper":return`${m}draco_wasm_wrapper.js`;default:return m}},Me=new R,Ce=new at,Fe=async G=>{if(G){const m=document.getElementById("draco-inline"),x=m?.textContent||"",w=Ce._loadLibrary.bind(Ce);return Ce._loadLibrary=function(v,_){return v==="draco_decoder.js"&&_==="text"?Promise.resolve(x):w(v,_)},Ce.setDecoderConfig({type:"js"}),Ce.setDecoderPath(""),Ce}else return Ce.setDecoderPath(Yt()),Ce};class Ue extends I.aHM{loader;initDecoderPromise;useInlineDracoLoader;constructor(m,x){super(m),this.useInlineDracoLoader=x,this.loader=new I.Y9S(this.manager),this.loader.setResponseType("arraybuffer"),this.initDecoderPromise=(async()=>{const w=await Fe(this.useInlineDracoLoader);Me.setDRACOLoader(w)})()}load(m,x,w,v){this.loader.load(m,async _=>{try{await this.initDecoderPromise;const C=new DataView(_).getBigUint64(8,!0),k=27,V=k+Number(C),U=_.slice(k,V),K=await new Blob([U],{type:"model/gltf-binary"}).arrayBuffer();Me.parse(K,"",nt=>{x(nt)},nt=>{throw new Error(`Error loading GLTF: ${nt}`)})}catch(b){v(b)}},w,v)}}const xe=G=>G.endsWith(".visme3d"),si=Ue;function li(G){const m={nodes:{},materials:{}};return G&&G.traverse(x=>{x.name&&(m.nodes[x.name]=x),x.isMesh&&x.material&&!m.materials[x.material.name]&&(m.materials[x.material.name]=x.material)}),m}let ve=null;function We(G){if(!ve){const m=new at;m.setDecoderPath(Yt()),ve=new R(G),ve.setDRACOLoader(m)}return ve}class Cs extends R{useInlineDracoLoader;constructor(m=!1,x){super(x),this.useInlineDracoLoader=m}load(m,x,w,v){const _=b=>{const C=li(b.scene);b.nodes=C.nodes,b.materials=C.materials,x(b)};if(m.endsWith(".gltf")||m.endsWith(".glb")){const b=We(this.manager);b?.load(m,_,w,v)}else m.endsWith(".visme3d")||m.includes(";base64")?new si(this.manager,this.useInlineDracoLoader).load(m,_,w,v):v(new Error(`Unsupported file format: ${m}`))}}const Hs=Cs},718121:(fe,Et,Q)=>{Q.d(Et,{bl:()=>mt});var I=Q(393358);const mt={accessories:{optional:!0},beard:{optional:!0},body:{optional:!1},bottom:{optional:!1},glasses:{optional:!0},hair:{optional:!0},hats:{optional:!0},shoes:{optional:!1},upper:{optional:!1}},at={body:{optional:!1},sleeve:{optional:!0}},E=I.I.filter(D=>D.color!=="transparent")},671102:(fe,Et,Q)=>{Q.r(Et),Q.d(Et,{default:()=>D});var I=Q(411855),mt=Q(55946),at=Q(281079);const E=Y=>{let{object:ft,isThumb:M}=Y;return I.createElement(at.default,{object:ft,isThumb:M,shouldShowCachedObject:!0})},D=(0,mt.PA)(E)},393358:(fe,Et,Q)=>{Q.d(Et,{I:()=>I});const I=[{color:"transparent"},{color:"#000000"},{color:"#5d647b"},{color:"#dfe0e5"},{color:"#ffffff"}]},979248:(fe,Et,Q)=>{Q.d(Et,{$EB:()=>T,$Ed:()=>ul,$Kf:()=>sh,$NF:()=>Nr,$O9:()=>Ce,$Yl:()=>Xe,$_I:()=>ve,$ei:()=>it,$p8:()=>hu,A$4:()=>Fc,AKb:()=>kp,ALV:()=>ud,AQS:()=>wc,Am1:()=>Yp,B69:()=>ue,B6O:()=>_l,BER:()=>wt,BH$:()=>ah,BKk:()=>fo,BND:()=>Vf,BRH:()=>Up,BXX:()=>Qt,B_h:()=>Pi,CR7:()=>nc,CSG:()=>Jl,CV9:()=>gh,CVz:()=>qe,CWW:()=>Jr,Cfg:()=>Fe,CmU:()=>du,CwR:()=>sf,D$Q:()=>Dl,DAe:()=>sr,DXC:()=>ai,Df:()=>Wl,Dmk:()=>V,E0M:()=>Wf,EAD:()=>To,EQC:()=>Tn,EZo:()=>tt,EdD:()=>j,F1T:()=>Jc,F1l:()=>Bf,FCc:()=>yl,FFZ:()=>Ta,FNr:()=>ql,FV:()=>qi,FXf:()=>st,FZo:()=>uu,Fn:()=>Ns,Fpm:()=>Rf,FvD:()=>No,Fvi:()=>Nt,Fvt:()=>Zl,G3T:()=>Xr,G4u:()=>xc,GBG:()=>Ql,GJx:()=>Ut,GOR:()=>sp,GWd:()=>K,GYF:()=>ni,GZZ:()=>mh,G_z:()=>Gl,Gu$:()=>Br,Gwm:()=>us,GxU:()=>Md,H23:()=>ki,H2z:()=>Jf,HIg:()=>H,HLH:()=>jh,HO_:()=>Gr,HPb:()=>ec,HXV:()=>vs,HgN:()=>Ac,HiM:()=>ou,Hit:()=>kr,Ho_:()=>_r,Hrb:()=>Ad,Hrq:()=>pc,I46:()=>nl,I9Y:()=>xt,IE4:()=>$t,IUQ:()=>He,IWo:()=>Df,Iit:()=>Wc,Ipv:()=>Ks,Iw4:()=>mf,IzY:()=>Hf,Jnc:()=>Y,K52:()=>es,KDk:()=>Is,KLL:()=>Cn,KPJ:()=>Ah,KRh:()=>Ls,Ke9:()=>An,Kef:()=>Wr,Ktl:()=>cc,Kwu:()=>R,Kzg:()=>Zp,LAk:()=>X,Ld9:()=>Gf,LiQ:()=>Ft,LlO:()=>zd,LoY:()=>oe,LuO:()=>vf,M4G:()=>wf,MBL:()=>Or,MOq:()=>fc,MSw:()=>sa,MW4:()=>Nc,Mjd:()=>Fs,N1A:()=>Hi,N2s:()=>Mu,N5j:()=>ya,NRn:()=>rs,NTi:()=>Z,NZq:()=>We,Nex:()=>ku,Nt7:()=>le,Nv2:()=>bl,Nwf:()=>de,Nz6:()=>ye,O0B:()=>za,O3Y:()=>na,O49:()=>Gh,O9p:()=>js,ONl:()=>xl,OUM:()=>Cs,Oax:()=>Id,Om:()=>re,OuU:()=>qt,P5j:()=>pf,PFK:()=>Ff,PJ3:()=>Sn,PPD:()=>Io,PTz:()=>Ms,Pdi:()=>$l,Pem:()=>Qd,Pf$:()=>Qp,Pq0:()=>F,Q1f:()=>te,QCA:()=>$o,QP0:()=>q,Qev:()=>yi,Qrf:()=>Bi,R1W:()=>kf,R3r:()=>Nd,RJ4:()=>Hh,ROr:()=>$h,RQf:()=>v,RcT:()=>rc,RiT:()=>Lr,Riy:()=>is,Rkk:()=>Yr,RlV:()=>On,RoJ:()=>Ka,RrE:()=>Ke,Ru$:()=>Kh,RyA:()=>A,S$4:()=>_n,S20:()=>Jo,SUR:()=>pu,SYV:()=>Kd,ScU:()=>Vp,T6I:()=>Th,TDQ:()=>Ml,THS:()=>_e,TM5:()=>vc,TMh:()=>ac,Tap:()=>Wp,TdN:()=>Es,TiK:()=>Ma,TkQ:()=>kt,U3G:()=>ls,UJ6:()=>Us,UPV:()=>ra,UTZ:()=>Bt,Ufg:()=>Pr,UpK:()=>Kc,UtB:()=>Af,UtX:()=>zh,V3x:()=>k,V9B:()=>en,VCu:()=>ip,VGF:()=>Zt,VT0:()=>Mt,VVr:()=>mi,Vb5:()=>D,VnP:()=>Al,Vnu:()=>hc,Vwu:()=>jf,VxR:()=>rr,W9U:()=>Ur,WBB:()=>Ko,WNZ:()=>E,WTh:()=>Nf,Wdf:()=>Aa,Wew:()=>b,Wk7:()=>O,Wyr:()=>yc,XG_:()=>Hr,XIg:()=>P,XJ7:()=>Ol,XMJ:()=>yf,XTe:()=>Xp,XrR:()=>Ei,Y9S:()=>Ti,YHV:()=>Sf,YJl:()=>Gn,YOZ:()=>dn,YRT:()=>Dp,Yhb:()=>Kl,Yuy:()=>x,Z0B:()=>fh,Z58:()=>Xc,ZLX:()=>hl,ZM4:()=>Uf,ZQM:()=>_t,Zcv:()=>rn,Zpd:()=>ia,Zr2:()=>nr,ZyN:()=>au,_4j:()=>Mh,_QJ:()=>Gs,_Ut:()=>Bd,_xc:()=>Pf,a$r:()=>Ue,a55:()=>In,a5J:()=>wn,aEY:()=>Le,aHM:()=>As,aJ8:()=>ut,aMy:()=>qr,aVO:()=>Xl,agE:()=>$i,amv:()=>xa,b4q:()=>yo,bC7:()=>bs,bCz:()=>J,bI3:()=>fi,bTm:()=>M,baL:()=>Sd,bdM:()=>ta,bkx:()=>w,brA:()=>ts,bw0:()=>ss,c5h:()=>ep,c90:()=>Rt,cHt:()=>m,cRK:()=>go,cZY:()=>Ef,caT:()=>ke,cj9:()=>id,czI:()=>Mn,dAo:()=>yh,dYF:()=>ka,dcC:()=>vt,dhZ:()=>ji,dth:()=>eu,dwI:()=>qs,dzP:()=>xf,e0p:()=>cs,eB$:()=>vo,eHc:()=>Ye,eHs:()=>nn,eaF:()=>Vs,eoi:()=>wa,er$:()=>fs,ezk:()=>Sh,f4X:()=>dt,fBL:()=>G,fJr:()=>Qh,fP5:()=>vu,fTw:()=>Of,fc6:()=>Td,g7M:()=>It,gJ2:()=>C,gO9:()=>lt,gPd:()=>Ne,gWB:()=>Sa,ghU:()=>Dt,h2z:()=>pi,hB5:()=>y,hIf:()=>uc,hZF:()=>pn,h_9:()=>tu,hdd:()=>me,hgQ:()=>Te,hjs:()=>Tf,hsX:()=>g,hxR:()=>Yt,hy7:()=>St,hzE:()=>Lf,i7d:()=>mo,i7u:()=>Oi,iNn:()=>fr,iOZ:()=>tp,iUH:()=>li,ibB:()=>wl,ie2:()=>Wt,imn:()=>as,ix0:()=>_,iyt:()=>je,j6:()=>oa,jGm:()=>Cl,jR7:()=>Kt,jUj:()=>xo,jej:()=>od,jf0:()=>ir,jsO:()=>ic,jut:()=>aa,jzd:()=>_a,k6Q:()=>he,k6q:()=>xe,k8v:()=>qh,kBv:()=>mt,kEx:()=>Np,kG0:()=>Yh,kLi:()=>Li,kO0:()=>ba,kRr:()=>si,kTW:()=>Jt,kTp:()=>we,kYr:()=>sc,k_V:()=>Dh,keZ:()=>jp,klZ:()=>oc,kn4:()=>se,kqe:()=>Zh,kxk:()=>jc,kyO:()=>ci,l2R:()=>hi,lGu:()=>Qe,lGw:()=>zr,lMl:()=>_s,lPF:()=>rd,lc7:()=>Zr,ljd:()=>Yi,lxW:()=>mr,lyL:()=>Xs,mcG:()=>Ra,mrM:()=>gs,nCl:()=>nu,nEu:()=>Uo,nNL:()=>xs,nST:()=>ht,nWS:()=>jr,nZQ:()=>$p,nc$:()=>Fh,nzx:()=>Qo,o6l:()=>Ld,oVO:()=>tc,oh6:()=>bf,ojh:()=>$,ojs:()=>ui,ov9:()=>Re,pBf:()=>ds,pFK:()=>Gi,pHI:()=>Me,pPE:()=>wu,paN:()=>At,ppV:()=>ws,psI:()=>zi,q2:()=>Nl,qBx:()=>Hl,qFE:()=>Sr,qU7:()=>Do,qUd:()=>Rh,qa3:()=>ps,qad:()=>pt,qq$:()=>hr,qtW:()=>Ot,r6x:()=>Ph,rFo:()=>Cc,rKP:()=>ea,rOG:()=>mc,rQf:()=>di,rSH:()=>ii,rYR:()=>Jh,s0K:()=>Tl,sKt:()=>or,sPf:()=>I,tBo:()=>Mf,tJf:()=>Hs,tXL:()=>Ul,tcD:()=>Vo,tz3:()=>Fr,uB5:()=>Js,uSd:()=>Vl,uV5:()=>zt,uWO:()=>Yn,uXQ:()=>lc,ubm:()=>zs,uf3:()=>Eo,uov:()=>dc,ure:()=>cu,v9J:()=>gc,veJ:()=>Ji,vim:()=>va,vmz:()=>Cd,vyJ:()=>ga,wAk:()=>Zo,wTz:()=>Xh,wfO:()=>Ct,wn6:()=>ee,wrO:()=>U,wtR:()=>at,wvS:()=>_d,xFO:()=>Vt,xJ6:()=>Qs,xOk:()=>lu,xSv:()=>Ae,xZx:()=>ef,xfg:()=>xh,y3Z:()=>Zi,y9J:()=>ld,y_p:()=>Ri,ypk:()=>cn,ywQ:()=>ft,zD7:()=>xu,zdS:()=>nt,zgK:()=>Va,znC:()=>yt});/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const I="179",mt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},at={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},E=0,D=1,Y=2,ft=3,M=0,q=1,O=2,A=3,y=0,g=1,T=2,P=0,Z=1,tt=2,R=3,j=4,J=5,lt=100,st=101,ht=102,yt=103,it=104,$=200,pt=201,dt=202,Ft=203,Wt=204,qt=205,me=206,le=207,ee=208,Le=209,Te=210,Ke=211,Xe=212,cs=213,Re=214,Ye=0,Qe=1,ts=2,Ae=3,ls=4,us=5,es=6,ss=7,ke=0,Ls=1,Ei=2,Ri=0,ci=1,Fs=2,xs=3,qi=4,It=5,X=6,ut=7,wt="attached",Nt="detached",Bt=300,St=301,Vt=302,Ct=303,zt=304,re=306,Ut=1e3,Dt=1001,Jt=1002,Yt=1003,Me=1004,Ce=1004,Fe=1005,Ue=1005,xe=1006,si=1007,li=1007,ve=1008,We=1008,Cs=1009,Hs=1010,G=1011,m=1012,x=1013,w=1014,v=1015,_=1016,b=1017,C=1018,k=1020,V=35902,U=1021,H=1022,K=1023,nt=1026,vt=1027,Mt=1028,_t=1029,At=1030,kt=1031,Zt=1032,Rt=1033,$t=33776,ye=33777,Kt=33778,Qt=33779,he=35840,we=35841,vs=35842,ds=35843,qe=36196,is=37492,Is=37496,ps=37808,Pi=37809,Mn=37810,ii=37811,Bi=37812,zi=37813,wn=37814,Gs=37815,Js=37816,Xs=37817,bs=37818,Zi=37819,ui=37820,_n=37821,Ns=36492,ki=36494,Ur=36495,Wr=36283,Hr=36284,Gr=36285,Jr=36286,Xr=2200,qr=2201,Zr=2202,Yi=2300,Sn=2301,Tn=2302,di=2400,pi=2401,ji=2402,An=2500,sr=2501,Hh=0,Gh=1,Jh=2,Yr=3200,ya=3201,Xh=3202,qh=3203,fi=0,ga=1,ir="",fs="srgb",nr="srgb-linear",rr="linear",Cn="srgb",Zh=0,mi=7680,Yh=7681,jh=7682,$h=7683,Kh=34055,Qh=34056,tc=5386,ec=512,sc=513,ic=514,nc=515,rc=516,oc=517,ac=518,or=519,xa=512,va=513,ba=514,Ma=515,wa=516,_a=517,Sa=518,Ta=519,$i=35044,hc=35048,cc=35040,lc=35045,uc=35049,dc=35041,pc=35046,fc=35050,mc=35042,yc="100",Aa="300 es",Es=2e3,Oi=2001,gc={COMPUTE:"compute",RENDER:"render"},xc={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},vc={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};class yi{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){const s=this._listeners;return s===void 0?!1:s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){const s=this._listeners;if(s===void 0)return;const i=s[t];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(t){const e=this._listeners;if(e===void 0)return;const s=e[t.type];if(s!==void 0){t.target=this;const i=s.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,t);t.target=null}}}const ns=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let bc=1234567;const Ki=Math.PI/180,In=180/Math.PI;function Rs(){const c=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(ns[c&255]+ns[c>>8&255]+ns[c>>16&255]+ns[c>>24&255]+"-"+ns[t&255]+ns[t>>8&255]+"-"+ns[t>>16&15|64]+ns[t>>24&255]+"-"+ns[e&63|128]+ns[e>>8&255]+"-"+ns[e>>16&255]+ns[e>>24&255]+ns[s&255]+ns[s>>8&255]+ns[s>>16&255]+ns[s>>24&255]).toLowerCase()}function jt(c,t,e){return Math.max(t,Math.min(e,c))}function Ca(c,t){return(c%t+t)%t}function Uu(c,t,e,s,i){return s+(c-t)*(i-s)/(e-t)}function Wu(c,t,e){return c!==t?(e-c)/(t-c):0}function ar(c,t,e){return(1-e)*c+e*t}function Hu(c,t,e,s){return ar(c,t,1-Math.exp(-e*s))}function Gu(c,t=1){return t-Math.abs(Ca(c,t*2)-t)}function Ju(c,t,e){return c<=t?0:c>=e?1:(c=(c-t)/(e-t),c*c*(3-2*c))}function Xu(c,t,e){return c<=t?0:c>=e?1:(c=(c-t)/(e-t),c*c*c*(c*(c*6-15)+10))}function qu(c,t){return c+Math.floor(Math.random()*(t-c+1))}function Zu(c,t){return c+Math.random()*(t-c)}function Yu(c){return c*(.5-Math.random())}function ju(c){c!==void 0&&(bc=c);let t=bc+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function $u(c){return c*Ki}function Ku(c){return c*In}function Qu(c){return(c&c-1)===0&&c!==0}function td(c){return Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function ed(c){return Math.pow(2,Math.floor(Math.log(c)/Math.LN2))}function sd(c,t,e,s,i){const n=Math.cos,r=Math.sin,o=n(e/2),a=r(e/2),h=n((t+s)/2),l=r((t+s)/2),u=n((t-s)/2),d=r((t-s)/2),p=n((s-t)/2),f=r((s-t)/2);switch(i){case"XYX":c.set(o*l,a*u,a*d,o*h);break;case"YZY":c.set(a*d,o*l,a*u,o*h);break;case"ZXZ":c.set(a*u,a*d,o*l,o*h);break;case"XZX":c.set(o*l,a*f,a*p,o*h);break;case"YXY":c.set(a*p,o*l,a*f,o*h);break;case"ZYZ":c.set(a*f,a*p,o*l,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function ms(c,t){switch(t.constructor){case Float32Array:return c;case Uint32Array:return c/4294967295;case Uint16Array:return c/65535;case Uint8Array:return c/255;case Int32Array:return Math.max(c/2147483647,-1);case Int16Array:return Math.max(c/32767,-1);case Int8Array:return Math.max(c/127,-1);default:throw new Error("Invalid component type.")}}function ie(c,t){switch(t.constructor){case Float32Array:return c;case Uint32Array:return Math.round(c*4294967295);case Uint16Array:return Math.round(c*65535);case Uint8Array:return Math.round(c*255);case Int32Array:return Math.round(c*2147483647);case Int16Array:return Math.round(c*32767);case Int8Array:return Math.round(c*127);default:throw new Error("Invalid component type.")}}const id={DEG2RAD:Ki,RAD2DEG:In,generateUUID:Rs,clamp:jt,euclideanModulo:Ca,mapLinear:Uu,inverseLerp:Wu,lerp:ar,damp:Hu,pingpong:Gu,smoothstep:Ju,smootherstep:Xu,randInt:qu,randFloat:Zu,randFloatSpread:Yu,seededRandom:ju,degToRad:$u,radToDeg:Ku,isPowerOfTwo:Qu,ceilPowerOfTwo:td,floorPowerOfTwo:ed,setQuaternionFromProperEuler:sd,normalize:ie,denormalize:ms};class xt{constructor(t=0,e=0){xt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=jt(this.x,t.x,e.x),this.y=jt(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=jt(this.x,t,e),this.y=jt(this.y,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(jt(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(jt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),n=this.x-t.x,r=this.y-t.y;return this.x=n*s-r*i+t.x,this.y=n*i+r*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ms{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,n,r,o){let a=s[i+0],h=s[i+1],l=s[i+2],u=s[i+3];const d=n[r+0],p=n[r+1],f=n[r+2],S=n[r+3];if(o===0){t[e+0]=a,t[e+1]=h,t[e+2]=l,t[e+3]=u;return}if(o===1){t[e+0]=d,t[e+1]=p,t[e+2]=f,t[e+3]=S;return}if(u!==S||a!==d||h!==p||l!==f){let B=1-o;const z=a*d+h*p+l*f+u*S,N=z>=0?1:-1,L=1-z*z;if(L>Number.EPSILON){const et=Math.sqrt(L),rt=Math.atan2(et,z*N);B=Math.sin(B*rt)/et,o=Math.sin(o*rt)/et}const W=o*N;if(a=a*B+d*W,h=h*B+p*W,l=l*B+f*W,u=u*B+S*W,B===1-o){const et=1/Math.sqrt(a*a+h*h+l*l+u*u);a*=et,h*=et,l*=et,u*=et}}t[e]=a,t[e+1]=h,t[e+2]=l,t[e+3]=u}static multiplyQuaternionsFlat(t,e,s,i,n,r){const o=s[i],a=s[i+1],h=s[i+2],l=s[i+3],u=n[r],d=n[r+1],p=n[r+2],f=n[r+3];return t[e]=o*f+l*u+a*p-h*d,t[e+1]=a*f+l*d+h*u-o*p,t[e+2]=h*f+l*p+o*d-a*u,t[e+3]=l*f-o*u-a*d-h*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,n=t._z,r=t._order,o=Math.cos,a=Math.sin,h=o(s/2),l=o(i/2),u=o(n/2),d=a(s/2),p=a(i/2),f=a(n/2);switch(r){case"XYZ":this._x=d*l*u+h*p*f,this._y=h*p*u-d*l*f,this._z=h*l*f+d*p*u,this._w=h*l*u-d*p*f;break;case"YXZ":this._x=d*l*u+h*p*f,this._y=h*p*u-d*l*f,this._z=h*l*f-d*p*u,this._w=h*l*u+d*p*f;break;case"ZXY":this._x=d*l*u-h*p*f,this._y=h*p*u+d*l*f,this._z=h*l*f+d*p*u,this._w=h*l*u-d*p*f;break;case"ZYX":this._x=d*l*u-h*p*f,this._y=h*p*u+d*l*f,this._z=h*l*f-d*p*u,this._w=h*l*u+d*p*f;break;case"YZX":this._x=d*l*u+h*p*f,this._y=h*p*u+d*l*f,this._z=h*l*f-d*p*u,this._w=h*l*u-d*p*f;break;case"XZY":this._x=d*l*u-h*p*f,this._y=h*p*u-d*l*f,this._z=h*l*f+d*p*u,this._w=h*l*u+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],n=e[8],r=e[1],o=e[5],a=e[9],h=e[2],l=e[6],u=e[10],d=s+o+u;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(l-a)*p,this._y=(n-h)*p,this._z=(r-i)*p}else if(s>o&&s>u){const p=2*Math.sqrt(1+s-o-u);this._w=(l-a)/p,this._x=.25*p,this._y=(i+r)/p,this._z=(n+h)/p}else if(o>u){const p=2*Math.sqrt(1+o-s-u);this._w=(n-h)/p,this._x=(i+r)/p,this._y=.25*p,this._z=(a+l)/p}else{const p=2*Math.sqrt(1+u-s-o);this._w=(r-i)/p,this._x=(n+h)/p,this._y=(a+l)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<1e-8?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(jt(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,n=t._z,r=t._w,o=e._x,a=e._y,h=e._z,l=e._w;return this._x=s*l+r*o+i*h-n*a,this._y=i*l+r*a+n*o-s*h,this._z=n*l+r*h+s*a-i*o,this._w=r*l-s*o-i*a-n*h,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,i=this._y,n=this._z,r=this._w;let o=r*t._w+s*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=s,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const p=1-e;return this._w=p*r+e*this._w,this._x=p*s+e*this._x,this._y=p*i+e*this._y,this._z=p*n+e*this._z,this.normalize(),this}const h=Math.sqrt(a),l=Math.atan2(h,o),u=Math.sin((1-e)*l)/h,d=Math.sin(e*l)/h;return this._w=r*u+this._w*d,this._x=s*u+this._x*d,this._y=i*u+this._y*d,this._z=n*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class F{constructor(t=0,e=0,s=0){F.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Mc.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Mc.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*s+n[6]*i,this.y=n[1]*e+n[4]*s+n[7]*i,this.z=n[2]*e+n[5]*s+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=t.elements,r=1/(n[3]*e+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*s+n[8]*i+n[12])*r,this.y=(n[1]*e+n[5]*s+n[9]*i+n[13])*r,this.z=(n[2]*e+n[6]*s+n[10]*i+n[14])*r,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,n=t.x,r=t.y,o=t.z,a=t.w,h=2*(r*i-o*s),l=2*(o*e-n*i),u=2*(n*s-r*e);return this.x=e+a*h+r*u-o*l,this.y=s+a*l+o*h-n*u,this.z=i+a*u+n*l-r*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*s+n[8]*i,this.y=n[1]*e+n[5]*s+n[9]*i,this.z=n[2]*e+n[6]*s+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=jt(this.x,t.x,e.x),this.y=jt(this.y,t.y,e.y),this.z=jt(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=jt(this.x,t,e),this.y=jt(this.y,t,e),this.z=jt(this.z,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(jt(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,n=t.z,r=e.x,o=e.y,a=e.z;return this.x=i*a-n*o,this.y=n*r-s*a,this.z=s*o-i*r,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return Ia.copy(this).projectOnVector(t),this.sub(Ia)}reflect(t){return this.sub(Ia.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(jt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ia=new F,Mc=new Ms;class qs{constructor(t,e,s,i,n,r,o,a,h){qs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,s,i,n,r,o,a,h)}set(t,e,s,i,n,r,o,a,h){const l=this.elements;return l[0]=t,l[1]=i,l[2]=o,l[3]=e,l[4]=n,l[5]=a,l[6]=s,l[7]=r,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[3],a=s[6],h=s[1],l=s[4],u=s[7],d=s[2],p=s[5],f=s[8],S=i[0],B=i[3],z=i[6],N=i[1],L=i[4],W=i[7],et=i[2],rt=i[5],ct=i[8];return n[0]=r*S+o*N+a*et,n[3]=r*B+o*L+a*rt,n[6]=r*z+o*W+a*ct,n[1]=h*S+l*N+u*et,n[4]=h*B+l*L+u*rt,n[7]=h*z+l*W+u*ct,n[2]=d*S+p*N+f*et,n[5]=d*B+p*L+f*rt,n[8]=d*z+p*W+f*ct,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8];return e*r*l-e*o*h-s*n*l+s*o*a+i*n*h-i*r*a}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],u=l*r-o*h,d=o*a-l*n,p=h*n-r*a,f=e*u+s*d+i*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const S=1/f;return t[0]=u*S,t[1]=(i*h-l*s)*S,t[2]=(o*s-i*r)*S,t[3]=d*S,t[4]=(l*e-i*a)*S,t[5]=(i*n-o*e)*S,t[6]=p*S,t[7]=(s*a-h*e)*S,t[8]=(r*e-s*n)*S,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,n,r,o){const a=Math.cos(n),h=Math.sin(n);return this.set(s*a,s*h,-s*(a*r+h*o)+r+t,-i*h,i*a,-i*(-h*r+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Ea.makeScale(t,e)),this}rotate(t){return this.premultiply(Ea.makeRotation(-t)),this}translate(t,e){return this.premultiply(Ea.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<9;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Ea=new qs;function wc(c){for(let t=c.length-1;t>=0;--t)if(c[t]>=65535)return!0;return!1}const nd={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function En(c,t){return new nd[c](t)}function hr(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}function rd(){const c=hr("canvas");return c.style.display="block",c}const _c={};function Ra(c){c in _c||(_c[c]=!0,console.warn(c))}function od(c,t,e){return new Promise(function(s,i){function n(){switch(c.clientWaitSync(t,c.SYNC_FLUSH_COMMANDS_BIT,0)){case c.WAIT_FAILED:i();break;case c.TIMEOUT_EXPIRED:setTimeout(n,e);break;default:s()}}setTimeout(n,e)})}const Sc=new qs().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Tc=new qs().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function ad(){const c={enabled:!0,workingColorSpace:nr,spaces:{},convert:function(i,n,r){return this.enabled===!1||n===r||!n||!r||(this.spaces[n].transfer===Cn&&(i.r=gi(i.r),i.g=gi(i.g),i.b=gi(i.b)),this.spaces[n].primaries!==this.spaces[r].primaries&&(i.applyMatrix3(this.spaces[n].toXYZ),i.applyMatrix3(this.spaces[r].fromXYZ)),this.spaces[r].transfer===Cn&&(i.r=Rn(i.r),i.g=Rn(i.g),i.b=Rn(i.b))),i},workingToColorSpace:function(i,n){return this.convert(i,this.workingColorSpace,n)},colorSpaceToWorking:function(i,n){return this.convert(i,n,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===ir?rr:this.spaces[i].transfer},getLuminanceCoefficients:function(i,n=this.workingColorSpace){return i.fromArray(this.spaces[n].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,n,r){return i.copy(this.spaces[n].toXYZ).multiply(this.spaces[r].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,n){return Ra("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),c.workingToColorSpace(i,n)},toWorkingColorSpace:function(i,n){return Ra("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),c.colorSpaceToWorking(i,n)}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],s=[.3127,.329];return c.define({[nr]:{primaries:t,whitePoint:s,transfer:rr,toXYZ:Sc,fromXYZ:Tc,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:fs},outputColorSpaceConfig:{drawingBufferColorSpace:fs}},[fs]:{primaries:t,whitePoint:s,transfer:Cn,toXYZ:Sc,fromXYZ:Tc,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:fs}}}),c}const ws=ad();function gi(c){return c<.04045?c*.0773993808:Math.pow(c*.9478672986+.0521327014,2.4)}function Rn(c){return c<.0031308?c*12.92:1.055*Math.pow(c,.41666)-.055}let Pn;class Ac{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let s;if(t instanceof HTMLCanvasElement)s=t;else{Pn===void 0&&(Pn=hr("canvas")),Pn.width=t.width,Pn.height=t.height;const i=Pn.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),s=Pn}return s.toDataURL(e)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=hr("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),n=i.data;for(let r=0;r<n.length;r++)n[r]=gi(n[r]/255)*255;return s.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(gi(e[s]/255)*255):e[s]=gi(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let hd=0;class Li{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:hd++}),this.uuid=Rs(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):e!==null?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let n;if(Array.isArray(i)){n=[];for(let r=0,o=i.length;r<o;r++)i[r].isDataTexture?n.push(Pa(i[r].image)):n.push(Pa(i[r]))}else n=Pa(i);s.url=n}return e||(t.images[this.uuid]=s),s}}function Pa(c){return typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&c instanceof ImageBitmap?Ac.getDataURL(c):c.data?{data:Array.from(c.data),width:c.width,height:c.height,type:c.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let cd=0;const Ba=new F;class Ne extends yi{constructor(t=Ne.DEFAULT_IMAGE,e=Ne.DEFAULT_MAPPING,s=Dt,i=Dt,n=xe,r=ve,o=K,a=Cs,h=Ne.DEFAULT_ANISOTROPY,l=ir){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:cd++}),this.uuid=Rs(),this.name="",this.source=new Li(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=r,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new xt(0,0),this.repeat=new xt(1,1),this.center=new xt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new qs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Ba).x}get height(){return this.source.getSize(Ba).y}get depth(){return this.source.getSize(Ba).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const s=t[e];if(s===void 0){console.warn(`THREE.Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Texture.setValues(): property '${e}' does not exist.`);continue}i&&s&&i.isVector2&&s.isVector2||i&&s&&i.isVector3&&s.isVector3||i&&s&&i.isMatrix3&&s.isMatrix3?i.copy(s):this[e]=s}}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Bt)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Ut:t.x=t.x-Math.floor(t.x);break;case Dt:t.x=t.x<0?0:1;break;case Jt:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Ut:t.y=t.y-Math.floor(t.y);break;case Dt:t.y=t.y<0?0:1;break;case Jt:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Ne.DEFAULT_IMAGE=null,Ne.DEFAULT_MAPPING=Bt,Ne.DEFAULT_ANISOTROPY=1;class He{constructor(t=0,e=0,s=0,i=1){He.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,i){return this.x=t,this.y=e,this.z=s,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=this.w,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i+r[12]*n,this.y=r[1]*e+r[5]*s+r[9]*i+r[13]*n,this.z=r[2]*e+r[6]*s+r[10]*i+r[14]*n,this.w=r[3]*e+r[7]*s+r[11]*i+r[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,i,n;const a=t.elements,h=a[0],l=a[4],u=a[8],d=a[1],p=a[5],f=a[9],S=a[2],B=a[6],z=a[10];if(Math.abs(l-d)<.01&&Math.abs(u-S)<.01&&Math.abs(f-B)<.01){if(Math.abs(l+d)<.1&&Math.abs(u+S)<.1&&Math.abs(f+B)<.1&&Math.abs(h+p+z-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const L=(h+1)/2,W=(p+1)/2,et=(z+1)/2,rt=(l+d)/4,ct=(u+S)/4,ot=(f+B)/4;return L>W&&L>et?L<.01?(s=0,i=.707106781,n=.707106781):(s=Math.sqrt(L),i=rt/s,n=ct/s):W>et?W<.01?(s=.707106781,i=0,n=.707106781):(i=Math.sqrt(W),s=rt/i,n=ot/i):et<.01?(s=.707106781,i=.707106781,n=0):(n=Math.sqrt(et),s=ct/n,i=ot/n),this.set(s,i,n,e),this}let N=Math.sqrt((B-f)*(B-f)+(u-S)*(u-S)+(d-l)*(d-l));return Math.abs(N)<.001&&(N=1),this.x=(B-f)/N,this.y=(u-S)/N,this.z=(d-l)/N,this.w=Math.acos((h+p+z-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=jt(this.x,t.x,e.x),this.y=jt(this.y,t.y,e.y),this.z=jt(this.z,t.z,e.z),this.w=jt(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=jt(this.x,t,e),this.y=jt(this.y,t,e),this.z=jt(this.z,t,e),this.w=jt(this.w,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(jt(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class za extends yi{constructor(t=1,e=1,s={}){super(),s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:xe,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},s),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=s.depth,this.scissor=new He(0,0,t,e),this.scissorTest=!1,this.viewport=new He(0,0,t,e);const i={width:t,height:e,depth:s.depth},n=new Ne(i);this.textures=[];const r=s.count;for(let o=0;o<r;o++)this.textures[o]=n.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(s),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.resolveDepthBuffer=s.resolveDepthBuffer,this.resolveStencilBuffer=s.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=s.depthTexture,this.samples=s.samples,this.multiview=s.multiview}_setTextureOptions(t={}){const e={minFilter:xe,generateMipmaps:!1,flipY:!1,internalFormat:null};t.mapping!==void 0&&(e.mapping=t.mapping),t.wrapS!==void 0&&(e.wrapS=t.wrapS),t.wrapT!==void 0&&(e.wrapT=t.wrapT),t.wrapR!==void 0&&(e.wrapR=t.wrapR),t.magFilter!==void 0&&(e.magFilter=t.magFilter),t.minFilter!==void 0&&(e.minFilter=t.minFilter),t.format!==void 0&&(e.format=t.format),t.type!==void 0&&(e.type=t.type),t.anisotropy!==void 0&&(e.anisotropy=t.anisotropy),t.colorSpace!==void 0&&(e.colorSpace=t.colorSpace),t.flipY!==void 0&&(e.flipY=t.flipY),t.generateMipmaps!==void 0&&(e.generateMipmaps=t.generateMipmaps),t.internalFormat!==void 0&&(e.internalFormat=t.internalFormat);for(let s=0;s<this.textures.length;s++)this.textures[s].setValues(e)}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,s=1){if(this.width!==t||this.height!==e||this.depth!==s){this.width=t,this.height=e,this.depth=s;for(let i=0,n=this.textures.length;i<n;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=s,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,s=t.textures.length;e<s;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const i=Object.assign({},t.textures[e].image);this.textures[e].source=new Li(i)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class jr extends za{constructor(t=1,e=1,s={}){super(t,e,s),this.isWebGLRenderTarget=!0}}class Cc extends Ne{constructor(t=null,e=1,s=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:s,depth:i},this.magFilter=Yt,this.minFilter=Yt,this.wrapR=Dt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class ld extends jr{constructor(t=1,e=1,s=1,i={}){super(t,e,i),this.isWebGLArrayRenderTarget=!0,this.depth=s,this.texture=new Cc(null,t,e,s),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class ka extends Ne{constructor(t=null,e=1,s=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:s,depth:i},this.magFilter=Yt,this.minFilter=Yt,this.wrapR=Dt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ud extends jr{constructor(t=1,e=1,s=1,i={}){super(t,e,i),this.isWebGL3DRenderTarget=!0,this.depth=s,this.texture=new ka(null,t,e,s),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class rs{constructor(t=new F(1/0,1/0,1/0),e=new F(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(Zs.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(Zs.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=Zs.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(s!==void 0){const n=s.getAttribute("position");if(e===!0&&n!==void 0&&t.isInstancedMesh!==!0)for(let r=0,o=n.count;r<o;r++)t.isMesh===!0?t.getVertexPosition(r,Zs):Zs.fromBufferAttribute(n,r),Zs.applyMatrix4(t.matrixWorld),this.expandByPoint(Zs);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),$r.copy(t.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),$r.copy(s.boundingBox)),$r.applyMatrix4(t.matrixWorld),this.union($r)}const i=t.children;for(let n=0,r=i.length;n<r;n++)this.expandByObject(i[n],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Zs),Zs.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(cr),Kr.subVectors(this.max,cr),Bn.subVectors(t.a,cr),zn.subVectors(t.b,cr),kn.subVectors(t.c,cr),Fi.subVectors(zn,Bn),Ni.subVectors(kn,zn),Qi.subVectors(Bn,kn);let e=[0,-Fi.z,Fi.y,0,-Ni.z,Ni.y,0,-Qi.z,Qi.y,Fi.z,0,-Fi.x,Ni.z,0,-Ni.x,Qi.z,0,-Qi.x,-Fi.y,Fi.x,0,-Ni.y,Ni.x,0,-Qi.y,Qi.x,0];return!Oa(e,Bn,zn,kn,Kr)||(e=[1,0,0,0,1,0,0,0,1],!Oa(e,Bn,zn,kn,Kr))?!1:(Qr.crossVectors(Fi,Ni),e=[Qr.x,Qr.y,Qr.z],Oa(e,Bn,zn,kn,Kr))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Zs).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Zs).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(xi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),xi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),xi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),xi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),xi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),xi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),xi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),xi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(xi),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const xi=[new F,new F,new F,new F,new F,new F,new F,new F],Zs=new F,$r=new rs,Bn=new F,zn=new F,kn=new F,Fi=new F,Ni=new F,Qi=new F,cr=new F,Kr=new F,Qr=new F,tn=new F;function Oa(c,t,e,s,i){for(let n=0,r=c.length-3;n<=r;n+=3){tn.fromArray(c,n);const o=i.x*Math.abs(tn.x)+i.y*Math.abs(tn.y)+i.z*Math.abs(tn.z),a=t.dot(tn),h=e.dot(tn),l=s.dot(tn);if(Math.max(-Math.max(a,h,l),Math.min(a,h,l))>o)return!1}return!0}const dd=new rs,lr=new F,La=new F;class je{constructor(t=new F,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;e!==void 0?s.copy(e):dd.setFromPoints(t).getCenter(s);let i=0;for(let n=0,r=t.length;n<r;n++)i=Math.max(i,s.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;lr.subVectors(t,this.center);const e=lr.lengthSq();if(e>this.radius*this.radius){const s=Math.sqrt(e),i=(s-this.radius)*.5;this.center.addScaledVector(lr,i/s),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(La.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(lr.copy(t.center).add(La)),this.expandByPoint(lr.copy(t.center).sub(La))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const vi=new F,Fa=new F,to=new F,Di=new F,Na=new F,eo=new F,Da=new F;class On{constructor(t=new F,e=new F(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,vi)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=vi.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(vi.copy(this.origin).addScaledVector(this.direction,e),vi.distanceToSquared(t))}distanceSqToSegment(t,e,s,i){Fa.copy(t).add(e).multiplyScalar(.5),to.copy(e).sub(t).normalize(),Di.copy(this.origin).sub(Fa);const n=t.distanceTo(e)*.5,r=-this.direction.dot(to),o=Di.dot(this.direction),a=-Di.dot(to),h=Di.lengthSq(),l=Math.abs(1-r*r);let u,d,p,f;if(l>0)if(u=r*a-o,d=r*o-a,f=n*l,u>=0)if(d>=-f)if(d<=f){const S=1/l;u*=S,d*=S,p=u*(u+r*d+2*o)+d*(r*u+d+2*a)+h}else d=n,u=Math.max(0,-(r*d+o)),p=-u*u+d*(d+2*a)+h;else d=-n,u=Math.max(0,-(r*d+o)),p=-u*u+d*(d+2*a)+h;else d<=-f?(u=Math.max(0,-(-r*n+o)),d=u>0?-n:Math.min(Math.max(-n,-a),n),p=-u*u+d*(d+2*a)+h):d<=f?(u=0,d=Math.min(Math.max(-n,-a),n),p=d*(d+2*a)+h):(u=Math.max(0,-(r*n+o)),d=u>0?n:Math.min(Math.max(-n,-a),n),p=-u*u+d*(d+2*a)+h);else d=r>0?-n:n,u=Math.max(0,-(r*d+o)),p=-u*u+d*(d+2*a)+h;return s&&s.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Fa).addScaledVector(to,d),p}intersectSphere(t,e){vi.subVectors(t.center,this.origin);const s=vi.dot(this.direction),i=vi.dot(vi)-s*s,n=t.radius*t.radius;if(i>n)return null;const r=Math.sqrt(n-i),o=s-r,a=s+r;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return t.radius<0?!1:this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return s===null?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,i,n,r,o,a;const h=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,d=this.origin;return h>=0?(s=(t.min.x-d.x)*h,i=(t.max.x-d.x)*h):(s=(t.max.x-d.x)*h,i=(t.min.x-d.x)*h),l>=0?(n=(t.min.y-d.y)*l,r=(t.max.y-d.y)*l):(n=(t.max.y-d.y)*l,r=(t.min.y-d.y)*l),s>r||n>i||((n>s||isNaN(s))&&(s=n),(r<i||isNaN(i))&&(i=r),u>=0?(o=(t.min.z-d.z)*u,a=(t.max.z-d.z)*u):(o=(t.max.z-d.z)*u,a=(t.min.z-d.z)*u),s>a||o>i)||((o>s||s!==s)&&(s=o),(a<i||i!==i)&&(i=a),i<0)?null:this.at(s>=0?s:i,e)}intersectsBox(t){return this.intersectBox(t,vi)!==null}intersectTriangle(t,e,s,i,n){Na.subVectors(e,t),eo.subVectors(s,t),Da.crossVectors(Na,eo);let r=this.direction.dot(Da),o;if(r>0){if(i)return null;o=1}else if(r<0)o=-1,r=-r;else return null;Di.subVectors(this.origin,t);const a=o*this.direction.dot(eo.crossVectors(Di,eo));if(a<0)return null;const h=o*this.direction.dot(Na.cross(Di));if(h<0||a+h>r)return null;const l=-o*Di.dot(Da);return l<0?null:this.at(l/r,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class se{constructor(t,e,s,i,n,r,o,a,h,l,u,d,p,f,S,B){se.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,s,i,n,r,o,a,h,l,u,d,p,f,S,B)}set(t,e,s,i,n,r,o,a,h,l,u,d,p,f,S,B){const z=this.elements;return z[0]=t,z[4]=e,z[8]=s,z[12]=i,z[1]=n,z[5]=r,z[9]=o,z[13]=a,z[2]=h,z[6]=l,z[10]=u,z[14]=d,z[3]=p,z[7]=f,z[11]=S,z[15]=B,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new se().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/Ln.setFromMatrixColumn(t,0).length(),n=1/Ln.setFromMatrixColumn(t,1).length(),r=1/Ln.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*n,e[5]=s[5]*n,e[6]=s[6]*n,e[7]=0,e[8]=s[8]*r,e[9]=s[9]*r,e[10]=s[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,n=t.z,r=Math.cos(s),o=Math.sin(s),a=Math.cos(i),h=Math.sin(i),l=Math.cos(n),u=Math.sin(n);if(t.order==="XYZ"){const d=r*l,p=r*u,f=o*l,S=o*u;e[0]=a*l,e[4]=-a*u,e[8]=h,e[1]=p+f*h,e[5]=d-S*h,e[9]=-o*a,e[2]=S-d*h,e[6]=f+p*h,e[10]=r*a}else if(t.order==="YXZ"){const d=a*l,p=a*u,f=h*l,S=h*u;e[0]=d+S*o,e[4]=f*o-p,e[8]=r*h,e[1]=r*u,e[5]=r*l,e[9]=-o,e[2]=p*o-f,e[6]=S+d*o,e[10]=r*a}else if(t.order==="ZXY"){const d=a*l,p=a*u,f=h*l,S=h*u;e[0]=d-S*o,e[4]=-r*u,e[8]=f+p*o,e[1]=p+f*o,e[5]=r*l,e[9]=S-d*o,e[2]=-r*h,e[6]=o,e[10]=r*a}else if(t.order==="ZYX"){const d=r*l,p=r*u,f=o*l,S=o*u;e[0]=a*l,e[4]=f*h-p,e[8]=d*h+S,e[1]=a*u,e[5]=S*h+d,e[9]=p*h-f,e[2]=-h,e[6]=o*a,e[10]=r*a}else if(t.order==="YZX"){const d=r*a,p=r*h,f=o*a,S=o*h;e[0]=a*l,e[4]=S-d*u,e[8]=f*u+p,e[1]=u,e[5]=r*l,e[9]=-o*l,e[2]=-h*l,e[6]=p*u+f,e[10]=d-S*u}else if(t.order==="XZY"){const d=r*a,p=r*h,f=o*a,S=o*h;e[0]=a*l,e[4]=-u,e[8]=h*l,e[1]=d*u+S,e[5]=r*l,e[9]=p*u-f,e[2]=f*u-p,e[6]=o*l,e[10]=S*u+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(pd,t,fd)}lookAt(t,e,s){const i=this.elements;return Ps.subVectors(t,e),Ps.lengthSq()===0&&(Ps.z=1),Ps.normalize(),Vi.crossVectors(s,Ps),Vi.lengthSq()===0&&(Math.abs(s.z)===1?Ps.x+=1e-4:Ps.z+=1e-4,Ps.normalize(),Vi.crossVectors(s,Ps)),Vi.normalize(),so.crossVectors(Ps,Vi),i[0]=Vi.x,i[4]=so.x,i[8]=Ps.x,i[1]=Vi.y,i[5]=so.y,i[9]=Ps.y,i[2]=Vi.z,i[6]=so.z,i[10]=Ps.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[4],a=s[8],h=s[12],l=s[1],u=s[5],d=s[9],p=s[13],f=s[2],S=s[6],B=s[10],z=s[14],N=s[3],L=s[7],W=s[11],et=s[15],rt=i[0],ct=i[4],ot=i[8],gt=i[12],bt=i[1],Ht=i[5],ne=i[9],ce=i[13],be=i[2],ge=i[6],Ge=i[10],$e=i[14],ti=i[3],Be=i[7],Ve=i[11],ze=i[15];return n[0]=r*rt+o*bt+a*be+h*ti,n[4]=r*ct+o*Ht+a*ge+h*Be,n[8]=r*ot+o*ne+a*Ge+h*Ve,n[12]=r*gt+o*ce+a*$e+h*ze,n[1]=l*rt+u*bt+d*be+p*ti,n[5]=l*ct+u*Ht+d*ge+p*Be,n[9]=l*ot+u*ne+d*Ge+p*Ve,n[13]=l*gt+u*ce+d*$e+p*ze,n[2]=f*rt+S*bt+B*be+z*ti,n[6]=f*ct+S*Ht+B*ge+z*Be,n[10]=f*ot+S*ne+B*Ge+z*Ve,n[14]=f*gt+S*ce+B*$e+z*ze,n[3]=N*rt+L*bt+W*be+et*ti,n[7]=N*ct+L*Ht+W*ge+et*Be,n[11]=N*ot+L*ne+W*Ge+et*Ve,n[15]=N*gt+L*ce+W*$e+et*ze,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],n=t[12],r=t[1],o=t[5],a=t[9],h=t[13],l=t[2],u=t[6],d=t[10],p=t[14],f=t[3],S=t[7],B=t[11],z=t[15];return f*(+n*a*u-i*h*u-n*o*d+s*h*d+i*o*p-s*a*p)+S*(+e*a*p-e*h*d+n*r*d-i*r*p+i*h*l-n*a*l)+B*(+e*h*u-e*o*p-n*r*u+s*r*p+n*o*l-s*h*l)+z*(-i*o*l-e*a*u+e*o*d+i*r*u-s*r*d+s*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],u=t[9],d=t[10],p=t[11],f=t[12],S=t[13],B=t[14],z=t[15],N=u*B*h-S*d*h+S*a*p-o*B*p-u*a*z+o*d*z,L=f*d*h-l*B*h-f*a*p+r*B*p+l*a*z-r*d*z,W=l*S*h-f*u*h+f*o*p-r*S*p-l*o*z+r*u*z,et=f*u*a-l*S*a-f*o*d+r*S*d+l*o*B-r*u*B,rt=e*N+s*L+i*W+n*et;if(rt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ct=1/rt;return t[0]=N*ct,t[1]=(S*d*n-u*B*n-S*i*p+s*B*p+u*i*z-s*d*z)*ct,t[2]=(o*B*n-S*a*n+S*i*h-s*B*h-o*i*z+s*a*z)*ct,t[3]=(u*a*n-o*d*n-u*i*h+s*d*h+o*i*p-s*a*p)*ct,t[4]=L*ct,t[5]=(l*B*n-f*d*n+f*i*p-e*B*p-l*i*z+e*d*z)*ct,t[6]=(f*a*n-r*B*n-f*i*h+e*B*h+r*i*z-e*a*z)*ct,t[7]=(r*d*n-l*a*n+l*i*h-e*d*h-r*i*p+e*a*p)*ct,t[8]=W*ct,t[9]=(f*u*n-l*S*n-f*s*p+e*S*p+l*s*z-e*u*z)*ct,t[10]=(r*S*n-f*o*n+f*s*h-e*S*h-r*s*z+e*o*z)*ct,t[11]=(l*o*n-r*u*n-l*s*h+e*u*h+r*s*p-e*o*p)*ct,t[12]=et*ct,t[13]=(l*S*i-f*u*i+f*s*d-e*S*d-l*s*B+e*u*B)*ct,t[14]=(f*o*i-r*S*i-f*s*a+e*S*a+r*s*B-e*o*B)*ct,t[15]=(r*u*i-l*o*i+l*s*a-e*u*a-r*s*d+e*o*d)*ct,this}scale(t){const e=this.elements,s=t.x,i=t.y,n=t.z;return e[0]*=s,e[4]*=i,e[8]*=n,e[1]*=s,e[5]*=i,e[9]*=n,e[2]*=s,e[6]*=i,e[10]*=n,e[3]*=s,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),n=1-s,r=t.x,o=t.y,a=t.z,h=n*r,l=n*o;return this.set(h*r+s,h*o-i*a,h*a+i*o,0,h*o+i*a,l*o+s,l*a-i*r,0,h*a-i*o,l*a+i*r,n*a*a+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,n,r){return this.set(1,s,n,0,t,1,r,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,n=e._x,r=e._y,o=e._z,a=e._w,h=n+n,l=r+r,u=o+o,d=n*h,p=n*l,f=n*u,S=r*l,B=r*u,z=o*u,N=a*h,L=a*l,W=a*u,et=s.x,rt=s.y,ct=s.z;return i[0]=(1-(S+z))*et,i[1]=(p+W)*et,i[2]=(f-L)*et,i[3]=0,i[4]=(p-W)*rt,i[5]=(1-(d+z))*rt,i[6]=(B+N)*rt,i[7]=0,i[8]=(f+L)*ct,i[9]=(B-N)*ct,i[10]=(1-(d+S))*ct,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let n=Ln.set(i[0],i[1],i[2]).length();const r=Ln.set(i[4],i[5],i[6]).length(),o=Ln.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],Ys.copy(this);const h=1/n,l=1/r,u=1/o;return Ys.elements[0]*=h,Ys.elements[1]*=h,Ys.elements[2]*=h,Ys.elements[4]*=l,Ys.elements[5]*=l,Ys.elements[6]*=l,Ys.elements[8]*=u,Ys.elements[9]*=u,Ys.elements[10]*=u,e.setFromRotationMatrix(Ys),s.x=n,s.y=r,s.z=o,this}makePerspective(t,e,s,i,n,r,o=Es,a=!1){const h=this.elements,l=2*n/(e-t),u=2*n/(s-i),d=(e+t)/(e-t),p=(s+i)/(s-i);let f,S;if(a)f=n/(r-n),S=r*n/(r-n);else if(o===Es)f=-(r+n)/(r-n),S=-2*r*n/(r-n);else if(o===Oi)f=-r/(r-n),S=-r*n/(r-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return h[0]=l,h[4]=0,h[8]=d,h[12]=0,h[1]=0,h[5]=u,h[9]=p,h[13]=0,h[2]=0,h[6]=0,h[10]=f,h[14]=S,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,s,i,n,r,o=Es,a=!1){const h=this.elements,l=2/(e-t),u=2/(s-i),d=-(e+t)/(e-t),p=-(s+i)/(s-i);let f,S;if(a)f=1/(r-n),S=r/(r-n);else if(o===Es)f=-2/(r-n),S=-(r+n)/(r-n);else if(o===Oi)f=-1/(r-n),S=-n/(r-n);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return h[0]=l,h[4]=0,h[8]=0,h[12]=d,h[1]=0,h[5]=u,h[9]=0,h[13]=p,h[2]=0,h[6]=0,h[10]=f,h[14]=S,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<16;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const Ln=new F,Ys=new se,pd=new F(0,0,0),fd=new F(1,1,1),Vi=new F,so=new F,Ps=new F,Ic=new se,Ec=new Ms;class js{constructor(t=0,e=0,s=0,i=js.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,n=i[0],r=i[4],o=i[8],a=i[1],h=i[5],l=i[9],u=i[2],d=i[6],p=i[10];switch(e){case"XYZ":this._y=Math.asin(jt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-r,n)):(this._x=Math.atan2(d,h),this._z=0);break;case"YXZ":this._x=Math.asin(-jt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(jt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-r,h)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-jt(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-r,h));break;case"YZX":this._z=Math.asin(jt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-jt(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(d,h),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-l,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return Ic.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ic,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ec.setFromEuler(this),this.setFromQuaternion(Ec,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}js.DEFAULT_ORDER="XYZ";class Va{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let md=0;const Rc=new F,Fn=new Ms,bi=new se,io=new F,ur=new F,yd=new F,gd=new Ms,Pc=new F(1,0,0),Bc=new F(0,1,0),zc=new F(0,0,1),kc={type:"added"},xd={type:"removed"},Nn={type:"childadded",child:null},Ua={type:"childremoved",child:null};class ue extends yi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:md++}),this.uuid=Rs(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ue.DEFAULT_UP.clone();const t=new F,e=new js,s=new Ms,i=new F(1,1,1);function n(){s.setFromEuler(e,!1)}function r(){e.setFromQuaternion(s,void 0,!1)}e._onChange(n),s._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new se},normalMatrix:{value:new qs}}),this.matrix=new se,this.matrixWorld=new se,this.matrixAutoUpdate=ue.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ue.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Va,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Fn.setFromAxisAngle(t,e),this.quaternion.multiply(Fn),this}rotateOnWorldAxis(t,e){return Fn.setFromAxisAngle(t,e),this.quaternion.premultiply(Fn),this}rotateX(t){return this.rotateOnAxis(Pc,t)}rotateY(t){return this.rotateOnAxis(Bc,t)}rotateZ(t){return this.rotateOnAxis(zc,t)}translateOnAxis(t,e){return Rc.copy(t).applyQuaternion(this.quaternion),this.position.add(Rc.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Pc,t)}translateY(t){return this.translateOnAxis(Bc,t)}translateZ(t){return this.translateOnAxis(zc,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(bi.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?io.copy(t):io.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),ur.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?bi.lookAt(ur,io,this.up):bi.lookAt(io,ur,this.up),this.quaternion.setFromRotationMatrix(bi),i&&(bi.extractRotation(i.matrixWorld),Fn.setFromRotationMatrix(bi),this.quaternion.premultiply(Fn.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(kc),Nn.child=t,this.dispatchEvent(Nn),Nn.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(xd),Ua.child=t,this.dispatchEvent(Ua),Ua.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),bi.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),bi.multiply(t.parent.matrixWorld)),t.applyMatrix4(bi),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(kc),Nn.child=t,this.dispatchEvent(Nn),Nn.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const r=this.children[s].getObjectByProperty(t,e);if(r!==void 0)return r}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ur,t,yd),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ur,gd,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].updateMatrixWorld(t)}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(t),i.indirectTexture=this._indirectTexture.toJSON(t),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function n(o,a){return o[a.uuid]===void 0&&(o[a.uuid]=a.toJSON(t)),a.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const a=o.shapes;if(Array.isArray(a))for(let h=0,l=a.length;h<l;h++){const u=a[h];n(t.shapes,u)}else n(t.shapes,a)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let a=0,h=this.material.length;a<h;a++)o.push(n(t.materials,this.material[a]));i.material=o}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const a=this.animations[o];i.animations.push(n(t.animations,a))}}if(e){const o=r(t.geometries),a=r(t.materials),h=r(t.textures),l=r(t.images),u=r(t.shapes),d=r(t.skeletons),p=r(t.animations),f=r(t.nodes);o.length>0&&(s.geometries=o),a.length>0&&(s.materials=a),h.length>0&&(s.textures=h),l.length>0&&(s.images=l),u.length>0&&(s.shapes=u),d.length>0&&(s.skeletons=d),p.length>0&&(s.animations=p),f.length>0&&(s.nodes=f)}return s.object=i,s;function r(o){const a=[];for(const h in o){const l=o[h];delete l.metadata,a.push(l)}return a}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const i=t.children[s];this.add(i.clone())}return this}}ue.DEFAULT_UP=new F(0,1,0),ue.DEFAULT_MATRIX_AUTO_UPDATE=!0,ue.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const $s=new F,Mi=new F,Wa=new F,wi=new F,Dn=new F,Vn=new F,Oc=new F,Ha=new F,Ga=new F,Ja=new F,Xa=new He,qa=new He,Za=new He;class _s{constructor(t=new F,e=new F,s=new F){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),$s.subVectors(t,e),i.cross($s);const n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(t,e,s,i,n){$s.subVectors(i,e),Mi.subVectors(s,e),Wa.subVectors(t,e);const r=$s.dot($s),o=$s.dot(Mi),a=$s.dot(Wa),h=Mi.dot(Mi),l=Mi.dot(Wa),u=r*h-o*o;if(u===0)return n.set(0,0,0),null;const d=1/u,p=(h*a-o*l)*d,f=(r*l-o*a)*d;return n.set(1-p-f,f,p)}static containsPoint(t,e,s,i){return this.getBarycoord(t,e,s,i,wi)===null?!1:wi.x>=0&&wi.y>=0&&wi.x+wi.y<=1}static getInterpolation(t,e,s,i,n,r,o,a){return this.getBarycoord(t,e,s,i,wi)===null?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(n,wi.x),a.addScaledVector(r,wi.y),a.addScaledVector(o,wi.z),a)}static getInterpolatedAttribute(t,e,s,i,n,r){return Xa.setScalar(0),qa.setScalar(0),Za.setScalar(0),Xa.fromBufferAttribute(t,e),qa.fromBufferAttribute(t,s),Za.fromBufferAttribute(t,i),r.setScalar(0),r.addScaledVector(Xa,n.x),r.addScaledVector(qa,n.y),r.addScaledVector(Za,n.z),r}static isFrontFacing(t,e,s,i){return $s.subVectors(s,e),Mi.subVectors(t,e),$s.cross(Mi).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return $s.subVectors(this.c,this.b),Mi.subVectors(this.a,this.b),$s.cross(Mi).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return _s.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return _s.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,i,n){return _s.getInterpolation(t,this.a,this.b,this.c,e,s,i,n)}containsPoint(t){return _s.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return _s.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,n=this.c;let r,o;Dn.subVectors(i,s),Vn.subVectors(n,s),Ha.subVectors(t,s);const a=Dn.dot(Ha),h=Vn.dot(Ha);if(a<=0&&h<=0)return e.copy(s);Ga.subVectors(t,i);const l=Dn.dot(Ga),u=Vn.dot(Ga);if(l>=0&&u<=l)return e.copy(i);const d=a*u-l*h;if(d<=0&&a>=0&&l<=0)return r=a/(a-l),e.copy(s).addScaledVector(Dn,r);Ja.subVectors(t,n);const p=Dn.dot(Ja),f=Vn.dot(Ja);if(f>=0&&p<=f)return e.copy(n);const S=p*h-a*f;if(S<=0&&h>=0&&f<=0)return o=h/(h-f),e.copy(s).addScaledVector(Vn,o);const B=l*f-p*u;if(B<=0&&u-l>=0&&p-f>=0)return Oc.subVectors(n,i),o=(u-l)/(u-l+(p-f)),e.copy(i).addScaledVector(Oc,o);const z=1/(B+S+d);return r=S*z,o=d*z,e.copy(s).addScaledVector(Dn,r).addScaledVector(Vn,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Lc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ui={h:0,s:0,l:0},no={h:0,s:0,l:0};function Ya(c,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?c+(t-c)*6*e:e<1/2?t:e<2/3?c+(t-c)*6*(2/3-e):c}class te{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(e===void 0&&s===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=fs){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ws.colorSpaceToWorking(this,e),this}setRGB(t,e,s,i=ws.workingColorSpace){return this.r=t,this.g=e,this.b=s,ws.colorSpaceToWorking(this,i),this}setHSL(t,e,s,i=ws.workingColorSpace){if(t=Ca(t,1),e=jt(e,0,1),s=jt(s,0,1),e===0)this.r=this.g=this.b=s;else{const n=s<=.5?s*(1+e):s+e-s*e,r=2*s-n;this.r=Ya(r,n,t+1/3),this.g=Ya(r,n,t),this.b=Ya(r,n,t-1/3)}return ws.colorSpaceToWorking(this,i),this}setStyle(t,e=fs){function s(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=i[1],r=n.length;if(r===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(r===6)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=fs){const s=Lc[t.toLowerCase()];return s!==void 0?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=gi(t.r),this.g=gi(t.g),this.b=gi(t.b),this}copyLinearToSRGB(t){return this.r=Rn(t.r),this.g=Rn(t.g),this.b=Rn(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=fs){return ws.workingToColorSpace(os.copy(this),t),Math.round(jt(os.r*255,0,255))*65536+Math.round(jt(os.g*255,0,255))*256+Math.round(jt(os.b*255,0,255))}getHexString(t=fs){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ws.workingColorSpace){ws.workingToColorSpace(os.copy(this),e);const s=os.r,i=os.g,n=os.b,r=Math.max(s,i,n),o=Math.min(s,i,n);let a,h;const l=(o+r)/2;if(o===r)a=0,h=0;else{const u=r-o;switch(h=l<=.5?u/(r+o):u/(2-r-o),r){case s:a=(i-n)/u+(i<n?6:0);break;case i:a=(n-s)/u+2;break;case n:a=(s-i)/u+4;break}a/=6}return t.h=a,t.s=h,t.l=l,t}getRGB(t,e=ws.workingColorSpace){return ws.workingToColorSpace(os.copy(this),e),t.r=os.r,t.g=os.g,t.b=os.b,t}getStyle(t=fs){ws.workingToColorSpace(os.copy(this),t);const e=os.r,s=os.g,i=os.b;return t!==fs?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(s*255)},${Math.round(i*255)})`}offsetHSL(t,e,s){return this.getHSL(Ui),this.setHSL(Ui.h+t,Ui.s+e,Ui.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(Ui),t.getHSL(no);const s=ar(Ui.h,no.h,e),i=ar(Ui.s,no.s,e),n=ar(Ui.l,no.l,e);return this.setHSL(s,i,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,n=t.elements;return this.r=n[0]*e+n[3]*s+n[6]*i,this.g=n[1]*e+n[4]*s+n[7]*i,this.b=n[2]*e+n[5]*s+n[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const os=new te;te.NAMES=Lc;let vd=0;class as extends yi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:vd++}),this.uuid=Rs(),this.name="",this.type="Material",this.blending=Z,this.side=y,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Wt,this.blendDst=qt,this.blendEquation=lt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new te(0,0,0),this.blendAlpha=0,this.depthFunc=Ae,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=or,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=mi,this.stencilZFail=mi,this.stencilZPass=mi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const s=t[e];if(s===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[e]=s}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const s={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==Z&&(s.blending=this.blending),this.side!==y&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==Wt&&(s.blendSrc=this.blendSrc),this.blendDst!==qt&&(s.blendDst=this.blendDst),this.blendEquation!==lt&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==Ae&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==or&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==mi&&(s.stencilFail=this.stencilFail),this.stencilZFail!==mi&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==mi&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function i(n){const r=[];for(const o in n){const a=n[o];delete a.metadata,r.push(a)}return r}if(e){const n=i(t.textures),r=i(t.images);n.length>0&&(s.textures=n),r.length>0&&(s.images=r)}return s}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(e!==null){const i=e.length;s=new Array(i);for(let n=0;n!==i;++n)s[n]=e[n].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class en extends as{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new te(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new js,this.combine=ke,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const _i=bd();function bd(){const c=new ArrayBuffer(4),t=new Float32Array(c),e=new Uint32Array(c),s=new Uint32Array(512),i=new Uint32Array(512);for(let a=0;a<256;++a){const h=a-127;h<-27?(s[a]=0,s[a|256]=32768,i[a]=24,i[a|256]=24):h<-14?(s[a]=1024>>-h-14,s[a|256]=1024>>-h-14|32768,i[a]=-h-1,i[a|256]=-h-1):h<=15?(s[a]=h+15<<10,s[a|256]=h+15<<10|32768,i[a]=13,i[a|256]=13):h<128?(s[a]=31744,s[a|256]=64512,i[a]=24,i[a|256]=24):(s[a]=31744,s[a|256]=64512,i[a]=13,i[a|256]=13)}const n=new Uint32Array(2048),r=new Uint32Array(64),o=new Uint32Array(64);for(let a=1;a<1024;++a){let h=a<<13,l=0;for(;!(h&8388608);)h<<=1,l-=8388608;h&=-8388609,l+=947912704,n[a]=h|l}for(let a=1024;a<2048;++a)n[a]=939524096+(a-1024<<13);for(let a=1;a<31;++a)r[a]=a<<23;r[31]=1199570944,r[32]=2147483648;for(let a=33;a<63;++a)r[a]=2147483648+(a-32<<23);r[63]=3347054592;for(let a=1;a<64;++a)a!==32&&(o[a]=1024);return{floatView:t,uint32View:e,baseTable:s,shiftTable:i,mantissaTable:n,exponentTable:r,offsetTable:o}}function Ss(c){Math.abs(c)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),c=jt(c,-65504,65504),_i.floatView[0]=c;const t=_i.uint32View[0],e=t>>23&511;return _i.baseTable[e]+((t&8388607)>>_i.shiftTable[e])}function dr(c){const t=c>>10;return _i.uint32View[0]=_i.mantissaTable[_i.offsetTable[t]+(c&1023)]+_i.exponentTable[t],_i.floatView[0]}class Md{static toHalfFloat(t){return Ss(t)}static fromHalfFloat(t){return dr(t)}}const De=new F,ro=new xt;let wd=0;class _e{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:wd++}),this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=s,this.usage=$i,this.updateRanges=[],this.gpuType=v,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[s+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,s=this.count;e<s;e++)ro.fromBufferAttribute(this,e),ro.applyMatrix3(t),this.setXY(e,ro.x,ro.y);else if(this.itemSize===3)for(let e=0,s=this.count;e<s;e++)De.fromBufferAttribute(this,e),De.applyMatrix3(t),this.setXYZ(e,De.x,De.y,De.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)De.fromBufferAttribute(this,e),De.applyMatrix4(t),this.setXYZ(e,De.x,De.y,De.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)De.fromBufferAttribute(this,e),De.applyNormalMatrix(t),this.setXYZ(e,De.x,De.y,De.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)De.fromBufferAttribute(this,e),De.transformDirection(t),this.setXYZ(e,De.x,De.y,De.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let s=this.array[t*this.itemSize+e];return this.normalized&&(s=ms(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=ie(s,this.array)),this.array[t*this.itemSize+e]=s,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=ms(e,this.array)),e}setX(t,e){return this.normalized&&(e=ie(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=ms(e,this.array)),e}setY(t,e){return this.normalized&&(e=ie(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=ms(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ie(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=ms(e,this.array)),e}setW(t,e){return this.normalized&&(e=ie(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=ie(e,this.array),s=ie(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=ie(e,this.array),s=ie(s,this.array),i=ie(i,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=ie(e,this.array),s=ie(s,this.array),i=ie(i,this.array),n=ie(n,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==$i&&(t.usage=this.usage),t}}class _d extends _e{constructor(t,e,s){super(new Int8Array(t),e,s)}}class Sd extends _e{constructor(t,e,s){super(new Uint8Array(t),e,s)}}class Td extends _e{constructor(t,e,s){super(new Uint8ClampedArray(t),e,s)}}class Ad extends _e{constructor(t,e,s){super(new Int16Array(t),e,s)}}class Fc extends _e{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class Cd extends _e{constructor(t,e,s){super(new Int32Array(t),e,s)}}class Nc extends _e{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class Id extends _e{constructor(t,e,s){super(new Uint16Array(t),e,s),this.isFloat16BufferAttribute=!0}getX(t){let e=dr(this.array[t*this.itemSize]);return this.normalized&&(e=ms(e,this.array)),e}setX(t,e){return this.normalized&&(e=ie(e,this.array)),this.array[t*this.itemSize]=Ss(e),this}getY(t){let e=dr(this.array[t*this.itemSize+1]);return this.normalized&&(e=ms(e,this.array)),e}setY(t,e){return this.normalized&&(e=ie(e,this.array)),this.array[t*this.itemSize+1]=Ss(e),this}getZ(t){let e=dr(this.array[t*this.itemSize+2]);return this.normalized&&(e=ms(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ie(e,this.array)),this.array[t*this.itemSize+2]=Ss(e),this}getW(t){let e=dr(this.array[t*this.itemSize+3]);return this.normalized&&(e=ms(e,this.array)),e}setW(t,e){return this.normalized&&(e=ie(e,this.array)),this.array[t*this.itemSize+3]=Ss(e),this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=ie(e,this.array),s=ie(s,this.array)),this.array[t+0]=Ss(e),this.array[t+1]=Ss(s),this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=ie(e,this.array),s=ie(s,this.array),i=ie(i,this.array)),this.array[t+0]=Ss(e),this.array[t+1]=Ss(s),this.array[t+2]=Ss(i),this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=ie(e,this.array),s=ie(s,this.array),i=ie(i,this.array),n=ie(n,this.array)),this.array[t+0]=Ss(e),this.array[t+1]=Ss(s),this.array[t+2]=Ss(i),this.array[t+3]=Ss(n),this}}class Ot extends _e{constructor(t,e,s){super(new Float32Array(t),e,s)}}let Ed=0;const Ds=new se,ja=new ue,Un=new F,Bs=new rs,pr=new rs,Ze=new F;class oe extends yi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ed++}),this.uuid=Rs(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(wc(t)?Nc:Fc)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const n=new qs().getNormalMatrix(t);s.applyNormalMatrix(n),s.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ds.makeRotationFromQuaternion(t),this.applyMatrix4(Ds),this}rotateX(t){return Ds.makeRotationX(t),this.applyMatrix4(Ds),this}rotateY(t){return Ds.makeRotationY(t),this.applyMatrix4(Ds),this}rotateZ(t){return Ds.makeRotationZ(t),this.applyMatrix4(Ds),this}translate(t,e,s){return Ds.makeTranslation(t,e,s),this.applyMatrix4(Ds),this}scale(t,e,s){return Ds.makeScale(t,e,s),this.applyMatrix4(Ds),this}lookAt(t){return ja.lookAt(t),ja.updateMatrix(),this.applyMatrix4(ja.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Un).negate(),this.translate(Un.x,Un.y,Un.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const s=[];for(let i=0,n=t.length;i<n;i++){const r=t[i];s.push(r.x,r.y,r.z||0)}this.setAttribute("position",new Ot(s,3))}else{const s=Math.min(t.length,e.count);for(let i=0;i<s;i++){const n=t[i];e.setXYZ(i,n.x,n.y,n.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new rs);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new F(-1/0,-1/0,-1/0),new F(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let s=0,i=e.length;s<i;s++){const n=e[s];Bs.setFromBufferAttribute(n),this.morphTargetsRelative?(Ze.addVectors(this.boundingBox.min,Bs.min),this.boundingBox.expandByPoint(Ze),Ze.addVectors(this.boundingBox.max,Bs.max),this.boundingBox.expandByPoint(Ze)):(this.boundingBox.expandByPoint(Bs.min),this.boundingBox.expandByPoint(Bs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new je);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new F,1/0);return}if(t){const s=this.boundingSphere.center;if(Bs.setFromBufferAttribute(t),e)for(let n=0,r=e.length;n<r;n++){const o=e[n];pr.setFromBufferAttribute(o),this.morphTargetsRelative?(Ze.addVectors(Bs.min,pr.min),Bs.expandByPoint(Ze),Ze.addVectors(Bs.max,pr.max),Bs.expandByPoint(Ze)):(Bs.expandByPoint(pr.min),Bs.expandByPoint(pr.max))}Bs.getCenter(s);let i=0;for(let n=0,r=t.count;n<r;n++)Ze.fromBufferAttribute(t,n),i=Math.max(i,s.distanceToSquared(Ze));if(e)for(let n=0,r=e.length;n<r;n++){const o=e[n],a=this.morphTargetsRelative;for(let h=0,l=o.count;h<l;h++)Ze.fromBufferAttribute(o,h),a&&(Un.fromBufferAttribute(t,h),Ze.add(Un)),i=Math.max(i,s.distanceToSquared(Ze))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=e.position,i=e.normal,n=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new _e(new Float32Array(4*s.count),4));const r=this.getAttribute("tangent"),o=[],a=[];for(let ot=0;ot<s.count;ot++)o[ot]=new F,a[ot]=new F;const h=new F,l=new F,u=new F,d=new xt,p=new xt,f=new xt,S=new F,B=new F;function z(ot,gt,bt){h.fromBufferAttribute(s,ot),l.fromBufferAttribute(s,gt),u.fromBufferAttribute(s,bt),d.fromBufferAttribute(n,ot),p.fromBufferAttribute(n,gt),f.fromBufferAttribute(n,bt),l.sub(h),u.sub(h),p.sub(d),f.sub(d);const Ht=1/(p.x*f.y-f.x*p.y);isFinite(Ht)&&(S.copy(l).multiplyScalar(f.y).addScaledVector(u,-p.y).multiplyScalar(Ht),B.copy(u).multiplyScalar(p.x).addScaledVector(l,-f.x).multiplyScalar(Ht),o[ot].add(S),o[gt].add(S),o[bt].add(S),a[ot].add(B),a[gt].add(B),a[bt].add(B))}let N=this.groups;N.length===0&&(N=[{start:0,count:t.count}]);for(let ot=0,gt=N.length;ot<gt;++ot){const bt=N[ot],Ht=bt.start,ne=bt.count;for(let ce=Ht,be=Ht+ne;ce<be;ce+=3)z(t.getX(ce+0),t.getX(ce+1),t.getX(ce+2))}const L=new F,W=new F,et=new F,rt=new F;function ct(ot){et.fromBufferAttribute(i,ot),rt.copy(et);const gt=o[ot];L.copy(gt),L.sub(et.multiplyScalar(et.dot(gt))).normalize(),W.crossVectors(rt,gt);const Ht=W.dot(a[ot])<0?-1:1;r.setXYZW(ot,L.x,L.y,L.z,Ht)}for(let ot=0,gt=N.length;ot<gt;++ot){const bt=N[ot],Ht=bt.start,ne=bt.count;for(let ce=Ht,be=Ht+ne;ce<be;ce+=3)ct(t.getX(ce+0)),ct(t.getX(ce+1)),ct(t.getX(ce+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new _e(new Float32Array(e.count*3),3),this.setAttribute("normal",s);else for(let d=0,p=s.count;d<p;d++)s.setXYZ(d,0,0,0);const i=new F,n=new F,r=new F,o=new F,a=new F,h=new F,l=new F,u=new F;if(t)for(let d=0,p=t.count;d<p;d+=3){const f=t.getX(d+0),S=t.getX(d+1),B=t.getX(d+2);i.fromBufferAttribute(e,f),n.fromBufferAttribute(e,S),r.fromBufferAttribute(e,B),l.subVectors(r,n),u.subVectors(i,n),l.cross(u),o.fromBufferAttribute(s,f),a.fromBufferAttribute(s,S),h.fromBufferAttribute(s,B),o.add(l),a.add(l),h.add(l),s.setXYZ(f,o.x,o.y,o.z),s.setXYZ(S,a.x,a.y,a.z),s.setXYZ(B,h.x,h.y,h.z)}else for(let d=0,p=e.count;d<p;d+=3)i.fromBufferAttribute(e,d+0),n.fromBufferAttribute(e,d+1),r.fromBufferAttribute(e,d+2),l.subVectors(r,n),u.subVectors(i,n),l.cross(u),s.setXYZ(d+0,l.x,l.y,l.z),s.setXYZ(d+1,l.x,l.y,l.z),s.setXYZ(d+2,l.x,l.y,l.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)Ze.fromBufferAttribute(t,e),Ze.normalize(),t.setXYZ(e,Ze.x,Ze.y,Ze.z)}toNonIndexed(){function t(o,a){const h=o.array,l=o.itemSize,u=o.normalized,d=new h.constructor(a.length*l);let p=0,f=0;for(let S=0,B=a.length;S<B;S++){o.isInterleavedBufferAttribute?p=a[S]*o.data.stride+o.offset:p=a[S]*l;for(let z=0;z<l;z++)d[f++]=h[p++]}return new _e(d,l,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new oe,s=this.index.array,i=this.attributes;for(const o in i){const a=i[o],h=t(a,s);e.setAttribute(o,h)}const n=this.morphAttributes;for(const o in n){const a=[],h=n[o];for(let l=0,u=h.length;l<u;l++){const d=h[l],p=t(d,s);a.push(p)}e.morphAttributes[o]=a}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let o=0,a=r.length;o<a;o++){const h=r[o];e.addGroup(h.start,h.count,h.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const a=this.parameters;for(const h in a)a[h]!==void 0&&(t[h]=a[h]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const a in s){const h=s[a];t.data.attributes[a]=h.toJSON(t.data)}const i={};let n=!1;for(const a in this.morphAttributes){const h=this.morphAttributes[a],l=[];for(let u=0,d=h.length;u<d;u++){const p=h[u];l.push(p.toJSON(t.data))}l.length>0&&(i[a]=l,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere=o.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;s!==null&&this.setIndex(s.clone());const i=t.attributes;for(const h in i){const l=i[h];this.setAttribute(h,l.clone(e))}const n=t.morphAttributes;for(const h in n){const l=[],u=n[h];for(let d=0,p=u.length;d<p;d++)l.push(u[d].clone(e));this.morphAttributes[h]=l}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let h=0,l=r.length;h<l;h++){const u=r[h];this.addGroup(u.start,u.count,u.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const a=t.boundingSphere;return a!==null&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Dc=new se,sn=new On,oo=new je,Vc=new F,ao=new F,ho=new F,co=new F,$a=new F,lo=new F,Uc=new F,uo=new F;class Vs extends ue{constructor(t=new oe,e=new en){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(t,e){const s=this.geometry,i=s.attributes.position,n=s.morphAttributes.position,r=s.morphTargetsRelative;e.fromBufferAttribute(i,t);const o=this.morphTargetInfluences;if(n&&o){lo.set(0,0,0);for(let a=0,h=n.length;a<h;a++){const l=o[a],u=n[a];l!==0&&($a.fromBufferAttribute(u,t),r?lo.addScaledVector($a,l):lo.addScaledVector($a.sub(e),l))}e.add(lo)}return e}raycast(t,e){const s=this.geometry,i=this.material,n=this.matrixWorld;i!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),oo.copy(s.boundingSphere),oo.applyMatrix4(n),sn.copy(t.ray).recast(t.near),!(oo.containsPoint(sn.origin)===!1&&(sn.intersectSphere(oo,Vc)===null||sn.origin.distanceToSquared(Vc)>(t.far-t.near)**2))&&(Dc.copy(n).invert(),sn.copy(t.ray).applyMatrix4(Dc),!(s.boundingBox!==null&&sn.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(t,e,sn)))}_computeIntersections(t,e,s){let i;const n=this.geometry,r=this.material,o=n.index,a=n.attributes.position,h=n.attributes.uv,l=n.attributes.uv1,u=n.attributes.normal,d=n.groups,p=n.drawRange;if(o!==null)if(Array.isArray(r))for(let f=0,S=d.length;f<S;f++){const B=d[f],z=r[B.materialIndex],N=Math.max(B.start,p.start),L=Math.min(o.count,Math.min(B.start+B.count,p.start+p.count));for(let W=N,et=L;W<et;W+=3){const rt=o.getX(W),ct=o.getX(W+1),ot=o.getX(W+2);i=po(this,z,t,s,h,l,u,rt,ct,ot),i&&(i.faceIndex=Math.floor(W/3),i.face.materialIndex=B.materialIndex,e.push(i))}}else{const f=Math.max(0,p.start),S=Math.min(o.count,p.start+p.count);for(let B=f,z=S;B<z;B+=3){const N=o.getX(B),L=o.getX(B+1),W=o.getX(B+2);i=po(this,r,t,s,h,l,u,N,L,W),i&&(i.faceIndex=Math.floor(B/3),e.push(i))}}else if(a!==void 0)if(Array.isArray(r))for(let f=0,S=d.length;f<S;f++){const B=d[f],z=r[B.materialIndex],N=Math.max(B.start,p.start),L=Math.min(a.count,Math.min(B.start+B.count,p.start+p.count));for(let W=N,et=L;W<et;W+=3){const rt=W,ct=W+1,ot=W+2;i=po(this,z,t,s,h,l,u,rt,ct,ot),i&&(i.faceIndex=Math.floor(W/3),i.face.materialIndex=B.materialIndex,e.push(i))}}else{const f=Math.max(0,p.start),S=Math.min(a.count,p.start+p.count);for(let B=f,z=S;B<z;B+=3){const N=B,L=B+1,W=B+2;i=po(this,r,t,s,h,l,u,N,L,W),i&&(i.faceIndex=Math.floor(B/3),e.push(i))}}}}function Rd(c,t,e,s,i,n,r,o){let a;if(t.side===g?a=s.intersectTriangle(r,n,i,!0,o):a=s.intersectTriangle(i,n,r,t.side===y,o),a===null)return null;uo.copy(o),uo.applyMatrix4(c.matrixWorld);const h=e.ray.origin.distanceTo(uo);return h<e.near||h>e.far?null:{distance:h,point:uo.clone(),object:c}}function po(c,t,e,s,i,n,r,o,a,h){c.getVertexPosition(o,ao),c.getVertexPosition(a,ho),c.getVertexPosition(h,co);const l=Rd(c,t,e,s,ao,ho,co,Uc);if(l){const u=new F;_s.getBarycoord(Uc,ao,ho,co,u),i&&(l.uv=_s.getInterpolatedAttribute(i,o,a,h,u,new xt)),n&&(l.uv1=_s.getInterpolatedAttribute(n,o,a,h,u,new xt)),r&&(l.normal=_s.getInterpolatedAttribute(r,o,a,h,u,new F),l.normal.dot(s.direction)>0&&l.normal.multiplyScalar(-1));const d={a:o,b:a,c:h,normal:new F,materialIndex:0};_s.getNormal(ao,ho,co,d.normal),l.face=d,l.barycoord=u}return l}class fr extends oe{constructor(t=1,e=1,s=1,i=1,n=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:s,widthSegments:i,heightSegments:n,depthSegments:r};const o=this;i=Math.floor(i),n=Math.floor(n),r=Math.floor(r);const a=[],h=[],l=[],u=[];let d=0,p=0;f("z","y","x",-1,-1,s,e,t,r,n,0),f("z","y","x",1,-1,s,e,-t,r,n,1),f("x","z","y",1,1,t,s,e,i,r,2),f("x","z","y",1,-1,t,s,-e,i,r,3),f("x","y","z",1,-1,t,e,s,i,n,4),f("x","y","z",-1,-1,t,e,-s,i,n,5),this.setIndex(a),this.setAttribute("position",new Ot(h,3)),this.setAttribute("normal",new Ot(l,3)),this.setAttribute("uv",new Ot(u,2));function f(S,B,z,N,L,W,et,rt,ct,ot,gt){const bt=W/ct,Ht=et/ot,ne=W/2,ce=et/2,be=rt/2,ge=ct+1,Ge=ot+1;let $e=0,ti=0;const Be=new F;for(let Ve=0;Ve<Ge;Ve++){const ze=Ve*Ht-ce;for(let ei=0;ei<ge;ei++){const Ws=ei*bt-ne;Be[S]=Ws*N,Be[B]=ze*L,Be[z]=be,h.push(Be.x,Be.y,Be.z),Be[S]=0,Be[B]=0,Be[z]=rt>0?1:-1,l.push(Be.x,Be.y,Be.z),u.push(ei/ct),u.push(1-Ve/ot),$e+=1}}for(let Ve=0;Ve<ot;Ve++)for(let ze=0;ze<ct;ze++){const ei=d+ze+ge*Ve,Ws=d+ze+ge*(Ve+1),er=d+(ze+1)+ge*(Ve+1),Vr=d+(ze+1)+ge*Ve;a.push(ei,Ws,Vr),a.push(Ws,er,Vr),ti+=6}o.addGroup(p,ti,gt),p+=ti,d+=$e}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new fr(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function mr(c){const t={};for(const e in c){t[e]={};for(const s in c[e]){const i=c[e][s];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][s]=null):t[e][s]=i.clone():Array.isArray(i)?t[e][s]=i.slice():t[e][s]=i}}return t}function Wc(c){const t={};for(let e=0;e<c.length;e++){const s=mr(c[e]);for(const i in s)t[i]=s[i]}return t}function Pd(c){const t=[];for(let e=0;e<c.length;e++)t.push(c[e].clone());return t}function Bd(c){const t=c.getRenderTarget();return t===null?c.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:ws.workingColorSpace}const zd={clone:mr,merge:Wc};var kd=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Od=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class fo extends as{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=kd,this.fragmentShader=Od,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=mr(t.uniforms),this.uniformsGroups=Pd(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const r=this.uniforms[i].value;r&&r.isTexture?e.uniforms[i]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[i]={type:"m4",value:r.toArray()}:e.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const s={};for(const i in this.extensions)this.extensions[i]===!0&&(s[i]=!0);return Object.keys(s).length>0&&(e.extensions=s),e}}class mo extends ue{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new se,this.projectionMatrix=new se,this.projectionMatrixInverse=new se,this.coordinateSystem=Es,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Wi=new F,Hc=new xt,Gc=new xt;class zs extends mo{constructor(t=50,e=1,s=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=s,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=In*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Ki*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return In*2*Math.atan(Math.tan(Ki*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,s){Wi.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Wi.x,Wi.y).multiplyScalar(-t/Wi.z),Wi.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(Wi.x,Wi.y).multiplyScalar(-t/Wi.z)}getViewSize(t,e){return this.getViewBounds(t,Hc,Gc),e.subVectors(Gc,Hc)}setViewOffset(t,e,s,i,n,r){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=n,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(Ki*.5*this.fov)/this.zoom,s=2*e,i=this.aspect*s,n=-.5*i;const r=this.view;if(this.view!==null&&this.view.enabled){const a=r.fullWidth,h=r.fullHeight;n+=r.offsetX*i/a,e-=r.offsetY*s/h,i*=r.width/a,s*=r.height/h}const o=this.filmOffset;o!==0&&(n+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,e,e-s,t,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Wn=-90,Hn=1;class Jc extends ue{constructor(t,e,s){super(),this.type="CubeCamera",this.renderTarget=s,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new zs(Wn,Hn,t,e);i.layers=this.layers,this.add(i);const n=new zs(Wn,Hn,t,e);n.layers=this.layers,this.add(n);const r=new zs(Wn,Hn,t,e);r.layers=this.layers,this.add(r);const o=new zs(Wn,Hn,t,e);o.layers=this.layers,this.add(o);const a=new zs(Wn,Hn,t,e);a.layers=this.layers,this.add(a);const h=new zs(Wn,Hn,t,e);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[s,i,n,r,o,a]=e;for(const h of e)this.remove(h);if(t===Es)s.up.set(0,1,0),s.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),r.up.set(0,0,1),r.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else if(t===Oi)s.up.set(0,-1,0),s.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),r.up.set(0,0,-1),r.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const h of e)this.add(h),h.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:s,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[n,r,o,a,h,l]=this.children,u=t.getRenderTarget(),d=t.getActiveCubeFace(),p=t.getActiveMipmapLevel(),f=t.xr.enabled;t.xr.enabled=!1;const S=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,t.setRenderTarget(s,0,i),t.render(e,n),t.setRenderTarget(s,1,i),t.render(e,r),t.setRenderTarget(s,2,i),t.render(e,o),t.setRenderTarget(s,3,i),t.render(e,a),t.setRenderTarget(s,4,i),t.render(e,h),s.texture.generateMipmaps=S,t.setRenderTarget(s,5,i),t.render(e,l),t.setRenderTarget(u,d,p),t.xr.enabled=f,s.texture.needsPMREMUpdate=!0}}class yo extends Ne{constructor(t=[],e=St,s,i,n,r,o,a,h,l){super(t,e,s,i,n,r,o,a,h,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Ld extends jr{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const s={width:t,height:t,depth:1},i=[s,s,s,s,s,s];this.texture=new yo(i),this._setTextureOptions(e),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new fr(5,5,5),n=new fo({name:"CubemapFromEquirect",uniforms:mr(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:g,blending:P});n.uniforms.tEquirect.value=e;const r=new Vs(i,n),o=e.minFilter;return e.minFilter===ve&&(e.minFilter=xe),new Jc(1,10,this).update(t,r),e.minFilter=o,r.geometry.dispose(),r.material.dispose(),this}clear(t,e=!0,s=!0,i=!0){const n=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,s,i);t.setRenderTarget(n)}}class Gn extends ue{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Fd={type:"move"};class Nd{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Gn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Gn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new F,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new F),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Gn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new F,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new F),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const s of t.hand.values())this._getHandJoint(e,s)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,s){let i=null,n=null,r=null;const o=this._targetRay,a=this._grip,h=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(h&&t.hand){r=!0;for(const S of t.hand.values()){const B=e.getJointPose(S,s),z=this._getHandJoint(h,S);B!==null&&(z.matrix.fromArray(B.transform.matrix),z.matrix.decompose(z.position,z.rotation,z.scale),z.matrixWorldNeedsUpdate=!0,z.jointRadius=B.radius),z.visible=B!==null}const l=h.joints["index-finger-tip"],u=h.joints["thumb-tip"],d=l.position.distanceTo(u.position),p=.02,f=.005;h.inputState.pinching&&d>p+f?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&d<=p-f&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else a!==null&&t.gripSpace&&(n=e.getPose(t.gripSpace,s),n!==null&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1));o!==null&&(i=e.getPose(t.targetRaySpace,s),i===null&&n!==null&&(i=n),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Fd)))}return o!==null&&(o.visible=i!==null),a!==null&&(a.visible=n!==null),h!==null&&(h.visible=r!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const s=new Gn;s.matrixAutoUpdate=!1,s.visible=!1,t.joints[e.jointName]=s,t.add(s)}return t.joints[e.jointName]}}class go{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new te(t),this.density=e}clone(){return new go(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class xo{constructor(t,e=1,s=1e3){this.isFog=!0,this.name="",this.color=new te(t),this.near=e,this.far=s}clone(){return new xo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Xc extends ue{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new js,this.environmentIntensity=1,this.environmentRotation=new js,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class vo{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=$i,this.updateRanges=[],this.version=0,this.uuid=Rs()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,s){t*=this.stride,s*=e.stride;for(let i=0,n=this.stride;i<n;i++)this.array[t+i]=e.array[s+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rs()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(e,this.stride);return s.setUsage(this.usage),s}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rs()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ys=new F;class nn{constructor(t,e,s,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=s,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,s=this.data.count;e<s;e++)ys.fromBufferAttribute(this,e),ys.applyMatrix4(t),this.setXYZ(e,ys.x,ys.y,ys.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)ys.fromBufferAttribute(this,e),ys.applyNormalMatrix(t),this.setXYZ(e,ys.x,ys.y,ys.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)ys.fromBufferAttribute(this,e),ys.transformDirection(t),this.setXYZ(e,ys.x,ys.y,ys.z);return this}getComponent(t,e){let s=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(s=ms(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=ie(s,this.array)),this.data.array[t*this.data.stride+this.offset+e]=s,this}setX(t,e){return this.normalized&&(e=ie(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=ie(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=ie(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=ie(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=ms(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=ms(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=ms(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=ms(e,this.array)),e}setXY(t,e,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=ie(e,this.array),s=ie(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this}setXYZ(t,e,s,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=ie(e,this.array),s=ie(s,this.array),i=ie(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=ie(e,this.array),s=ie(s,this.array),i=ie(i,this.array),n=ie(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this.data.array[t+3]=n,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[i+n])}return new _e(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new nn(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[i+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ka extends as{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new te(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let Jn;const yr=new F,Xn=new F,qn=new F,Zn=new xt,gr=new xt,qc=new se,bo=new F,xr=new F,Mo=new F,Zc=new xt,Qa=new xt,Yc=new xt;class jc extends ue{constructor(t=new Ka){if(super(),this.isSprite=!0,this.type="Sprite",Jn===void 0){Jn=new oe;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),s=new vo(e,5);Jn.setIndex([0,1,2,0,2,3]),Jn.setAttribute("position",new nn(s,3,0,!1)),Jn.setAttribute("uv",new nn(s,2,3,!1))}this.geometry=Jn,this.material=t,this.center=new xt(.5,.5),this.count=1}raycast(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Xn.setFromMatrixScale(this.matrixWorld),qc.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),qn.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Xn.multiplyScalar(-qn.z);const s=this.material.rotation;let i,n;s!==0&&(n=Math.cos(s),i=Math.sin(s));const r=this.center;wo(bo.set(-.5,-.5,0),qn,r,Xn,i,n),wo(xr.set(.5,-.5,0),qn,r,Xn,i,n),wo(Mo.set(.5,.5,0),qn,r,Xn,i,n),Zc.set(0,0),Qa.set(1,0),Yc.set(1,1);let o=t.ray.intersectTriangle(bo,xr,Mo,!1,yr);if(o===null&&(wo(xr.set(-.5,.5,0),qn,r,Xn,i,n),Qa.set(0,1),o=t.ray.intersectTriangle(bo,Mo,xr,!1,yr),o===null))return;const a=t.ray.origin.distanceTo(yr);a<t.near||a>t.far||e.push({distance:a,point:yr.clone(),uv:_s.getInterpolation(yr,bo,xr,Mo,Zc,Qa,Yc,new xt),face:null,object:this})}copy(t,e){return super.copy(t,e),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function wo(c,t,e,s,i,n){Zn.subVectors(c,e).addScalar(.5).multiply(s),i!==void 0?(gr.x=n*Zn.x-i*Zn.y,gr.y=i*Zn.x+n*Zn.y):gr.copy(Zn),c.copy(t),c.x+=gr.x,c.y+=gr.y,c.applyMatrix4(qc)}const _o=new F,$c=new F;class Kc extends ue{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let s=0,i=e.length;s<i;s++){const n=e[s];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,s=0){e=Math.abs(e);const i=this.levels;let n;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,hysteresis:s,object:t}),this.add(t),this}removeLevel(t){const e=this.levels;for(let s=0;s<e.length;s++)if(e[s].distance===t){const i=e.splice(s,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let s,i;for(s=1,i=e.length;s<i;s++){let n=e[s].distance;if(e[s].object.visible&&(n-=n*e[s].hysteresis),t<n)break}return e[s-1].object}return null}raycast(t,e){if(this.levels.length>0){_o.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(_o);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){_o.setFromMatrixPosition(t.matrixWorld),$c.setFromMatrixPosition(this.matrixWorld);const s=_o.distanceTo($c)/t.zoom;e[0].object.visible=!0;let i,n;for(i=1,n=e.length;i<n;i++){let r=e[i].distance;if(e[i].object.visible&&(r-=r*e[i].hysteresis),s>=r)e[i-1].object.visible=!1,e[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<n;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];const s=this.levels;for(let i=0,n=s.length;i<n;i++){const r=s[i];e.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return e}}const Qc=new F,tl=new He,el=new He,Dd=new F,sl=new se,So=new F,th=new je,il=new se,eh=new On;class nl extends Vs{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=wt,this.bindMatrix=new se,this.bindMatrixInverse=new se,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new rs),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let s=0;s<e.count;s++)this.getVertexPosition(s,So),this.boundingBox.expandByPoint(So)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new je),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let s=0;s<e.count;s++)this.getVertexPosition(s,So),this.boundingSphere.expandByPoint(So)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const s=this.material,i=this.matrixWorld;s!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),th.copy(this.boundingSphere),th.applyMatrix4(i),t.ray.intersectsSphere(th)!==!1&&(il.copy(i).invert(),eh.copy(t.ray).applyMatrix4(il),!(this.boundingBox!==null&&eh.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,e,eh)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new He,e=this.geometry.attributes.skinWeight;for(let s=0,i=e.count;s<i;s++){t.fromBufferAttribute(e,s);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(s,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===wt?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Nt?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const s=this.skeleton,i=this.geometry;tl.fromBufferAttribute(i.attributes.skinIndex,t),el.fromBufferAttribute(i.attributes.skinWeight,t),Qc.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let n=0;n<4;n++){const r=el.getComponent(n);if(r!==0){const o=tl.getComponent(n);sl.multiplyMatrices(s.bones[o].matrixWorld,s.boneInverses[o]),e.addScaledVector(Dd.copy(Qc).applyMatrix4(sl),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}class sh extends ue{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ni extends Ne{constructor(t=null,e=1,s=1,i,n,r,o,a,h=Yt,l=Yt,u,d){super(null,r,o,a,h,l,i,n,u,d),this.isDataTexture=!0,this.image={data:t,width:e,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const rl=new se,Vd=new se;class To{constructor(t=[],e=[]){this.uuid=Rs(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let s=0,i=this.bones.length;s<i;s++)this.boneInverses.push(new se)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const s=new se;this.bones[t]&&s.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(s)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const s=this.bones[t];s&&s.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const s=this.bones[t];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(){const t=this.bones,e=this.boneInverses,s=this.boneMatrices,i=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const o=t[n]?t[n].matrixWorld:Vd;rl.multiplyMatrices(o,e[n]),rl.toArray(s,n*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new To(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const s=new ni(e,t,t,K,v);return s.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=s,this}getBoneByName(t){for(let e=0,s=this.bones.length;e<s;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let s=0,i=t.bones.length;s<i;s++){const n=t.bones[s];let r=e[n];r===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new sh),this.bones.push(r),this.boneInverses.push(new se().fromArray(t.boneInverses[s]))}return this.init(),this}toJSON(){const t={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,s=this.boneInverses;for(let i=0,n=e.length;i<n;i++){const r=e[i];t.bones.push(r.uuid);const o=s[i];t.boneInverses.push(o.toArray())}return t}}class Yn extends _e{constructor(t,e,s,i=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const jn=new se,ol=new se,Ao=[],al=new rs,Ud=new se,vr=new Vs,br=new je;class hl extends Vs{constructor(t,e,s){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Yn(new Float32Array(s*16),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<s;i++)this.setMatrixAt(i,Ud)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new rs),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,jn),al.copy(t.boundingBox).applyMatrix4(jn),this.boundingBox.union(al)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new je),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,jn),br.copy(t.boundingSphere).applyMatrix4(jn),this.boundingSphere.union(br)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const s=e.morphTargetInfluences,i=this.morphTexture.source.data.data,n=s.length+1,r=t*n+1;for(let o=0;o<s.length;o++)s[o]=i[r+o]}raycast(t,e){const s=this.matrixWorld,i=this.count;if(vr.geometry=this.geometry,vr.material=this.material,vr.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),br.copy(this.boundingSphere),br.applyMatrix4(s),t.ray.intersectsSphere(br)!==!1))for(let n=0;n<i;n++){this.getMatrixAt(n,jn),ol.multiplyMatrices(s,jn),vr.matrixWorld=ol,vr.raycast(t,Ao);for(let r=0,o=Ao.length;r<o;r++){const a=Ao[r];a.instanceId=n,a.object=this,e.push(a)}Ao.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new Yn(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const s=e.morphTargetInfluences,i=s.length+1;this.morphTexture===null&&(this.morphTexture=new ni(new Float32Array(i*this.count),i,this.count,Mt,v));const n=this.morphTexture.source.data.data;let r=0;for(let h=0;h<s.length;h++)r+=s[h];const o=this.geometry.morphTargetsRelative?1:1-r,a=i*t;n[a]=o,n.set(s,a+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const ih=new F,Wd=new F,Hd=new qs;class rn{constructor(t=new F(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=ih.subVectors(s,e).cross(Wd.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(ih),i=this.normal.dot(s);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:e.copy(t.start).addScaledVector(s,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||Hd.getNormalMatrix(t),i=this.coplanarPoint(ih).applyMatrix4(t),n=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const on=new je,Gd=new xt(.5,.5),Co=new F;class Io{constructor(t=new rn,e=new rn,s=new rn,i=new rn,n=new rn,r=new rn){this.planes=[t,e,s,i,n,r]}set(t,e,s,i,n,r){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(s),o[3].copy(i),o[4].copy(n),o[5].copy(r),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t,e=Es,s=!1){const i=this.planes,n=t.elements,r=n[0],o=n[1],a=n[2],h=n[3],l=n[4],u=n[5],d=n[6],p=n[7],f=n[8],S=n[9],B=n[10],z=n[11],N=n[12],L=n[13],W=n[14],et=n[15];if(i[0].setComponents(h-r,p-l,z-f,et-N).normalize(),i[1].setComponents(h+r,p+l,z+f,et+N).normalize(),i[2].setComponents(h+o,p+u,z+S,et+L).normalize(),i[3].setComponents(h-o,p-u,z-S,et-L).normalize(),s)i[4].setComponents(a,d,B,W).normalize(),i[5].setComponents(h-a,p-d,z-B,et-W).normalize();else if(i[4].setComponents(h-a,p-d,z-B,et-W).normalize(),e===Es)i[5].setComponents(h+a,p+d,z+B,et+W).normalize();else if(e===Oi)i[5].setComponents(a,d,B,W).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),on.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),on.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(on)}intersectsSprite(t){on.center.set(0,0,0);const e=Gd.distanceTo(t.center);return on.radius=.7071067811865476+e,on.applyMatrix4(t.matrixWorld),this.intersectsSphere(on)}intersectsSphere(t){const e=this.planes,s=t.center,i=-t.radius;for(let n=0;n<6;n++)if(e[n].distanceToPoint(s)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const i=e[s];if(Co.x=i.normal.x>0?t.max.x:t.min.x,Co.y=i.normal.y>0?t.max.y:t.min.y,Co.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Co)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const ri=new se,oi=new Io;class Eo{constructor(){this.coordinateSystem=Es}intersectsObject(t,e){if(!e.isArrayCamera||e.cameras.length===0)return!1;for(let s=0;s<e.cameras.length;s++){const i=e.cameras[s];if(ri.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oi.setFromProjectionMatrix(ri,i.coordinateSystem,i.reversedDepth),oi.intersectsObject(t))return!0}return!1}intersectsSprite(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let s=0;s<e.cameras.length;s++){const i=e.cameras[s];if(ri.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oi.setFromProjectionMatrix(ri,i.coordinateSystem,i.reversedDepth),oi.intersectsSprite(t))return!0}return!1}intersectsSphere(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let s=0;s<e.cameras.length;s++){const i=e.cameras[s];if(ri.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oi.setFromProjectionMatrix(ri,i.coordinateSystem,i.reversedDepth),oi.intersectsSphere(t))return!0}return!1}intersectsBox(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let s=0;s<e.cameras.length;s++){const i=e.cameras[s];if(ri.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oi.setFromProjectionMatrix(ri,i.coordinateSystem,i.reversedDepth),oi.intersectsBox(t))return!0}return!1}containsPoint(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let s=0;s<e.cameras.length;s++){const i=e.cameras[s];if(ri.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oi.setFromProjectionMatrix(ri,i.coordinateSystem,i.reversedDepth),oi.containsPoint(t))return!0}return!1}clone(){return new Eo}}function nh(c,t){return c-t}function Jd(c,t){return c.z-t.z}function Xd(c,t){return t.z-c.z}class qd{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,s,i){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1,index:-1});const o=n[this.index];r.push(o),this.index++,o.start=t,o.count=e,o.z=s,o.index=i}reset(){this.list.length=0,this.index=0}}const Ts=new se,Zd=new te(1,1,1),cl=new Io,Yd=new Eo,Ro=new rs,an=new je,Mr=new F,ll=new F,jd=new F,rh=new qd,hs=new Vs,Po=[];function $d(c,t,e=0){const s=t.itemSize;if(c.isInterleavedBufferAttribute||c.array.constructor!==t.array.constructor){const i=c.count;for(let n=0;n<i;n++)for(let r=0;r<s;r++)t.setComponent(n+e,r,c.getComponent(n,r))}else t.array.set(c.array,e*s);t.needsUpdate=!0}function hn(c,t){if(c.constructor!==t.constructor){const e=Math.min(c.length,t.length);for(let s=0;s<e;s++)t[s]=c[s]}else{const e=Math.min(c.length,t.length);t.set(new c.constructor(c.buffer,0,e))}}class ul extends Vs{constructor(t,e,s=e*2,i){super(new oe,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=s,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(this._maxInstanceCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4),s=new ni(e,t,t,K,v);this._matricesTexture=s}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Uint32Array(t*t),s=new ni(e,t,t,_t,w);this._indirectTexture=s}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),s=new ni(e,t,t,K,v);s.colorSpace=ws.workingColorSpace,this._colorsTexture=s}_initializeGeometry(t){const e=this.geometry,s=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const n in t.attributes){const r=t.getAttribute(n),{array:o,itemSize:a,normalized:h}=r,l=new o.constructor(s*a),u=new _e(l,a,h);e.setAttribute(n,u)}if(t.getIndex()!==null){const n=s>65535?new Uint32Array(i):new Uint16Array(i);e.setIndex(new _e(n,1))}this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(!!t.getIndex()!=!!e.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const s in e.attributes){if(!t.hasAttribute(s))throw new Error(`THREE.BatchedMesh: Added geometry missing "${s}". All geometries must have consistent attributes.`);const i=t.getAttribute(s),n=e.getAttribute(s);if(i.itemSize!==n.itemSize||i.normalized!==n.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const e=this._instanceInfo;if(t<0||t>=e.length||e[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${t}. Instance is either out of range or has been deleted.`)}validateGeometryId(t){const e=this._geometryInfo;if(t<0||t>=e.length||e[t].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${t}. Geometry is either out of range or has been deleted.`)}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new rs);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let s=0,i=e.length;s<i;s++){if(e[s].active===!1)continue;const n=e[s].geometryIndex;this.getMatrixAt(s,Ts),this.getBoundingBoxAt(n,Ro).applyMatrix4(Ts),t.union(Ro)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new je);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let s=0,i=e.length;s<i;s++){if(e[s].active===!1)continue;const n=e[s].geometryIndex;this.getMatrixAt(s,Ts),this.getBoundingSphereAt(n,an).applyMatrix4(Ts),t.union(an)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const s={visible:!0,active:!0,geometryIndex:t};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(nh),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=s):(i=this._instanceInfo.length,this._instanceInfo.push(s));const n=this._matricesTexture;Ts.identity().toArray(n.image.data,i*16),n.needsUpdate=!0;const r=this._colorsTexture;return r&&(Zd.toArray(r.image.data,i*4),r.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(t,e=-1,s=-1){this._initializeGeometry(t),this._validateGeometry(t);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},n=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=e===-1?t.getAttribute("position").count:e;const r=t.getIndex();if(r!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=s===-1?r.count:s),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let a;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(nh),a=this._availableGeometryIds.shift(),n[a]=i):(a=this._geometryCount,this._geometryCount++,n.push(i)),this.setGeometryAt(a,t),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,a}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const s=this.geometry,i=s.getIndex()!==null,n=s.getIndex(),r=e.getIndex(),o=this._geometryInfo[t];if(i&&r.count>o.reservedIndexCount||e.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const a=o.vertexStart,h=o.reservedVertexCount;o.vertexCount=e.getAttribute("position").count;for(const l in s.attributes){const u=e.getAttribute(l),d=s.getAttribute(l);$d(u,d,a);const p=u.itemSize;for(let f=u.count,S=h;f<S;f++){const B=a+f;for(let z=0;z<p;z++)d.setComponent(B,z,0)}d.needsUpdate=!0,d.addUpdateRange(a*p,h*p)}if(i){const l=o.indexStart,u=o.reservedIndexCount;o.indexCount=e.getIndex().count;for(let d=0;d<r.count;d++)n.setX(l+d,a+r.getX(d));for(let d=r.count,p=u;d<p;d++)n.setX(l+d,a);n.needsUpdate=!0,n.addUpdateRange(l,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,e.boundingBox!==null&&(o.boundingBox=e.boundingBox.clone()),o.boundingSphere=null,e.boundingSphere!==null&&(o.boundingSphere=e.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._geometryInfo;if(t>=e.length||e[t].active===!1)return this;const s=this._instanceInfo;for(let i=0,n=s.length;i<n;i++)s[i].active&&s[i].geometryIndex===t&&this.deleteInstance(i);return e[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,e=0;const s=this._geometryInfo,i=s.map((r,o)=>o).sort((r,o)=>s[r].vertexStart-s[o].vertexStart),n=this.geometry;for(let r=0,o=s.length;r<o;r++){const a=i[r],h=s[a];if(h.active!==!1){if(n.index!==null){if(h.indexStart!==e){const{indexStart:l,vertexStart:u,reservedIndexCount:d}=h,p=n.index,f=p.array,S=t-u;for(let B=l;B<l+d;B++)f[B]=f[B]+S;p.array.copyWithin(e,l,l+d),p.addUpdateRange(e,d),h.indexStart=e}e+=h.reservedIndexCount}if(h.vertexStart!==t){const{vertexStart:l,reservedVertexCount:u}=h,d=n.attributes;for(const p in d){const f=d[p],{array:S,itemSize:B}=f;S.copyWithin(t*B,l*B,(l+u)*B),f.addUpdateRange(t*B,u*B)}h.vertexStart=t}t+=h.reservedVertexCount,h.start=n.index?h.indexStart:h.vertexStart,this._nextIndexStart=n.index?h.indexStart+h.reservedIndexCount:0,this._nextVertexStart=h.vertexStart+h.reservedVertexCount}}return this}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const s=this.geometry,i=this._geometryInfo[t];if(i.boundingBox===null){const n=new rs,r=s.index,o=s.attributes.position;for(let a=i.start,h=i.start+i.count;a<h;a++){let l=a;r&&(l=r.getX(l)),n.expandByPoint(Mr.fromBufferAttribute(o,l))}i.boundingBox=n}return e.copy(i.boundingBox),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const s=this.geometry,i=this._geometryInfo[t];if(i.boundingSphere===null){const n=new je;this.getBoundingBoxAt(t,Ro),Ro.getCenter(n.center);const r=s.index,o=s.attributes.position;let a=0;for(let h=i.start,l=i.start+i.count;h<l;h++){let u=h;r&&(u=r.getX(u)),Mr.fromBufferAttribute(o,u),a=Math.max(a,n.center.distanceToSquared(Mr))}n.radius=Math.sqrt(a),i.boundingSphere=n}return e.copy(i.boundingSphere),e}setMatrixAt(t,e){this.validateInstanceId(t);const s=this._matricesTexture,i=this._matricesTexture.image.data;return e.toArray(i,t*16),s.needsUpdate=!0,this}getMatrixAt(t,e){return this.validateInstanceId(t),e.fromArray(this._matricesTexture.image.data,t*16)}setColorAt(t,e){return this.validateInstanceId(t),this._colorsTexture===null&&this._initColorsTexture(),e.toArray(this._colorsTexture.image.data,t*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,e){return this.validateInstanceId(t),e.fromArray(this._colorsTexture.image.data,t*4)}setVisibleAt(t,e){return this.validateInstanceId(t),this._instanceInfo[t].visible===e?this:(this._instanceInfo[t].visible=e,this._visibilityChanged=!0,this)}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,e){return this.validateInstanceId(t),this.validateGeometryId(e),this._instanceInfo[t].geometryIndex=e,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t,e={}){this.validateGeometryId(t);const s=this._geometryInfo[t];return e.vertexStart=s.vertexStart,e.vertexCount=s.vertexCount,e.reservedVertexCount=s.reservedVertexCount,e.indexStart=s.indexStart,e.indexCount=s.indexCount,e.reservedIndexCount=s.reservedIndexCount,e.start=s.start,e.count=s.count,e}setInstanceCount(t){const e=this._availableInstanceIds,s=this._instanceInfo;for(e.sort(nh);e[e.length-1]===s.length-1;)s.pop(),e.pop();if(t<s.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const i=new Int32Array(t),n=new Int32Array(t);hn(this._multiDrawCounts,i),hn(this._multiDrawStarts,n),this._multiDrawCounts=i,this._multiDrawStarts=n,this._maxInstanceCount=t;const r=this._indirectTexture,o=this._matricesTexture,a=this._colorsTexture;r.dispose(),this._initIndirectTexture(),hn(r.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),hn(o.image.data,this._matricesTexture.image.data),a&&(a.dispose(),this._initColorsTexture(),hn(a.image.data,this._colorsTexture.image.data))}setGeometrySize(t,e){const s=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...s.map(o=>o.vertexStart+o.reservedVertexCount))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${e}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...s.map(a=>a.indexStart+a.reservedIndexCount))>e)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${e}. Cannot shrink further.`);const n=this.geometry;n.dispose(),this._maxVertexCount=t,this._maxIndexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new oe,this._initializeGeometry(n));const r=this.geometry;n.index&&hn(n.index.array,r.index.array);for(const o in n.attributes)hn(n.attributes[o].array,r.attributes[o].array)}raycast(t,e){const s=this._instanceInfo,i=this._geometryInfo,n=this.matrixWorld,r=this.geometry;hs.material=this.material,hs.geometry.index=r.index,hs.geometry.attributes=r.attributes,hs.geometry.boundingBox===null&&(hs.geometry.boundingBox=new rs),hs.geometry.boundingSphere===null&&(hs.geometry.boundingSphere=new je);for(let o=0,a=s.length;o<a;o++){if(!s[o].visible||!s[o].active)continue;const h=s[o].geometryIndex,l=i[h];hs.geometry.setDrawRange(l.start,l.count),this.getMatrixAt(o,hs.matrixWorld).premultiply(n),this.getBoundingBoxAt(h,hs.geometry.boundingBox),this.getBoundingSphereAt(h,hs.geometry.boundingSphere),hs.raycast(t,Po);for(let u=0,d=Po.length;u<d;u++){const p=Po[u];p.object=this,p.batchId=o,e.push(p)}Po.length=0}hs.material=null,hs.geometry.index=null,hs.geometry.attributes={},hs.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map(e=>({...e,boundingBox:e.boundingBox!==null?e.boundingBox.clone():null,boundingSphere:e.boundingSphere!==null?e.boundingSphere.clone():null})),this._instanceInfo=t._instanceInfo.map(e=>({...e})),this._availableInstanceIds=t._availableInstanceIds.slice(),this._availableGeometryIds=t._availableGeometryIds.slice(),this._nextIndexStart=t._nextIndexStart,this._nextVertexStart=t._nextVertexStart,this._geometryCount=t._geometryCount,this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._indirectTexture=t._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,e,s,i,n){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const r=i.getIndex(),o=r===null?1:r.array.BYTES_PER_ELEMENT,a=this._instanceInfo,h=this._multiDrawStarts,l=this._multiDrawCounts,u=this._geometryInfo,d=this.perObjectFrustumCulled,p=this._indirectTexture,f=p.image.data,S=s.isArrayCamera?Yd:cl;d&&!s.isArrayCamera&&(Ts.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse).multiply(this.matrixWorld),cl.setFromProjectionMatrix(Ts,s.coordinateSystem,s.reversedDepth));let B=0;if(this.sortObjects){Ts.copy(this.matrixWorld).invert(),Mr.setFromMatrixPosition(s.matrixWorld).applyMatrix4(Ts),ll.set(0,0,-1).transformDirection(s.matrixWorld).transformDirection(Ts);for(let L=0,W=a.length;L<W;L++)if(a[L].visible&&a[L].active){const et=a[L].geometryIndex;this.getMatrixAt(L,Ts),this.getBoundingSphereAt(et,an).applyMatrix4(Ts);let rt=!1;if(d&&(rt=!S.intersectsSphere(an,s)),!rt){const ct=u[et],ot=jd.subVectors(an.center,Mr).dot(ll);rh.push(ct.start,ct.count,ot,L)}}const z=rh.list,N=this.customSort;N===null?z.sort(n.transparent?Xd:Jd):N.call(this,z,s);for(let L=0,W=z.length;L<W;L++){const et=z[L];h[B]=et.start*o,l[B]=et.count,f[B]=et.index,B++}rh.reset()}else for(let z=0,N=a.length;z<N;z++)if(a[z].visible&&a[z].active){const L=a[z].geometryIndex;let W=!1;if(d&&(this.getMatrixAt(z,Ts),this.getBoundingSphereAt(L,an).applyMatrix4(Ts),W=!S.intersectsSphere(an,s)),!W){const et=u[L];h[B]=et.start*o,l[B]=et.count,f[B]=z,B++}}p.needsUpdate=!0,this._multiDrawCount=B,this._visibilityChanged=!1}onBeforeShadow(t,e,s,i,n,r){this.onBeforeRender(t,null,i,n,r)}}class gs extends as{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new te(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Bo=new F,zo=new F,dl=new se,wr=new On,ko=new je,oh=new F,pl=new F;class Hi extends ue{constructor(t=new oe,e=new gs){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[0];for(let i=1,n=e.count;i<n;i++)Bo.fromBufferAttribute(e,i-1),zo.fromBufferAttribute(e,i),s[i]=s[i-1],s[i]+=Bo.distanceTo(zo);t.setAttribute("lineDistance",new Ot(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const s=this.geometry,i=this.matrixWorld,n=t.params.Line.threshold,r=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),ko.copy(s.boundingSphere),ko.applyMatrix4(i),ko.radius+=n,t.ray.intersectsSphere(ko)===!1)return;dl.copy(i).invert(),wr.copy(t.ray).applyMatrix4(dl);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,h=this.isLineSegments?2:1,l=s.index,d=s.attributes.position;if(l!==null){const p=Math.max(0,r.start),f=Math.min(l.count,r.start+r.count);for(let S=p,B=f-1;S<B;S+=h){const z=l.getX(S),N=l.getX(S+1),L=Oo(this,t,wr,a,z,N,S);L&&e.push(L)}if(this.isLineLoop){const S=l.getX(f-1),B=l.getX(p),z=Oo(this,t,wr,a,S,B,f-1);z&&e.push(z)}}else{const p=Math.max(0,r.start),f=Math.min(d.count,r.start+r.count);for(let S=p,B=f-1;S<B;S+=h){const z=Oo(this,t,wr,a,S,S+1,S);z&&e.push(z)}if(this.isLineLoop){const S=Oo(this,t,wr,a,f-1,p,f-1);S&&e.push(S)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}}function Oo(c,t,e,s,i,n,r){const o=c.geometry.attributes.position;if(Bo.fromBufferAttribute(o,i),zo.fromBufferAttribute(o,n),e.distanceSqToSegment(Bo,zo,oh,pl)>s)return;oh.applyMatrix4(c.matrixWorld);const h=t.ray.origin.distanceTo(oh);if(!(h<t.near||h>t.far))return{distance:h,point:pl.clone().applyMatrix4(c.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:c}}const fl=new F,ml=new F;class ai extends Hi{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[];for(let i=0,n=e.count;i<n;i+=2)fl.fromBufferAttribute(e,i),ml.fromBufferAttribute(e,i+1),s[i]=i===0?0:s[i-1],s[i+1]=s[i]+fl.distanceTo(ml);t.setAttribute("lineDistance",new Ot(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class yl extends Hi{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class ah extends as{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new te(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const gl=new se,hh=new On,Lo=new je,Fo=new F;class xl extends ue{constructor(t=new oe,e=new ah){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const s=this.geometry,i=this.matrixWorld,n=t.params.Points.threshold,r=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),Lo.copy(s.boundingSphere),Lo.applyMatrix4(i),Lo.radius+=n,t.ray.intersectsSphere(Lo)===!1)return;gl.copy(i).invert(),hh.copy(t.ray).applyMatrix4(gl);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,h=s.index,u=s.attributes.position;if(h!==null){const d=Math.max(0,r.start),p=Math.min(h.count,r.start+r.count);for(let f=d,S=p;f<S;f++){const B=h.getX(f);Fo.fromBufferAttribute(u,B),vl(Fo,B,a,i,t,e,this)}}else{const d=Math.max(0,r.start),p=Math.min(u.count,r.start+r.count);for(let f=d,S=p;f<S;f++)Fo.fromBufferAttribute(u,f),vl(Fo,f,a,i,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){const o=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}}function vl(c,t,e,s,i,n,r){const o=hh.distanceSqToPoint(c);if(o<e){const a=new F;hh.closestPointToPoint(c,a),a.applyMatrix4(s);const h=i.ray.origin.distanceTo(a);if(h<i.near||h>i.far)return;n.push({distance:h,distanceToRay:Math.sqrt(o),point:a,index:t,face:null,faceIndex:null,barycoord:null,object:r})}}class bl extends Ne{constructor(t,e,s,i,n=xe,r=xe,o,a,h){super(t,e,s,i,n,r,o,a,h),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const l=this;function u(){l.needsUpdate=!0,l._requestVideoFrameCallbackId=t.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in t&&(this._requestVideoFrameCallbackId=t.requestVideoFrameCallback(u))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class Kd extends bl{constructor(t,e,s,i,n,r,o,a){super({},t,e,s,i,n,r,o,a),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class Qd extends Ne{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=Yt,this.minFilter=Yt,this.generateMipmaps=!1,this.needsUpdate=!0}}class No extends Ne{constructor(t,e,s,i,n,r,o,a,h,l,u,d){super(null,r,o,a,h,l,i,n,u,d),this.isCompressedTexture=!0,this.image={width:e,height:s},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class tp extends No{constructor(t,e,s,i,n,r){super(t,e,s,n,r),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Dt,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class ep extends No{constructor(t,e,s){super(void 0,t[0].width,t[0].height,e,s,St),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class sp extends Ne{constructor(t,e,s,i,n,r,o,a,h){super(t,e,s,i,n,r,o,a,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ip extends Ne{constructor(t,e,s=w,i,n,r,o=Yt,a=Yt,h,l=nt,u=1){if(l!==nt&&l!==vt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const d={width:t,height:e,depth:u};super(d,i,n,r,o,a,l,s,h),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Li(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}class Do extends oe{constructor(t=1,e=1,s=4,i=8,n=1){super(),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:s,radialSegments:i,heightSegments:n},e=Math.max(0,e),s=Math.max(1,Math.floor(s)),i=Math.max(3,Math.floor(i)),n=Math.max(1,Math.floor(n));const r=[],o=[],a=[],h=[],l=e/2,u=Math.PI/2*t,d=e,p=2*u+d,f=s*2+n,S=i+1,B=new F,z=new F;for(let N=0;N<=f;N++){let L=0,W=0,et=0,rt=0;if(N<=s){const gt=N/s,bt=gt*Math.PI/2;W=-l-t*Math.cos(bt),et=t*Math.sin(bt),rt=-t*Math.cos(bt),L=gt*u}else if(N<=s+n){const gt=(N-s)/n;W=-l+gt*e,et=t,rt=0,L=u+gt*d}else{const gt=(N-s-n)/s,bt=gt*Math.PI/2;W=l+t*Math.sin(bt),et=t*Math.cos(bt),rt=t*Math.sin(bt),L=u+d+gt*u}const ct=Math.max(0,Math.min(1,L/p));let ot=0;N===0?ot=.5/i:N===f&&(ot=-.5/i);for(let gt=0;gt<=i;gt++){const bt=gt/i,Ht=bt*Math.PI*2,ne=Math.sin(Ht),ce=Math.cos(Ht);z.x=-et*ce,z.y=W,z.z=et*ne,o.push(z.x,z.y,z.z),B.set(-et*ce,rt,et*ne),B.normalize(),a.push(B.x,B.y,B.z),h.push(bt+ot,ct)}if(N>0){const gt=(N-1)*S;for(let bt=0;bt<i;bt++){const Ht=gt+bt,ne=gt+bt+1,ce=N*S+bt,be=N*S+bt+1;r.push(Ht,ne,ce),r.push(ne,be,ce)}}}this.setIndex(r),this.setAttribute("position",new Ot(o,3)),this.setAttribute("normal",new Ot(a,3)),this.setAttribute("uv",new Ot(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Do(t.radius,t.height,t.capSegments,t.radialSegments,t.heightSegments)}}class Vo extends oe{constructor(t=1,e=32,s=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:s,thetaLength:i},e=Math.max(3,e);const n=[],r=[],o=[],a=[],h=new F,l=new xt;r.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let u=0,d=3;u<=e;u++,d+=3){const p=s+u/e*i;h.x=t*Math.cos(p),h.y=t*Math.sin(p),r.push(h.x,h.y,h.z),o.push(0,0,1),l.x=(r[d]/t+1)/2,l.y=(r[d+1]/t+1)/2,a.push(l.x,l.y)}for(let u=1;u<=e;u++)n.push(u,u+1,0);this.setIndex(n),this.setAttribute("position",new Ot(r,3)),this.setAttribute("normal",new Ot(o,3)),this.setAttribute("uv",new Ot(a,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Vo(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class _r extends oe{constructor(t=1,e=1,s=1,i=32,n=1,r=!1,o=0,a=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:s,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a};const h=this;i=Math.floor(i),n=Math.floor(n);const l=[],u=[],d=[],p=[];let f=0;const S=[],B=s/2;let z=0;N(),r===!1&&(t>0&&L(!0),e>0&&L(!1)),this.setIndex(l),this.setAttribute("position",new Ot(u,3)),this.setAttribute("normal",new Ot(d,3)),this.setAttribute("uv",new Ot(p,2));function N(){const W=new F,et=new F;let rt=0;const ct=(e-t)/s;for(let ot=0;ot<=n;ot++){const gt=[],bt=ot/n,Ht=bt*(e-t)+t;for(let ne=0;ne<=i;ne++){const ce=ne/i,be=ce*a+o,ge=Math.sin(be),Ge=Math.cos(be);et.x=Ht*ge,et.y=-bt*s+B,et.z=Ht*Ge,u.push(et.x,et.y,et.z),W.set(ge,ct,Ge).normalize(),d.push(W.x,W.y,W.z),p.push(ce,1-bt),gt.push(f++)}S.push(gt)}for(let ot=0;ot<i;ot++)for(let gt=0;gt<n;gt++){const bt=S[gt][ot],Ht=S[gt+1][ot],ne=S[gt+1][ot+1],ce=S[gt][ot+1];(t>0||gt!==0)&&(l.push(bt,Ht,ce),rt+=3),(e>0||gt!==n-1)&&(l.push(Ht,ne,ce),rt+=3)}h.addGroup(z,rt,0),z+=rt}function L(W){const et=f,rt=new xt,ct=new F;let ot=0;const gt=W===!0?t:e,bt=W===!0?1:-1;for(let ne=1;ne<=i;ne++)u.push(0,B*bt,0),d.push(0,bt,0),p.push(.5,.5),f++;const Ht=f;for(let ne=0;ne<=i;ne++){const be=ne/i*a+o,ge=Math.cos(be),Ge=Math.sin(be);ct.x=gt*Ge,ct.y=B*bt,ct.z=gt*ge,u.push(ct.x,ct.y,ct.z),d.push(0,bt,0),rt.x=ge*.5+.5,rt.y=Ge*.5*bt+.5,p.push(rt.x,rt.y),f++}for(let ne=0;ne<i;ne++){const ce=et+ne,be=Ht+ne;W===!0?l.push(be,be+1,ce):l.push(be+1,be,ce),ot+=3}h.addGroup(z,ot,W===!0?1:2),z+=ot}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new _r(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Sr extends _r{constructor(t=1,e=1,s=32,i=1,n=!1,r=0,o=Math.PI*2){super(0,t,e,s,i,n,r,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:s,heightSegments:i,openEnded:n,thetaStart:r,thetaLength:o}}static fromJSON(t){return new Sr(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Gi extends oe{constructor(t=[],e=[],s=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:s,detail:i};const n=[],r=[];o(i),h(s),l(),this.setAttribute("position",new Ot(n,3)),this.setAttribute("normal",new Ot(n.slice(),3)),this.setAttribute("uv",new Ot(r,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(N){const L=new F,W=new F,et=new F;for(let rt=0;rt<e.length;rt+=3)p(e[rt+0],L),p(e[rt+1],W),p(e[rt+2],et),a(L,W,et,N)}function a(N,L,W,et){const rt=et+1,ct=[];for(let ot=0;ot<=rt;ot++){ct[ot]=[];const gt=N.clone().lerp(W,ot/rt),bt=L.clone().lerp(W,ot/rt),Ht=rt-ot;for(let ne=0;ne<=Ht;ne++)ne===0&&ot===rt?ct[ot][ne]=gt:ct[ot][ne]=gt.clone().lerp(bt,ne/Ht)}for(let ot=0;ot<rt;ot++)for(let gt=0;gt<2*(rt-ot)-1;gt++){const bt=Math.floor(gt/2);gt%2===0?(d(ct[ot][bt+1]),d(ct[ot+1][bt]),d(ct[ot][bt])):(d(ct[ot][bt+1]),d(ct[ot+1][bt+1]),d(ct[ot+1][bt]))}}function h(N){const L=new F;for(let W=0;W<n.length;W+=3)L.x=n[W+0],L.y=n[W+1],L.z=n[W+2],L.normalize().multiplyScalar(N),n[W+0]=L.x,n[W+1]=L.y,n[W+2]=L.z}function l(){const N=new F;for(let L=0;L<n.length;L+=3){N.x=n[L+0],N.y=n[L+1],N.z=n[L+2];const W=B(N)/2/Math.PI+.5,et=z(N)/Math.PI+.5;r.push(W,1-et)}f(),u()}function u(){for(let N=0;N<r.length;N+=6){const L=r[N+0],W=r[N+2],et=r[N+4],rt=Math.max(L,W,et),ct=Math.min(L,W,et);rt>.9&&ct<.1&&(L<.2&&(r[N+0]+=1),W<.2&&(r[N+2]+=1),et<.2&&(r[N+4]+=1))}}function d(N){n.push(N.x,N.y,N.z)}function p(N,L){const W=N*3;L.x=t[W+0],L.y=t[W+1],L.z=t[W+2]}function f(){const N=new F,L=new F,W=new F,et=new F,rt=new xt,ct=new xt,ot=new xt;for(let gt=0,bt=0;gt<n.length;gt+=9,bt+=6){N.set(n[gt+0],n[gt+1],n[gt+2]),L.set(n[gt+3],n[gt+4],n[gt+5]),W.set(n[gt+6],n[gt+7],n[gt+8]),rt.set(r[bt+0],r[bt+1]),ct.set(r[bt+2],r[bt+3]),ot.set(r[bt+4],r[bt+5]),et.copy(N).add(L).add(W).divideScalar(3);const Ht=B(et);S(rt,bt+0,N,Ht),S(ct,bt+2,L,Ht),S(ot,bt+4,W,Ht)}}function S(N,L,W,et){et<0&&N.x===1&&(r[L]=N.x-1),W.x===0&&W.z===0&&(r[L]=et/2/Math.PI+.5)}function B(N){return Math.atan2(N.z,-N.x)}function z(N){return Math.atan2(-N.y,Math.sqrt(N.x*N.x+N.z*N.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Gi(t.vertices,t.indices,t.radius,t.details)}}class Uo extends Gi{constructor(t=1,e=0){const s=(1+Math.sqrt(5))/2,i=1/s,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-s,0,-i,s,0,i,-s,0,i,s,-i,-s,0,-i,s,0,i,-s,0,i,s,0,-s,0,-i,s,0,-i,-s,0,i,s,0,i],r=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,r,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Uo(t.radius,t.detail)}}const Wo=new F,Ho=new F,ch=new F,Go=new _s;class Ml extends oe{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},t!==null){const i=Math.pow(10,4),n=Math.cos(Ki*e),r=t.getIndex(),o=t.getAttribute("position"),a=r?r.count:o.count,h=[0,0,0],l=["a","b","c"],u=new Array(3),d={},p=[];for(let f=0;f<a;f+=3){r?(h[0]=r.getX(f),h[1]=r.getX(f+1),h[2]=r.getX(f+2)):(h[0]=f,h[1]=f+1,h[2]=f+2);const{a:S,b:B,c:z}=Go;if(S.fromBufferAttribute(o,h[0]),B.fromBufferAttribute(o,h[1]),z.fromBufferAttribute(o,h[2]),Go.getNormal(ch),u[0]=`${Math.round(S.x*i)},${Math.round(S.y*i)},${Math.round(S.z*i)}`,u[1]=`${Math.round(B.x*i)},${Math.round(B.y*i)},${Math.round(B.z*i)}`,u[2]=`${Math.round(z.x*i)},${Math.round(z.y*i)},${Math.round(z.z*i)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let N=0;N<3;N++){const L=(N+1)%3,W=u[N],et=u[L],rt=Go[l[N]],ct=Go[l[L]],ot=`${W}_${et}`,gt=`${et}_${W}`;gt in d&&d[gt]?(ch.dot(d[gt].normal)<=n&&(p.push(rt.x,rt.y,rt.z),p.push(ct.x,ct.y,ct.z)),d[gt]=null):ot in d||(d[ot]={index0:h[N],index1:h[L],normal:ch.clone()})}}for(const f in d)if(d[f]){const{index0:S,index1:B}=d[f];Wo.fromBufferAttribute(o,S),Ho.fromBufferAttribute(o,B),p.push(Wo.x,Wo.y,Wo.z),p.push(Ho.x,Ho.y,Ho.z)}this.setAttribute("position",new Ot(p,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Ks{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,e){const s=this.getUtoTmapping(t);return this.getPoint(s,e)}getPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return e}getSpacedPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPointAt(s/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let s,i=this.getPoint(0),n=0;e.push(0);for(let r=1;r<=t;r++)s=this.getPoint(r/t),n+=s.distanceTo(i),e.push(n),i=s;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e=null){const s=this.getLengths();let i=0;const n=s.length;let r;e?r=e:r=t*s[n-1];let o=0,a=n-1,h;for(;o<=a;)if(i=Math.floor(o+(a-o)/2),h=s[i]-r,h<0)o=i+1;else if(h>0)a=i-1;else{a=i;break}if(i=a,s[i]===r)return i/(n-1);const l=s[i],d=s[i+1]-l,p=(r-l)/d;return(i+p)/(n-1)}getTangent(t,e){let i=t-1e-4,n=t+1e-4;i<0&&(i=0),n>1&&(n=1);const r=this.getPoint(i),o=this.getPoint(n),a=e||(r.isVector2?new xt:new F);return a.copy(o).sub(r).normalize(),a}getTangentAt(t,e){const s=this.getUtoTmapping(t);return this.getTangent(s,e)}computeFrenetFrames(t,e=!1){const s=new F,i=[],n=[],r=[],o=new F,a=new se;for(let p=0;p<=t;p++){const f=p/t;i[p]=this.getTangentAt(f,new F)}n[0]=new F,r[0]=new F;let h=Number.MAX_VALUE;const l=Math.abs(i[0].x),u=Math.abs(i[0].y),d=Math.abs(i[0].z);l<=h&&(h=l,s.set(1,0,0)),u<=h&&(h=u,s.set(0,1,0)),d<=h&&s.set(0,0,1),o.crossVectors(i[0],s).normalize(),n[0].crossVectors(i[0],o),r[0].crossVectors(i[0],n[0]);for(let p=1;p<=t;p++){if(n[p]=n[p-1].clone(),r[p]=r[p-1].clone(),o.crossVectors(i[p-1],i[p]),o.length()>Number.EPSILON){o.normalize();const f=Math.acos(jt(i[p-1].dot(i[p]),-1,1));n[p].applyMatrix4(a.makeRotationAxis(o,f))}r[p].crossVectors(i[p],n[p])}if(e===!0){let p=Math.acos(jt(n[0].dot(n[t]),-1,1));p/=t,i[0].dot(o.crossVectors(n[0],n[t]))>0&&(p=-p);for(let f=1;f<=t;f++)n[f].applyMatrix4(a.makeRotationAxis(i[f],p*f)),r[f].crossVectors(i[f],n[f])}return{tangents:i,normals:n,binormals:r}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Jo extends Ks{constructor(t=0,e=0,s=1,i=1,n=0,r=Math.PI*2,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=s,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=r,this.aClockwise=o,this.aRotation=a}getPoint(t,e=new xt){const s=e,i=Math.PI*2;let n=this.aEndAngle-this.aStartAngle;const r=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(r?n=0:n=i),this.aClockwise===!0&&!r&&(n===i?n=-i:n=n-i);const o=this.aStartAngle+t*n;let a=this.aX+this.xRadius*Math.cos(o),h=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const l=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=a-this.aX,p=h-this.aY;a=d*l-p*u+this.aX,h=d*u+p*l+this.aY}return s.set(a,h)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class wl extends Jo{constructor(t,e,s,i,n,r){super(t,e,s,s,i,n,r),this.isArcCurve=!0,this.type="ArcCurve"}}function lh(){let c=0,t=0,e=0,s=0;function i(n,r,o,a){c=n,t=o,e=-3*n+3*r-2*o-a,s=2*n-2*r+o+a}return{initCatmullRom:function(n,r,o,a,h){i(r,o,h*(o-n),h*(a-r))},initNonuniformCatmullRom:function(n,r,o,a,h,l,u){let d=(r-n)/h-(o-n)/(h+l)+(o-r)/l,p=(o-r)/l-(a-r)/(l+u)+(a-o)/u;d*=l,p*=l,i(r,o,d,p)},calc:function(n){const r=n*n,o=r*n;return c+t*n+e*r+s*o}}}const Xo=new F,uh=new lh,dh=new lh,ph=new lh;class _l extends Ks{constructor(t=[],e=!1,s="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=s,this.tension=i}getPoint(t,e=new F){const s=e,i=this.points,n=i.length,r=(n-(this.closed?0:1))*t;let o=Math.floor(r),a=r-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/n)+1)*n:a===0&&o===n-1&&(o=n-2,a=1);let h,l;this.closed||o>0?h=i[(o-1)%n]:(Xo.subVectors(i[0],i[1]).add(i[0]),h=Xo);const u=i[o%n],d=i[(o+1)%n];if(this.closed||o+2<n?l=i[(o+2)%n]:(Xo.subVectors(i[n-1],i[n-2]).add(i[n-1]),l=Xo),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let f=Math.pow(h.distanceToSquared(u),p),S=Math.pow(u.distanceToSquared(d),p),B=Math.pow(d.distanceToSquared(l),p);S<1e-4&&(S=1),f<1e-4&&(f=S),B<1e-4&&(B=S),uh.initNonuniformCatmullRom(h.x,u.x,d.x,l.x,f,S,B),dh.initNonuniformCatmullRom(h.y,u.y,d.y,l.y,f,S,B),ph.initNonuniformCatmullRom(h.z,u.z,d.z,l.z,f,S,B)}else this.curveType==="catmullrom"&&(uh.initCatmullRom(h.x,u.x,d.x,l.x,this.tension),dh.initCatmullRom(h.y,u.y,d.y,l.y,this.tension),ph.initCatmullRom(h.z,u.z,d.z,l.z,this.tension));return s.set(uh.calc(a),dh.calc(a),ph.calc(a)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(new F().fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Sl(c,t,e,s,i){const n=(s-t)*.5,r=(i-e)*.5,o=c*c,a=c*o;return(2*e-2*s+n+r)*a+(-3*e+3*s-2*n-r)*o+n*c+e}function np(c,t){const e=1-c;return e*e*t}function rp(c,t){return 2*(1-c)*c*t}function op(c,t){return c*c*t}function Tr(c,t,e,s){return np(c,t)+rp(c,e)+op(c,s)}function ap(c,t){const e=1-c;return e*e*e*t}function hp(c,t){const e=1-c;return 3*e*e*c*t}function cp(c,t){return 3*(1-c)*c*c*t}function lp(c,t){return c*c*c*t}function Ar(c,t,e,s,i){return ap(c,t)+hp(c,e)+cp(c,s)+lp(c,i)}class fh extends Ks{constructor(t=new xt,e=new xt,s=new xt,i=new xt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=s,this.v3=i}getPoint(t,e=new xt){const s=e,i=this.v0,n=this.v1,r=this.v2,o=this.v3;return s.set(Ar(t,i.x,n.x,r.x,o.x),Ar(t,i.y,n.y,r.y,o.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Tl extends Ks{constructor(t=new F,e=new F,s=new F,i=new F){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=s,this.v3=i}getPoint(t,e=new F){const s=e,i=this.v0,n=this.v1,r=this.v2,o=this.v3;return s.set(Ar(t,i.x,n.x,r.x,o.x),Ar(t,i.y,n.y,r.y,o.y),Ar(t,i.z,n.z,r.z,o.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class mh extends Ks{constructor(t=new xt,e=new xt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new xt){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new xt){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Al extends Ks{constructor(t=new F,e=new F){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new F){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new F){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class yh extends Ks{constructor(t=new xt,e=new xt,s=new xt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new xt){const s=e,i=this.v0,n=this.v1,r=this.v2;return s.set(Tr(t,i.x,n.x,r.x),Tr(t,i.y,n.y,r.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class gh extends Ks{constructor(t=new F,e=new F,s=new F){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new F){const s=e,i=this.v0,n=this.v1,r=this.v2;return s.set(Tr(t,i.x,n.x,r.x),Tr(t,i.y,n.y,r.y),Tr(t,i.z,n.z,r.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class xh extends Ks{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new xt){const s=e,i=this.points,n=(i.length-1)*t,r=Math.floor(n),o=n-r,a=i[r===0?r:r-1],h=i[r],l=i[r>i.length-2?i.length-1:r+1],u=i[r>i.length-3?i.length-1:r+2];return s.set(Sl(o,a.x,h.x,l.x,u.x),Sl(o,a.y,h.y,l.y,u.y)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(new xt().fromArray(i))}return this}}var qo=Object.freeze({__proto__:null,ArcCurve:wl,CatmullRomCurve3:_l,CubicBezierCurve:fh,CubicBezierCurve3:Tl,EllipseCurve:Jo,LineCurve:mh,LineCurve3:Al,QuadraticBezierCurve:yh,QuadraticBezierCurve3:gh,SplineCurve:xh});class Cl extends Ks{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const s=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new qo[s](e,t))}return this}getPoint(t,e){const s=t*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=s){const r=i[n]-s,o=this.curves[n],a=o.getLength(),h=a===0?0:1-r/a;return o.getPointAt(h,e)}n++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let s=0,i=this.curves.length;s<i;s++)e+=this.curves[s].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let s;for(let i=0,n=this.curves;i<n.length;i++){const r=n[i],o=r.isEllipseCurve?t*2:r.isLineCurve||r.isLineCurve3?1:r.isSplineCurve?t*r.points.length:t,a=r.getPoints(o);for(let h=0;h<a.length;h++){const l=a[h];s&&s.equals(l)||(e.push(l),s=l)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,s=this.curves.length;e<s;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const i=t.curves[e];this.curves.push(new qo[i.type]().fromJSON(i))}return this}}class Zo extends Cl{constructor(t){super(),this.type="Path",this.currentPoint=new xt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,s=t.length;e<s;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const s=new mh(this.currentPoint.clone(),new xt(t,e));return this.curves.push(s),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,s,i){const n=new yh(this.currentPoint.clone(),new xt(t,e),new xt(s,i));return this.curves.push(n),this.currentPoint.set(s,i),this}bezierCurveTo(t,e,s,i,n,r){const o=new fh(this.currentPoint.clone(),new xt(t,e),new xt(s,i),new xt(n,r));return this.curves.push(o),this.currentPoint.set(n,r),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),s=new xh(e);return this.curves.push(s),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,s,i,n,r){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,s,i,n,r),this}absarc(t,e,s,i,n,r){return this.absellipse(t,e,s,s,i,n,r),this}ellipse(t,e,s,i,n,r,o,a){const h=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+h,e+l,s,i,n,r,o,a),this}absellipse(t,e,s,i,n,r,o,a){const h=new Jo(t,e,s,i,n,r,o,a);if(this.curves.length>0){const u=h.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(h);const l=h.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class cn extends Zo{constructor(t){super(t),this.uuid=Rs(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let s=0,i=this.holes.length;s<i;s++)e[s]=this.holes[s].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,s=this.holes.length;e<s;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const i=t.holes[e];this.holes.push(new Zo().fromJSON(i))}return this}}function up(c,t,e=2){const s=t&&t.length,i=s?t[0]*e:c.length;let n=Il(c,0,i,e,!0);const r=[];if(!n||n.next===n.prev)return r;let o,a,h;if(s&&(n=yp(c,t,n,e)),c.length>80*e){o=1/0,a=1/0;let l=-1/0,u=-1/0;for(let d=e;d<i;d+=e){const p=c[d],f=c[d+1];p<o&&(o=p),f<a&&(a=f),p>l&&(l=p),f>u&&(u=f)}h=Math.max(l-o,u-a),h=h!==0?32767/h:0}return Cr(n,r,e,o,a,h,0),r}function Il(c,t,e,s,i){let n;if(i===Cp(c,t,e,s)>0)for(let r=t;r<e;r+=s)n=Bl(r/s|0,c[r],c[r+1],n);else for(let r=e-s;r>=t;r-=s)n=Bl(r/s|0,c[r],c[r+1],n);return n&&$n(n,n.next)&&(Rr(n),n=n.next),n}function ln(c,t){if(!c)return c;t||(t=c);let e=c,s;do if(s=!1,!e.steiner&&($n(e,e.next)||Ie(e.prev,e,e.next)===0)){if(Rr(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function Cr(c,t,e,s,i,n,r){if(!c)return;!r&&n&&Mp(c,s,i,n);let o=c;for(;c.prev!==c.next;){const a=c.prev,h=c.next;if(n?pp(c,s,i,n):dp(c)){t.push(a.i,c.i,h.i),Rr(c),c=h.next,o=h.next;continue}if(c=h,c===o){r?r===1?(c=fp(ln(c),t),Cr(c,t,e,s,i,n,2)):r===2&&mp(c,t,e,s,i,n):Cr(ln(c),t,e,s,i,n,1);break}}}function dp(c){const t=c.prev,e=c,s=c.next;if(Ie(t,e,s)>=0)return!1;const i=t.x,n=e.x,r=s.x,o=t.y,a=e.y,h=s.y,l=Math.min(i,n,r),u=Math.min(o,a,h),d=Math.max(i,n,r),p=Math.max(o,a,h);let f=s.next;for(;f!==t;){if(f.x>=l&&f.x<=d&&f.y>=u&&f.y<=p&&Ir(i,o,n,a,r,h,f.x,f.y)&&Ie(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function pp(c,t,e,s){const i=c.prev,n=c,r=c.next;if(Ie(i,n,r)>=0)return!1;const o=i.x,a=n.x,h=r.x,l=i.y,u=n.y,d=r.y,p=Math.min(o,a,h),f=Math.min(l,u,d),S=Math.max(o,a,h),B=Math.max(l,u,d),z=vh(p,f,t,e,s),N=vh(S,B,t,e,s);let L=c.prevZ,W=c.nextZ;for(;L&&L.z>=z&&W&&W.z<=N;){if(L.x>=p&&L.x<=S&&L.y>=f&&L.y<=B&&L!==i&&L!==r&&Ir(o,l,a,u,h,d,L.x,L.y)&&Ie(L.prev,L,L.next)>=0||(L=L.prevZ,W.x>=p&&W.x<=S&&W.y>=f&&W.y<=B&&W!==i&&W!==r&&Ir(o,l,a,u,h,d,W.x,W.y)&&Ie(W.prev,W,W.next)>=0))return!1;W=W.nextZ}for(;L&&L.z>=z;){if(L.x>=p&&L.x<=S&&L.y>=f&&L.y<=B&&L!==i&&L!==r&&Ir(o,l,a,u,h,d,L.x,L.y)&&Ie(L.prev,L,L.next)>=0)return!1;L=L.prevZ}for(;W&&W.z<=N;){if(W.x>=p&&W.x<=S&&W.y>=f&&W.y<=B&&W!==i&&W!==r&&Ir(o,l,a,u,h,d,W.x,W.y)&&Ie(W.prev,W,W.next)>=0)return!1;W=W.nextZ}return!0}function fp(c,t){let e=c;do{const s=e.prev,i=e.next.next;!$n(s,i)&&Rl(s,e,e.next,i)&&Er(s,i)&&Er(i,s)&&(t.push(s.i,e.i,i.i),Rr(e),Rr(e.next),e=c=i),e=e.next}while(e!==c);return ln(e)}function mp(c,t,e,s,i,n){let r=c;do{let o=r.next.next;for(;o!==r.prev;){if(r.i!==o.i&&Sp(r,o)){let a=Pl(r,o);r=ln(r,r.next),a=ln(a,a.next),Cr(r,t,e,s,i,n,0),Cr(a,t,e,s,i,n,0);return}o=o.next}r=r.next}while(r!==c)}function yp(c,t,e,s){const i=[];for(let n=0,r=t.length;n<r;n++){const o=t[n]*s,a=n<r-1?t[n+1]*s:c.length,h=Il(c,o,a,s,!1);h===h.next&&(h.steiner=!0),i.push(_p(h))}i.sort(gp);for(let n=0;n<i.length;n++)e=xp(i[n],e);return e}function gp(c,t){let e=c.x-t.x;if(e===0&&(e=c.y-t.y,e===0)){const s=(c.next.y-c.y)/(c.next.x-c.x),i=(t.next.y-t.y)/(t.next.x-t.x);e=s-i}return e}function xp(c,t){const e=vp(c,t);if(!e)return t;const s=Pl(e,c);return ln(s,s.next),ln(e,e.next)}function vp(c,t){let e=t;const s=c.x,i=c.y;let n=-1/0,r;if($n(c,e))return e;do{if($n(c,e.next))return e.next;if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){const u=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=s&&u>n&&(n=u,r=e.x<e.next.x?e:e.next,u===s))return r}e=e.next}while(e!==t);if(!r)return null;const o=r,a=r.x,h=r.y;let l=1/0;e=r;do{if(s>=e.x&&e.x>=a&&s!==e.x&&El(i<h?s:n,i,a,h,i<h?n:s,i,e.x,e.y)){const u=Math.abs(i-e.y)/(s-e.x);Er(e,c)&&(u<l||u===l&&(e.x>r.x||e.x===r.x&&bp(r,e)))&&(r=e,l=u)}e=e.next}while(e!==o);return r}function bp(c,t){return Ie(c.prev,c,t.prev)<0&&Ie(t.next,c,c.next)<0}function Mp(c,t,e,s){let i=c;do i.z===0&&(i.z=vh(i.x,i.y,t,e,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==c);i.prevZ.nextZ=null,i.prevZ=null,wp(i)}function wp(c){let t,e=1;do{let s=c,i;c=null;let n=null;for(t=0;s;){t++;let r=s,o=0;for(let h=0;h<e&&(o++,r=r.nextZ,!!r);h++);let a=e;for(;o>0||a>0&&r;)o!==0&&(a===0||!r||s.z<=r.z)?(i=s,s=s.nextZ,o--):(i=r,r=r.nextZ,a--),n?n.nextZ=i:c=i,i.prevZ=n,n=i;s=r}n.nextZ=null,e*=2}while(t>1);return c}function vh(c,t,e,s,i){return c=(c-e)*i|0,t=(t-s)*i|0,c=(c|c<<8)&16711935,c=(c|c<<4)&252645135,c=(c|c<<2)&858993459,c=(c|c<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,c|t<<1}function _p(c){let t=c,e=c;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==c);return e}function El(c,t,e,s,i,n,r,o){return(i-r)*(t-o)>=(c-r)*(n-o)&&(c-r)*(s-o)>=(e-r)*(t-o)&&(e-r)*(n-o)>=(i-r)*(s-o)}function Ir(c,t,e,s,i,n,r,o){return!(c===r&&t===o)&&El(c,t,e,s,i,n,r,o)}function Sp(c,t){return c.next.i!==t.i&&c.prev.i!==t.i&&!Tp(c,t)&&(Er(c,t)&&Er(t,c)&&Ap(c,t)&&(Ie(c.prev,c,t.prev)||Ie(c,t.prev,t))||$n(c,t)&&Ie(c.prev,c,c.next)>0&&Ie(t.prev,t,t.next)>0)}function Ie(c,t,e){return(t.y-c.y)*(e.x-t.x)-(t.x-c.x)*(e.y-t.y)}function $n(c,t){return c.x===t.x&&c.y===t.y}function Rl(c,t,e,s){const i=jo(Ie(c,t,e)),n=jo(Ie(c,t,s)),r=jo(Ie(e,s,c)),o=jo(Ie(e,s,t));return!!(i!==n&&r!==o||i===0&&Yo(c,e,t)||n===0&&Yo(c,s,t)||r===0&&Yo(e,c,s)||o===0&&Yo(e,t,s))}function Yo(c,t,e){return t.x<=Math.max(c.x,e.x)&&t.x>=Math.min(c.x,e.x)&&t.y<=Math.max(c.y,e.y)&&t.y>=Math.min(c.y,e.y)}function jo(c){return c>0?1:c<0?-1:0}function Tp(c,t){let e=c;do{if(e.i!==c.i&&e.next.i!==c.i&&e.i!==t.i&&e.next.i!==t.i&&Rl(e,e.next,c,t))return!0;e=e.next}while(e!==c);return!1}function Er(c,t){return Ie(c.prev,c,c.next)<0?Ie(c,t,c.next)>=0&&Ie(c,c.prev,t)>=0:Ie(c,t,c.prev)<0||Ie(c,c.next,t)<0}function Ap(c,t){let e=c,s=!1;const i=(c.x+t.x)/2,n=(c.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&i<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==c);return s}function Pl(c,t){const e=bh(c.i,c.x,c.y),s=bh(t.i,t.x,t.y),i=c.next,n=t.prev;return c.next=t,t.prev=c,e.next=i,i.prev=e,s.next=e,e.prev=s,n.next=s,s.prev=n,s}function Bl(c,t,e,s){const i=bh(c,t,e);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function Rr(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function bh(c,t,e){return{i:c,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Cp(c,t,e,s){let i=0;for(let n=t,r=e-s;n<e;n+=s)i+=(c[r]-c[n])*(c[n+1]+c[r+1]),r=n;return i}class Ip{static triangulate(t,e,s=2){return up(t,e,s)}}class Qs{static area(t){const e=t.length;let s=0;for(let i=e-1,n=0;n<e;i=n++)s+=t[i].x*t[n].y-t[n].x*t[i].y;return s*.5}static isClockWise(t){return Qs.area(t)<0}static triangulateShape(t,e){const s=[],i=[],n=[];zl(t),kl(s,t);let r=t.length;e.forEach(zl);for(let a=0;a<e.length;a++)i.push(r),r+=e[a].length,kl(s,e[a]);const o=Ip.triangulate(s,i);for(let a=0;a<o.length;a+=3)n.push(o.slice(a,a+3));return n}}function zl(c){const t=c.length;t>2&&c[t-1].equals(c[0])&&c.pop()}function kl(c,t){for(let e=0;e<t.length;e++)c.push(t[e].x),c.push(t[e].y)}class $o extends oe{constructor(t=new cn([new xt(.5,.5),new xt(-.5,.5),new xt(-.5,-.5),new xt(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const s=this,i=[],n=[];for(let o=0,a=t.length;o<a;o++){const h=t[o];r(h)}this.setAttribute("position",new Ot(i,3)),this.setAttribute("uv",new Ot(n,2)),this.computeVertexNormals();function r(o){const a=[],h=e.curveSegments!==void 0?e.curveSegments:12,l=e.steps!==void 0?e.steps:1,u=e.depth!==void 0?e.depth:1;let d=e.bevelEnabled!==void 0?e.bevelEnabled:!0,p=e.bevelThickness!==void 0?e.bevelThickness:.2,f=e.bevelSize!==void 0?e.bevelSize:p-.1,S=e.bevelOffset!==void 0?e.bevelOffset:0,B=e.bevelSegments!==void 0?e.bevelSegments:3;const z=e.extrudePath,N=e.UVGenerator!==void 0?e.UVGenerator:Ep;let L,W=!1,et,rt,ct,ot;z&&(L=z.getSpacedPoints(l),W=!0,d=!1,et=z.computeFrenetFrames(l,!1),rt=new F,ct=new F,ot=new F),d||(B=0,p=0,f=0,S=0);const gt=o.extractPoints(h);let bt=gt.shape;const Ht=gt.holes;if(!Qs.isClockWise(bt)){bt=bt.reverse();for(let Tt=0,Pt=Ht.length;Tt<Pt;Tt++){const Lt=Ht[Tt];Qs.isClockWise(Lt)&&(Ht[Tt]=Lt.reverse())}}function ce(Tt){const Lt=10000000000000001e-36;let Xt=Tt[0];for(let Gt=1;Gt<=Tt.length;Gt++){const pe=Gt%Tt.length,ae=Tt[pe],Se=ae.x-Xt.x,Ee=ae.y-Xt.y,Je=Se*Se+Ee*Ee,ks=Math.max(Math.abs(ae.x),Math.abs(ae.y),Math.abs(Xt.x),Math.abs(Xt.y)),bn=Lt*ks*ks;if(Je<=bn){Tt.splice(pe,1),Gt--;continue}Xt=ae}}ce(bt),Ht.forEach(ce);const be=Ht.length,ge=bt;for(let Tt=0;Tt<be;Tt++){const Pt=Ht[Tt];bt=bt.concat(Pt)}function Ge(Tt,Pt,Lt){return Pt||console.error("THREE.ExtrudeGeometry: vec does not exist"),Tt.clone().addScaledVector(Pt,Lt)}const $e=bt.length;function ti(Tt,Pt,Lt){let Xt,Gt,pe;const ae=Tt.x-Pt.x,Se=Tt.y-Pt.y,Ee=Lt.x-Tt.x,Je=Lt.y-Tt.y,ks=ae*ae+Se*Se,bn=ae*Je-Se*Ee;if(Math.abs(bn)>Number.EPSILON){const Os=Math.sqrt(ks),Lu=Math.sqrt(Ee*Ee+Je*Je),Fu=Pt.x-Se/Os,Nu=Pt.y+ae/Os,tm=Lt.x-Je/Lu,em=Lt.y+Ee/Lu,Du=((tm-Fu)*Je-(em-Nu)*Ee)/(ae*Je-Se*Ee);Xt=Fu+ae*Du-Tt.x,Gt=Nu+Se*Du-Tt.y;const Vu=Xt*Xt+Gt*Gt;if(Vu<=2)return new xt(Xt,Gt);pe=Math.sqrt(Vu/2)}else{let Os=!1;ae>Number.EPSILON?Ee>Number.EPSILON&&(Os=!0):ae<-Number.EPSILON?Ee<-Number.EPSILON&&(Os=!0):Math.sign(Se)===Math.sign(Je)&&(Os=!0),Os?(Xt=-Se,Gt=ae,pe=Math.sqrt(ks)):(Xt=ae,Gt=Se,pe=Math.sqrt(ks/2))}return new xt(Xt/pe,Gt/pe)}const Be=[];for(let Tt=0,Pt=ge.length,Lt=Pt-1,Xt=Tt+1;Tt<Pt;Tt++,Lt++,Xt++)Lt===Pt&&(Lt=0),Xt===Pt&&(Xt=0),Be[Tt]=ti(ge[Tt],ge[Lt],ge[Xt]);const Ve=[];let ze,ei=Be.concat();for(let Tt=0,Pt=be;Tt<Pt;Tt++){const Lt=Ht[Tt];ze=[];for(let Xt=0,Gt=Lt.length,pe=Gt-1,ae=Xt+1;Xt<Gt;Xt++,pe++,ae++)pe===Gt&&(pe=0),ae===Gt&&(ae=0),ze[Xt]=ti(Lt[Xt],Lt[pe],Lt[ae]);Ve.push(ze),ei=ei.concat(ze)}let Ws;if(B===0)Ws=Qs.triangulateShape(ge,Ht);else{const Tt=[],Pt=[];for(let Lt=0;Lt<B;Lt++){const Xt=Lt/B,Gt=p*Math.cos(Xt*Math.PI/2),pe=f*Math.sin(Xt*Math.PI/2)+S;for(let ae=0,Se=ge.length;ae<Se;ae++){const Ee=Ge(ge[ae],Be[ae],pe);Ai(Ee.x,Ee.y,-Gt),Xt===0&&Tt.push(Ee)}for(let ae=0,Se=be;ae<Se;ae++){const Ee=Ht[ae];ze=Ve[ae];const Je=[];for(let ks=0,bn=Ee.length;ks<bn;ks++){const Os=Ge(Ee[ks],ze[ks],pe);Ai(Os.x,Os.y,-Gt),Xt===0&&Je.push(Os)}Xt===0&&Pt.push(Je)}}Ws=Qs.triangulateShape(Tt,Pt)}const er=Ws.length,Vr=f+S;for(let Tt=0;Tt<$e;Tt++){const Pt=d?Ge(bt[Tt],ei[Tt],Vr):bt[Tt];W?(ct.copy(et.normals[0]).multiplyScalar(Pt.x),rt.copy(et.binormals[0]).multiplyScalar(Pt.y),ot.copy(L[0]).add(ct).add(rt),Ai(ot.x,ot.y,ot.z)):Ai(Pt.x,Pt.y,0)}for(let Tt=1;Tt<=l;Tt++)for(let Pt=0;Pt<$e;Pt++){const Lt=d?Ge(bt[Pt],ei[Pt],Vr):bt[Pt];W?(ct.copy(et.normals[Tt]).multiplyScalar(Lt.x),rt.copy(et.binormals[Tt]).multiplyScalar(Lt.y),ot.copy(L[Tt]).add(ct).add(rt),Ai(ot.x,ot.y,ot.z)):Ai(Lt.x,Lt.y,u/l*Tt)}for(let Tt=B-1;Tt>=0;Tt--){const Pt=Tt/B,Lt=p*Math.cos(Pt*Math.PI/2),Xt=f*Math.sin(Pt*Math.PI/2)+S;for(let Gt=0,pe=ge.length;Gt<pe;Gt++){const ae=Ge(ge[Gt],Be[Gt],Xt);Ai(ae.x,ae.y,u+Lt)}for(let Gt=0,pe=Ht.length;Gt<pe;Gt++){const ae=Ht[Gt];ze=Ve[Gt];for(let Se=0,Ee=ae.length;Se<Ee;Se++){const Je=Ge(ae[Se],ze[Se],Xt);W?Ai(Je.x,Je.y+L[l-1].y,L[l-1].x+Lt):Ai(Je.x,Je.y,u+Lt)}}}$f(),Kf();function $f(){const Tt=i.length/3;if(d){let Pt=0,Lt=$e*Pt;for(let Xt=0;Xt<er;Xt++){const Gt=Ws[Xt];ma(Gt[2]+Lt,Gt[1]+Lt,Gt[0]+Lt)}Pt=l+B*2,Lt=$e*Pt;for(let Xt=0;Xt<er;Xt++){const Gt=Ws[Xt];ma(Gt[0]+Lt,Gt[1]+Lt,Gt[2]+Lt)}}else{for(let Pt=0;Pt<er;Pt++){const Lt=Ws[Pt];ma(Lt[2],Lt[1],Lt[0])}for(let Pt=0;Pt<er;Pt++){const Lt=Ws[Pt];ma(Lt[0]+$e*l,Lt[1]+$e*l,Lt[2]+$e*l)}}s.addGroup(Tt,i.length/3-Tt,0)}function Kf(){const Tt=i.length/3;let Pt=0;Ou(ge,Pt),Pt+=ge.length;for(let Lt=0,Xt=Ht.length;Lt<Xt;Lt++){const Gt=Ht[Lt];Ou(Gt,Pt),Pt+=Gt.length}s.addGroup(Tt,i.length/3-Tt,1)}function Ou(Tt,Pt){let Lt=Tt.length;for(;--Lt>=0;){const Xt=Lt;let Gt=Lt-1;Gt<0&&(Gt=Tt.length-1);for(let pe=0,ae=l+B*2;pe<ae;pe++){const Se=$e*pe,Ee=$e*(pe+1),Je=Pt+Xt+Se,ks=Pt+Gt+Se,bn=Pt+Gt+Ee,Os=Pt+Xt+Ee;Qf(Je,ks,bn,Os)}}}function Ai(Tt,Pt,Lt){a.push(Tt),a.push(Pt),a.push(Lt)}function ma(Tt,Pt,Lt){Ci(Tt),Ci(Pt),Ci(Lt);const Xt=i.length/3,Gt=N.generateTopUV(s,i,Xt-3,Xt-2,Xt-1);Ii(Gt[0]),Ii(Gt[1]),Ii(Gt[2])}function Qf(Tt,Pt,Lt,Xt){Ci(Tt),Ci(Pt),Ci(Xt),Ci(Pt),Ci(Lt),Ci(Xt);const Gt=i.length/3,pe=N.generateSideWallUV(s,i,Gt-6,Gt-3,Gt-2,Gt-1);Ii(pe[0]),Ii(pe[1]),Ii(pe[3]),Ii(pe[1]),Ii(pe[2]),Ii(pe[3])}function Ci(Tt){i.push(a[Tt*3+0]),i.push(a[Tt*3+1]),i.push(a[Tt*3+2])}function Ii(Tt){n.push(Tt.x),n.push(Tt.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,s=this.parameters.options;return Rp(e,s,t)}static fromJSON(t,e){const s=[];for(let n=0,r=t.shapes.length;n<r;n++){const o=e[t.shapes[n]];s.push(o)}const i=t.options.extrudePath;return i!==void 0&&(t.options.extrudePath=new qo[i.type]().fromJSON(i)),new $o(s,t.options)}}const Ep={generateTopUV:function(c,t,e,s,i){const n=t[e*3],r=t[e*3+1],o=t[s*3],a=t[s*3+1],h=t[i*3],l=t[i*3+1];return[new xt(n,r),new xt(o,a),new xt(h,l)]},generateSideWallUV:function(c,t,e,s,i,n){const r=t[e*3],o=t[e*3+1],a=t[e*3+2],h=t[s*3],l=t[s*3+1],u=t[s*3+2],d=t[i*3],p=t[i*3+1],f=t[i*3+2],S=t[n*3],B=t[n*3+1],z=t[n*3+2];return Math.abs(o-l)<Math.abs(r-h)?[new xt(r,1-a),new xt(h,1-u),new xt(d,1-f),new xt(S,1-z)]:[new xt(o,1-a),new xt(l,1-u),new xt(p,1-f),new xt(B,1-z)]}};function Rp(c,t,e){if(e.shapes=[],Array.isArray(c))for(let s=0,i=c.length;s<i;s++){const n=c[s];e.shapes.push(n.uuid)}else e.shapes.push(c.uuid);return e.options=Object.assign({},t),t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class Ko extends Gi{constructor(t=1,e=0){const s=(1+Math.sqrt(5))/2,i=[-1,s,0,1,s,0,-1,-s,0,1,-s,0,0,-1,s,0,1,s,0,-1,-s,0,1,-s,s,0,-1,s,0,1,-s,0,-1,-s,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,n,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Ko(t.radius,t.detail)}}class Qo extends oe{constructor(t=[new xt(0,-.5),new xt(.5,0),new xt(0,.5)],e=12,s=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:s,phiLength:i},e=Math.floor(e),i=jt(i,0,Math.PI*2);const n=[],r=[],o=[],a=[],h=[],l=1/e,u=new F,d=new xt,p=new F,f=new F,S=new F;let B=0,z=0;for(let N=0;N<=t.length-1;N++)switch(N){case 0:B=t[N+1].x-t[N].x,z=t[N+1].y-t[N].y,p.x=z*1,p.y=-B,p.z=z*0,S.copy(p),p.normalize(),a.push(p.x,p.y,p.z);break;case t.length-1:a.push(S.x,S.y,S.z);break;default:B=t[N+1].x-t[N].x,z=t[N+1].y-t[N].y,p.x=z*1,p.y=-B,p.z=z*0,f.copy(p),p.x+=S.x,p.y+=S.y,p.z+=S.z,p.normalize(),a.push(p.x,p.y,p.z),S.copy(f)}for(let N=0;N<=e;N++){const L=s+N*l*i,W=Math.sin(L),et=Math.cos(L);for(let rt=0;rt<=t.length-1;rt++){u.x=t[rt].x*W,u.y=t[rt].y,u.z=t[rt].x*et,r.push(u.x,u.y,u.z),d.x=N/e,d.y=rt/(t.length-1),o.push(d.x,d.y);const ct=a[3*rt+0]*W,ot=a[3*rt+1],gt=a[3*rt+0]*et;h.push(ct,ot,gt)}}for(let N=0;N<e;N++)for(let L=0;L<t.length-1;L++){const W=L+N*t.length,et=W,rt=W+t.length,ct=W+t.length+1,ot=W+1;n.push(et,rt,ot),n.push(ct,ot,rt)}this.setIndex(n),this.setAttribute("position",new Ot(r,3)),this.setAttribute("uv",new Ot(o,2)),this.setAttribute("normal",new Ot(h,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Qo(t.points,t.segments,t.phiStart,t.phiLength)}}class Pr extends Gi{constructor(t=1,e=0){const s=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(s,i,t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Pr(t.radius,t.detail)}}class ta extends oe{constructor(t=1,e=1,s=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:s,heightSegments:i};const n=t/2,r=e/2,o=Math.floor(s),a=Math.floor(i),h=o+1,l=a+1,u=t/o,d=e/a,p=[],f=[],S=[],B=[];for(let z=0;z<l;z++){const N=z*d-r;for(let L=0;L<h;L++){const W=L*u-n;f.push(W,-N,0),S.push(0,0,1),B.push(L/o),B.push(1-z/a)}}for(let z=0;z<a;z++)for(let N=0;N<o;N++){const L=N+h*z,W=N+h*(z+1),et=N+1+h*(z+1),rt=N+1+h*z;p.push(L,W,rt),p.push(W,et,rt)}this.setIndex(p),this.setAttribute("position",new Ot(f,3)),this.setAttribute("normal",new Ot(S,3)),this.setAttribute("uv",new Ot(B,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ta(t.width,t.height,t.widthSegments,t.heightSegments)}}class ea extends oe{constructor(t=.5,e=1,s=32,i=1,n=0,r=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:s,phiSegments:i,thetaStart:n,thetaLength:r},s=Math.max(3,s),i=Math.max(1,i);const o=[],a=[],h=[],l=[];let u=t;const d=(e-t)/i,p=new F,f=new xt;for(let S=0;S<=i;S++){for(let B=0;B<=s;B++){const z=n+B/s*r;p.x=u*Math.cos(z),p.y=u*Math.sin(z),a.push(p.x,p.y,p.z),h.push(0,0,1),f.x=(p.x/e+1)/2,f.y=(p.y/e+1)/2,l.push(f.x,f.y)}u+=d}for(let S=0;S<i;S++){const B=S*(s+1);for(let z=0;z<s;z++){const N=z+B,L=N,W=N+s+1,et=N+s+2,rt=N+1;o.push(L,W,rt),o.push(W,et,rt)}}this.setIndex(o),this.setAttribute("position",new Ot(a,3)),this.setAttribute("normal",new Ot(h,3)),this.setAttribute("uv",new Ot(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ea(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class sa extends oe{constructor(t=new cn([new xt(0,.5),new xt(-.5,-.5),new xt(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const s=[],i=[],n=[],r=[];let o=0,a=0;if(Array.isArray(t)===!1)h(t);else for(let l=0;l<t.length;l++)h(t[l]),this.addGroup(o,a,l),o+=a,a=0;this.setIndex(s),this.setAttribute("position",new Ot(i,3)),this.setAttribute("normal",new Ot(n,3)),this.setAttribute("uv",new Ot(r,2));function h(l){const u=i.length/3,d=l.extractPoints(e);let p=d.shape;const f=d.holes;Qs.isClockWise(p)===!1&&(p=p.reverse());for(let B=0,z=f.length;B<z;B++){const N=f[B];Qs.isClockWise(N)===!0&&(f[B]=N.reverse())}const S=Qs.triangulateShape(p,f);for(let B=0,z=f.length;B<z;B++){const N=f[B];p=p.concat(N)}for(let B=0,z=p.length;B<z;B++){const N=p[B];i.push(N.x,N.y,0),n.push(0,0,1),r.push(N.x,N.y)}for(let B=0,z=S.length;B<z;B++){const N=S[B],L=N[0]+u,W=N[1]+u,et=N[2]+u;s.push(L,W,et),a+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return Pp(e,t)}static fromJSON(t,e){const s=[];for(let i=0,n=t.shapes.length;i<n;i++){const r=e[t.shapes[i]];s.push(r)}return new sa(s,t.curveSegments)}}function Pp(c,t){if(t.shapes=[],Array.isArray(c))for(let e=0,s=c.length;e<s;e++){const i=c[e];t.shapes.push(i.uuid)}else t.shapes.push(c.uuid);return t}class Br extends oe{constructor(t=1,e=32,s=16,i=0,n=Math.PI*2,r=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:s,phiStart:i,phiLength:n,thetaStart:r,thetaLength:o},e=Math.max(3,Math.floor(e)),s=Math.max(2,Math.floor(s));const a=Math.min(r+o,Math.PI);let h=0;const l=[],u=new F,d=new F,p=[],f=[],S=[],B=[];for(let z=0;z<=s;z++){const N=[],L=z/s;let W=0;z===0&&r===0?W=.5/e:z===s&&a===Math.PI&&(W=-.5/e);for(let et=0;et<=e;et++){const rt=et/e;u.x=-t*Math.cos(i+rt*n)*Math.sin(r+L*o),u.y=t*Math.cos(r+L*o),u.z=t*Math.sin(i+rt*n)*Math.sin(r+L*o),f.push(u.x,u.y,u.z),d.copy(u).normalize(),S.push(d.x,d.y,d.z),B.push(rt+W,1-L),N.push(h++)}l.push(N)}for(let z=0;z<s;z++)for(let N=0;N<e;N++){const L=l[z][N+1],W=l[z][N],et=l[z+1][N],rt=l[z+1][N+1];(z!==0||r>0)&&p.push(L,W,rt),(z!==s-1||a<Math.PI)&&p.push(W,et,rt)}this.setIndex(p),this.setAttribute("position",new Ot(f,3)),this.setAttribute("normal",new Ot(S,3)),this.setAttribute("uv",new Ot(B,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Br(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class ia extends Gi{constructor(t=1,e=0){const s=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(s,i,t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new ia(t.radius,t.detail)}}class na extends oe{constructor(t=1,e=.4,s=12,i=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:s,tubularSegments:i,arc:n},s=Math.floor(s),i=Math.floor(i);const r=[],o=[],a=[],h=[],l=new F,u=new F,d=new F;for(let p=0;p<=s;p++)for(let f=0;f<=i;f++){const S=f/i*n,B=p/s*Math.PI*2;u.x=(t+e*Math.cos(B))*Math.cos(S),u.y=(t+e*Math.cos(B))*Math.sin(S),u.z=e*Math.sin(B),o.push(u.x,u.y,u.z),l.x=t*Math.cos(S),l.y=t*Math.sin(S),d.subVectors(u,l).normalize(),a.push(d.x,d.y,d.z),h.push(f/i),h.push(p/s)}for(let p=1;p<=s;p++)for(let f=1;f<=i;f++){const S=(i+1)*p+f-1,B=(i+1)*(p-1)+f-1,z=(i+1)*(p-1)+f,N=(i+1)*p+f;r.push(S,B,N),r.push(B,z,N)}this.setIndex(r),this.setAttribute("position",new Ot(o,3)),this.setAttribute("normal",new Ot(a,3)),this.setAttribute("uv",new Ot(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new na(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class ra extends oe{constructor(t=1,e=.4,s=64,i=8,n=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:s,radialSegments:i,p:n,q:r},s=Math.floor(s),i=Math.floor(i);const o=[],a=[],h=[],l=[],u=new F,d=new F,p=new F,f=new F,S=new F,B=new F,z=new F;for(let L=0;L<=s;++L){const W=L/s*n*Math.PI*2;N(W,n,r,t,p),N(W+.01,n,r,t,f),B.subVectors(f,p),z.addVectors(f,p),S.crossVectors(B,z),z.crossVectors(S,B),S.normalize(),z.normalize();for(let et=0;et<=i;++et){const rt=et/i*Math.PI*2,ct=-e*Math.cos(rt),ot=e*Math.sin(rt);u.x=p.x+(ct*z.x+ot*S.x),u.y=p.y+(ct*z.y+ot*S.y),u.z=p.z+(ct*z.z+ot*S.z),a.push(u.x,u.y,u.z),d.subVectors(u,p).normalize(),h.push(d.x,d.y,d.z),l.push(L/s),l.push(et/i)}}for(let L=1;L<=s;L++)for(let W=1;W<=i;W++){const et=(i+1)*(L-1)+(W-1),rt=(i+1)*L+(W-1),ct=(i+1)*L+W,ot=(i+1)*(L-1)+W;o.push(et,rt,ot),o.push(rt,ct,ot)}this.setIndex(o),this.setAttribute("position",new Ot(a,3)),this.setAttribute("normal",new Ot(h,3)),this.setAttribute("uv",new Ot(l,2));function N(L,W,et,rt,ct){const ot=Math.cos(L),gt=Math.sin(L),bt=et/W*L,Ht=Math.cos(bt);ct.x=rt*(2+Ht)*.5*ot,ct.y=rt*(2+Ht)*gt*.5,ct.z=rt*Math.sin(bt)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ra(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class oa extends oe{constructor(t=new gh(new F(-1,-1,0),new F(-1,1,0),new F(1,1,0)),e=64,s=1,i=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:s,radialSegments:i,closed:n};const r=t.computeFrenetFrames(e,n);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const o=new F,a=new F,h=new xt;let l=new F;const u=[],d=[],p=[],f=[];S(),this.setIndex(f),this.setAttribute("position",new Ot(u,3)),this.setAttribute("normal",new Ot(d,3)),this.setAttribute("uv",new Ot(p,2));function S(){for(let L=0;L<e;L++)B(L);B(n===!1?e:0),N(),z()}function B(L){l=t.getPointAt(L/e,l);const W=r.normals[L],et=r.binormals[L];for(let rt=0;rt<=i;rt++){const ct=rt/i*Math.PI*2,ot=Math.sin(ct),gt=-Math.cos(ct);a.x=gt*W.x+ot*et.x,a.y=gt*W.y+ot*et.y,a.z=gt*W.z+ot*et.z,a.normalize(),d.push(a.x,a.y,a.z),o.x=l.x+s*a.x,o.y=l.y+s*a.y,o.z=l.z+s*a.z,u.push(o.x,o.y,o.z)}}function z(){for(let L=1;L<=e;L++)for(let W=1;W<=i;W++){const et=(i+1)*(L-1)+(W-1),rt=(i+1)*L+(W-1),ct=(i+1)*L+W,ot=(i+1)*(L-1)+W;f.push(et,rt,ot),f.push(rt,ct,ot)}}function N(){for(let L=0;L<=e;L++)for(let W=0;W<=i;W++)h.x=L/e,h.y=W/i,p.push(h.x,h.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new oa(new qo[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Ol extends oe{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const e=[],s=new Set,i=new F,n=new F;if(t.index!==null){const r=t.attributes.position,o=t.index;let a=t.groups;a.length===0&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let h=0,l=a.length;h<l;++h){const u=a[h],d=u.start,p=u.count;for(let f=d,S=d+p;f<S;f+=3)for(let B=0;B<3;B++){const z=o.getX(f+B),N=o.getX(f+(B+1)%3);i.fromBufferAttribute(r,z),n.fromBufferAttribute(r,N),Ll(i,n,s)===!0&&(e.push(i.x,i.y,i.z),e.push(n.x,n.y,n.z))}}}else{const r=t.attributes.position;for(let o=0,a=r.count/3;o<a;o++)for(let h=0;h<3;h++){const l=3*o+h,u=3*o+(h+1)%3;i.fromBufferAttribute(r,l),n.fromBufferAttribute(r,u),Ll(i,n,s)===!0&&(e.push(i.x,i.y,i.z),e.push(n.x,n.y,n.z))}}this.setAttribute("position",new Ot(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function Ll(c,t,e){const s=`${c.x},${c.y},${c.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${c.x},${c.y},${c.z}`;return e.has(s)===!0||e.has(i)===!0?!1:(e.add(s),e.add(i),!0)}var Fl=Object.freeze({__proto__:null,BoxGeometry:fr,CapsuleGeometry:Do,CircleGeometry:Vo,ConeGeometry:Sr,CylinderGeometry:_r,DodecahedronGeometry:Uo,EdgesGeometry:Ml,ExtrudeGeometry:$o,IcosahedronGeometry:Ko,LatheGeometry:Qo,OctahedronGeometry:Pr,PlaneGeometry:ta,PolyhedronGeometry:Gi,RingGeometry:ea,ShapeGeometry:sa,SphereGeometry:Br,TetrahedronGeometry:ia,TorusGeometry:na,TorusKnotGeometry:ra,TubeGeometry:oa,WireframeGeometry:Ol});class Nl extends as{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new te(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Dl extends fo{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Mh extends as{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new te(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fi,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new js,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Vl extends Mh{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new xt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return jt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new te(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new te(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new te(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Ul extends as{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new te(16777215),this.specular=new te(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fi,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new js,this.combine=ke,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Wl extends as{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new te(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fi,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Hl extends as{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fi,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Gl extends as{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new te(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fi,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new js,this.combine=ke,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Jl extends as{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Yr,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Xl extends as{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class ql extends as{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new te(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fi,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Zl extends gs{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function un(c,t){return!c||c.constructor===t?c:typeof t.BYTES_PER_ELEMENT=="number"?new t(c):Array.prototype.slice.call(c)}function Yl(c){return ArrayBuffer.isView(c)&&!(c instanceof DataView)}function jl(c){function t(i,n){return c[i]-c[n]}const e=c.length,s=new Array(e);for(let i=0;i!==e;++i)s[i]=i;return s.sort(t),s}function wh(c,t,e){const s=c.length,i=new c.constructor(s);for(let n=0,r=0;r!==s;++n){const o=e[n]*t;for(let a=0;a!==t;++a)i[r++]=c[o+a]}return i}function _h(c,t,e,s){let i=1,n=c[0];for(;n!==void 0&&n[s]===void 0;)n=c[i++];if(n===void 0)return;let r=n[s];if(r!==void 0)if(Array.isArray(r))do r=n[s],r!==void 0&&(t.push(n.time),e.push(...r)),n=c[i++];while(n!==void 0);else if(r.toArray!==void 0)do r=n[s],r!==void 0&&(t.push(n.time),r.toArray(e,e.length)),n=c[i++];while(n!==void 0);else do r=n[s],r!==void 0&&(t.push(n.time),e.push(r)),n=c[i++];while(n!==void 0)}function Bp(c,t,e,s,i=30){const n=c.clone();n.name=t;const r=[];for(let a=0;a<n.tracks.length;++a){const h=n.tracks[a],l=h.getValueSize(),u=[],d=[];for(let p=0;p<h.times.length;++p){const f=h.times[p]*i;if(!(f<e||f>=s)){u.push(h.times[p]);for(let S=0;S<l;++S)d.push(h.values[p*l+S])}}u.length!==0&&(h.times=un(u,h.times.constructor),h.values=un(d,h.values.constructor),r.push(h))}n.tracks=r;let o=1/0;for(let a=0;a<n.tracks.length;++a)o>n.tracks[a].times[0]&&(o=n.tracks[a].times[0]);for(let a=0;a<n.tracks.length;++a)n.tracks[a].shift(-1*o);return n.resetDuration(),n}function zp(c,t=0,e=c,s=30){s<=0&&(s=30);const i=e.tracks.length,n=t/s;for(let r=0;r<i;++r){const o=e.tracks[r],a=o.ValueTypeName;if(a==="bool"||a==="string")continue;const h=c.tracks.find(function(z){return z.name===o.name&&z.ValueTypeName===a});if(h===void 0)continue;let l=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);let d=0;const p=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const f=o.times.length-1;let S;if(n<=o.times[0]){const z=l,N=u-l;S=o.values.slice(z,N)}else if(n>=o.times[f]){const z=f*u+l,N=z+u-l;S=o.values.slice(z,N)}else{const z=o.createInterpolant(),N=l,L=u-l;z.evaluate(n),S=z.resultBuffer.slice(N,L)}a==="quaternion"&&new Ms().fromArray(S).normalize().conjugate().toArray(S);const B=h.times.length;for(let z=0;z<B;++z){const N=z*p+d;if(a==="quaternion")Ms.multiplyQuaternionsFlat(h.values,N,S,0,h.values,N);else{const L=p-d*2;for(let W=0;W<L;++W)h.values[N+W]-=S[W]}}}return c.blendMode=sr,c}class kp{static convertArray(t,e){return un(t,e)}static isTypedArray(t){return Yl(t)}static getKeyframeOrder(t){return jl(t)}static sortedArray(t,e,s){return wh(t,e,s)}static flattenJSON(t,e,s,i){_h(t,e,s,i)}static subclip(t,e,s,i,n=30){return Bp(t,e,s,i,n)}static makeClipAdditive(t,e=0,s=t,i=30){return zp(t,e,s,i)}}class zr{constructor(t,e,s,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new e.constructor(s),this.sampleValues=e,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let s=this._cachedIndex,i=e[s],n=e[s-1];t:{e:{let r;s:{i:if(!(t<i)){for(let o=s+2;;){if(i===void 0){if(t<n)break i;return s=e.length,this._cachedIndex=s,this.copySampleValue_(s-1)}if(s===o)break;if(n=i,i=e[++s],t<i)break e}r=e.length;break s}if(!(t>=n)){const o=e[1];t<o&&(s=2,n=o);for(let a=s-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===a)break;if(i=n,n=e[--s-1],t>=n)break e}r=s,s=0;break s}break t}for(;s<r;){const o=s+r>>>1;t<e[o]?r=o:s=o+1}if(i=e[s],n=e[s-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return s=e.length,this._cachedIndex=s,this.copySampleValue_(s-1)}this._cachedIndex=s,this.intervalChanged_(s,n,i)}return this.interpolate_(s,n,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,s=this.sampleValues,i=this.valueSize,n=t*i;for(let r=0;r!==i;++r)e[r]=s[n+r];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class $l extends zr{constructor(t,e,s,i){super(t,e,s,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:di,endingEnd:di}}intervalChanged_(t,e,s){const i=this.parameterPositions;let n=t-2,r=t+1,o=i[n],a=i[r];if(o===void 0)switch(this.getSettings_().endingStart){case pi:n=t,o=2*e-s;break;case ji:n=i.length-2,o=e+i[n]-i[n+1];break;default:n=t,o=s}if(a===void 0)switch(this.getSettings_().endingEnd){case pi:r=t,a=2*s-e;break;case ji:r=1,a=s+i[1]-i[0];break;default:r=t-1,a=e}const h=(s-e)*.5,l=this.valueSize;this._weightPrev=h/(e-o),this._weightNext=h/(a-s),this._offsetPrev=n*l,this._offsetNext=r*l}interpolate_(t,e,s,i){const n=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,l=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(s-e)/(i-e),S=f*f,B=S*f,z=-d*B+2*d*S-d*f,N=(1+d)*B+(-1.5-2*d)*S+(-.5+d)*f+1,L=(-1-p)*B+(1.5+p)*S+.5*f,W=p*B-p*S;for(let et=0;et!==o;++et)n[et]=z*r[l+et]+N*r[h+et]+L*r[a+et]+W*r[u+et];return n}}class Sh extends zr{constructor(t,e,s,i){super(t,e,s,i)}interpolate_(t,e,s,i){const n=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,l=(s-e)/(i-e),u=1-l;for(let d=0;d!==o;++d)n[d]=r[h+d]*u+r[a+d]*l;return n}}class Kl extends zr{constructor(t,e,s,i){super(t,e,s,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Us{constructor(t,e,s,i){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=un(e,this.TimeBufferType),this.values=un(s,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let s;if(e.toJSON!==this.toJSON)s=e.toJSON(t);else{s={name:t.name,times:un(t.times,Array),values:un(t.values,Array)};const i=t.getInterpolation();i!==t.DefaultInterpolation&&(s.interpolation=i)}return s.type=t.ValueTypeName,s}InterpolantFactoryMethodDiscrete(t){return new Kl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Sh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new $l(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Yi:e=this.InterpolantFactoryMethodDiscrete;break;case Sn:e=this.InterpolantFactoryMethodLinear;break;case Tn:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(s);return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Yi;case this.InterpolantFactoryMethodLinear:return Sn;case this.InterpolantFactoryMethodSmooth:return Tn}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let s=0,i=e.length;s!==i;++s)e[s]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let s=0,i=e.length;s!==i;++s)e[s]*=t}return this}trim(t,e){const s=this.times,i=s.length;let n=0,r=i-1;for(;n!==i&&s[n]<t;)++n;for(;r!==-1&&s[r]>e;)--r;if(++r,n!==0||r!==i){n>=r&&(r=Math.max(r,1),n=r-1);const o=this.getValueSize();this.times=s.slice(n,r),this.values=this.values.slice(n*o,r*o)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const s=this.times,i=this.values,n=s.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let r=null;for(let o=0;o!==n;o++){const a=s[o];if(typeof a=="number"&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),t=!1;break}if(r!==null&&r>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,r),t=!1;break}r=a}if(i!==void 0&&Yl(i))for(let o=0,a=i.length;o!==a;++o){const h=i[o];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,h),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),s=this.getValueSize(),i=this.getInterpolation()===Tn,n=t.length-1;let r=1;for(let o=1;o<n;++o){let a=!1;const h=t[o],l=t[o+1];if(h!==l&&(o!==1||h!==t[0]))if(i)a=!0;else{const u=o*s,d=u-s,p=u+s;for(let f=0;f!==s;++f){const S=e[u+f];if(S!==e[d+f]||S!==e[p+f]){a=!0;break}}}if(a){if(o!==r){t[r]=t[o];const u=o*s,d=r*s;for(let p=0;p!==s;++p)e[d+p]=e[u+p]}++r}}if(n>0){t[r]=t[n];for(let o=n*s,a=r*s,h=0;h!==s;++h)e[a+h]=e[o+h];++r}return r!==t.length?(this.times=t.slice(0,r),this.values=e.slice(0,r*s)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),s=this.constructor,i=new s(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Us.prototype.ValueTypeName="",Us.prototype.TimeBufferType=Float32Array,Us.prototype.ValueBufferType=Float32Array,Us.prototype.DefaultInterpolation=Sn;class dn extends Us{constructor(t,e,s){super(t,e,s)}}dn.prototype.ValueTypeName="bool",dn.prototype.ValueBufferType=Array,dn.prototype.DefaultInterpolation=Yi,dn.prototype.InterpolantFactoryMethodLinear=void 0,dn.prototype.InterpolantFactoryMethodSmooth=void 0;class Th extends Us{constructor(t,e,s,i){super(t,e,s,i)}}Th.prototype.ValueTypeName="color";class kr extends Us{constructor(t,e,s,i){super(t,e,s,i)}}kr.prototype.ValueTypeName="number";class Ql extends zr{constructor(t,e,s,i){super(t,e,s,i)}interpolate_(t,e,s,i){const n=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=(s-e)/(i-e);let h=t*o;for(let l=h+o;h!==l;h+=4)Ms.slerpFlat(n,0,r,h-o,r,h,a);return n}}class Or extends Us{constructor(t,e,s,i){super(t,e,s,i)}InterpolantFactoryMethodLinear(t){return new Ql(this.times,this.values,this.getValueSize(),t)}}Or.prototype.ValueTypeName="quaternion",Or.prototype.InterpolantFactoryMethodSmooth=void 0;class pn extends Us{constructor(t,e,s){super(t,e,s)}}pn.prototype.ValueTypeName="string",pn.prototype.ValueBufferType=Array,pn.prototype.DefaultInterpolation=Yi,pn.prototype.InterpolantFactoryMethodLinear=void 0,pn.prototype.InterpolantFactoryMethodSmooth=void 0;class Lr extends Us{constructor(t,e,s,i){super(t,e,s,i)}}Lr.prototype.ValueTypeName="vector";class Fr{constructor(t="",e=-1,s=[],i=An){this.name=t,this.tracks=s,this.duration=e,this.blendMode=i,this.uuid=Rs(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],s=t.tracks,i=1/(t.fps||1);for(let r=0,o=s.length;r!==o;++r)e.push(Lp(s[r]).scale(i));const n=new this(t.name,t.duration,e,t.blendMode);return n.uuid=t.uuid,n}static toJSON(t){const e=[],s=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let n=0,r=s.length;n!==r;++n)e.push(Us.toJSON(s[n]));return i}static CreateFromMorphTargetSequence(t,e,s,i){const n=e.length,r=[];for(let o=0;o<n;o++){let a=[],h=[];a.push((o+n-1)%n,o,(o+1)%n),h.push(0,1,0);const l=jl(a);a=wh(a,1,l),h=wh(h,1,l),!i&&a[0]===0&&(a.push(n),h.push(h[0])),r.push(new kr(".morphTargetInfluences["+e[o].name+"]",a,h).scale(1/s))}return new this(t,-1,r)}static findByName(t,e){let s=t;if(!Array.isArray(t)){const i=t;s=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<s.length;i++)if(s[i].name===e)return s[i];return null}static CreateClipsFromMorphTargetSequences(t,e,s){const i={},n=/^([\w-]*?)([\d]+)$/;for(let o=0,a=t.length;o<a;o++){const h=t[o],l=h.name.match(n);if(l&&l.length>1){const u=l[1];let d=i[u];d||(i[u]=d=[]),d.push(h)}}const r=[];for(const o in i)r.push(this.CreateFromMorphTargetSequence(o,i[o],e,s));return r}static parseAnimation(t,e){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const s=function(u,d,p,f,S){if(p.length!==0){const B=[],z=[];_h(p,B,z,f),B.length!==0&&S.push(new u(d,B,z))}},i=[],n=t.name||"default",r=t.fps||30,o=t.blendMode;let a=t.length||-1;const h=t.hierarchy||[];for(let u=0;u<h.length;u++){const d=h[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let S=0;S<d[f].morphTargets.length;S++)p[d[f].morphTargets[S]]=-1;for(const S in p){const B=[],z=[];for(let N=0;N!==d[f].morphTargets.length;++N){const L=d[f];B.push(L.time),z.push(L.morphTarget===S?1:0)}i.push(new kr(".morphTargetInfluence["+S+"]",B,z))}a=p.length*r}else{const p=".bones["+e[u].name+"]";s(Lr,p+".position",d,"pos",i),s(Or,p+".quaternion",d,"rot",i),s(Lr,p+".scale",d,"scl",i)}}return i.length===0?null:new this(n,a,i,o)}resetDuration(){const t=this.tracks;let e=0;for(let s=0,i=t.length;s!==i;++s){const n=this.tracks[s];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Op(c){switch(c.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return kr;case"vector":case"vector2":case"vector3":case"vector4":return Lr;case"color":return Th;case"quaternion":return Or;case"bool":case"boolean":return dn;case"string":return pn}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+c)}function Lp(c){if(c.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=Op(c.type);if(c.times===void 0){const e=[],s=[];_h(c.keys,e,s,"value"),c.times=e,c.values=s}return t.parse!==void 0?t.parse(c):new t(c.name,c.times,c.values,c.interpolation)}const hi={enabled:!1,files:{},add:function(c,t){this.enabled!==!1&&(this.files[c]=t)},get:function(c){if(this.enabled!==!1)return this.files[c]},remove:function(c){delete this.files[c]},clear:function(){this.files={}}};class Ah{constructor(t,e,s){const i=this;let n=!1,r=0,o=0,a;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=s,this.abortController=new AbortController,this.itemStart=function(l){o++,n===!1&&i.onStart!==void 0&&i.onStart(l,r,o),n=!0},this.itemEnd=function(l){r++,i.onProgress!==void 0&&i.onProgress(l,r,o),r===o&&(n=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(l){i.onError!==void 0&&i.onError(l)},this.resolveURL=function(l){return a?a(l):l},this.setURLModifier=function(l){return a=l,this},this.addHandler=function(l,u){return h.push(l,u),this},this.removeHandler=function(l){const u=h.indexOf(l);return u!==-1&&h.splice(u,2),this},this.getHandler=function(l){for(let u=0,d=h.length;u<d;u+=2){const p=h[u],f=h[u+1];if(p.global&&(p.lastIndex=0),p.test(l))return f}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const tu=new Ah;class As{constructor(t){this.manager=t!==void 0?t:tu,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const s=this;return new Promise(function(i,n){s.load(t,i,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}As.DEFAULT_MATERIAL_NAME="__DEFAULT";const Si={};class Fp extends Error{constructor(t,e){super(t),this.response=e}}class Ti extends As{constructor(t){super(t),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(t,e,s,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=hi.get(`file:${t}`);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(Si[t]!==void 0){Si[t].push({onLoad:e,onProgress:s,onError:i});return}Si[t]=[],Si[t].push({onLoad:e,onProgress:s,onError:i});const r=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,a=this.responseType;fetch(r).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const l=Si[t],u=h.body.getReader(),d=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),p=d?parseInt(d):0,f=p!==0;let S=0;const B=new ReadableStream({start(z){N();function N(){u.read().then(({done:L,value:W})=>{if(L)z.close();else{S+=W.byteLength;const et=new ProgressEvent("progress",{lengthComputable:f,loaded:S,total:p});for(let rt=0,ct=l.length;rt<ct;rt++){const ot=l[rt];ot.onProgress&&ot.onProgress(et)}z.enqueue(W),N()}},L=>{z.error(L)})}}});return new Response(B)}else throw new Fp(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(a){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(l=>new DOMParser().parseFromString(l,o));case"json":return h.json();default:if(o==="")return h.text();{const u=/charset="?([^;"\s]*)"?/i.exec(o),d=u&&u[1]?u[1].toLowerCase():void 0,p=new TextDecoder(d);return h.arrayBuffer().then(f=>p.decode(f))}}}).then(h=>{hi.add(`file:${t}`,h);const l=Si[t];delete Si[t];for(let u=0,d=l.length;u<d;u++){const p=l[u];p.onLoad&&p.onLoad(h)}}).catch(h=>{const l=Si[t];if(l===void 0)throw this.manager.itemError(t),h;delete Si[t];for(let u=0,d=l.length;u<d;u++){const p=l[u];p.onError&&p.onError(h)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class Np extends As{constructor(t){super(t)}load(t,e,s,i){const n=this,r=new Ti(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,function(o){try{e(n.parse(JSON.parse(o)))}catch(a){i?i(a):console.error(a),n.manager.itemError(t)}},s,i)}parse(t){const e=[];for(let s=0;s<t.length;s++){const i=Fr.parse(t[s]);e.push(i)}return e}}class Dp extends As{constructor(t){super(t)}load(t,e,s,i){const n=this,r=[],o=new No,a=new Ti(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(n.withCredentials);let h=0;function l(u){a.load(t[u],function(d){const p=n.parse(d,!0);r[u]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},h+=1,h===6&&(p.mipmapCount===1&&(o.minFilter=xe),o.image=r,o.format=p.format,o.needsUpdate=!0,e&&e(o))},s,i)}if(Array.isArray(t))for(let u=0,d=t.length;u<d;++u)l(u);else a.load(t,function(u){const d=n.parse(u,!0);if(d.isCubemap){const p=d.mipmaps.length/d.mipmapCount;for(let f=0;f<p;f++){r[f]={mipmaps:[]};for(let S=0;S<d.mipmapCount;S++)r[f].mipmaps.push(d.mipmaps[f*d.mipmapCount+S]),r[f].format=d.format,r[f].width=d.width,r[f].height=d.height}o.image=r}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=xe),o.format=d.format,o.needsUpdate=!0,e&&e(o)},s,i);return o}}const Kn=new WeakMap;class Nr extends As{constructor(t){super(t)}load(t,e,s,i){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,r=hi.get(`image:${t}`);if(r!==void 0){if(r.complete===!0)n.manager.itemStart(t),setTimeout(function(){e&&e(r),n.manager.itemEnd(t)},0);else{let u=Kn.get(r);u===void 0&&(u=[],Kn.set(r,u)),u.push({onLoad:e,onError:i})}return r}const o=hr("img");function a(){l(),e&&e(this);const u=Kn.get(this)||[];for(let d=0;d<u.length;d++){const p=u[d];p.onLoad&&p.onLoad(this)}Kn.delete(this),n.manager.itemEnd(t)}function h(u){l(),i&&i(u),hi.remove(`image:${t}`);const d=Kn.get(this)||[];for(let p=0;p<d.length;p++){const f=d[p];f.onError&&f.onError(u)}Kn.delete(this),n.manager.itemError(t),n.manager.itemEnd(t)}function l(){o.removeEventListener("load",a,!1),o.removeEventListener("error",h,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",h,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),hi.add(`image:${t}`,o),n.manager.itemStart(t),o.src=t,o}}class Vp extends As{constructor(t){super(t)}load(t,e,s,i){const n=new yo;n.colorSpace=fs;const r=new Nr(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let o=0;function a(h){r.load(t[h],function(l){n.images[h]=l,o++,o===6&&(n.needsUpdate=!0,e&&e(n))},void 0,i)}for(let h=0;h<t.length;++h)a(h);return n}}class Up extends As{constructor(t){super(t)}load(t,e,s,i){const n=this,r=new ni,o=new Ti(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(n.withCredentials),o.load(t,function(a){let h;try{h=n.parse(a)}catch(l){if(i!==void 0)i(l);else{console.error(l);return}}h.image!==void 0?r.image=h.image:h.data!==void 0&&(r.image.width=h.width,r.image.height=h.height,r.image.data=h.data),r.wrapS=h.wrapS!==void 0?h.wrapS:Dt,r.wrapT=h.wrapT!==void 0?h.wrapT:Dt,r.magFilter=h.magFilter!==void 0?h.magFilter:xe,r.minFilter=h.minFilter!==void 0?h.minFilter:xe,r.anisotropy=h.anisotropy!==void 0?h.anisotropy:1,h.colorSpace!==void 0&&(r.colorSpace=h.colorSpace),h.flipY!==void 0&&(r.flipY=h.flipY),h.format!==void 0&&(r.format=h.format),h.type!==void 0&&(r.type=h.type),h.mipmaps!==void 0&&(r.mipmaps=h.mipmaps,r.minFilter=ve),h.mipmapCount===1&&(r.minFilter=xe),h.generateMipmaps!==void 0&&(r.generateMipmaps=h.generateMipmaps),r.needsUpdate=!0,e&&e(r,h)},s,i),r}}class Wp extends As{constructor(t){super(t)}load(t,e,s,i){const n=new Ne,r=new Nr(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(t,function(o){n.image=o,n.needsUpdate=!0,e!==void 0&&e(n)},s,i),n}}class Ji extends ue{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new te(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}}class eu extends Ji{constructor(t,e,s){super(t,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ue.DEFAULT_UP),this.updateMatrix(),this.groundColor=new te(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const Ch=new se,su=new F,iu=new F;class Ih{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new xt(512,512),this.mapType=Cs,this.map=null,this.mapPass=null,this.matrix=new se,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Io,this._frameExtents=new xt(1,1),this._viewportCount=1,this._viewports=[new He(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,s=this.matrix;su.setFromMatrixPosition(t.matrixWorld),e.position.copy(su),iu.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(iu),e.updateMatrixWorld(),Ch.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ch,e.coordinateSystem,e.reversedDepth),e.reversedDepth?s.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(Ch)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Hp extends Ih{constructor(){super(new zs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(t){const e=this.camera,s=In*2*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,n=t.distance||e.far;(s!==e.fov||i!==e.aspect||n!==e.far)&&(e.fov=s,e.aspect=i,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class nu extends Ji{constructor(t,e,s=0,i=Math.PI/3,n=0,r=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ue.DEFAULT_UP),this.updateMatrix(),this.target=new ue,this.distance=s,this.angle=i,this.penumbra=n,this.decay=r,this.map=null,this.shadow=new Hp}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const ru=new se,Dr=new F,Eh=new F;class Gp extends Ih{constructor(){super(new zs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new xt(4,2),this._viewportCount=6,this._viewports=[new He(2,1,1,1),new He(0,1,1,1),new He(3,1,1,1),new He(1,1,1,1),new He(3,0,1,1),new He(1,0,1,1)],this._cubeDirections=[new F(1,0,0),new F(-1,0,0),new F(0,0,1),new F(0,0,-1),new F(0,1,0),new F(0,-1,0)],this._cubeUps=[new F(0,1,0),new F(0,1,0),new F(0,1,0),new F(0,1,0),new F(0,0,1),new F(0,0,-1)]}updateMatrices(t,e=0){const s=this.camera,i=this.matrix,n=t.distance||s.far;n!==s.far&&(s.far=n,s.updateProjectionMatrix()),Dr.setFromMatrixPosition(t.matrixWorld),s.position.copy(Dr),Eh.copy(s.position),Eh.add(this._cubeDirections[e]),s.up.copy(this._cubeUps[e]),s.lookAt(Eh),s.updateMatrixWorld(),i.makeTranslation(-Dr.x,-Dr.y,-Dr.z),ru.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ru,s.coordinateSystem,s.reversedDepth)}}class ou extends Ji{constructor(t,e,s=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=i,this.shadow=new Gp}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Rh extends mo{constructor(t=-1,e=1,s=1,i=-1,n=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=s,this.bottom=i,this.near=n,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,s,i,n,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=n,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let n=s-t,r=s+t,o=i+e,a=i-e;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=h*this.view.offsetX,r=n+h*this.view.width,o-=l*this.view.offsetY,a=o-l*this.view.height}this.projectionMatrix.makeOrthographic(n,r,o,a,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}class Jp extends Ih{constructor(){super(new Rh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class au extends Ji{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ue.DEFAULT_UP),this.updateMatrix(),this.target=new ue,this.shadow=new Jp}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class hu extends Ji{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class cu extends Ji{constructor(t,e,s=10,i=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=s,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class lu{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new F)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const s=t.x,i=t.y,n=t.z,r=this.coefficients;return e.copy(r[0]).multiplyScalar(.282095),e.addScaledVector(r[1],.488603*i),e.addScaledVector(r[2],.488603*n),e.addScaledVector(r[3],.488603*s),e.addScaledVector(r[4],1.092548*(s*i)),e.addScaledVector(r[5],1.092548*(i*n)),e.addScaledVector(r[6],.315392*(3*n*n-1)),e.addScaledVector(r[7],1.092548*(s*n)),e.addScaledVector(r[8],.546274*(s*s-i*i)),e}getIrradianceAt(t,e){const s=t.x,i=t.y,n=t.z,r=this.coefficients;return e.copy(r[0]).multiplyScalar(.886227),e.addScaledVector(r[1],2*.511664*i),e.addScaledVector(r[2],2*.511664*n),e.addScaledVector(r[3],2*.511664*s),e.addScaledVector(r[4],2*.429043*s*i),e.addScaledVector(r[5],2*.429043*i*n),e.addScaledVector(r[6],.743125*n*n-.247708),e.addScaledVector(r[7],2*.429043*s*n),e.addScaledVector(r[8],.429043*(s*s-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let s=0;s<9;s++)this.coefficients[s].addScaledVector(t.coefficients[s],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let s=0;s<9;s++)this.coefficients[s].lerp(t.coefficients[s],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const s=this.coefficients;for(let i=0;i<9;i++)s[i].fromArray(t,e+i*3);return this}toArray(t=[],e=0){const s=this.coefficients;for(let i=0;i<9;i++)s[i].toArray(t,e+i*3);return t}static getBasisAt(t,e){const s=t.x,i=t.y,n=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*n,e[3]=.488603*s,e[4]=1.092548*s*i,e[5]=1.092548*i*n,e[6]=.315392*(3*n*n-1),e[7]=1.092548*s*n,e[8]=.546274*(s*s-i*i)}}class uu extends Ji{constructor(t=new lu,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class aa extends As{constructor(t){super(t),this.textures={}}load(t,e,s,i){const n=this,r=new Ti(n.manager);r.setPath(n.path),r.setRequestHeader(n.requestHeader),r.setWithCredentials(n.withCredentials),r.load(t,function(o){try{e(n.parse(JSON.parse(o)))}catch(a){i?i(a):console.error(a),n.manager.itemError(t)}},s,i)}parse(t){const e=this.textures;function s(n){return e[n]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",n),e[n]}const i=this.createMaterialFromType(t.type);if(t.uuid!==void 0&&(i.uuid=t.uuid),t.name!==void 0&&(i.name=t.name),t.color!==void 0&&i.color!==void 0&&i.color.setHex(t.color),t.roughness!==void 0&&(i.roughness=t.roughness),t.metalness!==void 0&&(i.metalness=t.metalness),t.sheen!==void 0&&(i.sheen=t.sheen),t.sheenColor!==void 0&&(i.sheenColor=new te().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(i.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(t.emissive),t.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(t.specular),t.specularIntensity!==void 0&&(i.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(i.shininess=t.shininess),t.clearcoat!==void 0&&(i.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=t.clearcoatRoughness),t.dispersion!==void 0&&(i.dispersion=t.dispersion),t.iridescence!==void 0&&(i.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(i.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(i.transmission=t.transmission),t.thickness!==void 0&&(i.thickness=t.thickness),t.attenuationDistance!==void 0&&(i.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(i.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(i.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(i.fog=t.fog),t.flatShading!==void 0&&(i.flatShading=t.flatShading),t.blending!==void 0&&(i.blending=t.blending),t.combine!==void 0&&(i.combine=t.combine),t.side!==void 0&&(i.side=t.side),t.shadowSide!==void 0&&(i.shadowSide=t.shadowSide),t.opacity!==void 0&&(i.opacity=t.opacity),t.transparent!==void 0&&(i.transparent=t.transparent),t.alphaTest!==void 0&&(i.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(i.alphaHash=t.alphaHash),t.depthFunc!==void 0&&(i.depthFunc=t.depthFunc),t.depthTest!==void 0&&(i.depthTest=t.depthTest),t.depthWrite!==void 0&&(i.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(i.colorWrite=t.colorWrite),t.blendSrc!==void 0&&(i.blendSrc=t.blendSrc),t.blendDst!==void 0&&(i.blendDst=t.blendDst),t.blendEquation!==void 0&&(i.blendEquation=t.blendEquation),t.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=t.blendSrcAlpha),t.blendDstAlpha!==void 0&&(i.blendDstAlpha=t.blendDstAlpha),t.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=t.blendEquationAlpha),t.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(t.blendColor),t.blendAlpha!==void 0&&(i.blendAlpha=t.blendAlpha),t.stencilWriteMask!==void 0&&(i.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(i.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(i.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(i.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(i.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(i.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(i.stencilZPass=t.stencilZPass),t.stencilWrite!==void 0&&(i.stencilWrite=t.stencilWrite),t.wireframe!==void 0&&(i.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(i.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(i.rotation=t.rotation),t.linewidth!==void 0&&(i.linewidth=t.linewidth),t.dashSize!==void 0&&(i.dashSize=t.dashSize),t.gapSize!==void 0&&(i.gapSize=t.gapSize),t.scale!==void 0&&(i.scale=t.scale),t.polygonOffset!==void 0&&(i.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(i.dithering=t.dithering),t.alphaToCoverage!==void 0&&(i.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(i.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(i.visible=t.visible),t.toneMapped!==void 0&&(i.toneMapped=t.toneMapped),t.userData!==void 0&&(i.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const n in t.uniforms){const r=t.uniforms[n];switch(i.uniforms[n]={},r.type){case"t":i.uniforms[n].value=s(r.value);break;case"c":i.uniforms[n].value=new te().setHex(r.value);break;case"v2":i.uniforms[n].value=new xt().fromArray(r.value);break;case"v3":i.uniforms[n].value=new F().fromArray(r.value);break;case"v4":i.uniforms[n].value=new He().fromArray(r.value);break;case"m3":i.uniforms[n].value=new qs().fromArray(r.value);break;case"m4":i.uniforms[n].value=new se().fromArray(r.value);break;default:i.uniforms[n].value=r.value}}if(t.defines!==void 0&&(i.defines=t.defines),t.vertexShader!==void 0&&(i.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(i.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(i.glslVersion=t.glslVersion),t.extensions!==void 0)for(const n in t.extensions)i.extensions[n]=t.extensions[n];if(t.lights!==void 0&&(i.lights=t.lights),t.clipping!==void 0&&(i.clipping=t.clipping),t.size!==void 0&&(i.size=t.size),t.sizeAttenuation!==void 0&&(i.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(i.map=s(t.map)),t.matcap!==void 0&&(i.matcap=s(t.matcap)),t.alphaMap!==void 0&&(i.alphaMap=s(t.alphaMap)),t.bumpMap!==void 0&&(i.bumpMap=s(t.bumpMap)),t.bumpScale!==void 0&&(i.bumpScale=t.bumpScale),t.normalMap!==void 0&&(i.normalMap=s(t.normalMap)),t.normalMapType!==void 0&&(i.normalMapType=t.normalMapType),t.normalScale!==void 0){let n=t.normalScale;Array.isArray(n)===!1&&(n=[n,n]),i.normalScale=new xt().fromArray(n)}return t.displacementMap!==void 0&&(i.displacementMap=s(t.displacementMap)),t.displacementScale!==void 0&&(i.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(i.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(i.roughnessMap=s(t.roughnessMap)),t.metalnessMap!==void 0&&(i.metalnessMap=s(t.metalnessMap)),t.emissiveMap!==void 0&&(i.emissiveMap=s(t.emissiveMap)),t.emissiveIntensity!==void 0&&(i.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(i.specularMap=s(t.specularMap)),t.specularIntensityMap!==void 0&&(i.specularIntensityMap=s(t.specularIntensityMap)),t.specularColorMap!==void 0&&(i.specularColorMap=s(t.specularColorMap)),t.envMap!==void 0&&(i.envMap=s(t.envMap)),t.envMapRotation!==void 0&&i.envMapRotation.fromArray(t.envMapRotation),t.envMapIntensity!==void 0&&(i.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(i.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(i.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(i.lightMap=s(t.lightMap)),t.lightMapIntensity!==void 0&&(i.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(i.aoMap=s(t.aoMap)),t.aoMapIntensity!==void 0&&(i.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(i.gradientMap=s(t.gradientMap)),t.clearcoatMap!==void 0&&(i.clearcoatMap=s(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=s(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=s(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new xt().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(i.iridescenceMap=s(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=s(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(i.transmissionMap=s(t.transmissionMap)),t.thicknessMap!==void 0&&(i.thicknessMap=s(t.thicknessMap)),t.anisotropyMap!==void 0&&(i.anisotropyMap=s(t.anisotropyMap)),t.sheenColorMap!==void 0&&(i.sheenColorMap=s(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=s(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return aa.createMaterialFromType(t)}static createMaterialFromType(t){const e={ShadowMaterial:Nl,SpriteMaterial:Ka,RawShaderMaterial:Dl,ShaderMaterial:fo,PointsMaterial:ah,MeshPhysicalMaterial:Vl,MeshStandardMaterial:Mh,MeshPhongMaterial:Ul,MeshToonMaterial:Wl,MeshNormalMaterial:Hl,MeshLambertMaterial:Gl,MeshDepthMaterial:Jl,MeshDistanceMaterial:Xl,MeshBasicMaterial:en,MeshMatcapMaterial:ql,LineDashedMaterial:Zl,LineBasicMaterial:gs,Material:as};return new e[t]}}class Ph{static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class du extends oe{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class pu extends As{constructor(t){super(t)}load(t,e,s,i){const n=this,r=new Ti(n.manager);r.setPath(n.path),r.setRequestHeader(n.requestHeader),r.setWithCredentials(n.withCredentials),r.load(t,function(o){try{e(n.parse(JSON.parse(o)))}catch(a){i?i(a):console.error(a),n.manager.itemError(t)}},s,i)}parse(t){const e={},s={};function i(p,f){if(e[f]!==void 0)return e[f];const B=p.interleavedBuffers[f],z=n(p,B.buffer),N=En(B.type,z),L=new vo(N,B.stride);return L.uuid=B.uuid,e[f]=L,L}function n(p,f){if(s[f]!==void 0)return s[f];const B=p.arrayBuffers[f],z=new Uint32Array(B).buffer;return s[f]=z,z}const r=t.isInstancedBufferGeometry?new du:new oe,o=t.data.index;if(o!==void 0){const p=En(o.type,o.array);r.setIndex(new _e(p,1))}const a=t.data.attributes;for(const p in a){const f=a[p];let S;if(f.isInterleavedBufferAttribute){const B=i(t.data,f.data);S=new nn(B,f.itemSize,f.offset,f.normalized)}else{const B=En(f.type,f.array),z=f.isInstancedBufferAttribute?Yn:_e;S=new z(B,f.itemSize,f.normalized)}f.name!==void 0&&(S.name=f.name),f.usage!==void 0&&S.setUsage(f.usage),r.setAttribute(p,S)}const h=t.data.morphAttributes;if(h)for(const p in h){const f=h[p],S=[];for(let B=0,z=f.length;B<z;B++){const N=f[B];let L;if(N.isInterleavedBufferAttribute){const W=i(t.data,N.data);L=new nn(W,N.itemSize,N.offset,N.normalized)}else{const W=En(N.type,N.array);L=new _e(W,N.itemSize,N.normalized)}N.name!==void 0&&(L.name=N.name),S.push(L)}r.morphAttributes[p]=S}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const u=t.data.groups||t.data.drawcalls||t.data.offsets;if(u!==void 0)for(let p=0,f=u.length;p!==f;++p){const S=u[p];r.addGroup(S.start,S.count,S.materialIndex)}const d=t.data.boundingSphere;return d!==void 0&&(r.boundingSphere=new je().fromJSON(d)),t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}class Xp extends As{constructor(t){super(t)}load(t,e,s,i){const n=this,r=this.path===""?Ph.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||r;const o=new Ti(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(a){let h=null;try{h=JSON.parse(a)}catch(u){i!==void 0&&i(u),console.error("THREE:ObjectLoader: Can't parse "+t+".",u.message);return}const l=h.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}n.parse(h,e)},s,i)}async loadAsync(t,e){const s=this,i=this.path===""?Ph.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const n=new Ti(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const r=await n.loadAsync(t,e),o=JSON.parse(r),a=o.metadata;if(a===void 0||a.type===void 0||a.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await s.parseAsync(o)}parse(t,e){const s=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),r=this.parseImages(t.images,function(){e!==void 0&&e(h)}),o=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,o),h=this.parseObject(t.object,n,a,o,s),l=this.parseSkeletons(t.skeletons,h);if(this.bindSkeletons(h,l),this.bindLightTargets(h),e!==void 0){let u=!1;for(const d in r)if(r[d].data instanceof HTMLImageElement){u=!0;break}u===!1&&e(h)}return h}async parseAsync(t){const e=this.parseAnimations(t.animations),s=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,s),n=await this.parseImagesAsync(t.images),r=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,r),a=this.parseObject(t.object,i,o,r,e),h=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,h),this.bindLightTargets(a),a}parseShapes(t){const e={};if(t!==void 0)for(let s=0,i=t.length;s<i;s++){const n=new cn().fromJSON(t[s]);e[n.uuid]=n}return e}parseSkeletons(t,e){const s={},i={};if(e.traverse(function(n){n.isBone&&(i[n.uuid]=n)}),t!==void 0)for(let n=0,r=t.length;n<r;n++){const o=new To().fromJSON(t[n],i);s[o.uuid]=o}return s}parseGeometries(t,e){const s={};if(t!==void 0){const i=new pu;for(let n=0,r=t.length;n<r;n++){let o;const a=t[n];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(a);break;default:a.type in Fl?o=Fl[a.type].fromJSON(a,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}o.uuid=a.uuid,a.name!==void 0&&(o.name=a.name),a.userData!==void 0&&(o.userData=a.userData),s[a.uuid]=o}}return s}parseMaterials(t,e){const s={},i={};if(t!==void 0){const n=new aa;n.setTextures(e);for(let r=0,o=t.length;r<o;r++){const a=t[r];s[a.uuid]===void 0&&(s[a.uuid]=n.parse(a)),i[a.uuid]=s[a.uuid]}}return i}parseAnimations(t){const e={};if(t!==void 0)for(let s=0;s<t.length;s++){const i=t[s],n=Fr.parse(i);e[n.uuid]=n}return e}parseImages(t,e){const s=this,i={};let n;function r(a){return s.manager.itemStart(a),n.load(a,function(){s.manager.itemEnd(a)},void 0,function(){s.manager.itemError(a),s.manager.itemEnd(a)})}function o(a){if(typeof a=="string"){const h=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:s.resourcePath+h;return r(l)}else return a.data?{data:En(a.type,a.data),width:a.width,height:a.height}:null}if(t!==void 0&&t.length>0){const a=new Ah(e);n=new Nr(a),n.setCrossOrigin(this.crossOrigin);for(let h=0,l=t.length;h<l;h++){const u=t[h],d=u.url;if(Array.isArray(d)){const p=[];for(let f=0,S=d.length;f<S;f++){const B=d[f],z=o(B);z!==null&&(z instanceof HTMLImageElement?p.push(z):p.push(new ni(z.data,z.width,z.height)))}i[u.uuid]=new Li(p)}else{const p=o(u.url);i[u.uuid]=new Li(p)}}}return i}async parseImagesAsync(t){const e=this,s={};let i;async function n(r){if(typeof r=="string"){const o=r,a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:e.resourcePath+o;return await i.loadAsync(a)}else return r.data?{data:En(r.type,r.data),width:r.width,height:r.height}:null}if(t!==void 0&&t.length>0){i=new Nr(this.manager),i.setCrossOrigin(this.crossOrigin);for(let r=0,o=t.length;r<o;r++){const a=t[r],h=a.url;if(Array.isArray(h)){const l=[];for(let u=0,d=h.length;u<d;u++){const p=h[u],f=await n(p);f!==null&&(f instanceof HTMLImageElement?l.push(f):l.push(new ni(f.data,f.width,f.height)))}s[a.uuid]=new Li(l)}else{const l=await n(a.url);s[a.uuid]=new Li(l)}}}return s}parseTextures(t,e){function s(n,r){return typeof n=="number"?n:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",n),r[n])}const i={};if(t!==void 0)for(let n=0,r=t.length;n<r;n++){const o=t[n];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),e[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const a=e[o.image],h=a.data;let l;Array.isArray(h)?(l=new yo,h.length===6&&(l.needsUpdate=!0)):(h&&h.data?l=new ni:l=new Ne,h&&(l.needsUpdate=!0)),l.source=a,l.uuid=o.uuid,o.name!==void 0&&(l.name=o.name),o.mapping!==void 0&&(l.mapping=s(o.mapping,qp)),o.channel!==void 0&&(l.channel=o.channel),o.offset!==void 0&&l.offset.fromArray(o.offset),o.repeat!==void 0&&l.repeat.fromArray(o.repeat),o.center!==void 0&&l.center.fromArray(o.center),o.rotation!==void 0&&(l.rotation=o.rotation),o.wrap!==void 0&&(l.wrapS=s(o.wrap[0],fu),l.wrapT=s(o.wrap[1],fu)),o.format!==void 0&&(l.format=o.format),o.internalFormat!==void 0&&(l.internalFormat=o.internalFormat),o.type!==void 0&&(l.type=o.type),o.colorSpace!==void 0&&(l.colorSpace=o.colorSpace),o.minFilter!==void 0&&(l.minFilter=s(o.minFilter,mu)),o.magFilter!==void 0&&(l.magFilter=s(o.magFilter,mu)),o.anisotropy!==void 0&&(l.anisotropy=o.anisotropy),o.flipY!==void 0&&(l.flipY=o.flipY),o.generateMipmaps!==void 0&&(l.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(l.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(l.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(l.compareFunction=o.compareFunction),o.userData!==void 0&&(l.userData=o.userData),i[o.uuid]=l}return i}parseObject(t,e,s,i,n){let r;function o(d){return e[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),e[d]}function a(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let f=0,S=d.length;f<S;f++){const B=d[f];s[B]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",B),p.push(s[B])}return p}return s[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),s[d]}}function h(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),i[d]}let l,u;switch(t.type){case"Scene":r=new Xc,t.background!==void 0&&(Number.isInteger(t.background)?r.background=new te(t.background):r.background=h(t.background)),t.environment!==void 0&&(r.environment=h(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?r.fog=new xo(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(r.fog=new go(t.fog.color,t.fog.density)),t.fog.name!==""&&(r.fog.name=t.fog.name)),t.backgroundBlurriness!==void 0&&(r.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(r.backgroundIntensity=t.backgroundIntensity),t.backgroundRotation!==void 0&&r.backgroundRotation.fromArray(t.backgroundRotation),t.environmentIntensity!==void 0&&(r.environmentIntensity=t.environmentIntensity),t.environmentRotation!==void 0&&r.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":r=new zs(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(r.focus=t.focus),t.zoom!==void 0&&(r.zoom=t.zoom),t.filmGauge!==void 0&&(r.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(r.filmOffset=t.filmOffset),t.view!==void 0&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new Rh(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(r.zoom=t.zoom),t.view!==void 0&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new hu(t.color,t.intensity);break;case"DirectionalLight":r=new au(t.color,t.intensity),r.target=t.target||"";break;case"PointLight":r=new ou(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new cu(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new nu(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),r.target=t.target||"";break;case"HemisphereLight":r=new eu(t.color,t.groundColor,t.intensity);break;case"LightProbe":r=new uu().fromJSON(t);break;case"SkinnedMesh":l=o(t.geometry),u=a(t.material),r=new nl(l,u),t.bindMode!==void 0&&(r.bindMode=t.bindMode),t.bindMatrix!==void 0&&r.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(r.skeleton=t.skeleton);break;case"Mesh":l=o(t.geometry),u=a(t.material),r=new Vs(l,u);break;case"InstancedMesh":l=o(t.geometry),u=a(t.material);const d=t.count,p=t.instanceMatrix,f=t.instanceColor;r=new hl(l,u,d),r.instanceMatrix=new Yn(new Float32Array(p.array),16),f!==void 0&&(r.instanceColor=new Yn(new Float32Array(f.array),f.itemSize));break;case"BatchedMesh":l=o(t.geometry),u=a(t.material),r=new ul(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,u),r.geometry=l,r.perObjectFrustumCulled=t.perObjectFrustumCulled,r.sortObjects=t.sortObjects,r._drawRanges=t.drawRanges,r._reservedRanges=t.reservedRanges,r._geometryInfo=t.geometryInfo.map(S=>{let B=null,z=null;return S.boundingBox!==void 0&&(B=new rs().fromJSON(S.boundingBox)),S.boundingSphere!==void 0&&(z=new je().fromJSON(S.boundingSphere)),{...S,boundingBox:B,boundingSphere:z}}),r._instanceInfo=t.instanceInfo,r._availableInstanceIds=t._availableInstanceIds,r._availableGeometryIds=t._availableGeometryIds,r._nextIndexStart=t.nextIndexStart,r._nextVertexStart=t.nextVertexStart,r._geometryCount=t.geometryCount,r._maxInstanceCount=t.maxInstanceCount,r._maxVertexCount=t.maxVertexCount,r._maxIndexCount=t.maxIndexCount,r._geometryInitialized=t.geometryInitialized,r._matricesTexture=h(t.matricesTexture.uuid),r._indirectTexture=h(t.indirectTexture.uuid),t.colorsTexture!==void 0&&(r._colorsTexture=h(t.colorsTexture.uuid)),t.boundingSphere!==void 0&&(r.boundingSphere=new je().fromJSON(t.boundingSphere)),t.boundingBox!==void 0&&(r.boundingBox=new rs().fromJSON(t.boundingBox));break;case"LOD":r=new Kc;break;case"Line":r=new Hi(o(t.geometry),a(t.material));break;case"LineLoop":r=new yl(o(t.geometry),a(t.material));break;case"LineSegments":r=new ai(o(t.geometry),a(t.material));break;case"PointCloud":case"Points":r=new xl(o(t.geometry),a(t.material));break;case"Sprite":r=new jc(a(t.material));break;case"Group":r=new Gn;break;case"Bone":r=new sh;break;default:r=new ue}if(r.uuid=t.uuid,t.name!==void 0&&(r.name=t.name),t.matrix!==void 0?(r.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(r.matrixAutoUpdate=t.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(t.position!==void 0&&r.position.fromArray(t.position),t.rotation!==void 0&&r.rotation.fromArray(t.rotation),t.quaternion!==void 0&&r.quaternion.fromArray(t.quaternion),t.scale!==void 0&&r.scale.fromArray(t.scale)),t.up!==void 0&&r.up.fromArray(t.up),t.castShadow!==void 0&&(r.castShadow=t.castShadow),t.receiveShadow!==void 0&&(r.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.intensity!==void 0&&(r.shadow.intensity=t.shadow.intensity),t.shadow.bias!==void 0&&(r.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(r.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(r.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(r.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(r.visible=t.visible),t.frustumCulled!==void 0&&(r.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(r.renderOrder=t.renderOrder),t.userData!==void 0&&(r.userData=t.userData),t.layers!==void 0&&(r.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let p=0;p<d.length;p++)r.add(this.parseObject(d[p],e,s,i,n))}if(t.animations!==void 0){const d=t.animations;for(let p=0;p<d.length;p++){const f=d[p];r.animations.push(n[f])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(r.autoUpdate=t.autoUpdate);const d=t.levels;for(let p=0;p<d.length;p++){const f=d[p],S=r.getObjectByProperty("uuid",f.object);S!==void 0&&r.addLevel(S,f.distance,f.hysteresis)}}return r}bindSkeletons(t,e){Object.keys(e).length!==0&&t.traverse(function(s){if(s.isSkinnedMesh===!0&&s.skeleton!==void 0){const i=e[s.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",s.skeleton):s.bind(i,s.bindMatrix)}})}bindLightTargets(t){t.traverse(function(e){if(e.isDirectionalLight||e.isSpotLight){const s=e.target,i=t.getObjectByProperty("uuid",s);i!==void 0?e.target=i:e.target=new ue}})}}const qp={UVMapping:Bt,CubeReflectionMapping:St,CubeRefractionMapping:Vt,EquirectangularReflectionMapping:Ct,EquirectangularRefractionMapping:zt,CubeUVReflectionMapping:re},fu={RepeatWrapping:Ut,ClampToEdgeWrapping:Dt,MirroredRepeatWrapping:Jt},mu={NearestFilter:Yt,NearestMipmapNearestFilter:Me,NearestMipmapLinearFilter:Fe,LinearFilter:xe,LinearMipmapNearestFilter:si,LinearMipmapLinearFilter:ve},Bh=new WeakMap;class Zp extends As{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(t){return this.options=t,this}load(t,e,s,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,r=hi.get(`image-bitmap:${t}`);if(r!==void 0){if(n.manager.itemStart(t),r.then){r.then(h=>{if(Bh.has(r)===!0)i&&i(Bh.get(r)),n.manager.itemError(t),n.manager.itemEnd(t);else return e&&e(h),n.manager.itemEnd(t),h});return}return setTimeout(function(){e&&e(r),n.manager.itemEnd(t)},0),r}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const a=fetch(t,o).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(h){return hi.add(`image-bitmap:${t}`,h),e&&e(h),n.manager.itemEnd(t),h}).catch(function(h){i&&i(h),Bh.set(a,h),hi.remove(`image-bitmap:${t}`),n.manager.itemError(t),n.manager.itemEnd(t)});hi.add(`image-bitmap:${t}`,a),n.manager.itemStart(t)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let ha;class zh{static getContext(){return ha===void 0&&(ha=new(window.AudioContext||window.webkitAudioContext)),ha}static setContext(t){ha=t}}class Yp extends As{constructor(t){super(t)}load(t,e,s,i){const n=this,r=new Ti(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,function(a){try{const h=a.slice(0);zh.getContext().decodeAudioData(h,function(u){e(u)}).catch(o)}catch(h){o(h)}},s,i);function o(a){i?i(a):console.error(a),n.manager.itemError(t)}}}const yu=new se,gu=new se,fn=new se;class jp{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new zs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new zs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,fn.copy(t.projectionMatrix);const i=e.eyeSep/2,n=i*e.near/e.focus,r=e.near*Math.tan(Ki*e.fov*.5)/e.zoom;let o,a;gu.elements[12]=-i,yu.elements[12]=i,o=-r*e.aspect+n,a=r*e.aspect+n,fn.elements[0]=2*e.near/(a-o),fn.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(fn),o=-r*e.aspect-n,a=r*e.aspect-n,fn.elements[0]=2*e.near/(a-o),fn.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(fn)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(gu),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(yu)}}class $p extends zs{constructor(t=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class xu{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=performance.now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const mn=new F,kh=new Ms,Kp=new F,yn=new F,gn=new F;class Qp extends ue{constructor(){super(),this.type="AudioListener",this.context=zh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new xu}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(mn,kh,Kp),yn.set(0,0,-1).applyQuaternion(kh),gn.set(0,1,0).applyQuaternion(kh),e.positionX){const s=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(mn.x,s),e.positionY.linearRampToValueAtTime(mn.y,s),e.positionZ.linearRampToValueAtTime(mn.z,s),e.forwardX.linearRampToValueAtTime(yn.x,s),e.forwardY.linearRampToValueAtTime(yn.y,s),e.forwardZ.linearRampToValueAtTime(yn.z,s),e.upX.linearRampToValueAtTime(gn.x,s),e.upY.linearRampToValueAtTime(gn.y,s),e.upZ.linearRampToValueAtTime(gn.z,s)}else e.setPosition(mn.x,mn.y,mn.z),e.setOrientation(yn.x,yn.y,yn.z,gn.x,gn.y,gn.z)}}class vu extends ue{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(t=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,e){return super.copy(t,e),t.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const xn=new F,bu=new Ms,tf=new F,vn=new F;class ef extends vu{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,s){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=s,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(xn,bu,tf),vn.set(0,0,1).applyQuaternion(bu);const e=this.panner;if(e.positionX){const s=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(xn.x,s),e.positionY.linearRampToValueAtTime(xn.y,s),e.positionZ.linearRampToValueAtTime(xn.z,s),e.orientationX.linearRampToValueAtTime(vn.x,s),e.orientationY.linearRampToValueAtTime(vn.y,s),e.orientationZ.linearRampToValueAtTime(vn.z,s)}else e.setPosition(xn.x,xn.y,xn.z),e.setOrientation(vn.x,vn.y,vn.z)}}class sf{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let s=0;s<e.length;s++)t+=e[s];return t/e.length}}class Mu{constructor(t,e,s){this.binding=t,this.valueSize=s;let i,n,r;switch(e){case"quaternion":i=this._slerp,n=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(s*6),this._workIndex=5;break;case"string":case"bool":i=this._select,n=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(s*5);break;default:i=this._lerp,n=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(s*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=n,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const s=this.buffer,i=this.valueSize,n=t*i+i;let r=this.cumulativeWeight;if(r===0){for(let o=0;o!==i;++o)s[n+o]=s[o];r=e}else{r+=e;const o=e/r;this._mixBufferRegion(s,n,0,o,i)}this.cumulativeWeight=r}accumulateAdditive(t){const e=this.buffer,s=this.valueSize,i=s*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,s),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,s=this.buffer,i=t*e+e,n=this.cumulativeWeight,r=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){const a=e*this._origIndex;this._mixBufferRegion(s,i,a,1-n,e)}r>0&&this._mixBufferRegionAdditive(s,i,this._addIndex*e,1,e);for(let a=e,h=e+e;a!==h;++a)if(s[a]!==s[a+e]){o.setValue(s,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,s=this.valueSize,i=s*this._origIndex;t.getValue(e,i);for(let n=s,r=i;n!==r;++n)e[n]=e[i+n%s];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let s=t;s<e;s++)this.buffer[s]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let s=0;s<this.valueSize;s++)this.buffer[e+s]=this.buffer[t+s]}_select(t,e,s,i,n){if(i>=.5)for(let r=0;r!==n;++r)t[e+r]=t[s+r]}_slerp(t,e,s,i){Ms.slerpFlat(t,e,t,e,t,s,i)}_slerpAdditive(t,e,s,i,n){const r=this._workIndex*n;Ms.multiplyQuaternionsFlat(t,r,t,e,t,s),Ms.slerpFlat(t,e,t,e,t,r,i)}_lerp(t,e,s,i,n){const r=1-i;for(let o=0;o!==n;++o){const a=e+o;t[a]=t[a]*r+t[s+o]*i}}_lerpAdditive(t,e,s,i,n){for(let r=0;r!==n;++r){const o=e+r;t[o]=t[o]+t[s+r]*i}}}const Oh="\\[\\]\\.:\\/",nf=new RegExp("["+Oh+"]","g"),Lh="[^"+Oh+"]",rf="[^"+Oh.replace("\\.","")+"]",of=/((?:WC+[\/:])*)/.source.replace("WC",Lh),af=/(WCOD+)?/.source.replace("WCOD",rf),hf=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Lh),cf=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Lh),lf=new RegExp("^"+of+af+hf+cf+"$"),uf=["material","materials","bones","map"];class df{constructor(t,e,s){const i=s||de.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const s=this._targetGroup.nCachedObjects_,i=this._bindings[s];i!==void 0&&i.getValue(t,e)}setValue(t,e){const s=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=s.length;i!==n;++i)s[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,s=t.length;e!==s;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,s=t.length;e!==s;++e)t[e].unbind()}}class de{constructor(t,e,s){this.path=e,this.parsedPath=s||de.parseTrackName(e),this.node=de.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,s){return t&&t.isAnimationObjectGroup?new de.Composite(t,e,s):new de(t,e,s)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(nf,"")}static parseTrackName(t){const e=lf.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const s={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=s.nodeName&&s.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const n=s.nodeName.substring(i+1);uf.indexOf(n)!==-1&&(s.nodeName=s.nodeName.substring(0,i),s.objectName=n)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return s}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const s=t.skeleton.getBoneByName(e);if(s!==void 0)return s}if(t.children){const s=function(n){for(let r=0;r<n.length;r++){const o=n[r];if(o.name===e||o.uuid===e)return o;const a=s(o.children);if(a)return a}return null},i=s(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const s=this.resolvedProperty;for(let i=0,n=s.length;i!==n;++i)t[e++]=s[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const s=this.resolvedProperty;for(let i=0,n=s.length;i!==n;++i)s[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const s=this.resolvedProperty;for(let i=0,n=s.length;i!==n;++i)s[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const s=this.resolvedProperty;for(let i=0,n=s.length;i!==n;++i)s[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,s=e.objectName,i=e.propertyName;let n=e.propertyIndex;if(t||(t=de.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(s){let h=e.objectIndex;switch(s){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let l=0;l<t.length;l++)if(t[l].name===h){h=l;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[s]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[s]}if(h!==void 0){if(t[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[h]}}const r=t[i];if(r===void 0){const h=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+i+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.isMaterial===!0?o=this.Versioning.NeedsUpdate:t.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(n!==void 0){if(i==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[n]!==void 0&&(n=t.morphTargetDictionary[n])}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=n}else r.fromArray!==void 0&&r.toArray!==void 0?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}de.Composite=df,de.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},de.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},de.prototype.GetterByBindingType=[de.prototype._getValue_direct,de.prototype._getValue_array,de.prototype._getValue_arrayElement,de.prototype._getValue_toArray],de.prototype.SetterByBindingTypeAndVersioning=[[de.prototype._setValue_direct,de.prototype._setValue_direct_setNeedsUpdate,de.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[de.prototype._setValue_array,de.prototype._setValue_array_setNeedsUpdate,de.prototype._setValue_array_setMatrixWorldNeedsUpdate],[de.prototype._setValue_arrayElement,de.prototype._setValue_arrayElement_setNeedsUpdate,de.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[de.prototype._setValue_fromArray,de.prototype._setValue_fromArray_setNeedsUpdate,de.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class pf{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Rs(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let s=0,i=arguments.length;s!==i;++s)t[arguments[s].uuid]=s;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,s=this._paths,i=this._parsedPaths,n=this._bindings,r=n.length;let o,a=t.length,h=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const d=arguments[l],p=d.uuid;let f=e[p];if(f===void 0){f=a++,e[p]=f,t.push(d);for(let S=0,B=r;S!==B;++S)n[S].push(new de(d,s[S],i[S]))}else if(f<h){o=t[f];const S=--h,B=t[S];e[B.uuid]=f,t[f]=B,e[p]=S,t[S]=d;for(let z=0,N=r;z!==N;++z){const L=n[z],W=L[S];let et=L[f];L[f]=W,et===void 0&&(et=new de(d,s[z],i[z])),L[S]=et}}else t[f]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){const t=this._objects,e=this._indicesByUUID,s=this._bindings,i=s.length;let n=this.nCachedObjects_;for(let r=0,o=arguments.length;r!==o;++r){const a=arguments[r],h=a.uuid,l=e[h];if(l!==void 0&&l>=n){const u=n++,d=t[u];e[d.uuid]=l,t[l]=d,e[h]=u,t[u]=a;for(let p=0,f=i;p!==f;++p){const S=s[p],B=S[u],z=S[l];S[l]=B,S[u]=z}}}this.nCachedObjects_=n}uncache(){const t=this._objects,e=this._indicesByUUID,s=this._bindings,i=s.length;let n=this.nCachedObjects_,r=t.length;for(let o=0,a=arguments.length;o!==a;++o){const h=arguments[o],l=h.uuid,u=e[l];if(u!==void 0)if(delete e[l],u<n){const d=--n,p=t[d],f=--r,S=t[f];e[p.uuid]=u,t[u]=p,e[S.uuid]=d,t[d]=S,t.pop();for(let B=0,z=i;B!==z;++B){const N=s[B],L=N[d],W=N[f];N[u]=L,N[d]=W,N.pop()}}else{const d=--r,p=t[d];d>0&&(e[p.uuid]=u),t[u]=p,t.pop();for(let f=0,S=i;f!==S;++f){const B=s[f];B[u]=B[d],B.pop()}}}this.nCachedObjects_=n}subscribe_(t,e){const s=this._bindingsIndicesByPath;let i=s[t];const n=this._bindings;if(i!==void 0)return n[i];const r=this._paths,o=this._parsedPaths,a=this._objects,h=a.length,l=this.nCachedObjects_,u=new Array(h);i=n.length,s[t]=i,r.push(t),o.push(e),n.push(u);for(let d=l,p=a.length;d!==p;++d){const f=a[d];u[d]=new de(f,t,e)}return u}unsubscribe_(t){const e=this._bindingsIndicesByPath,s=e[t];if(s!==void 0){const i=this._paths,n=this._parsedPaths,r=this._bindings,o=r.length-1,a=r[o],h=t[o];e[h]=s,r[s]=a,r.pop(),n[s]=n[o],n.pop(),i[s]=i[o],i.pop()}}}class wu{constructor(t,e,s=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=s,this.blendMode=i;const n=e.tracks,r=n.length,o=new Array(r),a={endingStart:di,endingEnd:di};for(let h=0;h!==r;++h){const l=n[h].createInterpolant(null);o[h]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=qr,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,s=!1){if(t.fadeOut(e),this.fadeIn(e),s===!0){const i=this._clip.duration,n=t._clip.duration,r=n/i,o=i/n;t.warp(1,r,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,s=!1){return t.crossFadeFrom(this,e,s)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,s){const i=this._mixer,n=i.time,r=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,h=o.sampleValues;return a[0]=n,a[1]=n+s,h[0]=t/r,h[1]=e/r,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,s,i){if(!this.enabled){this._updateWeight(t);return}const n=this._startTime;if(n!==null){const a=(t-n)*s;a<0||s===0?e=0:(this._startTime=null,e=s*a)}e*=this._updateTimeScale(t);const r=this._updateTime(e),o=this._updateWeight(t);if(o>0){const a=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case sr:for(let l=0,u=a.length;l!==u;++l)a[l].evaluate(r),h[l].accumulateAdditive(o);break;case An:default:for(let l=0,u=a.length;l!==u;++l)a[l].evaluate(r),h[l].accumulate(i,o)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const s=this._weightInterpolant;if(s!==null){const i=s.evaluate(t)[0];e*=i,t>s.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const s=this._timeScaleInterpolant;if(s!==null){const i=s.evaluate(t)[0];e*=i,t>s.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,s=this.loop;let i=this.time+t,n=this._loopCount;const r=s===Zr;if(t===0)return n===-1?i:r&&(n&1)===1?e-i:i;if(s===Xr){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else if(i<0)i=0;else{this.time=i;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(n===-1&&(t>=0?(n=0,this._setEndings(!0,this.repetitions===0,r)):this._setEndings(this.repetitions===0,!0,r)),i>=e||i<0){const o=Math.floor(i/e);i-=e*o,n+=Math.abs(o);const a=this.repetitions-n;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(a===1){const h=t<0;this._setEndings(h,!h,r)}else this._setEndings(!1,!1,r);this._loopCount=n,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(r&&(n&1)===1)return e-i}return i}_setEndings(t,e,s){const i=this._interpolantSettings;s?(i.endingStart=pi,i.endingEnd=pi):(t?i.endingStart=this.zeroSlopeAtStart?pi:di:i.endingStart=ji,e?i.endingEnd=this.zeroSlopeAtEnd?pi:di:i.endingEnd=ji)}_scheduleFading(t,e,s){const i=this._mixer,n=i.time;let r=this._weightInterpolant;r===null&&(r=i._lendControlInterpolant(),this._weightInterpolant=r);const o=r.parameterPositions,a=r.sampleValues;return o[0]=n,a[0]=e,o[1]=n+t,a[1]=s,this}}const ff=new Float32Array(1);class mf extends yi{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const s=t._localRoot||this._root,i=t._clip.tracks,n=i.length,r=t._propertyBindings,o=t._interpolants,a=s.uuid,h=this._bindingsByRootAndName;let l=h[a];l===void 0&&(l={},h[a]=l);for(let u=0;u!==n;++u){const d=i[u],p=d.name;let f=l[p];if(f!==void 0)++f.referenceCount,r[u]=f;else{if(f=r[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,a,p));continue}const S=e&&e._propertyBindings[u].binding.parsedPath;f=new Mu(de.create(s,p,S),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,a,p),r[u]=f}o[u].resultBuffer=f.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const s=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,s)}const e=t._propertyBindings;for(let s=0,i=e.length;s!==i;++s){const n=e[s];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let s=0,i=e.length;s!==i;++s){const n=e[s];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,s){const i=this._actions,n=this._actionsByClip;let r=n[e];if(r===void 0)r={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=r;else{const o=r.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=i.length,i.push(t),r.actionByRoot[s]=t}_removeInactiveAction(t){const e=this._actions,s=e[e.length-1],i=t._cacheIndex;s._cacheIndex=i,e[i]=s,e.pop(),t._cacheIndex=null;const n=t._clip.uuid,r=this._actionsByClip,o=r[n],a=o.knownActions,h=a[a.length-1],l=t._byClipCacheIndex;h._byClipCacheIndex=l,a[l]=h,a.pop(),t._byClipCacheIndex=null;const u=o.actionByRoot,d=(t._localRoot||this._root).uuid;delete u[d],a.length===0&&delete r[n],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let s=0,i=e.length;s!==i;++s){const n=e[s];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,s=t._cacheIndex,i=this._nActiveActions++,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=s,e[s]=n}_takeBackAction(t){const e=this._actions,s=t._cacheIndex,i=--this._nActiveActions,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=s,e[s]=n}_addInactiveBinding(t,e,s){const i=this._bindingsByRootAndName,n=this._bindings;let r=i[e];r===void 0&&(r={},i[e]=r),r[s]=t,t._cacheIndex=n.length,n.push(t)}_removeInactiveBinding(t){const e=this._bindings,s=t.binding,i=s.rootNode.uuid,n=s.path,r=this._bindingsByRootAndName,o=r[i],a=e[e.length-1],h=t._cacheIndex;a._cacheIndex=h,e[h]=a,e.pop(),delete o[n],Object.keys(o).length===0&&delete r[i]}_lendBinding(t){const e=this._bindings,s=t._cacheIndex,i=this._nActiveBindings++,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=s,e[s]=n}_takeBackBinding(t){const e=this._bindings,s=t._cacheIndex,i=--this._nActiveBindings,n=e[i];t._cacheIndex=i,e[i]=t,n._cacheIndex=s,e[s]=n}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let s=t[e];return s===void 0&&(s=new Sh(new Float32Array(2),new Float32Array(2),1,ff),s.__cacheIndex=e,t[e]=s),s}_takeBackControlInterpolant(t){const e=this._controlInterpolants,s=t.__cacheIndex,i=--this._nActiveControlInterpolants,n=e[i];t.__cacheIndex=i,e[i]=t,n.__cacheIndex=s,e[s]=n}clipAction(t,e,s){const i=e||this._root,n=i.uuid;let r=typeof t=="string"?Fr.findByName(i,t):t;const o=r!==null?r.uuid:t,a=this._actionsByClip[o];let h=null;if(s===void 0&&(r!==null?s=r.blendMode:s=An),a!==void 0){const u=a.actionByRoot[n];if(u!==void 0&&u.blendMode===s)return u;h=a.knownActions[0],r===null&&(r=h._clip)}if(r===null)return null;const l=new wu(this,r,e,s);return this._bindAction(l,h),this._addInactiveAction(l,o,n),l}existingAction(t,e){const s=e||this._root,i=s.uuid,n=typeof t=="string"?Fr.findByName(s,t):t,r=n?n.uuid:t,o=this._actionsByClip[r];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let s=e-1;s>=0;--s)t[s].stop();return this}update(t){t*=this.timeScale;const e=this._actions,s=this._nActiveActions,i=this.time+=t,n=Math.sign(t),r=this._accuIndex^=1;for(let h=0;h!==s;++h)e[h]._update(i,t,n,r);const o=this._bindings,a=this._nActiveBindings;for(let h=0;h!==a;++h)o[h].apply(r);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,s=t.uuid,i=this._actionsByClip,n=i[s];if(n!==void 0){const r=n.knownActions;for(let o=0,a=r.length;o!==a;++o){const h=r[o];this._deactivateAction(h);const l=h._cacheIndex,u=e[e.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,u._cacheIndex=l,e[l]=u,e.pop(),this._removeInactiveBindingsForAction(h)}delete i[s]}}uncacheRoot(t){const e=t.uuid,s=this._actionsByClip;for(const r in s){const o=s[r].actionByRoot,a=o[e];a!==void 0&&(this._deactivateAction(a),this._removeInactiveAction(a))}const i=this._bindingsByRootAndName,n=i[e];if(n!==void 0)for(const r in n){const o=n[r];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(t,e){const s=this.existingAction(t,e);s!==null&&(this._deactivateAction(s),this._removeInactiveAction(s))}}class yf extends za{constructor(t=1,e=1,s=1,i={}){super(t,e,i),this.isRenderTarget3D=!0,this.depth=s,this.texture=new ka(null,t,e,s),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Fh{constructor(t){this.value=t}clone(){return new Fh(this.value.clone===void 0?this.value:this.value.clone())}}let gf=0;class xf extends yi{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:gf++}),this.name="",this.usage=$i,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return e!==-1&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let s=0,i=e.length;s<i;s++){const n=Array.isArray(e[s])?e[s]:[e[s]];for(let r=0;r<n.length;r++)this.uniforms.push(n[r].clone())}return this}clone(){return new this.constructor().copy(this)}}class vf extends vo{constructor(t,e,s=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class bf{constructor(t,e,s,i,n,r=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=s,this.elementSize=i,this.count=n,this.normalized=r,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const _u=new se;class Mf{constructor(t,e,s=0,i=1/0){this.ray=new On(t,e),this.near=s,this.far=i,this.camera=null,this.layers=new Va,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return _u.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_u),this}intersectObject(t,e=!0,s=[]){return Nh(t,this,s,e),s.sort(Su),s}intersectObjects(t,e=!0,s=[]){for(let i=0,n=t.length;i<n;i++)Nh(t[i],this,s,e);return s.sort(Su),s}}function Su(c,t){return c.distance-t.distance}function Nh(c,t,e,s){let i=!0;if(c.layers.test(t.layers)&&c.raycast(t,e)===!1&&(i=!1),i===!0&&s===!0){const n=c.children;for(let r=0,o=n.length;r<o;r++)Nh(n[r],t,e,!0)}}class wf{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(t){this._document=t,t.hidden!==void 0&&(this._pageVisibilityHandler=_f.bind(this),t.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(t){return this._timescale=t,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(t){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(t!==void 0?t:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function _f(){this._document.hidden===!1&&this.reset()}class Sf{constructor(t=1,e=0,s=0){this.radius=t,this.phi=e,this.theta=s}set(t,e,s){return this.radius=t,this.phi=e,this.theta=s,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=jt(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,s){return this.radius=Math.sqrt(t*t+e*e+s*s),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,s),this.phi=Math.acos(jt(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Tf{constructor(t=1,e=0,s=0){this.radius=t,this.theta=e,this.y=s}set(t,e,s){return this.radius=t,this.theta=e,this.y=s,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,s){return this.radius=Math.sqrt(t*t+s*s),this.theta=Math.atan2(t,s),this.y=e,this}clone(){return new this.constructor().copy(this)}}class Dh{constructor(t,e,s,i){Dh.prototype.isMatrix2=!0,this.elements=[1,0,0,1],t!==void 0&&this.set(t,e,s,i)}identity(){return this.set(1,0,0,1),this}fromArray(t,e=0){for(let s=0;s<4;s++)this.elements[s]=t[s+e];return this}set(t,e,s,i){const n=this.elements;return n[0]=t,n[2]=e,n[1]=s,n[3]=i,this}}const Tu=new xt;class Af{constructor(t=new xt(1/0,1/0),e=new xt(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=Tu.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Tu).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Au=new F,ca=new F,Qn=new F,tr=new F,Vh=new F,Cf=new F,If=new F;class Ef{constructor(t=new F,e=new F){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Au.subVectors(t,this.start),ca.subVectors(this.end,this.start);const s=ca.dot(ca);let n=ca.dot(Au)/s;return e&&(n=jt(n,0,1)),n}closestPointToPoint(t,e,s){const i=this.closestPointToPointParameter(t,e);return this.delta(s).multiplyScalar(i).add(this.start)}distanceSqToLine3(t,e=Cf,s=If){const i=10000000000000001e-32;let n,r;const o=this.start,a=t.start,h=this.end,l=t.end;Qn.subVectors(h,o),tr.subVectors(l,a),Vh.subVectors(o,a);const u=Qn.dot(Qn),d=tr.dot(tr),p=tr.dot(Vh);if(u<=i&&d<=i)return e.copy(o),s.copy(a),e.sub(s),e.dot(e);if(u<=i)n=0,r=p/d,r=jt(r,0,1);else{const f=Qn.dot(Vh);if(d<=i)r=0,n=jt(-f/u,0,1);else{const S=Qn.dot(tr),B=u*d-S*S;B!==0?n=jt((S*p-f*d)/B,0,1):n=0,r=(S*n+p)/d,r<0?(r=0,n=jt(-f/u,0,1)):r>1&&(r=1,n=jt((S-f)/u,0,1))}}return e.copy(o).add(Qn.multiplyScalar(n)),s.copy(a).add(tr.multiplyScalar(r)),e.sub(s),e.dot(e)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Cu=new F;class Rf extends ue{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const s=new oe,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let r=0,o=1,a=32;r<a;r++,o++){const h=r/a*Math.PI*2,l=o/a*Math.PI*2;i.push(Math.cos(h),Math.sin(h),1,Math.cos(l),Math.sin(l),1)}s.setAttribute("position",new Ot(i,3));const n=new gs({fog:!1,toneMapped:!1});this.cone=new ai(s,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Cu.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Cu),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Xi=new F,la=new se,Uh=new se;class Pf extends ai{constructor(t){const e=Iu(t),s=new oe,i=[],n=[];for(let h=0;h<e.length;h++){const l=e[h];l.parent&&l.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(0,0,0),n.push(0,0,0))}s.setAttribute("position",new Ot(i,3)),s.setAttribute("color",new Ot(n,3));const r=new gs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(s,r),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;const o=new te(255),a=new te(65280);this.setColors(o,a)}updateMatrixWorld(t){const e=this.bones,s=this.geometry,i=s.getAttribute("position");Uh.copy(this.root.matrixWorld).invert();for(let n=0,r=0;n<e.length;n++){const o=e[n];o.parent&&o.parent.isBone&&(la.multiplyMatrices(Uh,o.matrixWorld),Xi.setFromMatrixPosition(la),i.setXYZ(r,Xi.x,Xi.y,Xi.z),la.multiplyMatrices(Uh,o.parent.matrixWorld),Xi.setFromMatrixPosition(la),i.setXYZ(r+1,Xi.x,Xi.y,Xi.z),r+=2)}s.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}setColors(t,e){const i=this.geometry.getAttribute("color");for(let n=0;n<i.count;n+=2)i.setXYZ(n,t.r,t.g,t.b),i.setXYZ(n+1,e.r,e.g,e.b);return i.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function Iu(c){const t=[];c.isBone===!0&&t.push(c);for(let e=0;e<c.children.length;e++)t.push(...Iu(c.children[e]));return t}class Bf extends Vs{constructor(t,e,s){const i=new Br(e,4,2),n=new en({wireframe:!0,fog:!1,toneMapped:!1});super(i,n),this.light=t,this.color=s,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const zf=new F,Eu=new te,Ru=new te;class kf extends ue{constructor(t,e,s){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="HemisphereLightHelper";const i=new Pr(e);i.rotateY(Math.PI*.5),this.material=new en({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const n=i.getAttribute("position"),r=new Float32Array(n.count*3);i.setAttribute("color",new _e(r,3)),this.add(new Vs(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Eu.copy(this.light.color),Ru.copy(this.light.groundColor);for(let s=0,i=e.count;s<i;s++){const n=s<i/2?Eu:Ru;e.setXYZ(s,n.r,n.g,n.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(zf.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Of extends ai{constructor(t=10,e=10,s=4473924,i=8947848){s=new te(s),i=new te(i);const n=e/2,r=t/e,o=t/2,a=[],h=[];for(let d=0,p=0,f=-o;d<=e;d++,f+=r){a.push(-o,0,f,o,0,f),a.push(f,0,-o,f,0,o);const S=d===n?s:i;S.toArray(h,p),p+=3,S.toArray(h,p),p+=3,S.toArray(h,p),p+=3,S.toArray(h,p),p+=3}const l=new oe;l.setAttribute("position",new Ot(a,3)),l.setAttribute("color",new Ot(h,3));const u=new gs({vertexColors:!0,toneMapped:!1});super(l,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Lf extends ai{constructor(t=10,e=16,s=8,i=64,n=4473924,r=8947848){n=new te(n),r=new te(r);const o=[],a=[];if(e>1)for(let u=0;u<e;u++){const d=u/e*(Math.PI*2),p=Math.sin(d)*t,f=Math.cos(d)*t;o.push(0,0,0),o.push(p,0,f);const S=u&1?n:r;a.push(S.r,S.g,S.b),a.push(S.r,S.g,S.b)}for(let u=0;u<s;u++){const d=u&1?n:r,p=t-t/s*u;for(let f=0;f<i;f++){let S=f/i*(Math.PI*2),B=Math.sin(S)*p,z=Math.cos(S)*p;o.push(B,0,z),a.push(d.r,d.g,d.b),S=(f+1)/i*(Math.PI*2),B=Math.sin(S)*p,z=Math.cos(S)*p,o.push(B,0,z),a.push(d.r,d.g,d.b)}}const h=new oe;h.setAttribute("position",new Ot(o,3)),h.setAttribute("color",new Ot(a,3));const l=new gs({vertexColors:!0,toneMapped:!1});super(h,l),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Pu=new F,ua=new F,Bu=new F;class Ff extends ue{constructor(t,e,s){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="DirectionalLightHelper",e===void 0&&(e=1);let i=new oe;i.setAttribute("position",new Ot([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const n=new gs({fog:!1,toneMapped:!1});this.lightPlane=new Hi(i,n),this.add(this.lightPlane),i=new oe,i.setAttribute("position",new Ot([0,0,0,0,0,1],3)),this.targetLine=new Hi(i,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Pu.setFromMatrixPosition(this.light.matrixWorld),ua.setFromMatrixPosition(this.light.target.matrixWorld),Bu.subVectors(ua,Pu),this.lightPlane.lookAt(ua),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ua),this.targetLine.scale.z=Bu.length()}}const da=new F,Pe=new mo;class Nf extends ai{constructor(t){const e=new oe,s=new gs({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],n=[],r={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(f,S){a(f),a(S)}function a(f){i.push(0,0,0),n.push(0,0,0),r[f]===void 0&&(r[f]=[]),r[f].push(i.length/3-1)}e.setAttribute("position",new Ot(i,3)),e.setAttribute("color",new Ot(n,3)),super(e,s),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update();const h=new te(16755200),l=new te(16711680),u=new te(43775),d=new te(16777215),p=new te(3355443);this.setColors(h,l,u,d,p)}setColors(t,e,s,i,n){const o=this.geometry.getAttribute("color");return o.setXYZ(0,t.r,t.g,t.b),o.setXYZ(1,t.r,t.g,t.b),o.setXYZ(2,t.r,t.g,t.b),o.setXYZ(3,t.r,t.g,t.b),o.setXYZ(4,t.r,t.g,t.b),o.setXYZ(5,t.r,t.g,t.b),o.setXYZ(6,t.r,t.g,t.b),o.setXYZ(7,t.r,t.g,t.b),o.setXYZ(8,t.r,t.g,t.b),o.setXYZ(9,t.r,t.g,t.b),o.setXYZ(10,t.r,t.g,t.b),o.setXYZ(11,t.r,t.g,t.b),o.setXYZ(12,t.r,t.g,t.b),o.setXYZ(13,t.r,t.g,t.b),o.setXYZ(14,t.r,t.g,t.b),o.setXYZ(15,t.r,t.g,t.b),o.setXYZ(16,t.r,t.g,t.b),o.setXYZ(17,t.r,t.g,t.b),o.setXYZ(18,t.r,t.g,t.b),o.setXYZ(19,t.r,t.g,t.b),o.setXYZ(20,t.r,t.g,t.b),o.setXYZ(21,t.r,t.g,t.b),o.setXYZ(22,t.r,t.g,t.b),o.setXYZ(23,t.r,t.g,t.b),o.setXYZ(24,e.r,e.g,e.b),o.setXYZ(25,e.r,e.g,e.b),o.setXYZ(26,e.r,e.g,e.b),o.setXYZ(27,e.r,e.g,e.b),o.setXYZ(28,e.r,e.g,e.b),o.setXYZ(29,e.r,e.g,e.b),o.setXYZ(30,e.r,e.g,e.b),o.setXYZ(31,e.r,e.g,e.b),o.setXYZ(32,s.r,s.g,s.b),o.setXYZ(33,s.r,s.g,s.b),o.setXYZ(34,s.r,s.g,s.b),o.setXYZ(35,s.r,s.g,s.b),o.setXYZ(36,s.r,s.g,s.b),o.setXYZ(37,s.r,s.g,s.b),o.setXYZ(38,i.r,i.g,i.b),o.setXYZ(39,i.r,i.g,i.b),o.setXYZ(40,n.r,n.g,n.b),o.setXYZ(41,n.r,n.g,n.b),o.setXYZ(42,n.r,n.g,n.b),o.setXYZ(43,n.r,n.g,n.b),o.setXYZ(44,n.r,n.g,n.b),o.setXYZ(45,n.r,n.g,n.b),o.setXYZ(46,n.r,n.g,n.b),o.setXYZ(47,n.r,n.g,n.b),o.setXYZ(48,n.r,n.g,n.b),o.setXYZ(49,n.r,n.g,n.b),o.needsUpdate=!0,this}update(){const t=this.geometry,e=this.pointMap,s=1,i=1;let n,r;if(Pe.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)n=1,r=0;else if(this.camera.coordinateSystem===Es)n=-1,r=1;else if(this.camera.coordinateSystem===Oi)n=0,r=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);Oe("c",e,t,Pe,0,0,n),Oe("t",e,t,Pe,0,0,r),Oe("n1",e,t,Pe,-s,-i,n),Oe("n2",e,t,Pe,s,-i,n),Oe("n3",e,t,Pe,-s,i,n),Oe("n4",e,t,Pe,s,i,n),Oe("f1",e,t,Pe,-s,-i,r),Oe("f2",e,t,Pe,s,-i,r),Oe("f3",e,t,Pe,-s,i,r),Oe("f4",e,t,Pe,s,i,r),Oe("u1",e,t,Pe,s*.7,i*1.1,n),Oe("u2",e,t,Pe,-s*.7,i*1.1,n),Oe("u3",e,t,Pe,0,i*2,n),Oe("cf1",e,t,Pe,-s,0,r),Oe("cf2",e,t,Pe,s,0,r),Oe("cf3",e,t,Pe,0,-i,r),Oe("cf4",e,t,Pe,0,i,r),Oe("cn1",e,t,Pe,-s,0,n),Oe("cn2",e,t,Pe,s,0,n),Oe("cn3",e,t,Pe,0,-i,n),Oe("cn4",e,t,Pe,0,i,n),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Oe(c,t,e,s,i,n,r){da.set(i,n,r).unproject(s);const o=t[c];if(o!==void 0){const a=e.getAttribute("position");for(let h=0,l=o.length;h<l;h++)a.setXYZ(o[h],da.x,da.y,da.z)}}const pa=new rs;class Df extends ai{constructor(t,e=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),n=new oe;n.setIndex(new _e(s,1)),n.setAttribute("position",new _e(i,3)),super(n,new gs({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&pa.setFromObject(this.object),pa.isEmpty())return;const t=pa.min,e=pa.max,s=this.geometry.attributes.position,i=s.array;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=t.x,i[4]=e.y,i[5]=e.z,i[6]=t.x,i[7]=t.y,i[8]=e.z,i[9]=e.x,i[10]=t.y,i[11]=e.z,i[12]=e.x,i[13]=e.y,i[14]=t.z,i[15]=t.x,i[16]=e.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=e.x,i[22]=t.y,i[23]=t.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Vf extends ai{constructor(t,e=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new oe;n.setIndex(new _e(s,1)),n.setAttribute("position",new Ot(i,3)),super(n,new gs({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Uf extends Hi{constructor(t,e=1,s=16776960){const i=s,n=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],r=new oe;r.setAttribute("position",new Ot(n,3)),r.computeBoundingSphere(),super(r,new gs({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],a=new oe;a.setAttribute("position",new Ot(o,3)),a.computeBoundingSphere(),this.add(new Vs(a,new en({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const zu=new F;let fa,Wh;class Wf extends ue{constructor(t=new F(0,0,1),e=new F(0,0,0),s=1,i=16776960,n=s*.2,r=n*.2){super(),this.type="ArrowHelper",fa===void 0&&(fa=new oe,fa.setAttribute("position",new Ot([0,0,0,0,1,0],3)),Wh=new Sr(.5,1,5,1),Wh.translate(0,-.5,0)),this.position.copy(e),this.line=new Hi(fa,new gs({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Vs(Wh,new en({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(s,n,r)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{zu.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(zu,e)}}setLength(t,e=t*.2,s=e*.2){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(s,e,s),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Hf extends ai{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],s=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new oe;i.setAttribute("position",new Ot(e,3)),i.setAttribute("color",new Ot(s,3));const n=new gs({vertexColors:!0,toneMapped:!1});super(i,n),this.type="AxesHelper"}setColors(t,e,s){const i=new te,n=this.geometry.attributes.color.array;return i.set(t),i.toArray(n,0),i.toArray(n,3),i.set(e),i.toArray(n,6),i.toArray(n,9),i.set(s),i.toArray(n,12),i.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Gf{constructor(){this.type="ShapePath",this.color=new te,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Zo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,s,i){return this.currentPath.quadraticCurveTo(t,e,s,i),this}bezierCurveTo(t,e,s,i,n,r){return this.currentPath.bezierCurveTo(t,e,s,i,n,r),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(z){const N=[];for(let L=0,W=z.length;L<W;L++){const et=z[L],rt=new cn;rt.curves=et.curves,N.push(rt)}return N}function s(z,N){const L=N.length;let W=!1;for(let et=L-1,rt=0;rt<L;et=rt++){let ct=N[et],ot=N[rt],gt=ot.x-ct.x,bt=ot.y-ct.y;if(Math.abs(bt)>Number.EPSILON){if(bt<0&&(ct=N[rt],gt=-gt,ot=N[et],bt=-bt),z.y<ct.y||z.y>ot.y)continue;if(z.y===ct.y){if(z.x===ct.x)return!0}else{const Ht=bt*(z.x-ct.x)-gt*(z.y-ct.y);if(Ht===0)return!0;if(Ht<0)continue;W=!W}}else{if(z.y!==ct.y)continue;if(ot.x<=z.x&&z.x<=ct.x||ct.x<=z.x&&z.x<=ot.x)return!0}}return W}const i=Qs.isClockWise,n=this.subPaths;if(n.length===0)return[];let r,o,a;const h=[];if(n.length===1)return o=n[0],a=new cn,a.curves=o.curves,h.push(a),h;let l=!i(n[0].getPoints());l=t?!l:l;const u=[],d=[];let p=[],f=0,S;d[f]=void 0,p[f]=[];for(let z=0,N=n.length;z<N;z++)o=n[z],S=o.getPoints(),r=i(S),r=t?!r:r,r?(!l&&d[f]&&f++,d[f]={s:new cn,p:S},d[f].s.curves=o.curves,l&&f++,p[f]=[]):p[f].push({h:o,p:S[0]});if(!d[0])return e(n);if(d.length>1){let z=!1,N=0;for(let L=0,W=d.length;L<W;L++)u[L]=[];for(let L=0,W=d.length;L<W;L++){const et=p[L];for(let rt=0;rt<et.length;rt++){const ct=et[rt];let ot=!0;for(let gt=0;gt<d.length;gt++)s(ct.p,d[gt].p)&&(L!==gt&&N++,ot?(ot=!1,u[gt].push(ct)):z=!0);ot&&u[L].push(ct)}}N>0&&z===!1&&(p=u)}let B;for(let z=0,N=d.length;z<N;z++){a=d[z].s,h.push(a),B=p[z];for(let L=0,W=B.length;L<W;L++)a.holes.push(B[L].h)}return h}}class Jf extends yi{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(t){if(t===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=t}disconnect(){}dispose(){}update(){}}function Xf(c,t){const e=c.image&&c.image.width?c.image.width/c.image.height:1;return e>t?(c.repeat.x=1,c.repeat.y=e/t,c.offset.x=0,c.offset.y=(1-c.repeat.y)/2):(c.repeat.x=t/e,c.repeat.y=1,c.offset.x=(1-c.repeat.x)/2,c.offset.y=0),c}function qf(c,t){const e=c.image&&c.image.width?c.image.width/c.image.height:1;return e>t?(c.repeat.x=t/e,c.repeat.y=1,c.offset.x=(1-c.repeat.x)/2,c.offset.y=0):(c.repeat.x=1,c.repeat.y=e/t,c.offset.x=0,c.offset.y=(1-c.repeat.y)/2),c}function Zf(c){return c.repeat.x=1,c.repeat.y=1,c.offset.x=0,c.offset.y=0,c}function ku(c,t,e,s){const i=Yf(s);switch(e){case U:return c*t;case Mt:return c*t/i.components*i.byteLength;case _t:return c*t/i.components*i.byteLength;case At:return c*t*2/i.components*i.byteLength;case kt:return c*t*2/i.components*i.byteLength;case H:return c*t*3/i.components*i.byteLength;case K:return c*t*4/i.components*i.byteLength;case Rt:return c*t*4/i.components*i.byteLength;case $t:case ye:return Math.floor((c+3)/4)*Math.floor((t+3)/4)*8;case Kt:case Qt:return Math.floor((c+3)/4)*Math.floor((t+3)/4)*16;case we:case ds:return Math.max(c,16)*Math.max(t,8)/4;case he:case vs:return Math.max(c,8)*Math.max(t,8)/2;case qe:case is:return Math.floor((c+3)/4)*Math.floor((t+3)/4)*8;case Is:return Math.floor((c+3)/4)*Math.floor((t+3)/4)*16;case ps:return Math.floor((c+3)/4)*Math.floor((t+3)/4)*16;case Pi:return Math.floor((c+4)/5)*Math.floor((t+3)/4)*16;case Mn:return Math.floor((c+4)/5)*Math.floor((t+4)/5)*16;case ii:return Math.floor((c+5)/6)*Math.floor((t+4)/5)*16;case Bi:return Math.floor((c+5)/6)*Math.floor((t+5)/6)*16;case zi:return Math.floor((c+7)/8)*Math.floor((t+4)/5)*16;case wn:return Math.floor((c+7)/8)*Math.floor((t+5)/6)*16;case Gs:return Math.floor((c+7)/8)*Math.floor((t+7)/8)*16;case Js:return Math.floor((c+9)/10)*Math.floor((t+4)/5)*16;case Xs:return Math.floor((c+9)/10)*Math.floor((t+5)/6)*16;case bs:return Math.floor((c+9)/10)*Math.floor((t+7)/8)*16;case Zi:return Math.floor((c+9)/10)*Math.floor((t+9)/10)*16;case ui:return Math.floor((c+11)/12)*Math.floor((t+9)/10)*16;case _n:return Math.floor((c+11)/12)*Math.floor((t+11)/12)*16;case Ns:case ki:case Ur:return Math.ceil(c/4)*Math.ceil(t/4)*16;case Wr:case Hr:return Math.ceil(c/4)*Math.ceil(t/4)*8;case Gr:case Jr:return Math.ceil(c/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${e} format.`)}function Yf(c){switch(c){case Cs:case Hs:return{byteLength:1,components:1};case m:case G:case _:return{byteLength:2,components:1};case b:case C:return{byteLength:2,components:4};case w:case x:case v:return{byteLength:4,components:1};case V:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${c}.`)}class jf{static contain(t,e){return Xf(t,e)}static cover(t,e){return qf(t,e)}static fill(t){return Zf(t)}static getByteLength(t,e,s,i){return ku(t,e,s,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:I}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=I)},489699:(fe,Et,Q)=>{Q.d(Et,{o8:()=>E});function I(q,O){return O.getBoneName!==void 0?O.getBoneName(q):O.names[q.name]}function mt(q,O,A={}){const y=new Quaternion,g=new Vector3,T=new Matrix4,P=new Matrix4;A.preserveBoneMatrix=A.preserveBoneMatrix!==void 0?A.preserveBoneMatrix:!0,A.preserveBonePositions=A.preserveBonePositions!==void 0?A.preserveBonePositions:!0,A.useTargetMatrix=A.useTargetMatrix!==void 0?A.useTargetMatrix:!1,A.hip=A.hip!==void 0?A.hip:"hip",A.hipInfluence=A.hipInfluence!==void 0?A.hipInfluence:new Vector3(1,1,1),A.scale=A.scale!==void 0?A.scale:1,A.names=A.names||{};const Z=O.isObject3D?O.skeleton.bones:Y(O),tt=q.isObject3D?q.skeleton.bones:Y(q);let R,j,J,lt;if(q.isObject3D?q.skeleton.pose():(A.useTargetMatrix=!0,A.preserveBoneMatrix=!1),A.preserveBonePositions){lt=[];for(let st=0;st<tt.length;st++)lt.push(tt[st].position.clone())}if(A.preserveBoneMatrix){q.updateMatrixWorld(),q.matrixWorld.identity();for(let st=0;st<q.children.length;++st)q.children[st].updateMatrixWorld(!0)}for(let st=0;st<tt.length;++st)R=tt[st],j=I(R,A),J=D(j,Z),P.copy(R.matrixWorld),J&&(J.updateMatrixWorld(),A.useTargetMatrix?T.copy(J.matrixWorld):(T.copy(q.matrixWorld).invert(),T.multiply(J.matrixWorld)),g.setFromMatrixScale(T),T.scale(g.set(1/g.x,1/g.y,1/g.z)),P.makeRotationFromQuaternion(y.setFromRotationMatrix(T)),q.isObject3D&&A.localOffsets&&A.localOffsets[R.name]&&P.multiply(A.localOffsets[R.name]),P.copyPosition(T)),j===A.hip&&(P.elements[12]*=A.scale*A.hipInfluence.x,P.elements[13]*=A.scale*A.hipInfluence.y,P.elements[14]*=A.scale*A.hipInfluence.z,A.hipPosition!==void 0&&(P.elements[12]+=A.hipPosition.x*A.scale,P.elements[13]+=A.hipPosition.y*A.scale,P.elements[14]+=A.hipPosition.z*A.scale)),R.parent?(R.matrix.copy(R.parent.matrixWorld).invert(),R.matrix.multiply(P)):R.matrix.copy(P),R.matrix.decompose(R.position,R.quaternion,R.scale),R.updateMatrixWorld();if(A.preserveBonePositions)for(let st=0;st<tt.length;++st)R=tt[st],j=I(R,A)||R.name,j!==A.hip&&R.position.copy(lt[st]);A.preserveBoneMatrix&&q.updateMatrixWorld(!0)}function at(q,O,A,y={}){y.useFirstFramePosition=y.useFirstFramePosition!==void 0?y.useFirstFramePosition:!1,y.fps=y.fps!==void 0?y.fps:Math.max(...A.tracks.map($=>$.times.length))/A.duration,y.names=y.names||[],O.isObject3D||(O=ft(O));const g=Math.round(A.duration*(y.fps/1e3)*1e3),T=A.duration/(g-1),P=[],Z=new AnimationMixer(O),tt=Y(q.skeleton),R=[];let j,J,lt,st,ht;Z.clipAction(A).play();let yt=0,it=g;y.trim!==void 0?(yt=Math.round(y.trim[0]*y.fps),it=Math.min(Math.round(y.trim[1]*y.fps),g)-yt,Z.update(y.trim[0])):Z.update(0),O.updateMatrixWorld();for(let $=0;$<it;++$){const pt=$*T;mt(q,O,y);for(let dt=0;dt<tt.length;++dt)J=tt[dt],ht=I(J,y)||J.name,lt=D(ht,O.skeleton),lt&&(st=R[dt]=R[dt]||{bone:J},y.hip===ht&&(st.pos||(st.pos={times:new Float32Array(it),values:new Float32Array(it*3)}),y.useFirstFramePosition&&($===0&&(j=J.position.clone()),J.position.sub(j)),st.pos.times[$]=pt,J.position.toArray(st.pos.values,$*3)),st.quat||(st.quat={times:new Float32Array(it),values:new Float32Array(it*4)}),st.quat.times[$]=pt,J.quaternion.toArray(st.quat.values,$*4));$===it-2?Z.update(T-1e-7):Z.update(T),O.updateMatrixWorld()}for(let $=0;$<R.length;++$)st=R[$],st&&(st.pos&&P.push(new VectorKeyframeTrack(".bones["+st.bone.name+"].position",st.pos.times,st.pos.values)),P.push(new QuaternionKeyframeTrack(".bones["+st.bone.name+"].quaternion",st.quat.times,st.quat.values)));return Z.uncacheAction(A),new AnimationClip(A.name,-1,P)}function E(q){const O=new Map,A=new Map,y=q.clone();return M(q,y,function(g,T){O.set(T,g),A.set(g,T)}),y.traverse(function(g){if(!g.isSkinnedMesh)return;const T=g,P=O.get(g),Z=P.skeleton.bones;T.skeleton=P.skeleton.clone(),T.bindMatrix.copy(P.bindMatrix),T.skeleton.bones=Z.map(function(tt){return A.get(tt)}),T.bind(T.skeleton,T.bindMatrix)}),y}function D(q,O){for(let A=0,y=Y(O);A<y.length;A++)if(q===y[A].name)return y[A]}function Y(q){return Array.isArray(q)?q:q.bones}function ft(q){const O=new SkeletonHelper(q.bones[0]);return O.skeleton=q,O}function M(q,O,A){A(q,O);for(let y=0;y<q.children.length;y++)M(q.children[y],O.children[y],A)}},272790:(fe,Et,Q)=>{Q.d(Et,{$EB:()=>T,$Yl:()=>Xe,$_I:()=>ve,$ei:()=>it,BXX:()=>Qt,B_h:()=>Pi,CVz:()=>qe,CWW:()=>Jr,Cfg:()=>Fe,DAe:()=>sr,Dmk:()=>V,EQC:()=>Tn,EZo:()=>tt,EdD:()=>j,FFZ:()=>Ta,FV:()=>qi,FXf:()=>st,Fn:()=>Ns,G3T:()=>Xr,GJx:()=>Ut,GWd:()=>K,Gwm:()=>us,H23:()=>ki,HIg:()=>H,HO_:()=>Gr,HXV:()=>vs,IE4:()=>$t,Jnc:()=>Y,K52:()=>es,KDk:()=>Is,KLL:()=>Cn,KRh:()=>Ls,Ke9:()=>An,Kef:()=>Wr,Kwu:()=>R,LAk:()=>X,LiQ:()=>Ft,Mjd:()=>Fs,N5j:()=>ya,NTi:()=>Z,Nt7:()=>le,Nz6:()=>ye,OUM:()=>Cs,Om:()=>re,OuU:()=>qt,PJ3:()=>Sn,QP0:()=>q,Qrf:()=>Bi,RQf:()=>v,Riy:()=>is,Rkk:()=>Yr,RrE:()=>Ke,RyA:()=>A,S$4:()=>_n,TdN:()=>Es,TiK:()=>Ma,TkQ:()=>kt,U3G:()=>ls,UTZ:()=>Bt,V3x:()=>k,VT0:()=>Mt,VVr:()=>mi,Vb5:()=>D,VxR:()=>rr,W9U:()=>Ur,WNZ:()=>E,Wdf:()=>Aa,Wew:()=>b,Wk7:()=>O,XG_:()=>Hr,XIg:()=>P,XrR:()=>Ei,Yuy:()=>x,ZQM:()=>_t,Zr2:()=>nr,_QJ:()=>Gs,a5J:()=>wn,aEY:()=>Le,aJ8:()=>ut,aMy:()=>qr,agE:()=>$i,amv:()=>xa,bC7:()=>bs,bCz:()=>J,bI3:()=>fi,bkx:()=>w,brA:()=>ts,bw0:()=>ss,c90:()=>Rt,cHt:()=>m,caT:()=>ke,czI:()=>Mn,dcC:()=>vt,dhZ:()=>ji,e0p:()=>cs,eHc:()=>Ye,eoi:()=>wa,er$:()=>fs,f4X:()=>dt,fBL:()=>G,g7M:()=>It,gJ2:()=>C,gO9:()=>lt,gWB:()=>Sa,ghU:()=>Dt,h2z:()=>pi,hB5:()=>y,hdd:()=>me,hgQ:()=>Te,hsX:()=>g,hxR:()=>Yt,hy7:()=>St,i7u:()=>Oi,ie2:()=>Wt,ix0:()=>_,jR7:()=>Kt,jf0:()=>ir,jzd:()=>_a,k6Q:()=>he,k6q:()=>xe,kO0:()=>ba,kRr:()=>si,kTW:()=>Jt,kTp:()=>we,kyO:()=>ci,lGu:()=>Qe,lc7:()=>Zr,ljd:()=>Yi,lyL:()=>Xs,nNL:()=>xs,nST:()=>ht,ojh:()=>$,ojs:()=>ui,ov9:()=>Re,pBf:()=>ds,pHI:()=>Me,paN:()=>At,psI:()=>zi,qa3:()=>ps,qad:()=>pt,rQf:()=>di,rSH:()=>ii,sKt:()=>or,sPf:()=>I,tJf:()=>Hs,uB5:()=>Js,uV5:()=>zt,vim:()=>va,vyJ:()=>ga,wfO:()=>Ct,wn6:()=>ee,wrO:()=>U,xFO:()=>Vt,xSv:()=>Ae,y3Z:()=>Zi,y_p:()=>Ri,zdS:()=>nt,znC:()=>yt});const I="179",mt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},at={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},E=0,D=1,Y=2,ft=3,M=0,q=1,O=2,A=3,y=0,g=1,T=2,P=0,Z=1,tt=2,R=3,j=4,J=5,lt=100,st=101,ht=102,yt=103,it=104,$=200,pt=201,dt=202,Ft=203,Wt=204,qt=205,me=206,le=207,ee=208,Le=209,Te=210,Ke=211,Xe=212,cs=213,Re=214,Ye=0,Qe=1,ts=2,Ae=3,ls=4,us=5,es=6,ss=7,ke=0,Ls=1,Ei=2,Ri=0,ci=1,Fs=2,xs=3,qi=4,It=5,X=6,ut=7,wt="attached",Nt="detached",Bt=300,St=301,Vt=302,Ct=303,zt=304,re=306,Ut=1e3,Dt=1001,Jt=1002,Yt=1003,Me=1004,Ce=1004,Fe=1005,Ue=1005,xe=1006,si=1007,li=1007,ve=1008,We=1008,Cs=1009,Hs=1010,G=1011,m=1012,x=1013,w=1014,v=1015,_=1016,b=1017,C=1018,k=1020,V=35902,U=1021,H=1022,K=1023,nt=1026,vt=1027,Mt=1028,_t=1029,At=1030,kt=1031,Zt=1032,Rt=1033,$t=33776,ye=33777,Kt=33778,Qt=33779,he=35840,we=35841,vs=35842,ds=35843,qe=36196,is=37492,Is=37496,ps=37808,Pi=37809,Mn=37810,ii=37811,Bi=37812,zi=37813,wn=37814,Gs=37815,Js=37816,Xs=37817,bs=37818,Zi=37819,ui=37820,_n=37821,Ns=36492,ki=36494,Ur=36495,Wr=36283,Hr=36284,Gr=36285,Jr=36286,Xr=2200,qr=2201,Zr=2202,Yi=2300,Sn=2301,Tn=2302,di=2400,pi=2401,ji=2402,An=2500,sr=2501,Hh=0,Gh=1,Jh=2,Yr=3200,ya=3201,Xh=3202,qh=3203,fi=0,ga=1,ir="",fs="srgb",nr="srgb-linear",rr="linear",Cn="srgb",Zh=0,mi=7680,Yh=7681,jh=7682,$h=7683,Kh=34055,Qh=34056,tc=5386,ec=512,sc=513,ic=514,nc=515,rc=516,oc=517,ac=518,or=519,xa=512,va=513,ba=514,Ma=515,wa=516,_a=517,Sa=518,Ta=519,$i=35044,hc=35048,cc=35040,lc=35045,uc=35049,dc=35041,pc=35046,fc=35050,mc=35042,yc="100",Aa="300 es",Es=2e3,Oi=2001,gc={COMPUTE:"compute",RENDER:"render"},xc={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},vc={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"}},251750:(fe,Et,Q)=>{Q.d(Et,{Q:()=>I});class I{addEventListener(at,E){this._listeners===void 0&&(this._listeners={});const D=this._listeners;D[at]===void 0&&(D[at]=[]),D[at].indexOf(E)===-1&&D[at].push(E)}hasEventListener(at,E){const D=this._listeners;return D===void 0?!1:D[at]!==void 0&&D[at].indexOf(E)!==-1}removeEventListener(at,E){const D=this._listeners;if(D===void 0)return;const Y=D[at];if(Y!==void 0){const ft=Y.indexOf(E);ft!==-1&&Y.splice(ft,1)}}dispatchEvent(at){const E=this._listeners;if(E===void 0)return;const D=E[at.type];if(D!==void 0){at.target=this;const Y=D.slice(0);for(let ft=0,M=Y.length;ft<M;ft++)Y[ft].call(this,at);at.target=null}}}},238133:(fe,Et,Q)=>{Q.d(Et,{i:()=>Y});var I=Q(339957),mt=Q(251750),at=Q(272790),E=Q(774153);let D=0;class Y extends mt.Q{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:D++}),this.uuid=(0,E.lk)(),this.name="",this.type="Material",this.blending=at.NTi,this.side=at.hB5,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=at.ie2,this.blendDst=at.OuU,this.blendEquation=at.gO9,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new I.Q(0,0,0),this.blendAlpha=0,this.depthFunc=at.xSv,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=at.sKt,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=at.VVr,this.stencilZFail=at.VVr,this.stencilZPass=at.VVr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(M){this._alphaTest>0!=M>0&&this.version++,this._alphaTest=M}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(M){if(M!==void 0)for(const q in M){const O=M[q];if(O===void 0){console.warn(`THREE.Material: parameter '${q}' has value of undefined.`);continue}const A=this[q];if(A===void 0){console.warn(`THREE.Material: '${q}' is not a property of THREE.${this.type}.`);continue}A&&A.isColor?A.set(O):A&&A.isVector3&&O&&O.isVector3?A.copy(O):this[q]=O}}toJSON(M){const q=M===void 0||typeof M=="string";q&&(M={textures:{},images:{}});const O={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};O.uuid=this.uuid,O.type=this.type,this.name!==""&&(O.name=this.name),this.color&&this.color.isColor&&(O.color=this.color.getHex()),this.roughness!==void 0&&(O.roughness=this.roughness),this.metalness!==void 0&&(O.metalness=this.metalness),this.sheen!==void 0&&(O.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(O.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(O.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(O.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(O.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(O.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(O.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(O.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(O.shininess=this.shininess),this.clearcoat!==void 0&&(O.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(O.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(O.clearcoatMap=this.clearcoatMap.toJSON(M).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(O.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(M).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(O.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(M).uuid,O.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(O.dispersion=this.dispersion),this.iridescence!==void 0&&(O.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(O.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(O.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(O.iridescenceMap=this.iridescenceMap.toJSON(M).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(O.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(M).uuid),this.anisotropy!==void 0&&(O.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(O.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(O.anisotropyMap=this.anisotropyMap.toJSON(M).uuid),this.map&&this.map.isTexture&&(O.map=this.map.toJSON(M).uuid),this.matcap&&this.matcap.isTexture&&(O.matcap=this.matcap.toJSON(M).uuid),this.alphaMap&&this.alphaMap.isTexture&&(O.alphaMap=this.alphaMap.toJSON(M).uuid),this.lightMap&&this.lightMap.isTexture&&(O.lightMap=this.lightMap.toJSON(M).uuid,O.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(O.aoMap=this.aoMap.toJSON(M).uuid,O.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(O.bumpMap=this.bumpMap.toJSON(M).uuid,O.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(O.normalMap=this.normalMap.toJSON(M).uuid,O.normalMapType=this.normalMapType,O.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(O.displacementMap=this.displacementMap.toJSON(M).uuid,O.displacementScale=this.displacementScale,O.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(O.roughnessMap=this.roughnessMap.toJSON(M).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(O.metalnessMap=this.metalnessMap.toJSON(M).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(O.emissiveMap=this.emissiveMap.toJSON(M).uuid),this.specularMap&&this.specularMap.isTexture&&(O.specularMap=this.specularMap.toJSON(M).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(O.specularIntensityMap=this.specularIntensityMap.toJSON(M).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(O.specularColorMap=this.specularColorMap.toJSON(M).uuid),this.envMap&&this.envMap.isTexture&&(O.envMap=this.envMap.toJSON(M).uuid,this.combine!==void 0&&(O.combine=this.combine)),this.envMapRotation!==void 0&&(O.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(O.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(O.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(O.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(O.gradientMap=this.gradientMap.toJSON(M).uuid),this.transmission!==void 0&&(O.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(O.transmissionMap=this.transmissionMap.toJSON(M).uuid),this.thickness!==void 0&&(O.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(O.thicknessMap=this.thicknessMap.toJSON(M).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(O.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(O.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(O.size=this.size),this.shadowSide!==null&&(O.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(O.sizeAttenuation=this.sizeAttenuation),this.blending!==at.NTi&&(O.blending=this.blending),this.side!==at.hB5&&(O.side=this.side),this.vertexColors===!0&&(O.vertexColors=!0),this.opacity<1&&(O.opacity=this.opacity),this.transparent===!0&&(O.transparent=!0),this.blendSrc!==at.ie2&&(O.blendSrc=this.blendSrc),this.blendDst!==at.OuU&&(O.blendDst=this.blendDst),this.blendEquation!==at.gO9&&(O.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(O.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(O.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(O.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(O.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(O.blendAlpha=this.blendAlpha),this.depthFunc!==at.xSv&&(O.depthFunc=this.depthFunc),this.depthTest===!1&&(O.depthTest=this.depthTest),this.depthWrite===!1&&(O.depthWrite=this.depthWrite),this.colorWrite===!1&&(O.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(O.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==at.sKt&&(O.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(O.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(O.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==at.VVr&&(O.stencilFail=this.stencilFail),this.stencilZFail!==at.VVr&&(O.stencilZFail=this.stencilZFail),this.stencilZPass!==at.VVr&&(O.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(O.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(O.rotation=this.rotation),this.polygonOffset===!0&&(O.polygonOffset=!0),this.polygonOffsetFactor!==0&&(O.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(O.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(O.linewidth=this.linewidth),this.dashSize!==void 0&&(O.dashSize=this.dashSize),this.gapSize!==void 0&&(O.gapSize=this.gapSize),this.scale!==void 0&&(O.scale=this.scale),this.dithering===!0&&(O.dithering=!0),this.alphaTest>0&&(O.alphaTest=this.alphaTest),this.alphaHash===!0&&(O.alphaHash=!0),this.alphaToCoverage===!0&&(O.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(O.premultipliedAlpha=!0),this.forceSinglePass===!0&&(O.forceSinglePass=!0),this.wireframe===!0&&(O.wireframe=!0),this.wireframeLinewidth>1&&(O.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(O.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(O.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(O.flatShading=!0),this.visible===!1&&(O.visible=!1),this.toneMapped===!1&&(O.toneMapped=!1),this.fog===!1&&(O.fog=!1),Object.keys(this.userData).length>0&&(O.userData=this.userData);function A(y){const g=[];for(const T in y){const P=y[T];delete P.metadata,g.push(P)}return g}if(q){const y=A(M.textures),g=A(M.images);y.length>0&&(O.textures=y),g.length>0&&(O.images=g)}return O}clone(){return new this.constructor().copy(this)}copy(M){this.name=M.name,this.blending=M.blending,this.side=M.side,this.vertexColors=M.vertexColors,this.opacity=M.opacity,this.transparent=M.transparent,this.blendSrc=M.blendSrc,this.blendDst=M.blendDst,this.blendEquation=M.blendEquation,this.blendSrcAlpha=M.blendSrcAlpha,this.blendDstAlpha=M.blendDstAlpha,this.blendEquationAlpha=M.blendEquationAlpha,this.blendColor.copy(M.blendColor),this.blendAlpha=M.blendAlpha,this.depthFunc=M.depthFunc,this.depthTest=M.depthTest,this.depthWrite=M.depthWrite,this.stencilWriteMask=M.stencilWriteMask,this.stencilFunc=M.stencilFunc,this.stencilRef=M.stencilRef,this.stencilFuncMask=M.stencilFuncMask,this.stencilFail=M.stencilFail,this.stencilZFail=M.stencilZFail,this.stencilZPass=M.stencilZPass,this.stencilWrite=M.stencilWrite;const q=M.clippingPlanes;let O=null;if(q!==null){const A=q.length;O=new Array(A);for(let y=0;y!==A;++y)O[y]=q[y].clone()}return this.clippingPlanes=O,this.clipIntersection=M.clipIntersection,this.clipShadows=M.clipShadows,this.shadowSide=M.shadowSide,this.colorWrite=M.colorWrite,this.precision=M.precision,this.polygonOffset=M.polygonOffset,this.polygonOffsetFactor=M.polygonOffsetFactor,this.polygonOffsetUnits=M.polygonOffsetUnits,this.dithering=M.dithering,this.alphaTest=M.alphaTest,this.alphaHash=M.alphaHash,this.alphaToCoverage=M.alphaToCoverage,this.premultipliedAlpha=M.premultipliedAlpha,this.forceSinglePass=M.forceSinglePass,this.visible=M.visible,this.toneMapped=M.toneMapped,this.userData=JSON.parse(JSON.stringify(M.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(M){M===!0&&this.version++}}},103473:(fe,Et,Q)=>{Q.d(Et,{_:()=>Y});var I=Q(272790),mt=Q(238133),at=Q(237481),E=Q(339957),D=Q(430799);class Y extends mt.i{constructor(M){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new E.Q(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new E.Q(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=I.bI3,this.normalScale=new at.I(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new D.O,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(M)}copy(M){return super.copy(M),this.defines={STANDARD:""},this.color.copy(M.color),this.roughness=M.roughness,this.metalness=M.metalness,this.map=M.map,this.lightMap=M.lightMap,this.lightMapIntensity=M.lightMapIntensity,this.aoMap=M.aoMap,this.aoMapIntensity=M.aoMapIntensity,this.emissive.copy(M.emissive),this.emissiveMap=M.emissiveMap,this.emissiveIntensity=M.emissiveIntensity,this.bumpMap=M.bumpMap,this.bumpScale=M.bumpScale,this.normalMap=M.normalMap,this.normalMapType=M.normalMapType,this.normalScale.copy(M.normalScale),this.displacementMap=M.displacementMap,this.displacementScale=M.displacementScale,this.displacementBias=M.displacementBias,this.roughnessMap=M.roughnessMap,this.metalnessMap=M.metalnessMap,this.alphaMap=M.alphaMap,this.envMap=M.envMap,this.envMapRotation.copy(M.envMapRotation),this.envMapIntensity=M.envMapIntensity,this.wireframe=M.wireframe,this.wireframeLinewidth=M.wireframeLinewidth,this.wireframeLinecap=M.wireframeLinecap,this.wireframeLinejoin=M.wireframeLinejoin,this.flatShading=M.flatShading,this.fog=M.fog,this}}},523006:(fe,Et,Q)=>{Q.r(Et),Q.d(Et,{Box3:()=>mt});var I=Q(824954);class mt{constructor(R=new I.Vector3(1/0,1/0,1/0),j=new I.Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=R,this.max=j}set(R,j){return this.min.copy(R),this.max.copy(j),this}setFromArray(R){this.makeEmpty();for(let j=0,J=R.length;j<J;j+=3)this.expandByPoint(E.fromArray(R,j));return this}setFromBufferAttribute(R){this.makeEmpty();for(let j=0,J=R.count;j<J;j++)this.expandByPoint(E.fromBufferAttribute(R,j));return this}setFromPoints(R){this.makeEmpty();for(let j=0,J=R.length;j<J;j++)this.expandByPoint(R[j]);return this}setFromCenterAndSize(R,j){const J=E.copy(j).multiplyScalar(.5);return this.min.copy(R).sub(J),this.max.copy(R).add(J),this}setFromObject(R,j=!1){return this.makeEmpty(),this.expandByObject(R,j)}clone(){return new this.constructor().copy(this)}copy(R){return this.min.copy(R.min),this.max.copy(R.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(R){return this.isEmpty()?R.set(0,0,0):R.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(R){return this.isEmpty()?R.set(0,0,0):R.subVectors(this.max,this.min)}expandByPoint(R){return this.min.min(R),this.max.max(R),this}expandByVector(R){return this.min.sub(R),this.max.add(R),this}expandByScalar(R){return this.min.addScalar(-R),this.max.addScalar(R),this}expandByObject(R,j=!1){R.updateWorldMatrix(!1,!1);const J=R.geometry;if(J!==void 0){const st=J.getAttribute("position");if(j===!0&&st!==void 0&&R.isInstancedMesh!==!0)for(let ht=0,yt=st.count;ht<yt;ht++)R.isMesh===!0?R.getVertexPosition(ht,E):E.fromBufferAttribute(st,ht),E.applyMatrix4(R.matrixWorld),this.expandByPoint(E);else R.boundingBox!==void 0?(R.boundingBox===null&&R.computeBoundingBox(),D.copy(R.boundingBox)):(J.boundingBox===null&&J.computeBoundingBox(),D.copy(J.boundingBox)),D.applyMatrix4(R.matrixWorld),this.union(D)}const lt=R.children;for(let st=0,ht=lt.length;st<ht;st++)this.expandByObject(lt[st],j);return this}containsPoint(R){return R.x>=this.min.x&&R.x<=this.max.x&&R.y>=this.min.y&&R.y<=this.max.y&&R.z>=this.min.z&&R.z<=this.max.z}containsBox(R){return this.min.x<=R.min.x&&R.max.x<=this.max.x&&this.min.y<=R.min.y&&R.max.y<=this.max.y&&this.min.z<=R.min.z&&R.max.z<=this.max.z}getParameter(R,j){return j.set((R.x-this.min.x)/(this.max.x-this.min.x),(R.y-this.min.y)/(this.max.y-this.min.y),(R.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(R){return R.max.x>=this.min.x&&R.min.x<=this.max.x&&R.max.y>=this.min.y&&R.min.y<=this.max.y&&R.max.z>=this.min.z&&R.min.z<=this.max.z}intersectsSphere(R){return this.clampPoint(R.center,E),E.distanceToSquared(R.center)<=R.radius*R.radius}intersectsPlane(R){let j,J;return R.normal.x>0?(j=R.normal.x*this.min.x,J=R.normal.x*this.max.x):(j=R.normal.x*this.max.x,J=R.normal.x*this.min.x),R.normal.y>0?(j+=R.normal.y*this.min.y,J+=R.normal.y*this.max.y):(j+=R.normal.y*this.max.y,J+=R.normal.y*this.min.y),R.normal.z>0?(j+=R.normal.z*this.min.z,J+=R.normal.z*this.max.z):(j+=R.normal.z*this.max.z,J+=R.normal.z*this.min.z),j<=-R.constant&&J>=-R.constant}intersectsTriangle(R){if(this.isEmpty())return!1;this.getCenter(y),g.subVectors(this.max,y),Y.subVectors(R.a,y),ft.subVectors(R.b,y),M.subVectors(R.c,y),q.subVectors(ft,Y),O.subVectors(M,ft),A.subVectors(Y,M);let j=[0,-q.z,q.y,0,-O.z,O.y,0,-A.z,A.y,q.z,0,-q.x,O.z,0,-O.x,A.z,0,-A.x,-q.y,q.x,0,-O.y,O.x,0,-A.y,A.x,0];return!Z(j,Y,ft,M,g)||(j=[1,0,0,0,1,0,0,0,1],!Z(j,Y,ft,M,g))?!1:(T.crossVectors(q,O),j=[T.x,T.y,T.z],Z(j,Y,ft,M,g))}clampPoint(R,j){return j.copy(R).clamp(this.min,this.max)}distanceToPoint(R){return this.clampPoint(R,E).distanceTo(R)}getBoundingSphere(R){return this.isEmpty()?R.makeEmpty():(this.getCenter(R.center),R.radius=this.getSize(E).length()*.5),R}intersect(R){return this.min.max(R.min),this.max.min(R.max),this.isEmpty()&&this.makeEmpty(),this}union(R){return this.min.min(R.min),this.max.max(R.max),this}applyMatrix4(R){return this.isEmpty()?this:(at[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(R),at[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(R),at[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(R),at[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(R),at[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(R),at[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(R),at[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(R),at[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(R),this.setFromPoints(at),this)}translate(R){return this.min.add(R),this.max.add(R),this}equals(R){return R.min.equals(this.min)&&R.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(R){return this.min.fromArray(R.min),this.max.fromArray(R.max),this}}const at=[new I.Vector3,new I.Vector3,new I.Vector3,new I.Vector3,new I.Vector3,new I.Vector3,new I.Vector3,new I.Vector3],E=new I.Vector3,D=new mt,Y=new I.Vector3,ft=new I.Vector3,M=new I.Vector3,q=new I.Vector3,O=new I.Vector3,A=new I.Vector3,y=new I.Vector3,g=new I.Vector3,T=new I.Vector3,P=new I.Vector3;function Z(tt,R,j,J,lt){for(let st=0,ht=tt.length-3;st<=ht;st+=3){P.fromArray(tt,st);const yt=lt.x*Math.abs(P.x)+lt.y*Math.abs(P.y)+lt.z*Math.abs(P.z),it=R.dot(P),$=j.dot(P),pt=J.dot(P);if(Math.max(-Math.max(it,$,pt),Math.min(it,$,pt))>yt)return!1}return!0}},339957:(fe,Et,Q)=>{Q.d(Et,{Q:()=>M});var I=Q(774153),mt=Q(116898),at=Q(272790);const E={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},D={h:0,s:0,l:0},Y={h:0,s:0,l:0};function ft(O,A,y){return y<0&&(y+=1),y>1&&(y-=1),y<1/6?O+(A-O)*6*y:y<1/2?A:y<2/3?O+(A-O)*6*(2/3-y):O}class M{constructor(A,y,g){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(A,y,g)}set(A,y,g){if(y===void 0&&g===void 0){const T=A;T&&T.isColor?this.copy(T):typeof T=="number"?this.setHex(T):typeof T=="string"&&this.setStyle(T)}else this.setRGB(A,y,g);return this}setScalar(A){return this.r=A,this.g=A,this.b=A,this}setHex(A,y=at.er$){return A=Math.floor(A),this.r=(A>>16&255)/255,this.g=(A>>8&255)/255,this.b=(A&255)/255,mt.pp.colorSpaceToWorking(this,y),this}setRGB(A,y,g,T=mt.pp.workingColorSpace){return this.r=A,this.g=y,this.b=g,mt.pp.colorSpaceToWorking(this,T),this}setHSL(A,y,g,T=mt.pp.workingColorSpace){if(A=(0,I.rl)(A,1),y=(0,I.qE)(y,0,1),g=(0,I.qE)(g,0,1),y===0)this.r=this.g=this.b=g;else{const P=g<=.5?g*(1+y):g+y-g*y,Z=2*g-P;this.r=ft(Z,P,A+1/3),this.g=ft(Z,P,A),this.b=ft(Z,P,A-1/3)}return mt.pp.colorSpaceToWorking(this,T),this}setStyle(A,y=at.er$){function g(P){P!==void 0&&parseFloat(P)<1&&console.warn("THREE.Color: Alpha component of "+A+" will be ignored.")}let T;if(T=/^(\w+)\(([^\)]*)\)/.exec(A)){let P;const Z=T[1],tt=T[2];switch(Z){case"rgb":case"rgba":if(P=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(tt))return g(P[4]),this.setRGB(Math.min(255,parseInt(P[1],10))/255,Math.min(255,parseInt(P[2],10))/255,Math.min(255,parseInt(P[3],10))/255,y);if(P=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(tt))return g(P[4]),this.setRGB(Math.min(100,parseInt(P[1],10))/100,Math.min(100,parseInt(P[2],10))/100,Math.min(100,parseInt(P[3],10))/100,y);break;case"hsl":case"hsla":if(P=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(tt))return g(P[4]),this.setHSL(parseFloat(P[1])/360,parseFloat(P[2])/100,parseFloat(P[3])/100,y);break;default:console.warn("THREE.Color: Unknown color model "+A)}}else if(T=/^\#([A-Fa-f\d]+)$/.exec(A)){const P=T[1],Z=P.length;if(Z===3)return this.setRGB(parseInt(P.charAt(0),16)/15,parseInt(P.charAt(1),16)/15,parseInt(P.charAt(2),16)/15,y);if(Z===6)return this.setHex(parseInt(P,16),y);console.warn("THREE.Color: Invalid hex color "+A)}else if(A&&A.length>0)return this.setColorName(A,y);return this}setColorName(A,y=at.er$){const g=E[A.toLowerCase()];return g!==void 0?this.setHex(g,y):console.warn("THREE.Color: Unknown color "+A),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(A){return this.r=A.r,this.g=A.g,this.b=A.b,this}copySRGBToLinear(A){return this.r=(0,mt.dk)(A.r),this.g=(0,mt.dk)(A.g),this.b=(0,mt.dk)(A.b),this}copyLinearToSRGB(A){return this.r=(0,mt.rd)(A.r),this.g=(0,mt.rd)(A.g),this.b=(0,mt.rd)(A.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(A=at.er$){return mt.pp.workingToColorSpace(q.copy(this),A),Math.round((0,I.qE)(q.r*255,0,255))*65536+Math.round((0,I.qE)(q.g*255,0,255))*256+Math.round((0,I.qE)(q.b*255,0,255))}getHexString(A=at.er$){return("000000"+this.getHex(A).toString(16)).slice(-6)}getHSL(A,y=mt.pp.workingColorSpace){mt.pp.workingToColorSpace(q.copy(this),y);const g=q.r,T=q.g,P=q.b,Z=Math.max(g,T,P),tt=Math.min(g,T,P);let R,j;const J=(tt+Z)/2;if(tt===Z)R=0,j=0;else{const lt=Z-tt;switch(j=J<=.5?lt/(Z+tt):lt/(2-Z-tt),Z){case g:R=(T-P)/lt+(T<P?6:0);break;case T:R=(P-g)/lt+2;break;case P:R=(g-T)/lt+4;break}R/=6}return A.h=R,A.s=j,A.l=J,A}getRGB(A,y=mt.pp.workingColorSpace){return mt.pp.workingToColorSpace(q.copy(this),y),A.r=q.r,A.g=q.g,A.b=q.b,A}getStyle(A=at.er$){mt.pp.workingToColorSpace(q.copy(this),A);const y=q.r,g=q.g,T=q.b;return A!==at.er$?`color(${A} ${y.toFixed(3)} ${g.toFixed(3)} ${T.toFixed(3)})`:`rgb(${Math.round(y*255)},${Math.round(g*255)},${Math.round(T*255)})`}offsetHSL(A,y,g){return this.getHSL(D),this.setHSL(D.h+A,D.s+y,D.l+g)}add(A){return this.r+=A.r,this.g+=A.g,this.b+=A.b,this}addColors(A,y){return this.r=A.r+y.r,this.g=A.g+y.g,this.b=A.b+y.b,this}addScalar(A){return this.r+=A,this.g+=A,this.b+=A,this}sub(A){return this.r=Math.max(0,this.r-A.r),this.g=Math.max(0,this.g-A.g),this.b=Math.max(0,this.b-A.b),this}multiply(A){return this.r*=A.r,this.g*=A.g,this.b*=A.b,this}multiplyScalar(A){return this.r*=A,this.g*=A,this.b*=A,this}lerp(A,y){return this.r+=(A.r-this.r)*y,this.g+=(A.g-this.g)*y,this.b+=(A.b-this.b)*y,this}lerpColors(A,y,g){return this.r=A.r+(y.r-A.r)*g,this.g=A.g+(y.g-A.g)*g,this.b=A.b+(y.b-A.b)*g,this}lerpHSL(A,y){this.getHSL(D),A.getHSL(Y);const g=(0,I.Cc)(D.h,Y.h,y),T=(0,I.Cc)(D.s,Y.s,y),P=(0,I.Cc)(D.l,Y.l,y);return this.setHSL(g,T,P),this}setFromVector3(A){return this.r=A.x,this.g=A.y,this.b=A.z,this}applyMatrix3(A){const y=this.r,g=this.g,T=this.b,P=A.elements;return this.r=P[0]*y+P[3]*g+P[6]*T,this.g=P[1]*y+P[4]*g+P[7]*T,this.b=P[2]*y+P[5]*g+P[8]*T,this}equals(A){return A.r===this.r&&A.g===this.g&&A.b===this.b}fromArray(A,y=0){return this.r=A[y],this.g=A[y+1],this.b=A[y+2],this}toArray(A=[],y=0){return A[y]=this.r,A[y+1]=this.g,A[y+2]=this.b,A}fromBufferAttribute(A,y){return this.r=A.getX(y),this.g=A.getY(y),this.b=A.getZ(y),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const q=new M;M.NAMES=E},116898:(fe,Et,Q)=>{Q.d(Et,{dk:()=>M,pp:()=>ft,rd:()=>q});var I=Q(272790),mt=Q(914164),at=Q(472686);const E=new mt.d().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),D=new mt.d().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Y(){const O={enabled:!0,workingColorSpace:I.Zr2,spaces:{},convert:function(T,P,Z){return this.enabled===!1||P===Z||!P||!Z||(this.spaces[P].transfer===I.KLL&&(T.r=M(T.r),T.g=M(T.g),T.b=M(T.b)),this.spaces[P].primaries!==this.spaces[Z].primaries&&(T.applyMatrix3(this.spaces[P].toXYZ),T.applyMatrix3(this.spaces[Z].fromXYZ)),this.spaces[Z].transfer===I.KLL&&(T.r=q(T.r),T.g=q(T.g),T.b=q(T.b))),T},workingToColorSpace:function(T,P){return this.convert(T,this.workingColorSpace,P)},colorSpaceToWorking:function(T,P){return this.convert(T,P,this.workingColorSpace)},getPrimaries:function(T){return this.spaces[T].primaries},getTransfer:function(T){return T===I.jf0?I.VxR:this.spaces[T].transfer},getLuminanceCoefficients:function(T,P=this.workingColorSpace){return T.fromArray(this.spaces[P].luminanceCoefficients)},define:function(T){Object.assign(this.spaces,T)},_getMatrix:function(T,P,Z){return T.copy(this.spaces[P].toXYZ).multiply(this.spaces[Z].fromXYZ)},_getDrawingBufferColorSpace:function(T){return this.spaces[T].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(T=this.workingColorSpace){return this.spaces[T].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(T,P){return(0,at.mc)("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),O.workingToColorSpace(T,P)},toWorkingColorSpace:function(T,P){return(0,at.mc)("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),O.colorSpaceToWorking(T,P)}},A=[.64,.33,.3,.6,.15,.06],y=[.2126,.7152,.0722],g=[.3127,.329];return O.define({[I.Zr2]:{primaries:A,whitePoint:g,transfer:I.VxR,toXYZ:E,fromXYZ:D,luminanceCoefficients:y,workingColorSpaceConfig:{unpackColorSpace:I.er$},outputColorSpaceConfig:{drawingBufferColorSpace:I.er$}},[I.er$]:{primaries:A,whitePoint:g,transfer:I.KLL,toXYZ:E,fromXYZ:D,luminanceCoefficients:y,outputColorSpaceConfig:{drawingBufferColorSpace:I.er$}}}),O}const ft=Y();function M(O){return O<.04045?O*.0773993808:Math.pow(O*.9478672986+.0521327014,2.4)}function q(O){return O<.0031308?O*12.92:1.055*Math.pow(O,.41666)-.055}},430799:(fe,Et,Q)=>{Q.d(Et,{O:()=>Y});var I=Q(716920),mt=Q(541761),at=Q(774153);const E=new mt.k,D=new I.P;class Y{constructor(M=0,q=0,O=0,A=Y.DEFAULT_ORDER){this.isEuler=!0,this._x=M,this._y=q,this._z=O,this._order=A}get x(){return this._x}set x(M){this._x=M,this._onChangeCallback()}get y(){return this._y}set y(M){this._y=M,this._onChangeCallback()}get z(){return this._z}set z(M){this._z=M,this._onChangeCallback()}get order(){return this._order}set order(M){this._order=M,this._onChangeCallback()}set(M,q,O,A=this._order){return this._x=M,this._y=q,this._z=O,this._order=A,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(M){return this._x=M._x,this._y=M._y,this._z=M._z,this._order=M._order,this._onChangeCallback(),this}setFromRotationMatrix(M,q=this._order,O=!0){const A=M.elements,y=A[0],g=A[4],T=A[8],P=A[1],Z=A[5],tt=A[9],R=A[2],j=A[6],J=A[10];switch(q){case"XYZ":this._y=Math.asin((0,at.qE)(T,-1,1)),Math.abs(T)<.9999999?(this._x=Math.atan2(-tt,J),this._z=Math.atan2(-g,y)):(this._x=Math.atan2(j,Z),this._z=0);break;case"YXZ":this._x=Math.asin(-(0,at.qE)(tt,-1,1)),Math.abs(tt)<.9999999?(this._y=Math.atan2(T,J),this._z=Math.atan2(P,Z)):(this._y=Math.atan2(-R,y),this._z=0);break;case"ZXY":this._x=Math.asin((0,at.qE)(j,-1,1)),Math.abs(j)<.9999999?(this._y=Math.atan2(-R,J),this._z=Math.atan2(-g,Z)):(this._y=0,this._z=Math.atan2(P,y));break;case"ZYX":this._y=Math.asin(-(0,at.qE)(R,-1,1)),Math.abs(R)<.9999999?(this._x=Math.atan2(j,J),this._z=Math.atan2(P,y)):(this._x=0,this._z=Math.atan2(-g,Z));break;case"YZX":this._z=Math.asin((0,at.qE)(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(-tt,Z),this._y=Math.atan2(-R,y)):(this._x=0,this._y=Math.atan2(T,J));break;case"XZY":this._z=Math.asin(-(0,at.qE)(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(j,Z),this._y=Math.atan2(T,y)):(this._x=Math.atan2(-tt,J),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+q)}return this._order=q,O===!0&&this._onChangeCallback(),this}setFromQuaternion(M,q,O){return E.makeRotationFromQuaternion(M),this.setFromRotationMatrix(E,q,O)}setFromVector3(M,q=this._order){return this.set(M.x,M.y,M.z,q)}reorder(M){return D.setFromEuler(this),this.setFromQuaternion(D,M)}equals(M){return M._x===this._x&&M._y===this._y&&M._z===this._z&&M._order===this._order}fromArray(M){return this._x=M[0],this._y=M[1],this._z=M[2],M[3]!==void 0&&(this._order=M[3]),this._onChangeCallback(),this}toArray(M=[],q=0){return M[q]=this._x,M[q+1]=this._y,M[q+2]=this._z,M[q+3]=this._order,M}_onChange(M){return this._onChangeCallback=M,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Y.DEFAULT_ORDER="XYZ"},248056:(fe,Et,Q)=>{Q.d(Et,{P:()=>q});var I=Q(272790),mt=Q(237481),at=Q(824954),E=Q(721993),D=Q(432064);const Y=new E.i,ft=new mt.I(.5,.5),M=new at.Vector3;class q{constructor(A=new D.Z,y=new D.Z,g=new D.Z,T=new D.Z,P=new D.Z,Z=new D.Z){this.planes=[A,y,g,T,P,Z]}set(A,y,g,T,P,Z){const tt=this.planes;return tt[0].copy(A),tt[1].copy(y),tt[2].copy(g),tt[3].copy(T),tt[4].copy(P),tt[5].copy(Z),this}copy(A){const y=this.planes;for(let g=0;g<6;g++)y[g].copy(A.planes[g]);return this}setFromProjectionMatrix(A,y=I.TdN,g=!1){const T=this.planes,P=A.elements,Z=P[0],tt=P[1],R=P[2],j=P[3],J=P[4],lt=P[5],st=P[6],ht=P[7],yt=P[8],it=P[9],$=P[10],pt=P[11],dt=P[12],Ft=P[13],Wt=P[14],qt=P[15];if(T[0].setComponents(j-Z,ht-J,pt-yt,qt-dt).normalize(),T[1].setComponents(j+Z,ht+J,pt+yt,qt+dt).normalize(),T[2].setComponents(j+tt,ht+lt,pt+it,qt+Ft).normalize(),T[3].setComponents(j-tt,ht-lt,pt-it,qt-Ft).normalize(),g)T[4].setComponents(R,st,$,Wt).normalize(),T[5].setComponents(j-R,ht-st,pt-$,qt-Wt).normalize();else if(T[4].setComponents(j-R,ht-st,pt-$,qt-Wt).normalize(),y===I.TdN)T[5].setComponents(j+R,ht+st,pt+$,qt+Wt).normalize();else if(y===I.i7u)T[5].setComponents(R,st,$,Wt).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+y);return this}intersectsObject(A){if(A.boundingSphere!==void 0)A.boundingSphere===null&&A.computeBoundingSphere(),Y.copy(A.boundingSphere).applyMatrix4(A.matrixWorld);else{const y=A.geometry;y.boundingSphere===null&&y.computeBoundingSphere(),Y.copy(y.boundingSphere).applyMatrix4(A.matrixWorld)}return this.intersectsSphere(Y)}intersectsSprite(A){Y.center.set(0,0,0);const y=ft.distanceTo(A.center);return Y.radius=.7071067811865476+y,Y.applyMatrix4(A.matrixWorld),this.intersectsSphere(Y)}intersectsSphere(A){const y=this.planes,g=A.center,T=-A.radius;for(let P=0;P<6;P++)if(y[P].distanceToPoint(g)<T)return!1;return!0}intersectsBox(A){const y=this.planes;for(let g=0;g<6;g++){const T=y[g];if(M.x=T.normal.x>0?A.max.x:A.min.x,M.y=T.normal.y>0?A.max.y:A.min.y,M.z=T.normal.z>0?A.max.z:A.min.z,T.distanceToPoint(M)<0)return!1}return!0}containsPoint(A){const y=this.planes;for(let g=0;g<6;g++)if(y[g].distanceToPoint(A)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}},914164:(fe,Et,Q)=>{Q.d(Et,{d:()=>I});class I{constructor(E,D,Y,ft,M,q,O,A,y){I.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],E!==void 0&&this.set(E,D,Y,ft,M,q,O,A,y)}set(E,D,Y,ft,M,q,O,A,y){const g=this.elements;return g[0]=E,g[1]=ft,g[2]=O,g[3]=D,g[4]=M,g[5]=A,g[6]=Y,g[7]=q,g[8]=y,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(E){const D=this.elements,Y=E.elements;return D[0]=Y[0],D[1]=Y[1],D[2]=Y[2],D[3]=Y[3],D[4]=Y[4],D[5]=Y[5],D[6]=Y[6],D[7]=Y[7],D[8]=Y[8],this}extractBasis(E,D,Y){return E.setFromMatrix3Column(this,0),D.setFromMatrix3Column(this,1),Y.setFromMatrix3Column(this,2),this}setFromMatrix4(E){const D=E.elements;return this.set(D[0],D[4],D[8],D[1],D[5],D[9],D[2],D[6],D[10]),this}multiply(E){return this.multiplyMatrices(this,E)}premultiply(E){return this.multiplyMatrices(E,this)}multiplyMatrices(E,D){const Y=E.elements,ft=D.elements,M=this.elements,q=Y[0],O=Y[3],A=Y[6],y=Y[1],g=Y[4],T=Y[7],P=Y[2],Z=Y[5],tt=Y[8],R=ft[0],j=ft[3],J=ft[6],lt=ft[1],st=ft[4],ht=ft[7],yt=ft[2],it=ft[5],$=ft[8];return M[0]=q*R+O*lt+A*yt,M[3]=q*j+O*st+A*it,M[6]=q*J+O*ht+A*$,M[1]=y*R+g*lt+T*yt,M[4]=y*j+g*st+T*it,M[7]=y*J+g*ht+T*$,M[2]=P*R+Z*lt+tt*yt,M[5]=P*j+Z*st+tt*it,M[8]=P*J+Z*ht+tt*$,this}multiplyScalar(E){const D=this.elements;return D[0]*=E,D[3]*=E,D[6]*=E,D[1]*=E,D[4]*=E,D[7]*=E,D[2]*=E,D[5]*=E,D[8]*=E,this}determinant(){const E=this.elements,D=E[0],Y=E[1],ft=E[2],M=E[3],q=E[4],O=E[5],A=E[6],y=E[7],g=E[8];return D*q*g-D*O*y-Y*M*g+Y*O*A+ft*M*y-ft*q*A}invert(){const E=this.elements,D=E[0],Y=E[1],ft=E[2],M=E[3],q=E[4],O=E[5],A=E[6],y=E[7],g=E[8],T=g*q-O*y,P=O*A-g*M,Z=y*M-q*A,tt=D*T+Y*P+ft*Z;if(tt===0)return this.set(0,0,0,0,0,0,0,0,0);const R=1/tt;return E[0]=T*R,E[1]=(ft*y-g*Y)*R,E[2]=(O*Y-ft*q)*R,E[3]=P*R,E[4]=(g*D-ft*A)*R,E[5]=(ft*M-O*D)*R,E[6]=Z*R,E[7]=(Y*A-y*D)*R,E[8]=(q*D-Y*M)*R,this}transpose(){let E;const D=this.elements;return E=D[1],D[1]=D[3],D[3]=E,E=D[2],D[2]=D[6],D[6]=E,E=D[5],D[5]=D[7],D[7]=E,this}getNormalMatrix(E){return this.setFromMatrix4(E).invert().transpose()}transposeIntoArray(E){const D=this.elements;return E[0]=D[0],E[1]=D[3],E[2]=D[6],E[3]=D[1],E[4]=D[4],E[5]=D[7],E[6]=D[2],E[7]=D[5],E[8]=D[8],this}setUvTransform(E,D,Y,ft,M,q,O){const A=Math.cos(M),y=Math.sin(M);return this.set(Y*A,Y*y,-Y*(A*q+y*O)+q+E,-ft*y,ft*A,-ft*(-y*q+A*O)+O+D,0,0,1),this}scale(E,D){return this.premultiply(mt.makeScale(E,D)),this}rotate(E){return this.premultiply(mt.makeRotation(-E)),this}translate(E,D){return this.premultiply(mt.makeTranslation(E,D)),this}makeTranslation(E,D){return E.isVector2?this.set(1,0,E.x,0,1,E.y,0,0,1):this.set(1,0,E,0,1,D,0,0,1),this}makeRotation(E){const D=Math.cos(E),Y=Math.sin(E);return this.set(D,-Y,0,Y,D,0,0,0,1),this}makeScale(E,D){return this.set(E,0,0,0,D,0,0,0,1),this}equals(E){const D=this.elements,Y=E.elements;for(let ft=0;ft<9;ft++)if(D[ft]!==Y[ft])return!1;return!0}fromArray(E,D=0){for(let Y=0;Y<9;Y++)this.elements[Y]=E[Y+D];return this}toArray(E=[],D=0){const Y=this.elements;return E[D]=Y[0],E[D+1]=Y[1],E[D+2]=Y[2],E[D+3]=Y[3],E[D+4]=Y[4],E[D+5]=Y[5],E[D+6]=Y[6],E[D+7]=Y[7],E[D+8]=Y[8],E}clone(){return new this.constructor().fromArray(this.elements)}}const mt=new I},541761:(fe,Et,Q)=>{Q.d(Et,{k:()=>at});var I=Q(272790),mt=Q(824954);class at{constructor(y,g,T,P,Z,tt,R,j,J,lt,st,ht,yt,it,$,pt){at.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y!==void 0&&this.set(y,g,T,P,Z,tt,R,j,J,lt,st,ht,yt,it,$,pt)}set(y,g,T,P,Z,tt,R,j,J,lt,st,ht,yt,it,$,pt){const dt=this.elements;return dt[0]=y,dt[4]=g,dt[8]=T,dt[12]=P,dt[1]=Z,dt[5]=tt,dt[9]=R,dt[13]=j,dt[2]=J,dt[6]=lt,dt[10]=st,dt[14]=ht,dt[3]=yt,dt[7]=it,dt[11]=$,dt[15]=pt,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new at().fromArray(this.elements)}copy(y){const g=this.elements,T=y.elements;return g[0]=T[0],g[1]=T[1],g[2]=T[2],g[3]=T[3],g[4]=T[4],g[5]=T[5],g[6]=T[6],g[7]=T[7],g[8]=T[8],g[9]=T[9],g[10]=T[10],g[11]=T[11],g[12]=T[12],g[13]=T[13],g[14]=T[14],g[15]=T[15],this}copyPosition(y){const g=this.elements,T=y.elements;return g[12]=T[12],g[13]=T[13],g[14]=T[14],this}setFromMatrix3(y){const g=y.elements;return this.set(g[0],g[3],g[6],0,g[1],g[4],g[7],0,g[2],g[5],g[8],0,0,0,0,1),this}extractBasis(y,g,T){return y.setFromMatrixColumn(this,0),g.setFromMatrixColumn(this,1),T.setFromMatrixColumn(this,2),this}makeBasis(y,g,T){return this.set(y.x,g.x,T.x,0,y.y,g.y,T.y,0,y.z,g.z,T.z,0,0,0,0,1),this}extractRotation(y){const g=this.elements,T=y.elements,P=1/E.setFromMatrixColumn(y,0).length(),Z=1/E.setFromMatrixColumn(y,1).length(),tt=1/E.setFromMatrixColumn(y,2).length();return g[0]=T[0]*P,g[1]=T[1]*P,g[2]=T[2]*P,g[3]=0,g[4]=T[4]*Z,g[5]=T[5]*Z,g[6]=T[6]*Z,g[7]=0,g[8]=T[8]*tt,g[9]=T[9]*tt,g[10]=T[10]*tt,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromEuler(y){const g=this.elements,T=y.x,P=y.y,Z=y.z,tt=Math.cos(T),R=Math.sin(T),j=Math.cos(P),J=Math.sin(P),lt=Math.cos(Z),st=Math.sin(Z);if(y.order==="XYZ"){const ht=tt*lt,yt=tt*st,it=R*lt,$=R*st;g[0]=j*lt,g[4]=-j*st,g[8]=J,g[1]=yt+it*J,g[5]=ht-$*J,g[9]=-R*j,g[2]=$-ht*J,g[6]=it+yt*J,g[10]=tt*j}else if(y.order==="YXZ"){const ht=j*lt,yt=j*st,it=J*lt,$=J*st;g[0]=ht+$*R,g[4]=it*R-yt,g[8]=tt*J,g[1]=tt*st,g[5]=tt*lt,g[9]=-R,g[2]=yt*R-it,g[6]=$+ht*R,g[10]=tt*j}else if(y.order==="ZXY"){const ht=j*lt,yt=j*st,it=J*lt,$=J*st;g[0]=ht-$*R,g[4]=-tt*st,g[8]=it+yt*R,g[1]=yt+it*R,g[5]=tt*lt,g[9]=$-ht*R,g[2]=-tt*J,g[6]=R,g[10]=tt*j}else if(y.order==="ZYX"){const ht=tt*lt,yt=tt*st,it=R*lt,$=R*st;g[0]=j*lt,g[4]=it*J-yt,g[8]=ht*J+$,g[1]=j*st,g[5]=$*J+ht,g[9]=yt*J-it,g[2]=-J,g[6]=R*j,g[10]=tt*j}else if(y.order==="YZX"){const ht=tt*j,yt=tt*J,it=R*j,$=R*J;g[0]=j*lt,g[4]=$-ht*st,g[8]=it*st+yt,g[1]=st,g[5]=tt*lt,g[9]=-R*lt,g[2]=-J*lt,g[6]=yt*st+it,g[10]=ht-$*st}else if(y.order==="XZY"){const ht=tt*j,yt=tt*J,it=R*j,$=R*J;g[0]=j*lt,g[4]=-st,g[8]=J*lt,g[1]=ht*st+$,g[5]=tt*lt,g[9]=yt*st-it,g[2]=it*st-yt,g[6]=R*lt,g[10]=$*st+ht}return g[3]=0,g[7]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromQuaternion(y){return this.compose(Y,y,ft)}lookAt(y,g,T){const P=this.elements;return O.subVectors(y,g),O.lengthSq()===0&&(O.z=1),O.normalize(),M.crossVectors(T,O),M.lengthSq()===0&&(Math.abs(T.z)===1?O.x+=1e-4:O.z+=1e-4,O.normalize(),M.crossVectors(T,O)),M.normalize(),q.crossVectors(O,M),P[0]=M.x,P[4]=q.x,P[8]=O.x,P[1]=M.y,P[5]=q.y,P[9]=O.y,P[2]=M.z,P[6]=q.z,P[10]=O.z,this}multiply(y){return this.multiplyMatrices(this,y)}premultiply(y){return this.multiplyMatrices(y,this)}multiplyMatrices(y,g){const T=y.elements,P=g.elements,Z=this.elements,tt=T[0],R=T[4],j=T[8],J=T[12],lt=T[1],st=T[5],ht=T[9],yt=T[13],it=T[2],$=T[6],pt=T[10],dt=T[14],Ft=T[3],Wt=T[7],qt=T[11],me=T[15],le=P[0],ee=P[4],Le=P[8],Te=P[12],Ke=P[1],Xe=P[5],cs=P[9],Re=P[13],Ye=P[2],Qe=P[6],ts=P[10],Ae=P[14],ls=P[3],us=P[7],es=P[11],ss=P[15];return Z[0]=tt*le+R*Ke+j*Ye+J*ls,Z[4]=tt*ee+R*Xe+j*Qe+J*us,Z[8]=tt*Le+R*cs+j*ts+J*es,Z[12]=tt*Te+R*Re+j*Ae+J*ss,Z[1]=lt*le+st*Ke+ht*Ye+yt*ls,Z[5]=lt*ee+st*Xe+ht*Qe+yt*us,Z[9]=lt*Le+st*cs+ht*ts+yt*es,Z[13]=lt*Te+st*Re+ht*Ae+yt*ss,Z[2]=it*le+$*Ke+pt*Ye+dt*ls,Z[6]=it*ee+$*Xe+pt*Qe+dt*us,Z[10]=it*Le+$*cs+pt*ts+dt*es,Z[14]=it*Te+$*Re+pt*Ae+dt*ss,Z[3]=Ft*le+Wt*Ke+qt*Ye+me*ls,Z[7]=Ft*ee+Wt*Xe+qt*Qe+me*us,Z[11]=Ft*Le+Wt*cs+qt*ts+me*es,Z[15]=Ft*Te+Wt*Re+qt*Ae+me*ss,this}multiplyScalar(y){const g=this.elements;return g[0]*=y,g[4]*=y,g[8]*=y,g[12]*=y,g[1]*=y,g[5]*=y,g[9]*=y,g[13]*=y,g[2]*=y,g[6]*=y,g[10]*=y,g[14]*=y,g[3]*=y,g[7]*=y,g[11]*=y,g[15]*=y,this}determinant(){const y=this.elements,g=y[0],T=y[4],P=y[8],Z=y[12],tt=y[1],R=y[5],j=y[9],J=y[13],lt=y[2],st=y[6],ht=y[10],yt=y[14],it=y[3],$=y[7],pt=y[11],dt=y[15];return it*(+Z*j*st-P*J*st-Z*R*ht+T*J*ht+P*R*yt-T*j*yt)+$*(+g*j*yt-g*J*ht+Z*tt*ht-P*tt*yt+P*J*lt-Z*j*lt)+pt*(+g*J*st-g*R*yt-Z*tt*st+T*tt*yt+Z*R*lt-T*J*lt)+dt*(-P*R*lt-g*j*st+g*R*ht+P*tt*st-T*tt*ht+T*j*lt)}transpose(){const y=this.elements;let g;return g=y[1],y[1]=y[4],y[4]=g,g=y[2],y[2]=y[8],y[8]=g,g=y[6],y[6]=y[9],y[9]=g,g=y[3],y[3]=y[12],y[12]=g,g=y[7],y[7]=y[13],y[13]=g,g=y[11],y[11]=y[14],y[14]=g,this}setPosition(y,g,T){const P=this.elements;return y.isVector3?(P[12]=y.x,P[13]=y.y,P[14]=y.z):(P[12]=y,P[13]=g,P[14]=T),this}invert(){const y=this.elements,g=y[0],T=y[1],P=y[2],Z=y[3],tt=y[4],R=y[5],j=y[6],J=y[7],lt=y[8],st=y[9],ht=y[10],yt=y[11],it=y[12],$=y[13],pt=y[14],dt=y[15],Ft=st*pt*J-$*ht*J+$*j*yt-R*pt*yt-st*j*dt+R*ht*dt,Wt=it*ht*J-lt*pt*J-it*j*yt+tt*pt*yt+lt*j*dt-tt*ht*dt,qt=lt*$*J-it*st*J+it*R*yt-tt*$*yt-lt*R*dt+tt*st*dt,me=it*st*j-lt*$*j-it*R*ht+tt*$*ht+lt*R*pt-tt*st*pt,le=g*Ft+T*Wt+P*qt+Z*me;if(le===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ee=1/le;return y[0]=Ft*ee,y[1]=($*ht*Z-st*pt*Z-$*P*yt+T*pt*yt+st*P*dt-T*ht*dt)*ee,y[2]=(R*pt*Z-$*j*Z+$*P*J-T*pt*J-R*P*dt+T*j*dt)*ee,y[3]=(st*j*Z-R*ht*Z-st*P*J+T*ht*J+R*P*yt-T*j*yt)*ee,y[4]=Wt*ee,y[5]=(lt*pt*Z-it*ht*Z+it*P*yt-g*pt*yt-lt*P*dt+g*ht*dt)*ee,y[6]=(it*j*Z-tt*pt*Z-it*P*J+g*pt*J+tt*P*dt-g*j*dt)*ee,y[7]=(tt*ht*Z-lt*j*Z+lt*P*J-g*ht*J-tt*P*yt+g*j*yt)*ee,y[8]=qt*ee,y[9]=(it*st*Z-lt*$*Z-it*T*yt+g*$*yt+lt*T*dt-g*st*dt)*ee,y[10]=(tt*$*Z-it*R*Z+it*T*J-g*$*J-tt*T*dt+g*R*dt)*ee,y[11]=(lt*R*Z-tt*st*Z-lt*T*J+g*st*J+tt*T*yt-g*R*yt)*ee,y[12]=me*ee,y[13]=(lt*$*P-it*st*P+it*T*ht-g*$*ht-lt*T*pt+g*st*pt)*ee,y[14]=(it*R*P-tt*$*P-it*T*j+g*$*j+tt*T*pt-g*R*pt)*ee,y[15]=(tt*st*P-lt*R*P+lt*T*j-g*st*j-tt*T*ht+g*R*ht)*ee,this}scale(y){const g=this.elements,T=y.x,P=y.y,Z=y.z;return g[0]*=T,g[4]*=P,g[8]*=Z,g[1]*=T,g[5]*=P,g[9]*=Z,g[2]*=T,g[6]*=P,g[10]*=Z,g[3]*=T,g[7]*=P,g[11]*=Z,this}getMaxScaleOnAxis(){const y=this.elements,g=y[0]*y[0]+y[1]*y[1]+y[2]*y[2],T=y[4]*y[4]+y[5]*y[5]+y[6]*y[6],P=y[8]*y[8]+y[9]*y[9]+y[10]*y[10];return Math.sqrt(Math.max(g,T,P))}makeTranslation(y,g,T){return y.isVector3?this.set(1,0,0,y.x,0,1,0,y.y,0,0,1,y.z,0,0,0,1):this.set(1,0,0,y,0,1,0,g,0,0,1,T,0,0,0,1),this}makeRotationX(y){const g=Math.cos(y),T=Math.sin(y);return this.set(1,0,0,0,0,g,-T,0,0,T,g,0,0,0,0,1),this}makeRotationY(y){const g=Math.cos(y),T=Math.sin(y);return this.set(g,0,T,0,0,1,0,0,-T,0,g,0,0,0,0,1),this}makeRotationZ(y){const g=Math.cos(y),T=Math.sin(y);return this.set(g,-T,0,0,T,g,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(y,g){const T=Math.cos(g),P=Math.sin(g),Z=1-T,tt=y.x,R=y.y,j=y.z,J=Z*tt,lt=Z*R;return this.set(J*tt+T,J*R-P*j,J*j+P*R,0,J*R+P*j,lt*R+T,lt*j-P*tt,0,J*j-P*R,lt*j+P*tt,Z*j*j+T,0,0,0,0,1),this}makeScale(y,g,T){return this.set(y,0,0,0,0,g,0,0,0,0,T,0,0,0,0,1),this}makeShear(y,g,T,P,Z,tt){return this.set(1,T,Z,0,y,1,tt,0,g,P,1,0,0,0,0,1),this}compose(y,g,T){const P=this.elements,Z=g._x,tt=g._y,R=g._z,j=g._w,J=Z+Z,lt=tt+tt,st=R+R,ht=Z*J,yt=Z*lt,it=Z*st,$=tt*lt,pt=tt*st,dt=R*st,Ft=j*J,Wt=j*lt,qt=j*st,me=T.x,le=T.y,ee=T.z;return P[0]=(1-($+dt))*me,P[1]=(yt+qt)*me,P[2]=(it-Wt)*me,P[3]=0,P[4]=(yt-qt)*le,P[5]=(1-(ht+dt))*le,P[6]=(pt+Ft)*le,P[7]=0,P[8]=(it+Wt)*ee,P[9]=(pt-Ft)*ee,P[10]=(1-(ht+$))*ee,P[11]=0,P[12]=y.x,P[13]=y.y,P[14]=y.z,P[15]=1,this}decompose(y,g,T){const P=this.elements;let Z=E.set(P[0],P[1],P[2]).length();const tt=E.set(P[4],P[5],P[6]).length(),R=E.set(P[8],P[9],P[10]).length();this.determinant()<0&&(Z=-Z),y.x=P[12],y.y=P[13],y.z=P[14],D.copy(this);const J=1/Z,lt=1/tt,st=1/R;return D.elements[0]*=J,D.elements[1]*=J,D.elements[2]*=J,D.elements[4]*=lt,D.elements[5]*=lt,D.elements[6]*=lt,D.elements[8]*=st,D.elements[9]*=st,D.elements[10]*=st,g.setFromRotationMatrix(D),T.x=Z,T.y=tt,T.z=R,this}makePerspective(y,g,T,P,Z,tt,R=I.TdN,j=!1){const J=this.elements,lt=2*Z/(g-y),st=2*Z/(T-P),ht=(g+y)/(g-y),yt=(T+P)/(T-P);let it,$;if(j)it=Z/(tt-Z),$=tt*Z/(tt-Z);else if(R===I.TdN)it=-(tt+Z)/(tt-Z),$=-2*tt*Z/(tt-Z);else if(R===I.i7u)it=-tt/(tt-Z),$=-tt*Z/(tt-Z);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+R);return J[0]=lt,J[4]=0,J[8]=ht,J[12]=0,J[1]=0,J[5]=st,J[9]=yt,J[13]=0,J[2]=0,J[6]=0,J[10]=it,J[14]=$,J[3]=0,J[7]=0,J[11]=-1,J[15]=0,this}makeOrthographic(y,g,T,P,Z,tt,R=I.TdN,j=!1){const J=this.elements,lt=2/(g-y),st=2/(T-P),ht=-(g+y)/(g-y),yt=-(T+P)/(T-P);let it,$;if(j)it=1/(tt-Z),$=tt/(tt-Z);else if(R===I.TdN)it=-2/(tt-Z),$=-(tt+Z)/(tt-Z);else if(R===I.i7u)it=-1/(tt-Z),$=-Z/(tt-Z);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+R);return J[0]=lt,J[4]=0,J[8]=0,J[12]=ht,J[1]=0,J[5]=st,J[9]=0,J[13]=yt,J[2]=0,J[6]=0,J[10]=it,J[14]=$,J[3]=0,J[7]=0,J[11]=0,J[15]=1,this}equals(y){const g=this.elements,T=y.elements;for(let P=0;P<16;P++)if(g[P]!==T[P])return!1;return!0}fromArray(y,g=0){for(let T=0;T<16;T++)this.elements[T]=y[T+g];return this}toArray(y=[],g=0){const T=this.elements;return y[g]=T[0],y[g+1]=T[1],y[g+2]=T[2],y[g+3]=T[3],y[g+4]=T[4],y[g+5]=T[5],y[g+6]=T[6],y[g+7]=T[7],y[g+8]=T[8],y[g+9]=T[9],y[g+10]=T[10],y[g+11]=T[11],y[g+12]=T[12],y[g+13]=T[13],y[g+14]=T[14],y[g+15]=T[15],y}}const E=new mt.Vector3,D=new at,Y=new mt.Vector3(0,0,0),ft=new mt.Vector3(1,1,1),M=new mt.Vector3,q=new mt.Vector3,O=new mt.Vector3},432064:(fe,Et,Q)=>{Q.d(Et,{Z:()=>Y});var I=Q(914164),mt=Q(824954);const at=new mt.Vector3,E=new mt.Vector3,D=new I.d;class Y{constructor(M=new mt.Vector3(1,0,0),q=0){this.isPlane=!0,this.normal=M,this.constant=q}set(M,q){return this.normal.copy(M),this.constant=q,this}setComponents(M,q,O,A){return this.normal.set(M,q,O),this.constant=A,this}setFromNormalAndCoplanarPoint(M,q){return this.normal.copy(M),this.constant=-q.dot(this.normal),this}setFromCoplanarPoints(M,q,O){const A=at.subVectors(O,q).cross(E.subVectors(M,q)).normalize();return this.setFromNormalAndCoplanarPoint(A,M),this}copy(M){return this.normal.copy(M.normal),this.constant=M.constant,this}normalize(){const M=1/this.normal.length();return this.normal.multiplyScalar(M),this.constant*=M,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(M){return this.normal.dot(M)+this.constant}distanceToSphere(M){return this.distanceToPoint(M.center)-M.radius}projectPoint(M,q){return q.copy(M).addScaledVector(this.normal,-this.distanceToPoint(M))}intersectLine(M,q){const O=M.delta(at),A=this.normal.dot(O);if(A===0)return this.distanceToPoint(M.start)===0?q.copy(M.start):null;const y=-(M.start.dot(this.normal)+this.constant)/A;return y<0||y>1?null:q.copy(M.start).addScaledVector(O,y)}intersectsLine(M){const q=this.distanceToPoint(M.start),O=this.distanceToPoint(M.end);return q<0&&O>0||O<0&&q>0}intersectsBox(M){return M.intersectsPlane(this)}intersectsSphere(M){return M.intersectsPlane(this)}coplanarPoint(M){return M.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(M,q){const O=q||D.getNormalMatrix(M),A=this.coplanarPoint(at).applyMatrix4(M),y=this.normal.applyMatrix3(O).normalize();return this.constant=-A.dot(y),this}translate(M){return this.constant-=M.dot(this.normal),this}equals(M){return M.normal.equals(this.normal)&&M.constant===this.constant}clone(){return new this.constructor().copy(this)}}},721993:(fe,Et,Q)=>{Q.d(Et,{i:()=>Y});var I=Q(523006),mt=Q(824954);const at=new I.Box3,E=new mt.Vector3,D=new mt.Vector3;class Y{constructor(M=new mt.Vector3,q=-1){this.isSphere=!0,this.center=M,this.radius=q}set(M,q){return this.center.copy(M),this.radius=q,this}setFromPoints(M,q){const O=this.center;q!==void 0?O.copy(q):at.setFromPoints(M).getCenter(O);let A=0;for(let y=0,g=M.length;y<g;y++)A=Math.max(A,O.distanceToSquared(M[y]));return this.radius=Math.sqrt(A),this}copy(M){return this.center.copy(M.center),this.radius=M.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(M){return M.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(M){return M.distanceTo(this.center)-this.radius}intersectsSphere(M){const q=this.radius+M.radius;return M.center.distanceToSquared(this.center)<=q*q}intersectsBox(M){return M.intersectsSphere(this)}intersectsPlane(M){return Math.abs(M.distanceToPoint(this.center))<=this.radius}clampPoint(M,q){const O=this.center.distanceToSquared(M);return q.copy(M),O>this.radius*this.radius&&(q.sub(this.center).normalize(),q.multiplyScalar(this.radius).add(this.center)),q}getBoundingBox(M){return this.isEmpty()?(M.makeEmpty(),M):(M.set(this.center,this.center),M.expandByScalar(this.radius),M)}applyMatrix4(M){return this.center.applyMatrix4(M),this.radius=this.radius*M.getMaxScaleOnAxis(),this}translate(M){return this.center.add(M),this}expandByPoint(M){if(this.isEmpty())return this.center.copy(M),this.radius=0,this;E.subVectors(M,this.center);const q=E.lengthSq();if(q>this.radius*this.radius){const O=Math.sqrt(q),A=(O-this.radius)*.5;this.center.addScaledVector(E,A/O),this.radius+=A}return this}union(M){return M.isEmpty()?this:this.isEmpty()?(this.copy(M),this):(this.center.equals(M.center)===!0?this.radius=Math.max(this.radius,M.radius):(D.subVectors(M.center,this.center).setLength(M.radius),this.expandByPoint(E.copy(M.center).add(D)),this.expandByPoint(E.copy(M.center).sub(D))),this)}equals(M){return M.center.equals(this.center)&&M.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(M){return this.radius=M.radius,this.center.fromArray(M.center),this}}},237481:(fe,Et,Q)=>{Q.d(Et,{I:()=>mt});var I=Q(774153);class mt{constructor(E=0,D=0){mt.prototype.isVector2=!0,this.x=E,this.y=D}get width(){return this.x}set width(E){this.x=E}get height(){return this.y}set height(E){this.y=E}set(E,D){return this.x=E,this.y=D,this}setScalar(E){return this.x=E,this.y=E,this}setX(E){return this.x=E,this}setY(E){return this.y=E,this}setComponent(E,D){switch(E){case 0:this.x=D;break;case 1:this.y=D;break;default:throw new Error("index is out of range: "+E)}return this}getComponent(E){switch(E){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+E)}}clone(){return new this.constructor(this.x,this.y)}copy(E){return this.x=E.x,this.y=E.y,this}add(E){return this.x+=E.x,this.y+=E.y,this}addScalar(E){return this.x+=E,this.y+=E,this}addVectors(E,D){return this.x=E.x+D.x,this.y=E.y+D.y,this}addScaledVector(E,D){return this.x+=E.x*D,this.y+=E.y*D,this}sub(E){return this.x-=E.x,this.y-=E.y,this}subScalar(E){return this.x-=E,this.y-=E,this}subVectors(E,D){return this.x=E.x-D.x,this.y=E.y-D.y,this}multiply(E){return this.x*=E.x,this.y*=E.y,this}multiplyScalar(E){return this.x*=E,this.y*=E,this}divide(E){return this.x/=E.x,this.y/=E.y,this}divideScalar(E){return this.multiplyScalar(1/E)}applyMatrix3(E){const D=this.x,Y=this.y,ft=E.elements;return this.x=ft[0]*D+ft[3]*Y+ft[6],this.y=ft[1]*D+ft[4]*Y+ft[7],this}min(E){return this.x=Math.min(this.x,E.x),this.y=Math.min(this.y,E.y),this}max(E){return this.x=Math.max(this.x,E.x),this.y=Math.max(this.y,E.y),this}clamp(E,D){return this.x=(0,I.qE)(this.x,E.x,D.x),this.y=(0,I.qE)(this.y,E.y,D.y),this}clampScalar(E,D){return this.x=(0,I.qE)(this.x,E,D),this.y=(0,I.qE)(this.y,E,D),this}clampLength(E,D){const Y=this.length();return this.divideScalar(Y||1).multiplyScalar((0,I.qE)(Y,E,D))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(E){return this.x*E.x+this.y*E.y}cross(E){return this.x*E.y-this.y*E.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(E){const D=Math.sqrt(this.lengthSq()*E.lengthSq());if(D===0)return Math.PI/2;const Y=this.dot(E)/D;return Math.acos((0,I.qE)(Y,-1,1))}distanceTo(E){return Math.sqrt(this.distanceToSquared(E))}distanceToSquared(E){const D=this.x-E.x,Y=this.y-E.y;return D*D+Y*Y}manhattanDistanceTo(E){return Math.abs(this.x-E.x)+Math.abs(this.y-E.y)}setLength(E){return this.normalize().multiplyScalar(E)}lerp(E,D){return this.x+=(E.x-this.x)*D,this.y+=(E.y-this.y)*D,this}lerpVectors(E,D,Y){return this.x=E.x+(D.x-E.x)*Y,this.y=E.y+(D.y-E.y)*Y,this}equals(E){return E.x===this.x&&E.y===this.y}fromArray(E,D=0){return this.x=E[D],this.y=E[D+1],this}toArray(E=[],D=0){return E[D]=this.x,E[D+1]=this.y,E}fromBufferAttribute(E,D){return this.x=E.getX(D),this.y=E.getY(D),this}rotateAround(E,D){const Y=Math.cos(D),ft=Math.sin(D),M=this.x-E.x,q=this.y-E.y;return this.x=M*Y-q*ft+E.x,this.y=M*ft+q*Y+E.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}},472686:(fe,Et,Q)=>{Q.d(Et,{AQ:()=>at,je:()=>O,lP:()=>ft,mc:()=>q,qq:()=>Y});function I(g){if(g.length===0)return 1/0;let T=g[0];for(let P=1,Z=g.length;P<Z;++P)g[P]<T&&(T=g[P]);return T}function mt(g){if(g.length===0)return-1/0;let T=g[0];for(let P=1,Z=g.length;P<Z;++P)g[P]>T&&(T=g[P]);return T}function at(g){for(let T=g.length-1;T>=0;--T)if(g[T]>=65535)return!0;return!1}const E={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function D(g,T){return new E[g](T)}function Y(g){return document.createElementNS("http://www.w3.org/1999/xhtml",g)}function ft(){const g=Y("canvas");return g.style.display="block",g}const M={};function q(g){g in M||(M[g]=!0,console.warn(g))}function O(g,T,P){return new Promise(function(Z,tt){function R(){switch(g.clientWaitSync(T,g.SYNC_FLUSH_COMMANDS_BIT,0)){case g.WAIT_FAILED:tt();break;case g.TIMEOUT_EXPIRED:setTimeout(R,P);break;default:Z()}}setTimeout(R,P)})}function A(g){const T=g.elements;T[2]=.5*T[2]+.5*T[3],T[6]=.5*T[6]+.5*T[7],T[10]=.5*T[10]+.5*T[11],T[14]=.5*T[14]+.5*T[15]}function y(g){const T=g.elements;T[11]===-1?(T[10]=-T[10]-1,T[14]=-T[14]):(T[10]=-T[10],T[14]=-T[14]+1)}}}]);

//# sourceMappingURL=PlayerThreeJsWorldView.7cdfc43fa102a0aa3519.chunk.js.map