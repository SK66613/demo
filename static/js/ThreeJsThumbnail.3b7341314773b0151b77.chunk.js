(self.webpackChunkvisme_web=self.webpackChunkvisme_web||[]).push([[5292],{59770:(j,f,s)=>{var o=s(997201),c=s(383758);function u(h,i,n){var g=h==null?0:h.length;return g?(i=n||i===void 0?1:c(i),o(h,i<0?0:i,g)):[]}j.exports=u},745856:(j,f,s)=>{"use strict";s.r(f),s.d(f,{default:()=>P});var o=s(411855),c=s(55946),u=s(491530),h=s(72924),i=s(432563),n=s(833085);const g={container:"container--WzyguO5"};var A=s(333515);const C=a=>{let{object:r,child:e,thumbBase64:d}=a;const{appStore:m}=(0,u.g)(),l=(0,o.useRef)(null);return(0,A.A)(l,r.flipX,!1,m.settings.mode),o.createElement("img",{ref:l,alt:e.name,src:d||e.previewStaticURL||e.pose.previewUrl,height:r.height})},D=(0,c.PA)(C),O=a=>{let{vismeObject:r,modelUrl:e,cachedAssets:d,camera:m,onDone:l}=a;const v={useDefaultCamera:!0,backgroundTransparent:!0,camera:m};return i.f.generateVismeObjectImage({vismeObject:r,vismeObjectPoseUrl:e,sceneConfig:v,cachedAssets:d,useRandomBackground:!1}).then(l)},I=a=>{let{object:r,child:e}=a;var d,m,l;const{appStore:v}=(0,u.g)(),p=v==null||(d=v.vismeObjectsStore)===null||d===void 0?void 0:d.characterEditorStore,[R,J]=(0,o.useState)(""),[B,T]=(0,o.useState)(!1),L=(m=v.settings)===null||m===void 0?void 0:m.isEditorMode,M=(l=v.settings)===null||l===void 0?void 0:l.isDocumentView,U=e.type===n.u.CHARACTER,V=e.type===n.u.WIDGET,t=e.isCharacterEdited&&r.isSelected&&p?p?.character:e.threeJsCharacter;return(0,o.useEffect)(()=>{let b=!1;return(async()=>{if(V){await O({vismeObject:e,modelUrl:e.modelUrl,cachedAssets:[],camera:{position:[0,1.2,3.5],rotation:[0,0,0]},onDone:y=>{b||J(y)}}),b||T(!0);return}if(!L&&!M||!e?.isAssetsLoaded&&U||!e?.cachedAssets&&U){T(!0);return}if(U&&t){await O({vismeObject:t,modelUrl:e.modelUrl,cachedAssets:e.cachedAssets,camera:{position:[0,.83,2.5],rotation:[0,0,0]},onDone:y=>{b||J(y)}}),b||T(!0);return}T(!0)})(),()=>{b=!0}},[e?.modelUrl,e?.isAssetsLoaded,t?.style,t?.gender,t?.skinTone,t?.eyeColor,JSON.stringify(t?.characterAssetsColors),JSON.stringify(t?.assets),JSON.stringify(e?.colors)]),o.createElement("div",{className:g.container},B?o.createElement(D,{object:r,child:e,thumbBase64:R}):o.createElement(h.A,null))},E=(0,c.PA)(I),S=a=>{let{object:r}=a;return o.createElement(o.Fragment,null,r.allChildren.map(e=>o.createElement(E,{key:e.id,child:e,object:r})))},P=(0,c.PA)(S)},432563:(j,f,s)=>{"use strict";s.d(f,{f:()=>i});var o=s(59770),c=s.n(o),u=s(114317);const i=u.types.model("VismeObjectImageGeneratorStore").volatile(()=>({counter:0,generationQueue:[]})).views(()=>({get isDebug(){return window.location.hash==="#debugAvatar"}})).actions(n=>({shiftQueue(){n.generationQueue=c()(n.generationQueue)}})).actions(n=>({generateVismeObjectImage:(0,u.flow)(function*(g){let{vismeObject:A,vismeObjectPoseUrl:C,sceneConfig:D,cachedAssets:O,useRandomBackground:I=!0}=g,E=null,S=null;const P=new Promise((r,e)=>{E=r,S=e}),a={vismeObject:A,vismeObjectPoseUrl:C,useRandomBackground:I,sceneConfig:D,cachedAssets:O,resolvePromise:E,rejectPromise:S,queueOrder:n.counter};return n.counter++,n.generationQueue=[...n.generationQueue,a],yield P.finally(()=>{n.isDebug||n.shiftQueue()})})})).create()}}]);

//# sourceMappingURL=ThreeJsThumbnail.3b7341314773b0151b77.chunk.js.map